## Problem

Currently the Tevm api is not intuitive. Users are often not realizing they must mine a tx before it is actually included in the blockchain. To help fix this we want to do following:

1. Deprecate the `createTransaction` parameter and replace it with `addToMempool`.
2. Add a new parameter `addToBlockchain`. This should trigger both `addToMempool` and `miningMode: {type: "auto"}` such that it automatically mines the tx at the end of `callHandler`
3. We should update the docs to very early have a warning that Tevm MemoryClient and TevmNode defaults to miningMode 'manual' which means transactions are not included in the chain until you call `client.tevmMine()`

## Requirements

- `addToMempool` should do the same thing `createTransaction` currently does
- `addToBlockchain` must trigger `miningMode: 'auto'` to be forced on for just that call. Importantally, it shouldn't mine the tx already in mempool. We will have to look at the implementation to find cleanest way to do this.
- We should update the docs
- Anytime createTransaction is included please log a deprecation warning using the tevm logger

## Context

### What calls need to be updated

There are many call-like actions such as tevmCall, tevmContract, tevmDeploy. There are also tevmNode actions like callHandler contractHandler and deployHandler. ALl call-like methods, however call out to callHandler. If we update callHandler.js in the tevm/actions package it will update for all calls since all calls use callHandler under the hood.

### What else needs to be updated too?

This change will require a few extra tasks.

1. You will need to add a changeset to the .changeset folder for `tevm/actions`, `tevm`, and `tevm/memory-client` packages for a minor change (not major since we are in prerelease)
2. You will need to add tests for addToBlockchain to memory-client package and actions package
3. You will need to grep for all createTransaction calls in .js and .ts files to either update the property name. If we have a function or file named createTransaction don't update that though
4. You will have to run `pnpm generate:docs` from root of repo to regenerate the docs
5. You will need to search docs/node/\*_/_.mdx for any docs that need to be updated
6. You will want to make sure the entire repo builds using `pnpm run build`

### Tests

Run any test for a specific package via running `pnpm test:coverage @tevm/actions` to run the actions package.

- We should keep at least 1 test using createTransaction in both tevm/actions package and tevm/memory-client package but also add one using addToMempool
- Also add a test for addToBlockchain. The client should be miningMode: {type: 'manual'}. We assert the tx is not in mempool after and we assert that the tx did update the value of SimpleContract. SimpleContract is a simple contract we often use in tests.
- Add some tx to mempool and then use addToBlockchain. Assert that the tx we already added to the mempool don't get included.

### Docs

Most docs are autogenerated so don't bother updating them but docs/node/\*_/_.mdx has handwritten docs. Here is where we should update the docs. The warning should be prominent and early in the getting started docs because it's such a common issue. And we must remove any docs mentions to createTransaction

## Context loading

Before starting please load important files into context. These files are the following:

- `callHandler.js`
- `callHandler.spec.ts`
- `CallParams.ts`
- `CallResult.ts`

There will be other files too but most of your work will be relative to these files.

## Committing

Do not commit I will commit when you are done.

## Code review

The below section was created after producing a diff and reviewing the pr.

### `true`: Alias for `on-success` should be `always`

Everywhere where we use true as an alias for on-success we should instead have it be alias for always. We should double check that mining mode works same way in tevmCall.

### Unfinished test

```ts
// Skipping this test until we can better understand the transactions behavior
// Our focus is on making addToMempool and addToBlockchain work
it.skip("should not mine existing transactions when using addToBlockchain", async () => {});
```

We should make sure this test passes as it is important requirement for this feature that we should not mine existing

### Wierd if statement

Below we don't need to check addToMempool and addToBlockchain

```js
  // Log deprecation warning if createTransaction is used
  if (
    params.createTransaction !== undefined // &&
    // params.addToMempool === undefined &&
    // params.addToBlockchain === undefined
  ) {}
  )
```

### Bad else statement handling mining

In this code the else statement should not be an else it should be just an if statement for shouldAddToChain. And based on our requirements we should handle shouldAddToChain only via using this specific transaction and not entire mempool in the mining logic.

```ts
          // Handle automining or gas mining based on configuration
          const miningRes = (await handleAutomining(client, txHash, isGasMining)) ?? {}
          // Handle immediate mining if addToBlockchain is true
          if (shouldAddToChain && txHash) {
              // We need to mine the transaction with auto mode
              // For type safety, we'll continue to use the existing client
              // but tell handleAutomining to force mining regardless of config

              // Use true for isGasMining to force mining regardless of client mining mode
              const autoMiningResult = await handleAutomining(client, txHash, true)

            // Check for errors in the transaction creation and mining results
              // Handle any errors from mining
              if (autoMiningResult?.errors) {
                  errors.push(.../** @type {any} */ (autoMiningResult.errors))
                }
            } else {
              // Handle regular automining based on configuration
              const regularMiningResult = await handleAutomining(client, txHash, isGasMining)

              // Handle any errors from mining
              if (regularMiningResult?.errors) {
                  errors.push(.../** @type {any} */ (regularMiningResult.errors))
                }
            }

          // C
      }
    }
      }
    }
```

### Should throw if ambigous

If we set both addToMempool and addToBlockchain at the same time we should throw for invalid params. This should happen in the function we validate params in.

### Make sure we default to always for true

Just a reminder to update these javascript files
