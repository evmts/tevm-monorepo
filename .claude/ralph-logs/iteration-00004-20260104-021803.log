# Ralph Migration Log - Iteration 4
Date: 2026-01-04

## Migration Target
- Package: @tevm/utils
- Function: hexToNumber
- From: viem/utils
- To: native implementation (reusing hexToBigInt)

## Changes Made
1. Modified `packages/utils/src/viem.js`:
   - Removed `hexToNumber` from viem/utils import list
   - Added native `hexToNumber` function implementation
   - Implementation reuses hexToBigInt for the conversion
   - Added safe integer range check (throws if outside MAX/MIN_SAFE_INTEGER)
   - Supports signed integer conversion via options

2. Modified `packages/utils/src/viem.spec.ts`:
   - Added comprehensive test suite for all native implementations
   - Tests for bytesToHex edge cases (empty, single byte)
   - Tests for hexToBytes edge cases (empty, odd-length, invalid)
   - Tests for hexToBigInt edge cases (empty, signed integers)
   - Tests for hexToNumber edge cases (zero, signed, overflow)

## Tests Passed
- packages/utils/src/viem.spec.ts (19 tests, up from 8)
- All 69 tests in @tevm/utils pass
- 100% code coverage achieved

## Notes
- hexToNumber reuses hexToBigInt internally for DRY code
- Added safe integer range check which viem also does
- Comprehensive test coverage added for all native implementations
- Previous iterations lacked full test coverage; this fixes that

## Remaining viem imports in @tevm/utils/src/viem.js (40 remaining):
- boolToBytes, boolToHex, bytesToBigInt, bytesToBigint, bytesToBool, bytesToNumber
- decodeAbiParameters, decodeErrorResult, decodeEventLog, decodeFunctionData, decodeFunctionResult
- encodeAbiParameters, encodeDeployData, encodeErrorResult, encodeEventTopics
- encodeFunctionData, encodeFunctionResult, encodePacked
- formatEther, formatGwei, formatLog
- fromBytes, fromHex, fromRlp
- getAddress, hexToBool, hexToString
- isAddress, isBytes, isHex, keccak256
- numberToHex, parseEther, parseGwei, serializeTransaction, stringToHex
- toBytes, toHex, toRlp
- mnemonicToAccount (from viem/accounts)

## Next Steps
Possible next targets (simple conversions):
- numberToHex (inverse of hexToNumber, should be simple)
- boolToHex, hexToBool (very simple boolean conversions)
- isHex (validation function)

## Commit
695546c3d - âš¡ refactor(utils): replace viem hexToNumber with native implementation
