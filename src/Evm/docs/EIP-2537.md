# EIP-2537: BLS12-381 Curve Operations

## Overview

EIP-2537 introduces precompiled contracts for BLS12-381 elliptic curve operations. These operations are critical for various cryptographic protocols, particularly those related to zero-knowledge proofs and BLS (Boneh-Lynn-Shacham) signatures.

The BLS12-381 curve was designed specifically for efficient pairing-based cryptography and is widely used in blockchain applications, including Ethereum 2.0's consensus mechanism.

## Implementation Details

### Precompiled Contracts

Seven new precompiled contracts have been added at addresses from `0x0b` to `0x11` (activated in the Prague hard fork):

1. **G1Add** (`0x0b`): Addition of two points on the BLS12-381 G1 curve
2. **G1MultiExp** (`0x0c`): Multi-exponentiation on the BLS12-381 G1 curve
3. **G2Add** (`0x0d`): Addition of two points on the BLS12-381 G2 curve
4. **G2MultiExp** (`0x0e`): Multi-exponentiation on the BLS12-381 G2 curve
5. **Pairing** (`0x0f`): Pairing check between G1 and G2 points
6. **MapG1** (`0x10`): Maps a field element to a point on the G1 curve
7. **MapG2** (`0x11`): Maps a field element to a point on the G2 curve

### Point Encoding

Points on the BLS12-381 curves are encoded as follows:

- **G1 Points**: 128 bytes (two field elements, each 64 bytes including padding)
- **G2 Points**: 256 bytes (four field elements, each 64 bytes including padding)

Each field element is encoded in big-endian format with the top 16 bytes being zero (padded from 48 bytes).

### Gas Costs

- **G1Add**: 500 gas
- **G1MultiExp**: Variable, based on input size with a discount table
- **G2Add**: 800 gas
- **G2MultiExp**: Variable, based on input size with a discount table
- **Pairing**: 115,000 base gas + 23,000 gas per pair
- **MapG1**: 5,500 gas
- **MapG2**: 110,000 gas

## Current Implementation Status

The current implementation provides the basic structure and gas calculation for the BLS12-381 precompiled contracts. Due to the complexity of cryptographic operations on the BLS12-381 curve, the actual cryptographic operations are currently placeholder implementations.

### Key Components Implemented:

1. **Input Validation**: Proper validation of input lengths and field element encodings
2. **Special Case Handling**: Handling of special cases like point at infinity
3. **Gas Calculation**: Accurate gas cost computation per the EIP specification
4. **Error Handling**: Appropriate error types for invalid inputs
5. **Test Suite**: Basic tests for functionality and edge cases

### TODO Items:

1. **Cryptographic Library Integration**: A BLS12-381 implementation library needs to be integrated to perform the actual cryptographic operations
2. **Complete Point Validation**: Full validation including subgroup checks
3. **Performance Optimization**: Optimize for common cases and minimize memory allocation
4. **Comprehensive Test Vectors**: Add more test vectors from the Ethereum test suite

## Usage Examples

### G1 Point Addition

```solidity
// Add two G1 points
bytes memory result = staticcall(gas(), 0x0b, input, 256, output, 128);
```

Where `input` is 256 bytes containing two G1 points (128 bytes each), and `output` will contain the resulting G1 point (128 bytes).

### Pairing Check

```solidity
// Check pairing
bytes memory result = staticcall(gas(), 0x0f, input, k*384, output, 32);
```

Where `input` is `k*384` bytes containing `k` pairs of G1 and G2 points, and `output` will be 32 bytes with the least significant byte being 1 for valid pairings and 0 for invalid ones.

## References

- [EIP-2537 Specification](https://eips.ethereum.org/EIPS/eip-2537)
- [BLS12-381 Curve Documentation](https://hackmd.io/@benjaminion/bls12-381)
- [Ethereum EIPs Repository](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2537.md)