---
title: WhatsABI Integration
description: Access WhatsABI functionality through Tevm to analyze contract bytecode and resolve proxy implementations
---

import { Callout, Steps } from 'vocs/components'
import { TabGroup } from '../../../components'

# WhatsABI Integration

<Callout type="warning" emoji="üöß">
  **Coming Soon**: The WhatsABI integration is currently under development and not yet available in the latest released version. This documentation outlines the planned API design for the upcoming feature.
</Callout>

<Callout type="info" emoji="üîç">
  The WhatsABI action will provide a convenient way to analyze contract bytecode, discover function selectors, and resolve proxy contracts - all through the familiar Tevm API.
</Callout>

## Overview

[WhatsABI](https://github.com/shazow/whatsabi) is a powerful library that can extract ABI information from contract bytecode, even for unverified contracts. Tevm will integrate WhatsABI functionality through a Viem-compatible action, allowing you to:

- Discover function selectors from bytecode
- Look up function signatures from selectors
- Automatically resolve proxy contracts
- Access verified contract ABIs from Sourcify, Etherscan, and other sources

<div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '1rem', margin: '1rem 0'}}>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üß© Works with Unverified Contracts</h3>
    <p>Extract function selectors directly from bytecode</p>
  </div>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üîÑ Resolves Proxy Implementations</h3>
    <p>Automatically detects and follows proxy patterns</p>
  </div>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üìö Uses Multiple Sources</h3>
    <p>Combines Sourcify, Etherscan and bytecode analysis</p>
  </div>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üõ†Ô∏è Fully Typed API</h3>
    <p>Complete TypeScript support for parameters and results</p>
  </div>
</div>

## Proposed Usage

<TabGroup items={['Tree-shakable API (Proposed)', 'Client Extension API (Proposed)']}>
  <div data-title="Tree-shakable API (Proposed)">
    ```ts showLineNumbers {1,3-4,7-14,16-17} filename="whatsabi-tree-shakable.ts"
    import { whatsabi, createMemoryClient, http } from 'tevm'
    
    const client = createMemoryClient({ // [!code focus]
      fork: { transport: http('https://mainnet.optimism.io') } // [!code focus]
    })
    
    const { // [!code focus]
      abi,           // The resolved ABI  // [!code focus]
      address,       // The contract address (may differ if proxies were followed) // [!code focus]
      hasCode,       // Whether the address has deployed code // [!code focus]
      proxies,       // Array of detected proxy resolvers // [!code focus]
      followProxies, // Function to follow proxies if detected // [!code focus]
      contractResult // Optional full contract metadata // [!code focus]
    } = await whatsabi(client, { // [!code focus]
      address: '0x00000000006c3852cbEf3e08E8dF289169EdE581', // Seaport contract
      followProxies: true
    })
    
    console.log(`Resolved ${proxies.length} proxies`) // [!code focus]
    console.log(`ABI has ${abi.length} entries`) // [!code focus]
    ```
  </div>
  
  <div data-title="Client Extension API (Proposed)">
    ```ts showLineNumbers {1-2,4-6,9-12,14} filename="whatsabi-extension.ts"
    import { createClient, whatsabiExtension } from 'tevm' // [!code focus]
    import { http } from 'viem' // [!code focus]
    
    const client = createClient({ // [!code focus]
      transport: http('https://mainnet.optimism.io') // [!code focus]
    }).extend(whatsabiExtension()) // [!code focus]
    
    // Now available as a method on the client
    const result = await client.whatsabi({ // [!code focus]
      address: '0x00000000006c3852cbEf3e08E8dF289169EdE581', // [!code focus]
      followProxies: true // [!code focus]
    }) // [!code focus]
    
    console.log(`Contract has ${result.abi.length} ABI entries`) // [!code focus]
    ```
  </div>
</TabGroup>

## How It Works

<Steps>
### 1. Bytecode Analysis

WhatsABI extracts function selectors from the contract's bytecode by analyzing jump tables and other bytecode patterns. This works for any contract, even if it's not verified on block explorers.

### 2. Signature Lookup

The extracted function selectors are looked up in signature databases to match known function signatures. This helps identify common functions like `transfer`, `approve`, etc.

### 3. Proxy Detection

WhatsABI checks for common proxy patterns (ERC-1967, Transparent, Beacon, etc.) and can automatically resolve and follow these implementations.

### 4. On-chain Source Verification

WhatsABI attempts to find verified contract sources from Sourcify, Etherscan, and other sources based on the client's chain ID.
</Steps>

## Parameters

The `whatsabi` action accepts the following parameters:

| Parameter | Type | Description |
|-----------|------|-------------|
| `address` | `Address` | **Required**. The contract address to analyze |
| `followProxies` | `boolean` | Whether to automatically follow proxy contracts. Default: `false` |
| `loadContractResult` | `boolean` | Whether to load full contract metadata. Default: `false` |
| `enableExperimentalMetadata` | `boolean` | Whether to include experimental metadata like event topics. Default: `false` |
| `abiLoader` | `ABILoader \| false` | Custom ABI loader or `false` to disable. Default: uses WhatsABI's default loader |
| `signatureLookup` | `SignatureLookup \| false` | Custom signature lookup or `false` to disable. Default: uses WhatsABI's default lookup |
| `onProgress` | `(phase: string, ...args: any[]) => void` | Progress callback |
| `onError` | `(phase: string, error: Error) => boolean \| void` | Error callback |

## Return Value

The action returns an object with the following properties:

| Property | Type | Description |
|----------|------|-------------|
| `abi` | `Abi` | The resolved ABI from bytecode or verified sources |
| `address` | `Address` | The contract address (may be different if proxies were followed) |
| `hasCode` | `boolean` | Whether the address has deployed code |
| `proxies` | `Array<{name: string, implementation?: Address, selector?: string}>` | Array of detected proxy resolvers |
| `followProxies` | `(selector?: string) => Promise<WhatsAbiResult>` | Function to follow proxies if detected |
| `contractResult` | `ContractResult` | Full contract metadata (if `loadContractResult: true`) |
| `abiLoadedFrom` | `{name: string, url?: string}` | If the ABI was loaded from a verified source |
| `isFactory` | `boolean` | Experimental flag indicating if this might be a factory contract |

## Examples

### Resolving a Proxy Contract

```ts showLineNumbers {1-2,4,6-10,12-14} filename="proxy-resolution.ts"
import { whatsabi, createMemoryClient } from 'tevm'
import { http } from 'viem'

const client = createMemoryClient({ fork: { transport: http('https://mainnet.infura.io/v3/YOUR-KEY') } })

// Analyze a proxy contract (e.g., a typical ERC-1967 proxy)
const result = await whatsabi(client, {
  address: '0x4f8AD938eBA0CD19155a835f617317a6E788c868',
  followProxies: true
})

console.log(`Original address: 0x4f8AD938eBA0CD19155a835f617317a6E788c868`)
console.log(`Implementation address: ${result.address}`)
console.log(`Detected proxies: ${result.proxies.length}`)
```

<Callout type="note">
  In this example, if the contract at 0x4f8AD... is a proxy, WhatsABI will detect it and automatically follow the implementation. The returned `address` will be the implementation address, not the proxy address.
</Callout>

### Working with Unverified Contracts

```ts showLineNumbers {1-2,4,6-11,13-16} filename="unverified-contract.ts"
import { whatsabi, createMemoryClient } from 'tevm'
import { http } from 'viem'

const client = createMemoryClient({ fork: { transport: http('https://mainnet.infura.io/v3/YOUR-KEY') } })

// Analyze an unverified contract to extract its interface
const result = await whatsabi(client, {
  address: '0xUnverifiedContractAddress',
  // Disable ABI loaders since the contract is unverified
  abiLoader: false
})

// The resulting ABI will contain entries discovered through bytecode analysis
console.log('Discovered function selectors:')
result.abi
  .filter(item => item.type === 'function')
  .forEach(func => console.log(`- ${func.selector}: ${func.name || 'Unknown'}`))
```

### Loading Full Contract Metadata

```ts showLineNumbers {1-2,4,6-10,12-22} filename="contract-metadata.ts"
import { whatsabi, createMemoryClient } from 'tevm'
import { http } from 'viem'

const client = createMemoryClient({ fork: { transport: http('https://mainnet.infura.io/v3/YOUR-KEY') } })

// Get full contract metadata including sources if available
const result = await whatsabi(client, {
  address: '0xVerifiedContractAddress',
  loadContractResult: true
})

if (result.contractResult) {
  console.log(`Contract name: ${result.contractResult.name}`)
  console.log(`Compiler version: ${result.contractResult.compiler?.version}`)
  
  // Sources are available if the contract is verified
  if (result.contractResult.sources) {
    for (const [path, content] of Object.entries(result.contractResult.sources)) {
      console.log(`Source file: ${path}`)
      // Access source code with content
    }
  }
}
```

### Progress Tracking for Large Contracts

```ts showLineNumbers {5-14,17-21} filename="progress-tracking.ts"
import { whatsabi, createMemoryClient } from 'tevm'
import { http } from 'viem'

// Custom progress tracker
const progressTracker = (phase, ...args) => {
  switch (phase) {
    case 'bytecode':
      console.log('Analyzing bytecode...')
      break
    case 'proxy':
      console.log('Checking for proxy patterns...')
      break
    case 'abi':
      console.log('Loading ABI information...')
      break
  }
}

const result = await whatsabi(client, {
  address: '0xLargeContractAddress',
  followProxies: true,
  onProgress: progressTracker
})
```

## When to Use WhatsABI

- When working with unverified contracts
- When you need to automatically resolve proxy implementations
- When building tools that need to interact with arbitrary contracts
- For analyzing contract interfaces without source code
- For identifying proxy patterns in contracts

<div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1.5rem', backgroundColor: 'var(--vocs-color_background2)', margin: '1.5rem 0'}}>
  <h3 style={{marginTop: 0}}>Common Use Cases</h3>
  
  <ul style={{paddingLeft: '1.5rem'}}>
    <li><strong>DApp Browsers</strong> - Interact with contracts without prior knowledge of their ABI</li>
    <li><strong>Smart Contract Explorers</strong> - Analyze and display contract information on-the-fly</li>
    <li><strong>Development Tools</strong> - Automatically handle proxies during testing and debugging</li>
    <li><strong>Chain Explorers</strong> - Enhanced contract interaction capabilities</li>
    <li><strong>Wallet Interfaces</strong> - Better UX when interacting with arbitrary contracts</li>
  </ul>
</div>

<Callout type="tip">
  WhatsABI is perfect for building exploratory tools, frontends that can work with any contract, or for debugging contract interactions. It enables "magic" experiences where users can interact with contracts without needing to know their interface details.
</Callout>

<div style={{marginTop: '2rem', padding: '1rem', border: '1px solid var(--vocs-color_primary)', borderRadius: '8px', backgroundColor: 'var(--vocs-color_background2)'}}>
  <h2 style={{marginTop: 0}}>Feedback Welcome</h2>
  <p>This API design is currently in the planning phase. If you have suggestions, feature requests, or other feedback about the proposed WhatsABI integration, please share your thoughts in our <a href="https://github.com/evmts/tevm-monorepo/issues/new?labels=enhancement&template=feature_request.md&title=%5BFeature%5D%3A+WhatsABI+Integration+Feedback" target="_blank" rel="noopener noreferrer">GitHub repository</a> or <a href="https://t.me/+ANThR9bHDLAwMjUx" target="_blank" rel="noopener noreferrer">Telegram community</a>.</p>
</div>