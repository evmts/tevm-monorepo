---
title: Managing State
description: Overview of how to manage accounts, code, and storage in Tevm Node
---

import { Tabs, Tab, Steps, Step } from "vocs/components";

import { Callout, Steps, Button } from 'vocs/components'

# Managing State

<Callout type="info" title="State Management">
  Tevm provides powerful state management capabilities through multiple APIs to read, write, and manipulate blockchain state.
</Callout>

Tevm offers various approaches to manage Ethereum state, from low-level direct state access to high-level client APIs. Each approach has its benefits and use cases.

## State Management Approaches

<Tabs>
</Tabs>

## Contract State Management

<div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '1rem', margin: '1rem 0'}}>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üìÑ Deploy Code</h3>
    <p>Deploy smart contract bytecode to the blockchain</p>
  </div>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üëÅÔ∏è Read Code</h3>
    <p>Read the deployed bytecode of a contract</p>
  </div>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üíæ Storage Access</h3>
    <p>Read and write to contract storage slots</p>
  </div>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üîÑ State Reset</h3>
    <p>Clear contract storage or delete contracts</p>
  </div>
</div>

<Tabs>
</Tabs>

## Framework Integration

<Callout type="tip" title="Best of Both Worlds">
  Tevm allows you to combine high-level libraries like Viem and Ethers with low-level state access.
</Callout>

<Tabs>
</Tabs>

## Advanced Features

<Steps>
  ### State Checkpoints
  
  Create atomic state changes that can be committed or reverted:
  
  ```typescript showLineNumbers {1,3,4-10,12-13} filename="checkpoints.ts"
  const stateManager = (await node.getVm()).stateManager
  
  await stateManager.checkpoint() // [!code focus]
  try { // [!code focus]
    // Batch multiple state changes
    await Promise.all([
      stateManager.putAccount(address, account),
      stateManager.putContractStorage(address, key, value),
    ])
    await stateManager.commit() // [!code focus]
  } catch (error) { // [!code focus]
    await stateManager.revert() // [!code focus]
    console.error('State changes reverted:', error) // [!code focus]
  }
  ```
  
  <Callout type="info" title="Transaction-like Semantics">
    Checkpoints provide transaction-like semantics, allowing you to revert changes if something goes wrong.
  </Callout>
  
  ### State Persistence
  
  Save and load blockchain state:
  
  ```typescript showLineNumbers {2,5,8-9} filename="persistence.ts"
  // Dump complete state
  const state = await stateManager.dumpCanonicalGenesis() // [!code focus]
  
  // Save state (example with localStorage)
  localStorage.setItem('tevmState', JSON.stringify(state)) // [!code focus]
  
  // Load saved state
  const savedState = JSON.parse(localStorage.getItem('tevmState')) // [!code focus]
  await stateManager.generateCanonicalGenesis(savedState) // [!code focus]
  ```
  
  <Callout type="tip" title="Persistence Options">
    You can save state to any storage system - from localStorage in browsers to database systems in server environments.
  </Callout>
  
  ### Fork Mode
  
  Tevm supports lazy loading with caching when forking from another network:
  
  ```typescript showLineNumbers {1-5,7,10,13} filename="fork-mode.ts"
  const node = createTevmNode({
    fork: {
      transport: http('https://mainnet.optimism.io')
    }
  })
  
  const stateManager = (await node.getVm()).stateManager // [!code focus]
  
  // First access fetches from remote
  const account = await stateManager.getAccount('0x1234...') // [!code focus]
  
  // Subsequent access uses cache
  const cachedAccount = await stateManager.getAccount('0x1234...') // [!code focus]
  ```
  
  <Callout type="note" title="Efficient Forking">
    When forking, Tevm only loads the state it needs from the remote provider and caches it locally. This provides an efficient balance between performance and state availability.
  </Callout>
</Steps>

## Best Practices

<div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '1rem', margin: '1rem 0'}}>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>‚ö†Ô∏è Error Handling</h3>
    <p>Properly handle errors from state operations</p>
  </div>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>üõ°Ô∏è State Isolation</h3>
    <p>Create isolated copies of state for testing</p>
  </div>
  <div style={{border: '1px solid var(--vocs-border-color)', borderRadius: '8px', padding: '1rem'}}>
    <h3>‚öõÔ∏è Atomic Operations</h3>
    <p>Group related state changes with checkpoints</p>
  </div>
</div>

<Tabs>
</Tabs>

## Related Resources

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))', gap: '1rem', margin: '1.5rem 0' }}>
  <Button href="https://github.com/evmts/tevm-monorepo/blob/main/packages/state/docs/interfaces/StateManager.md" style={{ height: 'auto', padding: '1rem', display: 'flex', flexDirection: 'column', alignItems: 'flex-start' }}>
    <div style={{ fontWeight: 'var(--vocs-fontWeight_medium)', marginBottom: '0.5rem' }}>State Manager API</div>
    <div style={{ fontSize: 'var(--vocs-fontSize_14)', textAlign: 'left' }}>Complete API reference for the StateManager interface</div>
  </Button>
  
  <Button href="../api/account-management" style={{ height: 'auto', padding: '1rem', display: 'flex', flexDirection: 'column', alignItems: 'flex-start' }}>
    <div style={{ fontWeight: 'var(--vocs-fontWeight_medium)', marginBottom: '0.5rem' }}>Account Management</div>
    <div style={{ fontSize: 'var(--vocs-fontSize_14)', textAlign: 'left' }}>Learn how to manage Ethereum accounts</div>
  </Button>
  
  <Button href="/reference/contract" style={{ height: 'auto', padding: '1rem', display: 'flex', flexDirection: 'column', alignItems: 'flex-start' }}>
    <div style={{ fontWeight: 'var(--vocs-fontWeight_medium)', marginBottom: '0.5rem' }}>Contract Storage</div>
    <div style={{ fontSize: 'var(--vocs-fontSize_14)', textAlign: 'left' }}>Working with contract storage in depth</div>
  </Button>
  
  <Button href="../core/forking" variant="accent" style={{ height: 'auto', padding: '1rem', display: 'flex', flexDirection: 'column', alignItems: 'flex-start' }}>
    <div style={{ fontWeight: 'var(--vocs-fontWeight_medium)', marginBottom: '0.5rem' }}>Forking Guide</div>
    <div style={{ fontSize: 'var(--vocs-fontSize_14)', textAlign: 'left' }}>Learn how to fork from live networks</div>
  </Button>
</div>