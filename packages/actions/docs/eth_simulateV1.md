# eth_simulateV1

`eth_simulateV1` is a JSON-RPC method that allows simulating a series of transactions at a specific block height with optional state overrides. This method is particularly useful for:

- Simulating complex transaction sequences without modifying chain state
- Testing state changes before sending transactions
- Debugging smart contract interactions
- Estimating gas and assets changes for a sequence of operations

## Parameters

The method takes a single parameter object with the following fields:

- `account` (optional): The default sender address and account used for asset tracking
- `blockStateCalls`: Array of call items to execute (required)
- `blockNumber` (optional): Block to execute against (defaults to 'latest')
- `stateOverrides` (optional): Array of state overrides to apply before simulation
- `blockOverrides` (optional): Block parameters to override
- `traceAssetChanges` (optional): Whether to track asset balance changes

### blockStateCalls

Each call item in the `blockStateCalls` array can have the following properties:

- `from`: The address the transaction is sent from
- `to`: The address the transaction is directed to
- `data`: The call data
- `gas`: Gas limit
- `gasPrice`: Gas price in wei
- `maxFeePerGas`: Maximum fee per gas for EIP-1559 transactions
- `maxPriorityFeePerGas`: Maximum priority fee per gas for EIP-1559 transactions
- `value`: Value sent in wei
- `nonce`: Transaction nonce
- `accessList`: Access list

### stateOverrides

Each state override in the `stateOverrides` array can have:

- `address`: The address to override (required)
- `balance`: The new balance in wei
- `nonce`: The new nonce
- `code`: The new contract code
- `storage`: Storage key-value pairs to override

### blockOverrides

Block overrides can include:

- `baseFeePerGas`: Base fee per gas
- `timestamp`: Block timestamp
- `number`: Block number
- `difficulty`: Block difficulty
- `gasLimit`: Block gas limit
- `coinbase`: Block miner address

## Returns

The method returns an object with the following properties:

- `results`: Array of simulation results for each call
- `assetChanges` (optional): Array of asset balance changes if `traceAssetChanges` is true

Each result in the `results` array contains:

- `status`: 'success' or 'failure'
- `data`: The return data of the call
- `gasUsed`: The amount of gas used
- `logs`: The logs generated by the call
- `error` (only if status is 'failure'): Error message

## Example

```json
// Request
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "eth_simulateV1",
  "params": [{
    "account": "0x1234567890123456789012345678901234567890",
    "blockStateCalls": [
      {
        "to": "0xabcdef0123456789abcdef0123456789abcdef01",
        "data": "0xa9059cbb000000000000000000000000fedcba9876543210fedcba9876543210fedcba98000000000000000000000000000000000000000000000000000000000000000a",
        "from": "0x1234567890123456789012345678901234567890"
      },
      {
        "to": "0x0123456789abcdef0123456789abcdef01234567",
        "data": "0x0dfe1681",
        "from": "0x1234567890123456789012345678901234567890"
      }
    ],
    "blockNumber": "latest",
    "stateOverrides": [
      {
        "address": "0x1234567890123456789012345678901234567890",
        "balance": "0x1000000000000000000"
      }
    ],
    "traceAssetChanges": true
  }]
}

// Response
{
  "id": 1,
  "jsonrpc": "2.0",
  "method": "eth_simulateV1",
  "result": {
    "results": [
      {
        "status": "success",
        "data": "0x0000000000000000000000000000000000000000000000000000000000000001",
        "gasUsed": "0x7b2d",
        "logs": [
          {
            "address": "0xabcdef0123456789abcdef0123456789abcdef01",
            "topics": [
              "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
              "0x0000000000000000000000001234567890123456789012345678901234567890",
              "0x000000000000000000000000fedcba9876543210fedcba9876543210fedcba98"
            ],
            "data": "0x000000000000000000000000000000000000000000000000000000000000000a"
          }
        ]
      },
      {
        "status": "success",
        "data": "0x000000000000000000000000abcdef0123456789abcdef0123456789abcdef01",
        "gasUsed": "0x1c2b",
        "logs": []
      }
    ],
    "assetChanges": [
      {
        "token": {
          "address": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
          "symbol": "ETH",
          "decimals": 18
        },
        "value": {
          "diff": "-0x9c40",
          "start": "0x1000000000000000000",
          "end": "0xfffffffffffffffffff6b3c0"
        }
      }
    ]
  }
}
```

## Notes

- This method works similar to `eth_call` but allows for more complex simulations
- All simulations are performed in a temporary state that does not affect the main blockchain state
- State overrides are applied before running the simulations
- When `traceAssetChanges` is true, the method tracks ETH balance changes for the specified account