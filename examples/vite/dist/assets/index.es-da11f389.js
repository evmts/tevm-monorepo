import{e as fa,f as re,h as t1,w as Dl,r as ql,i as bc,t as pa,j as r1,k as i1,m as mi,D as n1,o as s1,N as Z,p as a1,q as sc,s as o1,V as c1,R as u1,F as Nh,K as h1,x as l1,L as f1,u as Fh,$ as p1,v as d1,y as Bn,Z as Dh,J as g1,X as y1,_ as jl,z as $r,A as v1,B as m1,C as on,E as Nt,U as er,G as vi,H as cr,I as _1,M as cn,O as Ll,P as w1,Q as b1,S as E1,T as Ml,W as x1,Y as zl,a0 as Ul,a1 as hn,a2 as ac,a3 as aa,a4 as ln,a5 as I1,a6 as oa,a7 as S1,a8 as P1,a9 as O1,aa as ra,ab as C1,ac as A1,ad as ko,ae as qh,af as T1,ag as R1,ah as $1,ai as jh,aj as N1,ak as F1,al as D1,am as q1,an as j1,ao as L1,ap as M1,aq as Hn,ar as Hl,as as Ko,at as z1,au as U1,av as H1}from"./index-a8ded276.js";import{e as Ur,E as Ec}from"./events-8ba2508c.js";import{s as xc,i as Lh,c as k1,a as K1,b as kl,f as Ic,p as V1,J as ii,d as Sc,e as Pc,g as Oc,h as yi,j as ri,k as Vn,l as B1,m as G1,H as bi}from"./http-b3502842.js";import"@safe-globalThis/safe-apps-provider";import"@safe-globalThis/safe-apps-sdk";var da={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var oc=function(o,i){return oc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},oc(o,i)};function W1(o,i){oc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var cc=function(){return cc=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(i[c]=t[c])}return i},cc.apply(this,arguments)};function J1(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function Q1(o,i,t,n){var a=arguments.length,c=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,i,t,n);else for(var d=o.length-1;d>=0;d--)(f=o[d])&&(c=(a<3?f(c):a>3?f(i,t,c):f(i,t))||c);return a>3&&c&&Object.defineProperty(i,t,c),c}function Y1(o,i){return function(t,n){i(t,n,o)}}function Z1(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function X1(o,i,t,n){function a(c){return c instanceof t?c:new t(function(f){f(c)})}return new(t||(t=Promise))(function(c,f){function d(P){try{v(n.next(P))}catch(L){f(L)}}function _(P){try{v(n.throw(P))}catch(L){f(L)}}function v(P){P.done?c(P.value):a(P.value).then(d,_)}v((n=n.apply(o,i||[])).next())})}function em(o,i){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,a,c,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(v){return function(P){return _([v,P])}}function _(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(c=v[0]&2?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[v[0]&2,c.value]),v[0]){case 0:case 1:c=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){t.label=v[1];break}if(v[0]===6&&t.label<c[1]){t.label=c[1],c=v;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(v);break}c[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=c=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function tm(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function rm(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function uc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kl(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,c=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(d){f={error:d}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return c}function im(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Kl(arguments[i]));return o}function nm(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var c=arguments[i],f=0,d=c.length;f<d;f++,a++)n[a]=c[f];return n}function Gn(o){return this instanceof Gn?(this.v=o,this):new Gn(o)}function sm(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,c=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(T){n[T]&&(a[T]=function(U){return new Promise(function(H,K){c.push([T,U,H,K])>1||d(T,U)})})}function d(T,U){try{_(n[T](U))}catch(H){L(c[0][3],H)}}function _(T){T.value instanceof Gn?Promise.resolve(T.value.v).then(v,P):L(c[0][2],T)}function v(T){d("next",T)}function P(T){d("throw",T)}function L(T,U){T(U),c.shift(),c.length&&d(c[0][0],c[0][1])}}function am(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,c){i[a]=o[a]?function(f){return(t=!t)?{value:Gn(o[a](f)),done:a==="return"}:c?c(f):f}:c}}function om(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof uc=="function"?uc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(f){return new Promise(function(d,_){f=o[c](f),a(d,_,f.done,f.value)})}}function a(c,f,d,_){Promise.resolve(_).then(function(v){c({value:v,done:d})},f)}}function cm(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function um(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function hm(o){return o&&o.__esModule?o:{default:o}}function lm(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function fm(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const pm=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return cc},__asyncDelegator:am,__asyncGenerator:sm,__asyncValues:om,__await:Gn,__awaiter:X1,__classPrivateFieldGet:lm,__classPrivateFieldSet:fm,__createBinding:tm,__decorate:Q1,__exportStar:rm,__extends:W1,__generator:em,__importDefault:hm,__importStar:um,__makeTemplateObject:cm,__metadata:Z1,__param:Y1,__read:Kl,__rest:J1,__spread:im,__spreadArrays:nm,__values:uc},Symbol.toStringTag,{value:"Module"})),Vl=fa(pm);var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0});function dm(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return JSON.parse(o)}catch{return o}}Qn.safeJsonParse=dm;function gm(o){return typeof o=="string"?o:JSON.stringify(o,(i,t)=>typeof t>"u"?null:t)}Qn.safeJsonStringify=gm;var $n={exports:{}},Mh;function ym(){return Mh||(Mh=1,function(){let o;function i(){}o=i,o.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},o.prototype.setItem=function(t,n){this[t]=String(n)},o.prototype.removeItem=function(t){delete this[t]},o.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(n){t[n]=void 0,delete t[n]})},o.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof globalThis<"u"&&globalThis.localStorage?$n.exports=globalThis.localStorage:typeof window<"u"&&window.localStorage?$n.exports=window.localStorage:$n.exports=new i}()),$n.exports}var Vo={},Nn={},zh;function vm(){if(zh)return Nn;zh=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.IKeyValueStorage=void 0;class o{}return Nn.IKeyValueStorage=o,Nn}var Fn={},Uh;function mm(){if(Uh)return Fn;Uh=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.parseEntry=void 0;const o=Qn;function i(t){var n;return[t[0],o.safeJsonParse((n=t[1])!==null&&n!==void 0?n:"")]}return Fn.parseEntry=i,Fn}var Hh;function _m(){return Hh||(Hh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0});const i=Vl;i.__exportStar(vm(),o),i.__exportStar(mm(),o)}(Vo)),Vo}Object.defineProperty(da,"__esModule",{value:!0});da.KeyValueStorage=void 0;const un=Vl,kh=Qn,wm=un.__importDefault(ym()),bm=_m();class Bl{constructor(){this.localStorage=wm.default}getKeys(){return un.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return un.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(bm.parseEntry)})}getItem(i){return un.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(i);if(t!==null)return kh.safeJsonParse(t)})}setItem(i,t){return un.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(i,kh.safeJsonStringify(t))})}removeItem(i){return un.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(i)})}}da.KeyValueStorage=Bl;var Em=da.default=Bl,fn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var hc=function(o,i){return hc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},hc(o,i)};function xm(o,i){hc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var lc=function(){return lc=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(i[c]=t[c])}return i},lc.apply(this,arguments)};function Im(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function Sm(o,i,t,n){var a=arguments.length,c=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,i,t,n);else for(var d=o.length-1;d>=0;d--)(f=o[d])&&(c=(a<3?f(c):a>3?f(i,t,c):f(i,t))||c);return a>3&&c&&Object.defineProperty(i,t,c),c}function Pm(o,i){return function(t,n){i(t,n,o)}}function Om(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function Cm(o,i,t,n){function a(c){return c instanceof t?c:new t(function(f){f(c)})}return new(t||(t=Promise))(function(c,f){function d(P){try{v(n.next(P))}catch(L){f(L)}}function _(P){try{v(n.throw(P))}catch(L){f(L)}}function v(P){P.done?c(P.value):a(P.value).then(d,_)}v((n=n.apply(o,i||[])).next())})}function Am(o,i){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,a,c,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(v){return function(P){return _([v,P])}}function _(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(c=v[0]&2?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[v[0]&2,c.value]),v[0]){case 0:case 1:c=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){t.label=v[1];break}if(v[0]===6&&t.label<c[1]){t.label=c[1],c=v;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(v);break}c[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=c=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function Tm(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function Rm(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function fc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gl(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,c=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(d){f={error:d}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return c}function $m(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Gl(arguments[i]));return o}function Nm(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var c=arguments[i],f=0,d=c.length;f<d;f++,a++)n[a]=c[f];return n}function Wn(o){return this instanceof Wn?(this.v=o,this):new Wn(o)}function Fm(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,c=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(T){n[T]&&(a[T]=function(U){return new Promise(function(H,K){c.push([T,U,H,K])>1||d(T,U)})})}function d(T,U){try{_(n[T](U))}catch(H){L(c[0][3],H)}}function _(T){T.value instanceof Wn?Promise.resolve(T.value.v).then(v,P):L(c[0][2],T)}function v(T){d("next",T)}function P(T){d("throw",T)}function L(T,U){T(U),c.shift(),c.length&&d(c[0][0],c[0][1])}}function Dm(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,c){i[a]=o[a]?function(f){return(t=!t)?{value:Wn(o[a](f)),done:a==="return"}:c?c(f):f}:c}}function qm(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof fc=="function"?fc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(f){return new Promise(function(d,_){f=o[c](f),a(d,_,f.done,f.value)})}}function a(c,f,d,_){Promise.resolve(_).then(function(v){c({value:v,done:d})},f)}}function jm(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function Lm(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function Mm(o){return o&&o.__esModule?o:{default:o}}function zm(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function Um(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const Hm=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return lc},__asyncDelegator:Dm,__asyncGenerator:Fm,__asyncValues:qm,__await:Wn,__awaiter:Cm,__classPrivateFieldGet:zm,__classPrivateFieldSet:Um,__createBinding:Tm,__decorate:Sm,__exportStar:Rm,__extends:xm,__generator:Am,__importDefault:Mm,__importStar:Lm,__makeTemplateObject:jm,__metadata:Om,__param:Pm,__read:Gl,__rest:Im,__spread:$m,__spreadArrays:Nm,__values:fc},Symbol.toStringTag,{value:"Module"})),ga=fa(Hm);var Dn={},Bo={},qn={};class Li{}const km=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Li},Symbol.toStringTag,{value:"Module"})),Km=fa(km);var Kh;function Vm(){if(Kh)return qn;Kh=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.IHeartBeat=void 0;const o=Km;class i extends o.IEvents{constructor(n){super()}}return qn.IHeartBeat=i,qn}var Vh;function Wl(){return Vh||(Vh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),ga.__exportStar(Vm(),o)}(Bo)),Bo}var Go={},qi={},Bh;function Bm(){if(Bh)return qi;Bh=1,Object.defineProperty(qi,"__esModule",{value:!0}),qi.HEARTBEAT_EVENTS=qi.HEARTBEAT_INTERVAL=void 0;const o=re;return qi.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,qi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},qi}var Gh;function Jl(){return Gh||(Gh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),ga.__exportStar(Bm(),o)}(Go)),Go}var Wh;function Gm(){if(Wh)return Dn;Wh=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.HeartBeat=void 0;const o=ga,i=Ur,t=re,n=Wl(),a=Jl();class c extends n.IHeartBeat{constructor(d){super(d),this.events=new i.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(d==null?void 0:d.interval)||a.HEARTBEAT_INTERVAL}static init(d){return o.__awaiter(this,void 0,void 0,function*(){const _=new c(d);return yield _.init(),_})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(d,_){this.events.on(d,_)}once(d,_){this.events.once(d,_)}off(d,_){this.events.off(d,_)}removeListener(d,_){this.events.removeListener(d,_)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Dn.HeartBeat=c,Dn}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const i=ga;i.__exportStar(Gm(),o),i.__exportStar(Wl(),o),i.__exportStar(Jl(),o)})(fn);var Ce={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var pc=function(o,i){return pc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},pc(o,i)};function Wm(o,i){pc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var dc=function(){return dc=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(i[c]=t[c])}return i},dc.apply(this,arguments)};function Jm(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function Qm(o,i,t,n){var a=arguments.length,c=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,i,t,n);else for(var d=o.length-1;d>=0;d--)(f=o[d])&&(c=(a<3?f(c):a>3?f(i,t,c):f(i,t))||c);return a>3&&c&&Object.defineProperty(i,t,c),c}function Ym(o,i){return function(t,n){i(t,n,o)}}function Zm(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function Xm(o,i,t,n){function a(c){return c instanceof t?c:new t(function(f){f(c)})}return new(t||(t=Promise))(function(c,f){function d(P){try{v(n.next(P))}catch(L){f(L)}}function _(P){try{v(n.throw(P))}catch(L){f(L)}}function v(P){P.done?c(P.value):a(P.value).then(d,_)}v((n=n.apply(o,i||[])).next())})}function e_(o,i){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,a,c,f;return f={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function d(v){return function(P){return _([v,P])}}function _(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(c=v[0]&2?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[v[0]&2,c.value]),v[0]){case 0:case 1:c=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){t.label=v[1];break}if(v[0]===6&&t.label<c[1]){t.label=c[1],c=v;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(v);break}c[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=c=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function t_(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function r_(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function gc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ql(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,c=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(d){f={error:d}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return c}function i_(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Ql(arguments[i]));return o}function n_(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var c=arguments[i],f=0,d=c.length;f<d;f++,a++)n[a]=c[f];return n}function Jn(o){return this instanceof Jn?(this.v=o,this):new Jn(o)}function s_(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,c=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(T){n[T]&&(a[T]=function(U){return new Promise(function(H,K){c.push([T,U,H,K])>1||d(T,U)})})}function d(T,U){try{_(n[T](U))}catch(H){L(c[0][3],H)}}function _(T){T.value instanceof Jn?Promise.resolve(T.value.v).then(v,P):L(c[0][2],T)}function v(T){d("next",T)}function P(T){d("throw",T)}function L(T,U){T(U),c.shift(),c.length&&d(c[0][0],c[0][1])}}function a_(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,c){i[a]=o[a]?function(f){return(t=!t)?{value:Jn(o[a](f)),done:a==="return"}:c?c(f):f}:c}}function o_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof gc=="function"?gc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(f){return new Promise(function(d,_){f=o[c](f),a(d,_,f.done,f.value)})}}function a(c,f,d,_){Promise.resolve(_).then(function(v){c({value:v,done:d})},f)}}function c_(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function u_(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function h_(o){return o&&o.__esModule?o:{default:o}}function l_(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function f_(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const p_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return dc},__asyncDelegator:a_,__asyncGenerator:s_,__asyncValues:o_,__await:Jn,__awaiter:Xm,__classPrivateFieldGet:l_,__classPrivateFieldSet:f_,__createBinding:t_,__decorate:Qm,__exportStar:r_,__extends:Wm,__generator:e_,__importDefault:h_,__importStar:u_,__makeTemplateObject:c_,__metadata:Zm,__param:Ym,__read:Ql,__rest:Jm,__spread:i_,__spreadArrays:n_,__values:gc},Symbol.toStringTag,{value:"Module"})),d_=fa(p_);var Wo,Jh;function g_(){if(Jh)return Wo;Jh=1;function o(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}Wo=i;function i(t,n,a){var c=a&&a.stringify||o,f=1;if(typeof t=="object"&&t!==null){var d=n.length+f;if(d===1)return t;var _=new Array(d);_[0]=c(t);for(var v=1;v<d;v++)_[v]=c(n[v]);return _.join(" ")}if(typeof t!="string")return t;var P=n.length;if(P===0)return t;for(var L="",T=1-f,U=-1,H=t&&t.length||0,K=0;K<H;){if(t.charCodeAt(K)===37&&K+1<H){switch(U=U>-1?U:0,t.charCodeAt(K+1)){case 100:case 102:if(T>=P||n[T]==null)break;U<K&&(L+=t.slice(U,K)),L+=Number(n[T]),U=K+2,K++;break;case 105:if(T>=P||n[T]==null)break;U<K&&(L+=t.slice(U,K)),L+=Math.floor(Number(n[T])),U=K+2,K++;break;case 79:case 111:case 106:if(T>=P||n[T]===void 0)break;U<K&&(L+=t.slice(U,K));var ae=typeof n[T];if(ae==="string"){L+="'"+n[T]+"'",U=K+2,K++;break}if(ae==="function"){L+=n[T].name||"<anonymous>",U=K+2,K++;break}L+=c(n[T]),U=K+2,K++;break;case 115:if(T>=P)break;U<K&&(L+=t.slice(U,K)),L+=String(n[T]),U=K+2,K++;break;case 37:U<K&&(L+=t.slice(U,K)),L+="%",U=K+2,K++,T--;break}++T}++K}return U===-1?t:(U<H&&(L+=t.slice(U)),L)}return Wo}var Jo,Qh;function y_(){if(Qh)return Jo;Qh=1;const o=g_();Jo=a;const i=he().console||{},t={mapHttpRequest:H,mapHttpResponse:H,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:H,res:H,err:T};function n($,z){return Array.isArray($)?$.filter(function(ge){return ge!=="!stdSerializers.err"}):$===!0?Object.keys(z):!1}function a($){$=$||{},$.browser=$.browser||{};const z=$.browser.transmit;if(z&&typeof z.send!="function")throw Error("pino: transmit option must have a send function");const W=$.browser.write||i;$.browser.write&&($.browser.asObject=!0);const ge=$.serializers||{},te=n($.browser.serialize,ge);let Ee=$.browser.serialize;Array.isArray($.browser.serialize)&&$.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ae=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),$.enabled===!1&&($.level="silent");const et=$.level||"info",C=Object.create(W);C.log||(C.log=ae),Object.defineProperty(C,"levelVal",{get:Me}),Object.defineProperty(C,"level",{get:Te,set:J});const q={transmit:z,serialize:te,asObject:$.browser.asObject,levels:Ae,timestamp:U($)};C.levels=a.levels,C.level=et,C.setMaxListeners=C.getMaxListeners=C.emit=C.addListener=C.on=C.prependListener=C.once=C.prependOnceListener=C.removeListener=C.removeAllListeners=C.listeners=C.listenerCount=C.eventNames=C.write=C.flush=ae,C.serializers=ge,C._serialize=te,C._stdErrSerialize=Ee,C.child=V,z&&(C._logEvent=L());function Me(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Te(){return this._level}function J(k){if(k!=="silent"&&!this.levels.values[k])throw Error("unknown level "+k);this._level=k,c(q,C,"error","log"),c(q,C,"fatal","error"),c(q,C,"warn","error"),c(q,C,"info","log"),c(q,C,"debug","log"),c(q,C,"trace","log")}function V(k,B){if(!k)throw new Error("missing bindings for child Pino");B=B||{},te&&k.serializers&&(B.serializers=k.serializers);const ut=B.serializers;if(te&&ut){var He=Object.assign({},ge,ut),Nr=$.browser.serialize===!0?Object.keys(He):te;delete k.serializers,_([k],Nr,He,this._stdErrSerialize)}function _e(xt){this._childLevel=(xt._childLevel|0)+1,this.error=v(xt,k,"error"),this.fatal=v(xt,k,"fatal"),this.warn=v(xt,k,"warn"),this.info=v(xt,k,"info"),this.debug=v(xt,k,"debug"),this.trace=v(xt,k,"trace"),He&&(this.serializers=He,this._serialize=Nr),z&&(this._logEvent=L([].concat(xt._logEvent.bindings,k)))}return _e.prototype=this,new _e(this)}return C}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=t,a.stdTimeFunctions=Object.assign({},{nullTime:be,epochTime:de,unixTime:pe,isoTime:ue});function c($,z,W,ge){const te=Object.getPrototypeOf(z);z[W]=z.levelVal>z.levels.values[W]?ae:te[W]?te[W]:i[W]||i[ge]||ae,f($,z,W)}function f($,z,W){!$.transmit&&z[W]===ae||(z[W]=function(ge){return function(){const Ee=$.timestamp(),Ae=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var C=0;C<Ae.length;C++)Ae[C]=arguments[C];if($.serialize&&!$.asObject&&_(Ae,this._serialize,this.serializers,this._stdErrSerialize),$.asObject?ge.call(et,d(this,W,Ae,Ee)):ge.apply(et,Ae),$.transmit){const q=$.transmit.level||z.level,Me=a.levels.values[q],Te=a.levels.values[W];if(Te<Me)return;P(this,{ts:Ee,methodLevel:W,methodValue:Te,transmitLevel:q,transmitValue:a.levels.values[$.transmit.level||z.level],send:$.transmit.send,val:z.levelVal},Ae)}}}(z[W]))}function d($,z,W,ge){$._serialize&&_(W,$._serialize,$.serializers,$._stdErrSerialize);const te=W.slice();let Ee=te[0];const Ae={};ge&&(Ae.time=ge),Ae.level=a.levels.values[z];let et=($._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof te[0]=="object";)Object.assign(Ae,te.shift());Ee=te.length?o(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=o(te.shift(),te));return Ee!==void 0&&(Ae.msg=Ee),Ae}function _($,z,W,ge){for(const te in $)if(ge&&$[te]instanceof Error)$[te]=a.stdSerializers.err($[te]);else if(typeof $[te]=="object"&&!Array.isArray($[te]))for(const Ee in $[te])z&&z.indexOf(Ee)>-1&&Ee in W&&($[te][Ee]=W[Ee]($[te][Ee]))}function v($,z,W){return function(){const ge=new Array(1+arguments.length);ge[0]=z;for(var te=1;te<ge.length;te++)ge[te]=arguments[te-1];return $[W].apply(this,ge)}}function P($,z,W){const ge=z.send,te=z.ts,Ee=z.methodLevel,Ae=z.methodValue,et=z.val,C=$._logEvent.bindings;_(W,$._serialize||Object.keys($.serializers),$.serializers,$._stdErrSerialize===void 0?!0:$._stdErrSerialize),$._logEvent.ts=te,$._logEvent.messages=W.filter(function(q){return C.indexOf(q)===-1}),$._logEvent.level.label=Ee,$._logEvent.level.value=Ae,ge(Ee,$._logEvent,et),$._logEvent=L(C)}function L($){return{ts:0,messages:[],bindings:$||[],level:{label:"",value:0}}}function T($){const z={type:$.constructor.name,msg:$.message,stack:$.stack};for(const W in $)z[W]===void 0&&(z[W]=$[W]);return z}function U($){return typeof $.timestamp=="function"?$.timestamp:$.timestamp===!1?be:de}function H(){return{}}function K($){return $}function ae(){}function be(){return!1}function de(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function ue(){return new Date(Date.now()).toISOString()}function he(){function $(z){return typeof z<"u"&&z}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return $(self)||$(window)||$(this)||{}}}return Jo}var ji={},Yh;function Yl(){return Yh||(Yh=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.PINO_CUSTOM_CONTEXT_KEY=ji.PINO_LOGGER_DEFAULTS=void 0,ji.PINO_LOGGER_DEFAULTS={level:"info"},ji.PINO_CUSTOM_CONTEXT_KEY="custom_context"),ji}var Xt={},Zh;function v_(){if(Zh)return Xt;Zh=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.generateChildLogger=Xt.formatChildLoggerContext=Xt.getLoggerContext=Xt.setBrowserLoggerContext=Xt.getBrowserLoggerContext=Xt.getDefaultLoggerOptions=void 0;const o=Yl();function i(d){return Object.assign(Object.assign({},d),{level:(d==null?void 0:d.level)||o.PINO_LOGGER_DEFAULTS.level})}Xt.getDefaultLoggerOptions=i;function t(d,_=o.PINO_CUSTOM_CONTEXT_KEY){return d[_]||""}Xt.getBrowserLoggerContext=t;function n(d,_,v=o.PINO_CUSTOM_CONTEXT_KEY){return d[v]=_,d}Xt.setBrowserLoggerContext=n;function a(d,_=o.PINO_CUSTOM_CONTEXT_KEY){let v="";return typeof d.bindings>"u"?v=t(d,_):v=d.bindings().context||"",v}Xt.getLoggerContext=a;function c(d,_,v=o.PINO_CUSTOM_CONTEXT_KEY){const P=a(d,v);return P.trim()?`${P}/${_}`:_}Xt.formatChildLoggerContext=c;function f(d,_,v=o.PINO_CUSTOM_CONTEXT_KEY){const P=c(d,_,v),L=d.child({context:P});return n(L,P,v)}return Xt.generateChildLogger=f,Xt}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const i=d_,t=i.__importDefault(y_());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return t.default}}),i.__exportStar(Yl(),o),i.__exportStar(v_(),o)})(Ce);class m_ extends Li{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class __ extends Li{constructor(i,t){super(),this.core=i,this.logger=t,this.records=new Map}}class w_{constructor(i,t){this.logger=i,this.core=t}}let b_=class extends Li{constructor(i,t){super(),this.relayer=i,this.logger=t}},E_=class extends Li{constructor(i){super()}},x_=class{constructor(i,t,n,a){this.core=i,this.logger=t,this.name=n}};class I_ extends Li{constructor(i,t){super(),this.relayer=i,this.logger=t}}let S_=class extends Li{constructor(i,t){super(),this.core=i,this.logger=t}},P_=class{constructor(i,t){this.projectId=i,this.logger=t}},O_=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}},C_=class{constructor(i){this.client=i}};var Cc={},Zl={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var i=t1,t=Dl;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var n=function(){function d(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return d.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},d.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},d.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},d.prototype.update=function(_,v){if(v===void 0&&(v=_.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var P=0;if(this._bytesHashed+=v,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&v>0;)this._buffer[this._bufferLength++]=_[P++],v--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(v>=this.blockSize&&(P=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,_,P,v),v%=this.blockSize);v>0;)this._buffer[this._bufferLength++]=_[P++],v--;return this},d.prototype.finish=function(_){if(!this._finished){var v=this._bytesHashed,P=this._bufferLength,L=v/536870912|0,T=v<<3,U=v%128<112?128:256;this._buffer[P]=128;for(var H=P+1;H<U-8;H++)this._buffer[H]=0;i.writeUint32BE(L,this._buffer,U-8),i.writeUint32BE(T,this._buffer,U-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,U),this._finished=!0}for(var H=0;H<this.digestLength/8;H++)i.writeUint32BE(this._stateHi[H],_,H*8),i.writeUint32BE(this._stateLo[H],_,H*8+4);return this},d.prototype.digest=function(){var _=new Uint8Array(this.digestLength);return this.finish(_),_},d.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},d.prototype.restoreState=function(_){return this._stateHi.set(_.stateHi),this._stateLo.set(_.stateLo),this._bufferLength=_.bufferLength,_.buffer&&this._buffer.set(_.buffer),this._bytesHashed=_.bytesHashed,this._finished=!1,this},d.prototype.cleanSavedState=function(_){t.wipe(_.stateHi),t.wipe(_.stateLo),_.buffer&&t.wipe(_.buffer),_.bufferLength=0,_.bytesHashed=0},d}();o.SHA512=n;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(d,_,v,P,L,T,U){for(var H=v[0],K=v[1],ae=v[2],be=v[3],de=v[4],pe=v[5],ue=v[6],he=v[7],$=P[0],z=P[1],W=P[2],ge=P[3],te=P[4],Ee=P[5],Ae=P[6],et=P[7],C,q,Me,Te,J,V,k,B;U>=128;){for(var ut=0;ut<16;ut++){var He=8*ut+T;d[ut]=i.readUint32BE(L,He),_[ut]=i.readUint32BE(L,He+4)}for(var ut=0;ut<80;ut++){var Nr=H,_e=K,xt=ae,R=be,A=de,S=pe,h=ue,b=he,X=$,oe=z,ve=W,Re=ge,Ne=te,Ie=Ee,It=Ae,mt=et;if(C=he,q=et,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=(de>>>14|te<<32-14)^(de>>>18|te<<32-18)^(te>>>41-32|de<<32-(41-32)),q=(te>>>14|de<<32-14)^(te>>>18|de<<32-18)^(de>>>41-32|te<<32-(41-32)),J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,C=de&pe^~de&ue,q=te&Ee^~te&Ae,J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,C=a[ut*2],q=a[ut*2+1],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,C=d[ut%16],q=_[ut%16],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,Me=k&65535|B<<16,Te=J&65535|V<<16,C=Me,q=Te,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=(H>>>28|$<<32-28)^($>>>34-32|H<<32-(34-32))^($>>>39-32|H<<32-(39-32)),q=($>>>28|H<<32-28)^(H>>>34-32|$<<32-(34-32))^(H>>>39-32|$<<32-(39-32)),J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,C=H&K^H&ae^K&ae,q=$&z^$&W^z&W,J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,b=k&65535|B<<16,mt=J&65535|V<<16,C=R,q=Re,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=Me,q=Te,J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,R=k&65535|B<<16,Re=J&65535|V<<16,K=Nr,ae=_e,be=xt,de=R,pe=A,ue=S,he=h,H=b,z=X,W=oe,ge=ve,te=Re,Ee=Ne,Ae=Ie,et=It,$=mt,ut%16===15)for(var He=0;He<16;He++)C=d[He],q=_[He],J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=d[(He+9)%16],q=_[(He+9)%16],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,Me=d[(He+1)%16],Te=_[(He+1)%16],C=(Me>>>1|Te<<32-1)^(Me>>>8|Te<<32-8)^Me>>>7,q=(Te>>>1|Me<<32-1)^(Te>>>8|Me<<32-8)^(Te>>>7|Me<<32-7),J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,Me=d[(He+14)%16],Te=_[(He+14)%16],C=(Me>>>19|Te<<32-19)^(Te>>>61-32|Me<<32-(61-32))^Me>>>6,q=(Te>>>19|Me<<32-19)^(Me>>>61-32|Te<<32-(61-32))^(Te>>>6|Me<<32-6),J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,d[He]=k&65535|B<<16,_[He]=J&65535|V<<16}C=H,q=$,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=v[0],q=P[0],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[0]=H=k&65535|B<<16,P[0]=$=J&65535|V<<16,C=K,q=z,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=v[1],q=P[1],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[1]=K=k&65535|B<<16,P[1]=z=J&65535|V<<16,C=ae,q=W,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=v[2],q=P[2],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[2]=ae=k&65535|B<<16,P[2]=W=J&65535|V<<16,C=be,q=ge,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=v[3],q=P[3],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[3]=be=k&65535|B<<16,P[3]=ge=J&65535|V<<16,C=de,q=te,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=v[4],q=P[4],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[4]=de=k&65535|B<<16,P[4]=te=J&65535|V<<16,C=pe,q=Ee,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=v[5],q=P[5],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[5]=pe=k&65535|B<<16,P[5]=Ee=J&65535|V<<16,C=ue,q=Ae,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=v[6],q=P[6],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[6]=ue=k&65535|B<<16,P[6]=Ae=J&65535|V<<16,C=he,q=et,J=q&65535,V=q>>>16,k=C&65535,B=C>>>16,C=v[7],q=P[7],J+=q&65535,V+=q>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[7]=he=k&65535|B<<16,P[7]=et=J&65535|V<<16,T+=128,U-=128}return T}function f(d){var _=new n;_.update(d);var v=_.digest();return _.clean(),v}o.hash=f})(Zl);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const i=ql,t=Zl,n=Dl;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a(R){const A=new Float64Array(16);if(R)for(let S=0;S<R.length;S++)A[S]=R[S];return A}const c=new Uint8Array(32);c[0]=9;const f=a(),d=a([1]),_=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),v=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),P=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),L=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),T=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function U(R,A){for(let S=0;S<16;S++)R[S]=A[S]|0}function H(R){let A=1;for(let S=0;S<16;S++){let h=R[S]+A+65535;A=Math.floor(h/65536),R[S]=h-A*65536}R[0]+=A-1+37*(A-1)}function K(R,A,S){const h=~(S-1);for(let b=0;b<16;b++){const X=h&(R[b]^A[b]);R[b]^=X,A[b]^=X}}function ae(R,A){const S=a(),h=a();for(let b=0;b<16;b++)h[b]=A[b];H(h),H(h),H(h);for(let b=0;b<2;b++){S[0]=h[0]-65517;for(let oe=1;oe<15;oe++)S[oe]=h[oe]-65535-(S[oe-1]>>16&1),S[oe-1]&=65535;S[15]=h[15]-32767-(S[14]>>16&1);const X=S[15]>>16&1;S[14]&=65535,K(h,S,1-X)}for(let b=0;b<16;b++)R[2*b]=h[b]&255,R[2*b+1]=h[b]>>8}function be(R,A){let S=0;for(let h=0;h<32;h++)S|=R[h]^A[h];return(1&S-1>>>8)-1}function de(R,A){const S=new Uint8Array(32),h=new Uint8Array(32);return ae(S,R),ae(h,A),be(S,h)}function pe(R){const A=new Uint8Array(32);return ae(A,R),A[0]&1}function ue(R,A){for(let S=0;S<16;S++)R[S]=A[2*S]+(A[2*S+1]<<8);R[15]&=32767}function he(R,A,S){for(let h=0;h<16;h++)R[h]=A[h]+S[h]}function $(R,A,S){for(let h=0;h<16;h++)R[h]=A[h]-S[h]}function z(R,A,S){let h,b,X=0,oe=0,ve=0,Re=0,Ne=0,Ie=0,It=0,mt=0,st=0,De=0,Je=0,Qe=0,at=0,ze=0,Ye=0,$e=0,ke=0,ht=0,je=0,St=0,Ft=0,zt=0,Ut=0,jt=0,Gt=0,tr=0,Fr=0,Wt=0,Hr=0,si=0,Ei=0,lt=S[0],tt=S[1],ft=S[2],pt=S[3],ot=S[4],rt=S[5],Pt=S[6],Ot=S[7],dt=S[8],Ct=S[9],gt=S[10],_t=S[11],yt=S[12],We=S[13],At=S[14],Tt=S[15];h=A[0],X+=h*lt,oe+=h*tt,ve+=h*ft,Re+=h*pt,Ne+=h*ot,Ie+=h*rt,It+=h*Pt,mt+=h*Ot,st+=h*dt,De+=h*Ct,Je+=h*gt,Qe+=h*_t,at+=h*yt,ze+=h*We,Ye+=h*At,$e+=h*Tt,h=A[1],oe+=h*lt,ve+=h*tt,Re+=h*ft,Ne+=h*pt,Ie+=h*ot,It+=h*rt,mt+=h*Pt,st+=h*Ot,De+=h*dt,Je+=h*Ct,Qe+=h*gt,at+=h*_t,ze+=h*yt,Ye+=h*We,$e+=h*At,ke+=h*Tt,h=A[2],ve+=h*lt,Re+=h*tt,Ne+=h*ft,Ie+=h*pt,It+=h*ot,mt+=h*rt,st+=h*Pt,De+=h*Ot,Je+=h*dt,Qe+=h*Ct,at+=h*gt,ze+=h*_t,Ye+=h*yt,$e+=h*We,ke+=h*At,ht+=h*Tt,h=A[3],Re+=h*lt,Ne+=h*tt,Ie+=h*ft,It+=h*pt,mt+=h*ot,st+=h*rt,De+=h*Pt,Je+=h*Ot,Qe+=h*dt,at+=h*Ct,ze+=h*gt,Ye+=h*_t,$e+=h*yt,ke+=h*We,ht+=h*At,je+=h*Tt,h=A[4],Ne+=h*lt,Ie+=h*tt,It+=h*ft,mt+=h*pt,st+=h*ot,De+=h*rt,Je+=h*Pt,Qe+=h*Ot,at+=h*dt,ze+=h*Ct,Ye+=h*gt,$e+=h*_t,ke+=h*yt,ht+=h*We,je+=h*At,St+=h*Tt,h=A[5],Ie+=h*lt,It+=h*tt,mt+=h*ft,st+=h*pt,De+=h*ot,Je+=h*rt,Qe+=h*Pt,at+=h*Ot,ze+=h*dt,Ye+=h*Ct,$e+=h*gt,ke+=h*_t,ht+=h*yt,je+=h*We,St+=h*At,Ft+=h*Tt,h=A[6],It+=h*lt,mt+=h*tt,st+=h*ft,De+=h*pt,Je+=h*ot,Qe+=h*rt,at+=h*Pt,ze+=h*Ot,Ye+=h*dt,$e+=h*Ct,ke+=h*gt,ht+=h*_t,je+=h*yt,St+=h*We,Ft+=h*At,zt+=h*Tt,h=A[7],mt+=h*lt,st+=h*tt,De+=h*ft,Je+=h*pt,Qe+=h*ot,at+=h*rt,ze+=h*Pt,Ye+=h*Ot,$e+=h*dt,ke+=h*Ct,ht+=h*gt,je+=h*_t,St+=h*yt,Ft+=h*We,zt+=h*At,Ut+=h*Tt,h=A[8],st+=h*lt,De+=h*tt,Je+=h*ft,Qe+=h*pt,at+=h*ot,ze+=h*rt,Ye+=h*Pt,$e+=h*Ot,ke+=h*dt,ht+=h*Ct,je+=h*gt,St+=h*_t,Ft+=h*yt,zt+=h*We,Ut+=h*At,jt+=h*Tt,h=A[9],De+=h*lt,Je+=h*tt,Qe+=h*ft,at+=h*pt,ze+=h*ot,Ye+=h*rt,$e+=h*Pt,ke+=h*Ot,ht+=h*dt,je+=h*Ct,St+=h*gt,Ft+=h*_t,zt+=h*yt,Ut+=h*We,jt+=h*At,Gt+=h*Tt,h=A[10],Je+=h*lt,Qe+=h*tt,at+=h*ft,ze+=h*pt,Ye+=h*ot,$e+=h*rt,ke+=h*Pt,ht+=h*Ot,je+=h*dt,St+=h*Ct,Ft+=h*gt,zt+=h*_t,Ut+=h*yt,jt+=h*We,Gt+=h*At,tr+=h*Tt,h=A[11],Qe+=h*lt,at+=h*tt,ze+=h*ft,Ye+=h*pt,$e+=h*ot,ke+=h*rt,ht+=h*Pt,je+=h*Ot,St+=h*dt,Ft+=h*Ct,zt+=h*gt,Ut+=h*_t,jt+=h*yt,Gt+=h*We,tr+=h*At,Fr+=h*Tt,h=A[12],at+=h*lt,ze+=h*tt,Ye+=h*ft,$e+=h*pt,ke+=h*ot,ht+=h*rt,je+=h*Pt,St+=h*Ot,Ft+=h*dt,zt+=h*Ct,Ut+=h*gt,jt+=h*_t,Gt+=h*yt,tr+=h*We,Fr+=h*At,Wt+=h*Tt,h=A[13],ze+=h*lt,Ye+=h*tt,$e+=h*ft,ke+=h*pt,ht+=h*ot,je+=h*rt,St+=h*Pt,Ft+=h*Ot,zt+=h*dt,Ut+=h*Ct,jt+=h*gt,Gt+=h*_t,tr+=h*yt,Fr+=h*We,Wt+=h*At,Hr+=h*Tt,h=A[14],Ye+=h*lt,$e+=h*tt,ke+=h*ft,ht+=h*pt,je+=h*ot,St+=h*rt,Ft+=h*Pt,zt+=h*Ot,Ut+=h*dt,jt+=h*Ct,Gt+=h*gt,tr+=h*_t,Fr+=h*yt,Wt+=h*We,Hr+=h*At,si+=h*Tt,h=A[15],$e+=h*lt,ke+=h*tt,ht+=h*ft,je+=h*pt,St+=h*ot,Ft+=h*rt,zt+=h*Pt,Ut+=h*Ot,jt+=h*dt,Gt+=h*Ct,tr+=h*gt,Fr+=h*_t,Wt+=h*yt,Hr+=h*We,si+=h*At,Ei+=h*Tt,X+=38*ke,oe+=38*ht,ve+=38*je,Re+=38*St,Ne+=38*Ft,Ie+=38*zt,It+=38*Ut,mt+=38*jt,st+=38*Gt,De+=38*tr,Je+=38*Fr,Qe+=38*Wt,at+=38*Hr,ze+=38*si,Ye+=38*Ei,b=1,h=X+b+65535,b=Math.floor(h/65536),X=h-b*65536,h=oe+b+65535,b=Math.floor(h/65536),oe=h-b*65536,h=ve+b+65535,b=Math.floor(h/65536),ve=h-b*65536,h=Re+b+65535,b=Math.floor(h/65536),Re=h-b*65536,h=Ne+b+65535,b=Math.floor(h/65536),Ne=h-b*65536,h=Ie+b+65535,b=Math.floor(h/65536),Ie=h-b*65536,h=It+b+65535,b=Math.floor(h/65536),It=h-b*65536,h=mt+b+65535,b=Math.floor(h/65536),mt=h-b*65536,h=st+b+65535,b=Math.floor(h/65536),st=h-b*65536,h=De+b+65535,b=Math.floor(h/65536),De=h-b*65536,h=Je+b+65535,b=Math.floor(h/65536),Je=h-b*65536,h=Qe+b+65535,b=Math.floor(h/65536),Qe=h-b*65536,h=at+b+65535,b=Math.floor(h/65536),at=h-b*65536,h=ze+b+65535,b=Math.floor(h/65536),ze=h-b*65536,h=Ye+b+65535,b=Math.floor(h/65536),Ye=h-b*65536,h=$e+b+65535,b=Math.floor(h/65536),$e=h-b*65536,X+=b-1+37*(b-1),b=1,h=X+b+65535,b=Math.floor(h/65536),X=h-b*65536,h=oe+b+65535,b=Math.floor(h/65536),oe=h-b*65536,h=ve+b+65535,b=Math.floor(h/65536),ve=h-b*65536,h=Re+b+65535,b=Math.floor(h/65536),Re=h-b*65536,h=Ne+b+65535,b=Math.floor(h/65536),Ne=h-b*65536,h=Ie+b+65535,b=Math.floor(h/65536),Ie=h-b*65536,h=It+b+65535,b=Math.floor(h/65536),It=h-b*65536,h=mt+b+65535,b=Math.floor(h/65536),mt=h-b*65536,h=st+b+65535,b=Math.floor(h/65536),st=h-b*65536,h=De+b+65535,b=Math.floor(h/65536),De=h-b*65536,h=Je+b+65535,b=Math.floor(h/65536),Je=h-b*65536,h=Qe+b+65535,b=Math.floor(h/65536),Qe=h-b*65536,h=at+b+65535,b=Math.floor(h/65536),at=h-b*65536,h=ze+b+65535,b=Math.floor(h/65536),ze=h-b*65536,h=Ye+b+65535,b=Math.floor(h/65536),Ye=h-b*65536,h=$e+b+65535,b=Math.floor(h/65536),$e=h-b*65536,X+=b-1+37*(b-1),R[0]=X,R[1]=oe,R[2]=ve,R[3]=Re,R[4]=Ne,R[5]=Ie,R[6]=It,R[7]=mt,R[8]=st,R[9]=De,R[10]=Je,R[11]=Qe,R[12]=at,R[13]=ze,R[14]=Ye,R[15]=$e}function W(R,A){z(R,A,A)}function ge(R,A){const S=a();let h;for(h=0;h<16;h++)S[h]=A[h];for(h=253;h>=0;h--)W(S,S),h!==2&&h!==4&&z(S,S,A);for(h=0;h<16;h++)R[h]=S[h]}function te(R,A){const S=a();let h;for(h=0;h<16;h++)S[h]=A[h];for(h=250;h>=0;h--)W(S,S),h!==1&&z(S,S,A);for(h=0;h<16;h++)R[h]=S[h]}function Ee(R,A){const S=a(),h=a(),b=a(),X=a(),oe=a(),ve=a(),Re=a(),Ne=a(),Ie=a();$(S,R[1],R[0]),$(Ie,A[1],A[0]),z(S,S,Ie),he(h,R[0],R[1]),he(Ie,A[0],A[1]),z(h,h,Ie),z(b,R[3],A[3]),z(b,b,v),z(X,R[2],A[2]),he(X,X,X),$(oe,h,S),$(ve,X,b),he(Re,X,b),he(Ne,h,S),z(R[0],oe,ve),z(R[1],Ne,Re),z(R[2],Re,ve),z(R[3],oe,Ne)}function Ae(R,A,S){for(let h=0;h<4;h++)K(R[h],A[h],S)}function et(R,A){const S=a(),h=a(),b=a();ge(b,A[2]),z(S,A[0],b),z(h,A[1],b),ae(R,h),R[31]^=pe(S)<<7}function C(R,A,S){U(R[0],f),U(R[1],d),U(R[2],d),U(R[3],f);for(let h=255;h>=0;--h){const b=S[h/8|0]>>(h&7)&1;Ae(R,A,b),Ee(A,R),Ee(R,R),Ae(R,A,b)}}function q(R,A){const S=[a(),a(),a(),a()];U(S[0],P),U(S[1],L),U(S[2],d),z(S[3],P,L),C(R,S,A)}function Me(R){if(R.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const A=(0,t.hash)(R);A[0]&=248,A[31]&=127,A[31]|=64;const S=new Uint8Array(32),h=[a(),a(),a(),a()];q(h,A),et(S,h);const b=new Uint8Array(64);return b.set(R),b.set(S,32),{publicKey:S,secretKey:b}}o.generateKeyPairFromSeed=Me;function Te(R){const A=(0,i.randomBytes)(32,R),S=Me(A);return(0,n.wipe)(A),S}o.generateKeyPair=Te;function J(R){if(R.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(R.subarray(32))}o.extractPublicKeyFromSecretKey=J;const V=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function k(R,A){let S,h,b,X;for(h=63;h>=32;--h){for(S=0,b=h-32,X=h-12;b<X;++b)A[b]+=S-16*A[h]*V[b-(h-32)],S=Math.floor((A[b]+128)/256),A[b]-=S*256;A[b]+=S,A[h]=0}for(S=0,b=0;b<32;b++)A[b]+=S-(A[31]>>4)*V[b],S=A[b]>>8,A[b]&=255;for(b=0;b<32;b++)A[b]-=S*V[b];for(h=0;h<32;h++)A[h+1]+=A[h]>>8,R[h]=A[h]&255}function B(R){const A=new Float64Array(64);for(let S=0;S<64;S++)A[S]=R[S];for(let S=0;S<64;S++)R[S]=0;k(R,A)}function ut(R,A){const S=new Float64Array(64),h=[a(),a(),a(),a()],b=(0,t.hash)(R.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const X=new Uint8Array(64);X.set(b.subarray(32),32);const oe=new t.SHA512;oe.update(X.subarray(32)),oe.update(A);const ve=oe.digest();oe.clean(),B(ve),q(h,ve),et(X,h),oe.reset(),oe.update(X.subarray(0,32)),oe.update(R.subarray(32)),oe.update(A);const Re=oe.digest();B(Re);for(let Ne=0;Ne<32;Ne++)S[Ne]=ve[Ne];for(let Ne=0;Ne<32;Ne++)for(let Ie=0;Ie<32;Ie++)S[Ne+Ie]+=Re[Ne]*b[Ie];return k(X.subarray(32),S),X}o.sign=ut;function He(R,A){const S=a(),h=a(),b=a(),X=a(),oe=a(),ve=a(),Re=a();return U(R[2],d),ue(R[1],A),W(b,R[1]),z(X,b,_),$(b,b,R[2]),he(X,R[2],X),W(oe,X),W(ve,oe),z(Re,ve,oe),z(S,Re,b),z(S,S,X),te(S,S),z(S,S,b),z(S,S,X),z(S,S,X),z(R[0],S,X),W(h,R[0]),z(h,h,X),de(h,b)&&z(R[0],R[0],T),W(h,R[0]),z(h,h,X),de(h,b)?-1:(pe(R[0])===A[31]>>7&&$(R[0],f,R[0]),z(R[3],R[0],R[1]),0)}function Nr(R,A,S){const h=new Uint8Array(32),b=[a(),a(),a(),a()],X=[a(),a(),a(),a()];if(S.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(He(X,R))return!1;const oe=new t.SHA512;oe.update(S.subarray(0,32)),oe.update(R),oe.update(A);const ve=oe.digest();return B(ve),C(b,X,ve),q(X,S.subarray(32)),Ee(b,X),et(h,b),!be(S,h)}o.verify=Nr;function _e(R){let A=[a(),a(),a(),a()];if(He(A,R))throw new Error("Ed25519: invalid public key");let S=a(),h=a(),b=A[1];he(S,d,b),$(h,d,b),ge(h,h),z(S,S,h);let X=new Uint8Array(32);return ae(X,S),X}o.convertPublicKeyToX25519=_e;function xt(R){const A=(0,t.hash)(R.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const S=new Uint8Array(A.subarray(0,32));return(0,n.wipe)(A),S}o.convertSecretKeyToX25519=xt})(Cc);const A_="EdDSA",T_="JWT",Xl=".",ef="base64url",R_="utf8",$_="utf8",N_=":",F_="did",D_="key",Xh="base58btc",q_="z",j_="K36",L_=32;function ua(o){return pa(bc(xc(o),R_),ef)}function tf(o){const i=bc(j_,Xh),t=q_+pa(r1([i,o]),Xh);return[F_,D_,t].join(N_)}function M_(o){return pa(o,ef)}function z_(o){return bc([ua(o.header),ua(o.payload)].join(Xl),$_)}function U_(o){return[ua(o.header),ua(o.payload),M_(o.signature)].join(Xl)}function el(o=ql.randomBytes(L_)){return Cc.generateKeyPairFromSeed(o)}async function H_(o,i,t,n,a=re.fromMiliseconds(Date.now())){const c={alg:A_,typ:T_},f=tf(n.publicKey),d=a+t,_={iss:f,sub:o,aud:i,iat:a,exp:d},v=z_({header:c,payload:_}),P=Cc.sign(n.secretKey,v);return U_({header:c,payload:_,signature:P})}const k_=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),K_=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",tl=o=>o.split("?")[0],rl=10,V_=k_();class B_{constructor(i){if(this.url=i,this.events=new Ur.EventEmitter,this.registering=!1,!Lh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}off(i,t){this.events.off(i,t)}removeListener(i,t){this.events.removeListener(i,t)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),i()},this.socket.close()})}async send(i,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(xc(i))}catch(n){this.onError(i.id,n)}}register(i=this.url){if(!Lh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,a)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),a(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=i,this.registering=!0,new Promise((t,n)=>{const a=k1.isReactNative()?void 0:{rejectUnauthorized:!K1(i)},c=new V_(i,[],a);K_()?c.onerror=f=>{const d=f;n(this.emitError(d.error))}:c.on("error",f=>{n(this.emitError(f))}),c.onopen=()=>{this.onOpen(c),t(c)}})}onOpen(i){i.onmessage=t=>this.onPayload(t),i.onclose=t=>this.onClose(t),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const t=typeof i.data=="string"?kl(i.data):i.data;this.events.emit("payload",t)}onError(i,t){const n=this.parseError(t),a=n.message||n.toString(),c=Ic(i,a);this.events.emit("payload",c)}parseError(i,t=this.url){return V1(i,tl(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>rl&&this.events.setMaxListeners(rl)}emitError(i){const t=this.parseError(new Error((i==null?void 0:i.message)||`WebSocket connection failed for host: ${tl(this.url)}`));return this.events.emit("register_error",t),t}}var ha={exports:{}};ha.exports;(function(o,i){var t=200,n="__lodash_hash_undefined__",a=1,c=2,f=9007199254740991,d="[object Arguments]",_="[object Array]",v="[object AsyncFunction]",P="[object Boolean]",L="[object Date]",T="[object Error]",U="[object Function]",H="[object GeneratorFunction]",K="[object Map]",ae="[object Number]",be="[object Null]",de="[object Object]",pe="[object Promise]",ue="[object Proxy]",he="[object RegExp]",$="[object Set]",z="[object String]",W="[object Symbol]",ge="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Ae="[object DataView]",et="[object Float32Array]",C="[object Float64Array]",q="[object Int8Array]",Me="[object Int16Array]",Te="[object Int32Array]",J="[object Uint8Array]",V="[object Uint8ClampedArray]",k="[object Uint16Array]",B="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,He=/^\[object .+?Constructor\]$/,Nr=/^(?:0|[1-9]\d*)$/,_e={};_e[et]=_e[C]=_e[q]=_e[Me]=_e[Te]=_e[J]=_e[V]=_e[k]=_e[B]=!0,_e[d]=_e[_]=_e[Ee]=_e[P]=_e[Ae]=_e[L]=_e[T]=_e[U]=_e[K]=_e[ae]=_e[de]=_e[he]=_e[$]=_e[z]=_e[te]=!1;var xt=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,R=typeof self=="object"&&self&&self.Object===Object&&self,A=xt||R||Function("return this")(),S=i&&!i.nodeType&&i,h=S&&!0&&o&&!o.nodeType&&o,b=h&&h.exports===S,X=b&&xt.process,oe=function(){try{return X&&X.binding&&X.binding("util")}catch{}}(),ve=oe&&oe.isTypedArray;function Re(y,E){for(var j=-1,Q=y==null?0:y.length,Ve=0,le=[];++j<Q;){var Ze=y[j];E(Ze,j,y)&&(le[Ve++]=Ze)}return le}function Ne(y,E){for(var j=-1,Q=E.length,Ve=y.length;++j<Q;)y[Ve+j]=E[j];return y}function Ie(y,E){for(var j=-1,Q=y==null?0:y.length;++j<Q;)if(E(y[j],j,y))return!0;return!1}function It(y,E){for(var j=-1,Q=Array(y);++j<y;)Q[j]=E(j);return Q}function mt(y){return function(E){return y(E)}}function st(y,E){return y.has(E)}function De(y,E){return y==null?void 0:y[E]}function Je(y){var E=-1,j=Array(y.size);return y.forEach(function(Q,Ve){j[++E]=[Ve,Q]}),j}function Qe(y,E){return function(j){return y(E(j))}}function at(y){var E=-1,j=Array(y.size);return y.forEach(function(Q){j[++E]=Q}),j}var ze=Array.prototype,Ye=Function.prototype,$e=Object.prototype,ke=A["__core-js_shared__"],ht=Ye.toString,je=$e.hasOwnProperty,St=function(){var y=/[^.]+$/.exec(ke&&ke.keys&&ke.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),Ft=$e.toString,zt=RegExp("^"+ht.call(je).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ut=b?A.Buffer:void 0,jt=A.Symbol,Gt=A.Uint8Array,tr=$e.propertyIsEnumerable,Fr=ze.splice,Wt=jt?jt.toStringTag:void 0,Hr=Object.getOwnPropertySymbols,si=Ut?Ut.isBuffer:void 0,Ei=Qe(Object.keys,Object),lt=ur(A,"DataView"),tt=ur(A,"Map"),ft=ur(A,"Promise"),pt=ur(A,"Set"),ot=ur(A,"WeakMap"),rt=ur(Object,"create"),Pt=Kr(lt),Ot=Kr(tt),dt=Kr(ft),Ct=Kr(pt),gt=Kr(ot),_t=jt?jt.prototype:void 0,yt=_t?_t.valueOf:void 0;function We(y){var E=-1,j=y==null?0:y.length;for(this.clear();++E<j;){var Q=y[E];this.set(Q[0],Q[1])}}function At(){this.__data__=rt?rt(null):{},this.size=0}function Tt(y){var E=this.has(y)&&delete this.__data__[y];return this.size-=E?1:0,E}function ma(y){var E=this.__data__;if(rt){var j=E[y];return j===n?void 0:j}return je.call(E,y)?E[y]:void 0}function _a(y){var E=this.__data__;return rt?E[y]!==void 0:je.call(E,y)}function wa(y,E){var j=this.__data__;return this.size+=this.has(y)?0:1,j[y]=rt&&E===void 0?n:E,this}We.prototype.clear=At,We.prototype.delete=Tt,We.prototype.get=ma,We.prototype.has=_a,We.prototype.set=wa;function gr(y){var E=-1,j=y==null?0:y.length;for(this.clear();++E<j;){var Q=y[E];this.set(Q[0],Q[1])}}function ba(){this.__data__=[],this.size=0}function Ea(y){var E=this.__data__,j=xi(E,y);if(j<0)return!1;var Q=E.length-1;return j==Q?E.pop():Fr.call(E,j,1),--this.size,!0}function xa(y){var E=this.__data__,j=xi(E,y);return j<0?void 0:E[j][1]}function Ia(y){return xi(this.__data__,y)>-1}function Sa(y,E){var j=this.__data__,Q=xi(j,y);return Q<0?(++this.size,j.push([y,E])):j[Q][1]=E,this}gr.prototype.clear=ba,gr.prototype.delete=Ea,gr.prototype.get=xa,gr.prototype.has=Ia,gr.prototype.set=Sa;function kr(y){var E=-1,j=y==null?0:y.length;for(this.clear();++E<j;){var Q=y[E];this.set(Q[0],Q[1])}}function zi(){this.size=0,this.__data__={hash:new We,map:new(tt||gr),string:new We}}function Pa(y){var E=ai(this,y).delete(y);return this.size-=E?1:0,E}function Ui(y){return ai(this,y).get(y)}function Oa(y){return ai(this,y).has(y)}function Ca(y,E){var j=ai(this,y),Q=j.size;return j.set(y,E),this.size+=j.size==Q?0:1,this}kr.prototype.clear=zi,kr.prototype.delete=Pa,kr.prototype.get=Ui,kr.prototype.has=Oa,kr.prototype.set=Ca;function Hi(y){var E=-1,j=y==null?0:y.length;for(this.__data__=new kr;++E<j;)this.add(y[E])}function Zn(y){return this.__data__.set(y,n),this}function Xn(y){return this.__data__.has(y)}Hi.prototype.add=Hi.prototype.push=Zn,Hi.prototype.has=Xn;function Sr(y){var E=this.__data__=new gr(y);this.size=E.size}function Aa(){this.__data__=new gr,this.size=0}function Ta(y){var E=this.__data__,j=E.delete(y);return this.size=E.size,j}function Ra(y){return this.__data__.get(y)}function $a(y){return this.__data__.has(y)}function es(y,E){var j=this.__data__;if(j instanceof gr){var Q=j.__data__;if(!tt||Q.length<t-1)return Q.push([y,E]),this.size=++j.size,this;j=this.__data__=new kr(Q)}return j.set(y,E),this.size=j.size,this}Sr.prototype.clear=Aa,Sr.prototype.delete=Ta,Sr.prototype.get=Ra,Sr.prototype.has=$a,Sr.prototype.set=es;function ts(y,E){var j=Vi(y),Q=!j&&ps(y),Ve=!j&&!Q&&gn(y),le=!j&&!Q&&!Ve&&ys(y),Ze=j||Q||Ve||le,Rt=Ze?It(y.length,String):[],Pe=Rt.length;for(var Be in y)(E||je.call(y,Be))&&!(Ze&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||le&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||cs(Be,Pe)))&&Rt.push(Be);return Rt}function xi(y,E){for(var j=y.length;j--;)if(fs(y[j][0],E))return j;return-1}function pn(y,E,j){var Q=E(y);return Vi(y)?Q:Ne(Q,j(y))}function Ii(y){return y==null?y===void 0?ge:be:Wt&&Wt in Object(y)?as(y):Da(y)}function dn(y){return Pi(y)&&Ii(y)==d}function Si(y,E,j,Q,Ve){return y===E?!0:y==null||E==null||!Pi(y)&&!Pi(E)?y!==y&&E!==E:rs(y,E,j,Q,Si,Ve)}function rs(y,E,j,Q,Ve,le){var Ze=Vi(y),Rt=Vi(E),Pe=Ze?_:Dr(y),Be=Rt?_:Dr(E);Pe=Pe==d?de:Pe,Be=Be==d?de:Be;var wt=Pe==de,rr=Be==de,$t=Pe==Be;if($t&&gn(y)){if(!gn(E))return!1;Ze=!0,wt=!1}if($t&&!wt)return le||(le=new Sr),Ze||ys(y)?ki(y,E,j,Q,Ve,le):Fa(y,E,Pe,j,Q,Ve,le);if(!(j&a)){var Xe=wt&&je.call(y,"__wrapped__"),Jt=rr&&je.call(E,"__wrapped__");if(Xe||Jt){var Pr=Xe?y.value():y,yr=Jt?E.value():E;return le||(le=new Sr),Ve(Pr,yr,j,Q,le)}}return $t?(le||(le=new Sr),ss(y,E,j,Q,Ve,le)):!1}function Na(y){if(!gs(y)||hs(y))return!1;var E=Bi(y)?zt:He;return E.test(Kr(y))}function is(y){return Pi(y)&&ds(y.length)&&!!_e[Ii(y)]}function ns(y){if(!ls(y))return Ei(y);var E=[];for(var j in Object(y))je.call(y,j)&&j!="constructor"&&E.push(j);return E}function ki(y,E,j,Q,Ve,le){var Ze=j&a,Rt=y.length,Pe=E.length;if(Rt!=Pe&&!(Ze&&Pe>Rt))return!1;var Be=le.get(y);if(Be&&le.get(E))return Be==E;var wt=-1,rr=!0,$t=j&c?new Hi:void 0;for(le.set(y,E),le.set(E,y);++wt<Rt;){var Xe=y[wt],Jt=E[wt];if(Q)var Pr=Ze?Q(Jt,Xe,wt,E,y,le):Q(Xe,Jt,wt,y,E,le);if(Pr!==void 0){if(Pr)continue;rr=!1;break}if($t){if(!Ie(E,function(yr,qr){if(!st($t,qr)&&(Xe===yr||Ve(Xe,yr,j,Q,le)))return $t.push(qr)})){rr=!1;break}}else if(!(Xe===Jt||Ve(Xe,Jt,j,Q,le))){rr=!1;break}}return le.delete(y),le.delete(E),rr}function Fa(y,E,j,Q,Ve,le,Ze){switch(j){case Ae:if(y.byteLength!=E.byteLength||y.byteOffset!=E.byteOffset)return!1;y=y.buffer,E=E.buffer;case Ee:return!(y.byteLength!=E.byteLength||!le(new Gt(y),new Gt(E)));case P:case L:case ae:return fs(+y,+E);case T:return y.name==E.name&&y.message==E.message;case he:case z:return y==E+"";case K:var Rt=Je;case $:var Pe=Q&a;if(Rt||(Rt=at),y.size!=E.size&&!Pe)return!1;var Be=Ze.get(y);if(Be)return Be==E;Q|=c,Ze.set(y,E);var wt=ki(Rt(y),Rt(E),Q,Ve,le,Ze);return Ze.delete(y),wt;case W:if(yt)return yt.call(y)==yt.call(E)}return!1}function ss(y,E,j,Q,Ve,le){var Ze=j&a,Rt=Ki(y),Pe=Rt.length,Be=Ki(E),wt=Be.length;if(Pe!=wt&&!Ze)return!1;for(var rr=Pe;rr--;){var $t=Rt[rr];if(!(Ze?$t in E:je.call(E,$t)))return!1}var Xe=le.get(y);if(Xe&&le.get(E))return Xe==E;var Jt=!0;le.set(y,E),le.set(E,y);for(var Pr=Ze;++rr<Pe;){$t=Rt[rr];var yr=y[$t],qr=E[$t];if(Q)var yn=Ze?Q(qr,yr,$t,E,y,le):Q(yr,qr,$t,y,E,le);if(!(yn===void 0?yr===qr||Ve(yr,qr,j,Q,le):yn)){Jt=!1;break}Pr||(Pr=$t=="constructor")}if(Jt&&!Pr){var Oi=y.constructor,Lt=E.constructor;Oi!=Lt&&"constructor"in y&&"constructor"in E&&!(typeof Oi=="function"&&Oi instanceof Oi&&typeof Lt=="function"&&Lt instanceof Lt)&&(Jt=!1)}return le.delete(y),le.delete(E),Jt}function Ki(y){return pn(y,La,os)}function ai(y,E){var j=y.__data__;return us(E)?j[typeof E=="string"?"string":"hash"]:j.map}function ur(y,E){var j=De(y,E);return Na(j)?j:void 0}function as(y){var E=je.call(y,Wt),j=y[Wt];try{y[Wt]=void 0;var Q=!0}catch{}var Ve=Ft.call(y);return Q&&(E?y[Wt]=j:delete y[Wt]),Ve}var os=Hr?function(y){return y==null?[]:(y=Object(y),Re(Hr(y),function(E){return tr.call(y,E)}))}:Ke,Dr=Ii;(lt&&Dr(new lt(new ArrayBuffer(1)))!=Ae||tt&&Dr(new tt)!=K||ft&&Dr(ft.resolve())!=pe||pt&&Dr(new pt)!=$||ot&&Dr(new ot)!=te)&&(Dr=function(y){var E=Ii(y),j=E==de?y.constructor:void 0,Q=j?Kr(j):"";if(Q)switch(Q){case Pt:return Ae;case Ot:return K;case dt:return pe;case Ct:return $;case gt:return te}return E});function cs(y,E){return E=E??f,!!E&&(typeof y=="number"||Nr.test(y))&&y>-1&&y%1==0&&y<E}function us(y){var E=typeof y;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?y!=="__proto__":y===null}function hs(y){return!!St&&St in y}function ls(y){var E=y&&y.constructor,j=typeof E=="function"&&E.prototype||$e;return y===j}function Da(y){return Ft.call(y)}function Kr(y){if(y!=null){try{return ht.call(y)}catch{}try{return y+""}catch{}}return""}function fs(y,E){return y===E||y!==y&&E!==E}var ps=dn(function(){return arguments}())?dn:function(y){return Pi(y)&&je.call(y,"callee")&&!tr.call(y,"callee")},Vi=Array.isArray;function qa(y){return y!=null&&ds(y.length)&&!Bi(y)}var gn=si||Ue;function ja(y,E){return Si(y,E)}function Bi(y){if(!gs(y))return!1;var E=Ii(y);return E==U||E==H||E==v||E==ue}function ds(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=f}function gs(y){var E=typeof y;return y!=null&&(E=="object"||E=="function")}function Pi(y){return y!=null&&typeof y=="object"}var ys=ve?mt(ve):is;function La(y){return qa(y)?ts(y):ns(y)}function Ke(){return[]}function Ue(){return!1}o.exports=ja})(ha,ha.exports);var G_=ha.exports;const W_=i1(G_);function J_(o,i){if(o.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var a=0;a<o.length;a++){var c=o.charAt(a),f=c.charCodeAt(0);if(t[f]!==255)throw new TypeError(c+" is ambiguous");t[f]=a}var d=o.length,_=o.charAt(0),v=Math.log(d)/Math.log(256),P=Math.log(256)/Math.log(d);function L(H){if(H instanceof Uint8Array||(ArrayBuffer.isView(H)?H=new Uint8Array(H.buffer,H.byteOffset,H.byteLength):Array.isArray(H)&&(H=Uint8Array.from(H))),!(H instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(H.length===0)return"";for(var K=0,ae=0,be=0,de=H.length;be!==de&&H[be]===0;)be++,K++;for(var pe=(de-be)*P+1>>>0,ue=new Uint8Array(pe);be!==de;){for(var he=H[be],$=0,z=pe-1;(he!==0||$<ae)&&z!==-1;z--,$++)he+=256*ue[z]>>>0,ue[z]=he%d>>>0,he=he/d>>>0;if(he!==0)throw new Error("Non-zero carry");ae=$,be++}for(var W=pe-ae;W!==pe&&ue[W]===0;)W++;for(var ge=_.repeat(K);W<pe;++W)ge+=o.charAt(ue[W]);return ge}function T(H){if(typeof H!="string")throw new TypeError("Expected String");if(H.length===0)return new Uint8Array;var K=0;if(H[K]!==" "){for(var ae=0,be=0;H[K]===_;)ae++,K++;for(var de=(H.length-K)*v+1>>>0,pe=new Uint8Array(de);H[K];){var ue=t[H.charCodeAt(K)];if(ue===255)return;for(var he=0,$=de-1;(ue!==0||he<be)&&$!==-1;$--,he++)ue+=d*pe[$]>>>0,pe[$]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");be=he,K++}if(H[K]!==" "){for(var z=de-be;z!==de&&pe[z]===0;)z++;for(var W=new Uint8Array(ae+(de-z)),ge=ae;z!==de;)W[ge++]=pe[z++];return W}}}function U(H){var K=T(H);if(K)return K;throw new Error(`Non-${i} character`)}return{encode:L,decodeUnsafe:T,decode:U}}var Q_=J_,Y_=Q_;const rf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Z_=o=>new TextEncoder().encode(o),X_=o=>new TextDecoder().decode(o);class ew{constructor(i,t,n){this.name=i,this.prefix=t,this.baseEncode=n}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class tw{constructor(i,t,n){if(this.name=i,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return nf(this,i)}}class rw{constructor(i){this.decoders=i}or(i){return nf(this,i)}decode(i){const t=i[0],n=this.decoders[t];if(n)return n.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const nf=(o,i)=>new rw({...o.decoders||{[o.prefix]:o},...i.decoders||{[i.prefix]:i}});class iw{constructor(i,t,n,a){this.name=i,this.prefix=t,this.baseEncode=n,this.baseDecode=a,this.encoder=new ew(i,t,n),this.decoder=new tw(i,t,a)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const ya=({name:o,prefix:i,encode:t,decode:n})=>new iw(o,i,t,n),Yn=({prefix:o,name:i,alphabet:t})=>{const{encode:n,decode:a}=Y_(t,i);return ya({prefix:o,name:i,encode:n,decode:c=>rf(a(c))})},nw=(o,i,t,n)=>{const a={};for(let P=0;P<i.length;++P)a[i[P]]=P;let c=o.length;for(;o[c-1]==="=";)--c;const f=new Uint8Array(c*t/8|0);let d=0,_=0,v=0;for(let P=0;P<c;++P){const L=a[o[P]];if(L===void 0)throw new SyntaxError(`Non-${n} character`);_=_<<t|L,d+=t,d>=8&&(d-=8,f[v++]=255&_>>d)}if(d>=t||255&_<<8-d)throw new SyntaxError("Unexpected end of data");return f},sw=(o,i,t)=>{const n=i[i.length-1]==="=",a=(1<<t)-1;let c="",f=0,d=0;for(let _=0;_<o.length;++_)for(d=d<<8|o[_],f+=8;f>t;)f-=t,c+=i[a&d>>f];if(f&&(c+=i[a&d<<t-f]),n)for(;c.length*t&7;)c+="=";return c},kt=({name:o,prefix:i,bitsPerChar:t,alphabet:n})=>ya({prefix:i,name:o,encode(a){return sw(a,n,t)},decode(a){return nw(a,n,t,o)}}),aw=ya({prefix:"\0",name:"identity",encode:o=>X_(o),decode:o=>Z_(o)});var ow=Object.freeze({__proto__:null,identity:aw});const cw=kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var uw=Object.freeze({__proto__:null,base2:cw});const hw=kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lw=Object.freeze({__proto__:null,base8:hw});const fw=Yn({prefix:"9",name:"base10",alphabet:"0123456789"});var pw=Object.freeze({__proto__:null,base10:fw});const dw=kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gw=kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var yw=Object.freeze({__proto__:null,base16:dw,base16upper:gw});const vw=kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mw=kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_w=kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ww=kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),bw=kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ew=kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xw=kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Iw=kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Sw=kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Pw=Object.freeze({__proto__:null,base32:vw,base32upper:mw,base32pad:_w,base32padupper:ww,base32hex:bw,base32hexupper:Ew,base32hexpad:xw,base32hexpadupper:Iw,base32z:Sw});const Ow=Yn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Cw=Yn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Aw=Object.freeze({__proto__:null,base36:Ow,base36upper:Cw});const Tw=Yn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Rw=Yn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var $w=Object.freeze({__proto__:null,base58btc:Tw,base58flickr:Rw});const Nw=kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fw=kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Dw=kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),qw=kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var jw=Object.freeze({__proto__:null,base64:Nw,base64pad:Fw,base64url:Dw,base64urlpad:qw});const sf=Array.from(""),Lw=sf.reduce((o,i,t)=>(o[t]=i,o),[]),Mw=sf.reduce((o,i,t)=>(o[i.codePointAt(0)]=t,o),[]);function zw(o){return o.reduce((i,t)=>(i+=Lw[t],i),"")}function Uw(o){const i=[];for(const t of o){const n=Mw[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);i.push(n)}return new Uint8Array(i)}const Hw=ya({prefix:"",name:"base256emoji",encode:zw,decode:Uw});var kw=Object.freeze({__proto__:null,base256emoji:Hw}),Kw=af,il=128,Vw=127,Bw=~Vw,Gw=Math.pow(2,31);function af(o,i,t){i=i||[],t=t||0;for(var n=t;o>=Gw;)i[t++]=o&255|il,o/=128;for(;o&Bw;)i[t++]=o&255|il,o>>>=7;return i[t]=o|0,af.bytes=t-n+1,i}var Ww=yc,Jw=128,nl=127;function yc(o,n){var t=0,n=n||0,a=0,c=n,f,d=o.length;do{if(c>=d)throw yc.bytes=0,new RangeError("Could not decode varint");f=o[c++],t+=a<28?(f&nl)<<a:(f&nl)*Math.pow(2,a),a+=7}while(f>=Jw);return yc.bytes=c-n,t}var Qw=Math.pow(2,7),Yw=Math.pow(2,14),Zw=Math.pow(2,21),Xw=Math.pow(2,28),eb=Math.pow(2,35),tb=Math.pow(2,42),rb=Math.pow(2,49),ib=Math.pow(2,56),nb=Math.pow(2,63),sb=function(o){return o<Qw?1:o<Yw?2:o<Zw?3:o<Xw?4:o<eb?5:o<tb?6:o<rb?7:o<ib?8:o<nb?9:10},ab={encode:Kw,decode:Ww,encodingLength:sb},of=ab;const sl=(o,i,t=0)=>(of.encode(o,i,t),i),al=o=>of.encodingLength(o),vc=(o,i)=>{const t=i.byteLength,n=al(o),a=n+al(t),c=new Uint8Array(a+t);return sl(o,c,0),sl(t,c,n),c.set(i,a),new ob(o,t,i,c)};class ob{constructor(i,t,n,a){this.code=i,this.size=t,this.digest=n,this.bytes=a}}const cf=({name:o,code:i,encode:t})=>new cb(o,i,t);class cb{constructor(i,t,n){this.name=i,this.code=t,this.encode=n}digest(i){if(i instanceof Uint8Array){const t=this.encode(i);return t instanceof Uint8Array?vc(this.code,t):t.then(n=>vc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const uf=o=>async i=>new Uint8Array(await crypto.subtle.digest(o,i)),ub=cf({name:"sha2-256",code:18,encode:uf("SHA-256")}),hb=cf({name:"sha2-512",code:19,encode:uf("SHA-512")});var lb=Object.freeze({__proto__:null,sha256:ub,sha512:hb});const hf=0,fb="identity",lf=rf,pb=o=>vc(hf,lf(o)),db={code:hf,name:fb,encode:lf,digest:pb};var gb=Object.freeze({__proto__:null,identity:db});new TextEncoder,new TextDecoder;const ol={...ow,...uw,...lw,...pw,...yw,...Pw,...Aw,...$w,...jw,...kw};({...lb,...gb});function ff(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function yb(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ff(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function pf(o,i,t,n){return{name:o,prefix:i,encoder:{name:o,prefix:i,encode:t},decoder:{decode:n}}}const cl=pf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),Qo=pf("ascii","a",o=>{let i="a";for(let t=0;t<o.length;t++)i+=String.fromCharCode(o[t]);return i},o=>{o=o.substring(1);const i=yb(o.length);for(let t=0;t<o.length;t++)i[t]=o.charCodeAt(t);return i}),vb={utf8:cl,"utf-8":cl,hex:ol.base16,latin1:Qo,ascii:Qo,binary:Qo,...ol};function mb(o,i="utf8"){const t=vb[i];if(!t)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ff(globalThis.Buffer.from(o,"utf-8")):t.decoder.decode(`${t.prefix}${o}`)}const df="wc",_b=2,Ac="core",_i=`${df}@2:${Ac}:`,wb={name:Ac,logger:"error"},bb={database:":memory:"},Eb="crypto",ul="client_ed25519_seed",xb=re.ONE_DAY,Ib="keychain",Sb="0.3",Pb="messages",Ob="0.3",Cb=re.SIX_HOURS,Ab="publisher",gf="irn",Tb="error",yf="wss://relay.walletconnect.com",hl="wss://relay.walletconnect.org",Rb="relayer",Bt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},$b="_subscription",ei={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Nb=re.ONE_SECOND,Fb="2.10.2",Db=1e4,qb="0.3",jb="WALLETCONNECT_CLIENT_ID",Rr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Lb="subscription",Mb="0.3",zb=re.FIVE_SECONDS*1e3,Ub="pairing",Hb="0.3",jn={wc_pairingDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:re.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:re.ONE_DAY,prompt:!1,tag:0},res:{ttl:re.ONE_DAY,prompt:!1,tag:0}}},kn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},zr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},kb="history",Kb="0.3",Vb="expirer",Ir={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Bb="0.3",Yo="verify-api",ca="https://verify.walletconnect.com",ll="https://verify.walletconnect.org";class Gb{constructor(i,t){this.core=i,this.logger=t,this.keychain=new Map,this.name=Ib,this.version=Sb,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:c}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=i,this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,zl(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Ul(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Wb{constructor(i,t,n){this.core=i,this.logger=t,this.name=Eb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),c=el(a);return tf(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=a1();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const c=await this.getClientSeed(),f=el(c),d=sc();return await H_(d,a,xb,f)},this.generateSharedKey=(a,c,f)=>{this.isInitialized();const d=this.getPrivateKey(a),_=o1(d,c);return this.setSymKey(_,f)},this.setSymKey=async(a,c)=>{this.isInitialized();const f=c||c1(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,c,f)=>{this.isInitialized();const d=u1(f),_=xc(c);if(Nh(d)){const T=d.senderPublicKey,U=d.receiverPublicKey;a=await this.generateSharedKey(T,U)}const v=this.getSymKey(a),{type:P,senderPublicKey:L}=d;return h1({type:P,symKey:v,message:_,senderPublicKey:L})},this.decode=async(a,c,f)=>{this.isInitialized();const d=l1(c,f);if(Nh(d)){const _=d.receiverPublicKey,v=d.senderPublicKey;a=await this.generateSharedKey(_,v)}try{const _=this.getSymKey(a),v=f1({symKey:_,encoded:c});return kl(v)}catch(_){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(_)}},this.getPayloadType=a=>{const c=Fh(a);return p1(c.type)},this.getPayloadSenderPublicKey=a=>{const c=Fh(a);return c.senderPublicKey?pa(c.senderPublicKey,d1):void 0},this.core=i,this.logger=Ce.generateChildLogger(t,this.name),this.keychain=n||new Gb(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(i,t){return await this.keychain.set(i,t),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(ul)}catch{i=sc(),await this.keychain.set(ul,i)}return mb(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Jb extends w_{constructor(i,t){super(i,t),this.logger=i,this.core=t,this.messages=new Map,this.name=Pb,this.version=Ob,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const c=hn(a);let f=this.messages.get(n);return typeof f>"u"&&(f={}),typeof f[c]<"u"||(f[c]=a,this.messages.set(n,f),await this.persist()),c},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const c=this.get(n),f=hn(a);return typeof c[f]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ce.generateChildLogger(i,this.name),this.core=t}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,zl(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Ul(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Qb extends b_{constructor(i,t){super(i,t),this.relayer=i,this.logger=t,this.events=new Ur.EventEmitter,this.name=Ab,this.queue=new Map,this.publishTimeout=re.toMiliseconds(re.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,c)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:c}});try{const d=(c==null?void 0:c.ttl)||Cb,_=ac(c),v=(c==null?void 0:c.prompt)||!1,P=(c==null?void 0:c.tag)||0,L=(c==null?void 0:c.id)||B1().toString(),T={topic:n,message:a,opts:{ttl:d,relay:_,prompt:v,tag:P,id:L}},U=setTimeout(()=>this.queue.set(L,T),this.publishTimeout);try{await await Bn(this.rpcPublish(n,a,d,_,v,P,L),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(L),this.relayer.events.emit(Bt.publish,T)}catch(H){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=c==null?void 0:c.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(L),H;return}finally{clearTimeout(U)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:c}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=i,this.logger=Ce.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(i,t,n,a,c,f,d){var _,v,P,L;const T={method:aa(a.protocol).publish,params:{topic:i,message:t,ttl:n,prompt:c,tag:f},id:d};return mi((_=T.params)==null?void 0:_.prompt)&&((v=T.params)==null||delete v.prompt),mi((P=T.params)==null?void 0:P.tag)&&((L=T.params)==null||delete L.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:T}),this.relayer.request(T)}removeRequestFromQueue(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:t,message:n,opts:a}=i;await this.publish(t,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(fn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Bt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Bt.message_ack,i=>{this.removeRequestFromQueue(i.id.toString())})}}class Yb{constructor(){this.map=new Map,this.set=(i,t)=>{const n=this.get(i);this.exists(i,t)||this.map.set(i,[...n,t])},this.get=i=>this.map.get(i)||[],this.exists=(i,t)=>this.get(i).includes(t),this.delete=(i,t)=>{if(typeof t>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const n=this.get(i);if(!this.exists(i,t))return;const a=n.filter(c=>c!==t);if(!a.length){this.map.delete(i);return}this.map.set(i,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Zb=Object.defineProperty,Xb=Object.defineProperties,eE=Object.getOwnPropertyDescriptors,fl=Object.getOwnPropertySymbols,tE=Object.prototype.hasOwnProperty,rE=Object.prototype.propertyIsEnumerable,pl=(o,i,t)=>i in o?Zb(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Ln=(o,i)=>{for(var t in i||(i={}))tE.call(i,t)&&pl(o,t,i[t]);if(fl)for(var t of fl(i))rE.call(i,t)&&pl(o,t,i[t]);return o},Zo=(o,i)=>Xb(o,eE(i));class iE extends I_{constructor(i,t){super(i,t),this.relayer=i,this.logger=t,this.subscriptions=new Map,this.topicMap=new Yb,this.events=new Ur.EventEmitter,this.name=Lb,this.version=Mb,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=_i,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const c=ac(a),f={topic:n,relay:c};this.pending.set(n,f);const d=await this.rpcSubscribe(n,c);return this.onSubscribe(d,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),d}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,c)=>{const f=new re.Watch;f.start(this.pendingSubscriptionWatchLabel);const d=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(d),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=zb&&(clearInterval(d),f.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=Ce.generateChildLogger(t,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,t){let n=!1;try{n=this.getSubscription(i).topic===t}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,t){const n=this.topicMap.get(i);await Promise.all(n.map(async a=>await this.unsubscribeById(i,a,t)))}async unsubscribeById(i,t,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:t,opts:n}});try{const a=ac(n);await this.rpcUnsubscribe(i,t,a);const c=er("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,t,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:t,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(i,t){const n={method:aa(t.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Bn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Bt.connection_stalled)}return hn(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const t=i[0].relay,n={method:aa(t.protocol).batchSubscribe,params:{topics:i.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Bn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Bt.connection_stalled)}}rpcUnsubscribe(i,t,n){const a={method:aa(n.protocol).unsubscribe,params:{topic:i,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(i,t){this.setSubscription(i,Zo(Ln({},t),{id:i})),this.pending.delete(t.topic)}onBatchSubscribe(i){i.length&&i.forEach(t=>{this.setSubscription(t.id,Ln({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(i,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,i)&&this.deleteSubscription(t,n),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,t){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:t}),this.addSubscription(i,t))}addSubscription(i,t){this.subscriptions.set(i,Ln({},t)),this.topicMap.set(t.topic,i),this.events.emit(Rr.created,t)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const t=this.subscriptions.get(i);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return t}deleteSubscription(i,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:t});const n=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(n.topic,i),this.events.emit(Rr.deleted,Zo(Ln({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Rr.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<i;t++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Rr.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const t=await this.rpcBatchSubscribe(i);ln(t)&&this.onBatchSubscribe(t.map((n,a)=>Zo(Ln({},i[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(t=>{i.push(t)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(fn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Bt.connect,async()=>{await this.onConnect()}),this.relayer.on(Bt.disconnect,()=>{this.onDisconnect()}),this.events.on(Rr.created,async i=>{const t=Rr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),await this.persist()}),this.events.on(Rr.deleted,async i=>{const t=Rr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),i())},this.pollingInterval)})}}var nE=Object.defineProperty,dl=Object.getOwnPropertySymbols,sE=Object.prototype.hasOwnProperty,aE=Object.prototype.propertyIsEnumerable,gl=(o,i,t)=>i in o?nE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,oE=(o,i)=>{for(var t in i||(i={}))sE.call(i,t)&&gl(o,t,i[t]);if(dl)for(var t of dl(i))aE.call(i,t)&&gl(o,t,i[t]);return o};class cE extends E_{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new Ur.EventEmitter,this.name=Rb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(Bt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(Bt.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ei.payload,this.onPayloadHandler),this.provider.on(ei.connect,this.onConnectHandler),this.provider.on(ei.disconnect,this.onDisconnectHandler),this.provider.on(ei.error,this.onProviderErrorHandler)},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?Ce.generateChildLogger(i.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:i.logger||Tb})),this.messages=new Jb(this.logger,i.core),this.subscriber=new iE(this,this.logger),this.publisher=new Qb(this,this.logger),this.relayUrl=(i==null?void 0:i.relayUrl)||yf,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${hl}...`),await this.restartTransport(hl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Db)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,t,n){this.isInitialized(),await this.publisher.publish(i,t,n),await this.recordMessageEvent({topic:i,message:t,publishedAt:Date.now()})}async subscribe(i,t){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(i))==null?void 0:n[0])||"";if(a)return a;let c;const f=d=>{d.topic===i&&(this.subscriber.off(Rr.created,f),c())};return await Promise.all([new Promise(d=>{c=d,this.subscriber.on(Rr.created,f)}),new Promise(async d=>{a=await this.subscriber.subscribe(i,t),d()})]),a}async unsubscribe(i,t){this.isInitialized(),await this.subscriber.unsubscribe(i,t)}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}off(i,t){this.events.off(i,t)}removeListener(i,t){this.events.removeListener(i,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Bn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(i){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){i&&i!==this.relayUrl&&(this.relayUrl=i,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(Rr.resubscribed,()=>{t()})}),new Promise(async(t,n)=>{try{await Bn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){n(a);return}t()})])}catch(t){this.logger.error(t);const n=t;if(!this.isConnectionStalled(n.message))throw t;this.provider.events.emit(ei.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(i){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=i||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Dh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(i){return this.staleConnectionErrors.some(t=>i.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ii(new B_(g1({sdkVersion:Fb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:t,message:n}=i;await this.messages.set(t,n)}async shouldIgnoreMessageEvent(i){const{topic:t,message:n}=i;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const a=this.messages.has(t,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),Sc(i)){if(!i.method.endsWith($b))return;const t=i.params,{topic:n,message:a,publishedAt:c}=t.data,f={topic:n,message:a,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(oE({type:"event",event:t.id},f)),this.events.emit(t.id,f),await this.acknowledgePayload(i),await this.onMessageEvent(f)}else Pc(i)&&this.events.emit(Bt.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(Bt.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const t=Oc(i.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(ei.payload,this.onPayloadHandler),this.provider.off(ei.connect,this.onConnectHandler),this.provider.off(ei.disconnect,this.onDisconnectHandler),this.provider.off(ei.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Bt.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let i=await Dh();y1(async t=>{this.initialized&&i!==t&&(i=t,t?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Bt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(i=>this.logger.error(i))},re.toMiliseconds(Nb)))}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(i=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var uE=Object.defineProperty,yl=Object.getOwnPropertySymbols,hE=Object.prototype.hasOwnProperty,lE=Object.prototype.propertyIsEnumerable,vl=(o,i,t)=>i in o?uE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,ml=(o,i)=>{for(var t in i||(i={}))hE.call(i,t)&&vl(o,t,i[t]);if(yl)for(var t of yl(i))lE.call(i,t)&&vl(o,t,i[t]);return o};class va extends x_{constructor(i,t,n,a=_i,c=void 0){super(i,t,n,a),this.core=i,this.logger=t,this.name=n,this.map=new Map,this.version=qb,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!mi(f)?this.map.set(this.getKey(f),f):n1(f)?this.map.set(f.id,f):s1(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,d)=>{this.isInitialized(),this.map.has(f)?await this.update(f,d):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:d}),this.map.set(f,d),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(d=>Object.keys(f).every(_=>W_(d[_],f[_]))):this.values),this.update=async(f,d)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:d});const _=ml(ml({},this.getData(f)),d);this.map.set(f,_),await this.persist()},this.delete=async(f,d)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:d}),this.map.delete(f),await this.persist())},this.logger=Ce.generateChildLogger(t,this.name),this.storagePrefix=a,this.getKey=c}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const t=this.map.get(i);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class fE{constructor(i,t){this.core=i,this.logger=t,this.name=Ub,this.version=Hb,this.events=new Ec,this.initialized=!1,this.storagePrefix=_i,this.ignoredPayloadTypes=[jl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=sc(),a=await this.core.crypto.setSymKey(n),c=$r(re.FIVE_MINUTES),f={protocol:gf},d={topic:a,expiry:c,relay:f,active:!1},_=v1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:f});return await this.pairings.set(a,d),await this.core.relayer.subscribe(a),this.core.expirer.set(a,c),{topic:a,uri:_}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:c,relay:f}=m1(n.uri);let d;if(this.pairings.keys.includes(a)&&(d=this.pairings.get(a),d.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(c,a),await this.core.relayer.subscribe(a,{relay:f}));const _=$r(re.FIVE_MINUTES),v={topic:a,relay:f,expiry:_,active:!1};return await this.pairings.set(a,v),this.core.expirer.set(a,_),n.activatePairing&&await this.activate({topic:a}),this.events.emit(kn.create,v),v},this.activate=async({topic:n})=>{this.isInitialized();const a=$r(re.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const c=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:d,reject:_}=on();this.events.once(Nt("pairing_ping",c),({error:v})=>{v?_(v):d()}),await f()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",er("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,c)=>{const f=Vn(a,c),d=await this.core.crypto.encode(n,f),_=jn[a].req;return this.core.history.set(n,f),this.core.relayer.publish(n,d,_),f.id},this.sendResult=async(n,a,c)=>{const f=Oc(n,c),d=await this.core.crypto.encode(a,f),_=await this.core.history.get(a,n),v=jn[_.request.method].res;await this.core.relayer.publish(a,d,v),await this.core.history.resolve(f)},this.sendError=async(n,a,c)=>{const f=Ic(n,c),d=await this.core.crypto.encode(a,f),_=await this.core.history.get(a,n),v=jn[_.request.method]?jn[_.request.method].res:jn.unregistered_method.res;await this.core.relayer.publish(a,d,v),await this.core.history.resolve(f)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,er("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>vi(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(a,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,c);default:return this.onUnknownRpcMethodRequest(a,c)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:c}=n,f=(await this.core.history.get(a,c.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,c);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(n,a)=>{const{id:c}=a;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(kn.ping,{id:c,topic:n})}catch(f){await this.sendError(c,n,f),this.logger.error(f)}},this.onPairingPingResponse=(n,a)=>{const{id:c}=a;setTimeout(()=>{yi(a)?this.events.emit(Nt("pairing_ping",c),{}):ri(a)&&this.events.emit(Nt("pairing_ping",c),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:c}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(kn.delete,{id:c,topic:n})}catch(f){await this.sendError(c,n,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:c,method:f}=a;try{if(this.registeredMethods.includes(f))return;const d=er("WC_METHOD_UNSUPPORTED",f);await this.sendError(c,n,d),this.logger.error(d)}catch(d){await this.sendError(c,n,d),this.logger.error(d)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(er("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!cr(n)){const{message:a}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(a)}if(!_1(n.uri)){const{message:a}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(a)}},this.isValidPing=async n=>{if(!cr(n)){const{message:c}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!cr(n)){const{message:c}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!cn(n,!1)){const{message:a}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(vi(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=i,this.logger=Ce.generateChildLogger(t,this.name),this.pairings=new va(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(Bt.message,async i=>{const{topic:t,message:n}=i;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(t,n);try{Sc(a)?(this.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Pc(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.core.history.delete(t,a.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Ir.expired,async i=>{const{topic:t}=Ll(i.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(kn.expire,{topic:t}))})}}class pE extends __{constructor(i,t){super(i,t),this.core=i,this.logger=t,this.records=new Map,this.events=new Ur.EventEmitter,this.name=kb,this.version=Kb,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:c}),this.records.has(a.id))return;const f={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:c,expiry:$r(re.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(zr.created,f)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=ri(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(zr.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(c=>{if(c.topic===n){if(typeof a<"u"&&c.id!==a)return;this.records.delete(c.id),this.events.emit(zr.deleted,c)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const n={topic:t.topic,request:Vn(t.request.method,t.request.params,t.id),chainId:t.chainId};return i.push(n)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const t=this.records.get(i);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(zr.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(zr.created,i=>{const t=zr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.events.on(zr.updated,i=>{const t=zr.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.events.on(zr.deleted,i=>{const t=zr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.core.heartbeat.on(fn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{re.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class dE extends S_{constructor(i,t){super(i,t),this.core=i,this.logger=t,this.expirations=new Map,this.events=new Ur.EventEmitter,this.name=Vb,this.version=Bb,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const c=this.formatTarget(n),f={target:c,expiry:a};this.expirations.set(c,f),this.checkExpiry(c,f),this.events.emit(Ir.created,{target:c,expiration:f})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),c=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ir.deleted,{target:a,expiration:c})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return w1(i);if(typeof i=="number")return b1(i);const{message:t}=Z("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(t)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ir.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const t=this.expirations.get(i);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return t}checkExpiry(i,t){const{expiry:n}=t;re.toMiliseconds(n)-Date.now()<=0&&this.expire(i,t)}expire(i,t){this.expirations.delete(i),this.events.emit(Ir.expired,{target:i,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,t)=>this.checkExpiry(t,i))}registerEventListeners(){this.core.heartbeat.on(fn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ir.created,i=>{const t=Ir.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()}),this.events.on(Ir.expired,i=>{const t=Ir.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()}),this.events.on(Ir.deleted,i=>{const t=Ir.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class gE extends P_{constructor(i,t){super(i,t),this.projectId=i,this.logger=t,this.name=Yo,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||E1()||!Ml())return;const n=ca;this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(a){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(a)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ll;try{await this.createIframe()}catch(a){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(a),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const a=(n==null?void 0:n.verifyUrl)||ca;let c;try{c=await this.fetchAttestation(n.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${a}`),this.logger.info(f),c=await this.fetchAttestation(n.attestationId,ll)}return c},this.fetchAttestation=async(n,a)=>{this.logger.info(`resolving attestation: ${n} from url: ${a}`);const c=this.startAbortTimer(re.ONE_SECOND*2),f=await fetch(`${a}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),f.status===200?await f.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const a=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),n())};await Promise.race([new Promise(c=>{if(document.getElementById(Yo))return c();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=Yo,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,n=c}),new Promise((c,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},re.toMiliseconds(re.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ce.generateChildLogger(t,this.name),this.verifyUrl=ca,this.abortController=new AbortController,this.isDevEnv=x1()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(i){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),re.toMiliseconds(i))}}var yE=Object.defineProperty,_l=Object.getOwnPropertySymbols,vE=Object.prototype.hasOwnProperty,mE=Object.prototype.propertyIsEnumerable,wl=(o,i,t)=>i in o?yE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,bl=(o,i)=>{for(var t in i||(i={}))vE.call(i,t)&&wl(o,t,i[t]);if(_l)for(var t of _l(i))mE.call(i,t)&&wl(o,t,i[t]);return o};class Tc extends m_{constructor(i){super(i),this.protocol=df,this.version=_b,this.name=Ac,this.events=new Ur.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=i==null?void 0:i.projectId,this.relayUrl=(i==null?void 0:i.relayUrl)||yf,this.customStoragePrefix=i!=null&&i.customStoragePrefix?`:${i.customStoragePrefix}`:"";const t=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||wb.logger}));this.logger=Ce.generateChildLogger(t,this.name),this.heartbeat=new fn.HeartBeat,this.crypto=new Wb(this,this.logger,i==null?void 0:i.keychain),this.history=new pE(this,this.logger),this.expirer=new dE(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new Em(bl(bl({},bb),i==null?void 0:i.storageOptions)),this.relayer=new cE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new fE(this,this.logger),this.verify=new gE(this.projectId||"",this.logger)}static async init(i){const t=new Tc(i);await t.initialize();const n=await t.crypto.getClientId();return await t.storage.setItem(jb,n),t}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const _E=Tc,vf="wc",mf=2,_f="client",Rc=`${vf}@${mf}:${_f}:`,Xo={name:_f,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},El="WALLETCONNECT_DEEPLINK_CHOICE",wE="proposal",wf="Proposal expired",bE="session",ia=re.SEVEN_DAYS,EE="engine",Mn={wc_sessionPropose:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1104},res:{ttl:re.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1106},res:{ttl:re.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1112},res:{ttl:re.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1115}}},ec={min:re.FIVE_MINUTES,max:re.SEVEN_DAYS},ti={idle:"IDLE",active:"ACTIVE"},xE="request",IE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var SE=Object.defineProperty,PE=Object.defineProperties,OE=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,CE=Object.prototype.hasOwnProperty,AE=Object.prototype.propertyIsEnumerable,Il=(o,i,t)=>i in o?SE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,or=(o,i)=>{for(var t in i||(i={}))CE.call(i,t)&&Il(o,t,i[t]);if(xl)for(var t of xl(i))AE.call(i,t)&&Il(o,t,i[t]);return o},zn=(o,i)=>PE(o,OE(i));class TE extends C_{constructor(i){super(i),this.name=EE,this.events=new Ec,this.initialized=!1,this.ignoredPayloadTypes=[jl],this.requestQueue={state:ti.idle,queue:[]},this.sessionRequestQueue={state:ti.idle,queue:[]},this.requestQueueDelay=re.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Mn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const n=zn(or({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:c,optionalNamespaces:f,sessionProperties:d,relays:_}=n;let v=a,P,L=!1;if(v&&(L=this.client.core.pairing.pairings.get(v).active),!v||!L){const{topic:pe,uri:ue}=await this.client.core.pairing.create();v=pe,P=ue}const T=await this.client.core.crypto.generateKeyPair(),U=or({requiredNamespaces:c,optionalNamespaces:f,relays:_??[{protocol:gf}],proposer:{publicKey:T,metadata:this.client.metadata}},d&&{sessionProperties:d}),{reject:H,resolve:K,done:ae}=on(re.FIVE_MINUTES,wf);if(this.events.once(Nt("session_connect"),async({error:pe,session:ue})=>{if(pe)H(pe);else if(ue){ue.self.publicKey=T;const he=zn(or({},ue),{requiredNamespaces:ue.requiredNamespaces,optionalNamespaces:ue.optionalNamespaces});await this.client.session.set(ue.topic,he),await this.setExpiry(ue.topic,ue.expiry),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:ue.peer.metadata}),K(he)}}),!v){const{message:pe}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${v}`);throw new Error(pe)}const be=await this.sendRequest({topic:v,method:"wc_sessionPropose",params:U}),de=$r(re.FIVE_MINUTES);return await this.setProposal(be,or({id:be,expiry:de},U)),{uri:P,approval:ae}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:n,relayProtocol:a,namespaces:c,sessionProperties:f}=t,d=this.client.proposal.get(n);let{pairingTopic:_,proposer:v,requiredNamespaces:P,optionalNamespaces:L}=d;_=_||"",oa(P)||(P=S1(c,"approve()"));const T=await this.client.core.crypto.generateKeyPair(),U=v.publicKey,H=await this.client.core.crypto.generateSharedKey(T,U);_&&n&&(await this.client.core.pairing.updateMetadata({topic:_,metadata:v.metadata}),await this.sendResult({id:n,topic:_,result:{relay:{protocol:a??"irn"},responderPublicKey:T}}),await this.client.proposal.delete(n,er("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:_}));const K=or({relay:{protocol:a??"irn"},namespaces:c,requiredNamespaces:P,optionalNamespaces:L,pairingTopic:_,controller:{publicKey:T,metadata:this.client.metadata},expiry:$r(ia)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(H),await this.sendRequest({topic:H,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0});const ae=zn(or({},K),{topic:H,pairingTopic:_,acknowledged:!1,self:K.controller,peer:{publicKey:v.publicKey,metadata:v.metadata},controller:T});return await this.client.session.set(H,ae),await this.setExpiry(H,$r(ia)),{topic:H,acknowledged:()=>new Promise(be=>setTimeout(()=>be(this.client.session.get(H)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:n,reason:a}=t,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,a),await this.client.proposal.delete(n,er("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:n,namespaces:a}=t,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:d,reject:_}=on();return this.events.once(Nt("session_update",c),({error:v})=>{v?_(v):d()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:f}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:n}=t,a=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:f,reject:d}=on();return this.events.once(Nt("session_extend",a),({error:_})=>{_?d(_):f()}),await this.setExpiry(n,$r(ia)),{acknowledged:c}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:n,request:a,topic:c,expiry:f}=t,d=G1(),{done:_,resolve:v,reject:P}=on(f,"Request expired. Please try again.");return this.events.once(Nt("session_request",d),({error:L,result:T})=>{L?P(L):v(T)}),await Promise.all([new Promise(async L=>{await this.sendRequest({clientRpcId:d,topic:c,method:"wc_sessionRequest",params:{request:a,chainId:n},expiry:f,throwOnFailedPublish:!0}).catch(T=>P(T)),this.client.events.emit("session_request_sent",{topic:c,request:a,chainId:n,id:d}),L()}),new Promise(async L=>{const T=await this.client.core.storage.getItem(El);P1({id:d,topic:c,wcDeepLink:T}),L()}),_()]).then(L=>L[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:n,response:a}=t,{id:c}=a;yi(a)?await this.sendResult({id:c,topic:n,result:a.result,throwOnFailedPublish:!0}):ri(a)&&await this.sendError(c,n,a.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:n}=t;if(this.client.session.keys.includes(n)){const a=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:f,reject:d}=on();this.events.once(Nt("session_ping",a),({error:_})=>{_?d(_):f()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:n,event:a,chainId:c}=t;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:a,chainId:c}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:n}=t;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:er("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(n=>O1(n,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const n=this.client.core.pairing.pairings.get(t.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(c=>{var f,d;return((f=c.peerMetadata)==null?void 0:f.url)&&((d=c.peerMetadata)==null?void 0:d.url)===t.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(t,n)=>{const{self:a}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,er("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),n||this.client.core.expirer.del(t),this.client.core.storage.removeItem(El).catch(c=>this.client.logger.warn(c))},this.deleteProposal=async(t,n)=>{await Promise.all([this.client.proposal.delete(t,er("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,n),a?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==t),a&&(this.sessionRequestQueue.state=ti.idle)},this.setExpiry=async(t,n)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:n}),this.client.core.expirer.set(t,n)},this.setProposal=async(t,n)=>{await this.client.proposal.set(t,n),this.client.core.expirer.set(t,n.expiry)},this.setPendingSessionRequest=async t=>{const n=Mn.wc_sessionRequest.req.ttl,{id:a,topic:c,params:f,verifyContext:d}=t;await this.client.pendingRequest.set(a,{id:a,topic:c,params:f,verifyContext:d}),n&&this.client.core.expirer.set(a,$r(n))},this.sendRequest=async t=>{const{topic:n,method:a,params:c,expiry:f,relayRpcId:d,clientRpcId:_,throwOnFailedPublish:v}=t,P=Vn(a,c,_);if(Ml()&&IE.includes(a)){const U=hn(JSON.stringify(P));this.client.core.verify.register({attestationId:U})}const L=await this.client.core.crypto.encode(n,P),T=Mn[a].req;return f&&(T.ttl=f),d&&(T.id=d),this.client.core.history.set(n,P),v?(T.internal=zn(or({},T.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,L,T)):this.client.core.relayer.publish(n,L,T).catch(U=>this.client.logger.error(U)),P.id},this.sendResult=async t=>{const{id:n,topic:a,result:c,throwOnFailedPublish:f}=t,d=Oc(n,c),_=await this.client.core.crypto.encode(a,d),v=await this.client.core.history.get(a,n),P=Mn[v.request.method].res;f?(P.internal=zn(or({},P.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,_,P)):this.client.core.relayer.publish(a,_,P).catch(L=>this.client.logger.error(L)),await this.client.core.history.resolve(d)},this.sendError=async(t,n,a)=>{const c=Ic(t,a),f=await this.client.core.crypto.encode(n,c),d=await this.client.core.history.get(n,t),_=Mn[d.request.method].res;this.client.core.relayer.publish(n,f,_),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const t=[],n=[];this.client.session.getAll().forEach(a=>{vi(a.expiry)&&t.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{vi(a.expiry)&&n.push(a.id)}),await Promise.all([...t.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ti.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ti.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ti.idle},this.processRequest=t=>{const{topic:n,payload:a}=t,c=a.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async t=>{const{topic:n,payload:a}=t,c=(await this.client.core.history.get(n,a.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:n}=t,{message:a}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(t,n)=>{const{params:a,id:c}=n;try{this.isValidConnect(or({},n.params));const f=$r(re.FIVE_MINUTES),d=or({id:c,pairingTopic:t,expiry:f},a);await this.setProposal(c,d);const _=hn(JSON.stringify(n)),v=await this.getVerifyContext(_,d.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:d,verifyContext:v})}catch(f){await this.sendError(c,t,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(t,n)=>{const{id:a}=n;if(yi(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const d=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:d});const _=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:_});const v=await this.client.core.crypto.generateSharedKey(d,_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:v});const P=await this.client.core.relayer.subscribe(v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:P}),await this.client.core.pairing.activate({topic:t})}else ri(n)&&(await this.client.proposal.delete(a,er("USER_DISCONNECTED")),this.events.emit(Nt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(t,n)=>{const{id:a,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:f,controller:d,expiry:_,namespaces:v,requiredNamespaces:P,optionalNamespaces:L,sessionProperties:T,pairingTopic:U}=n.params,H=or({topic:t,relay:f,expiry:_,namespaces:v,acknowledged:!0,pairingTopic:U,requiredNamespaces:P,optionalNamespaces:L,controller:d.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}},T&&{sessionProperties:T});await this.sendResult({id:n.id,topic:t,result:!0}),this.events.emit(Nt("session_connect"),{session:H}),this.cleanupDuplicatePairings(H)}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(t,n)=>{const{id:a}=n;yi(n)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Nt("session_approve",a),{})):ri(n)&&(await this.client.session.delete(t,er("USER_DISCONNECTED")),this.events.emit(Nt("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(t,n)=>{const{params:a,id:c}=n;try{const f=`${t}_session_update`,d=ra.get(f);if(d&&this.isRequestOutOfSync(d,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(or({topic:t},a)),await this.client.session.update(t,{namespaces:a.namespaces}),await this.sendResult({id:c,topic:t,result:!0}),this.client.events.emit("session_update",{id:c,topic:t,params:a}),ra.set(f,c)}catch(f){await this.sendError(c,t,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(t,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,n)=>{const{id:a}=n;yi(n)?this.events.emit(Nt("session_update",a),{}):ri(n)&&this.events.emit(Nt("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(t,n)=>{const{id:a}=n;try{this.isValidExtend({topic:t}),await this.setExpiry(t,$r(ia)),await this.sendResult({id:a,topic:t,result:!0}),this.client.events.emit("session_extend",{id:a,topic:t})}catch(c){await this.sendError(a,t,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(t,n)=>{const{id:a}=n;yi(n)?this.events.emit(Nt("session_extend",a),{}):ri(n)&&this.events.emit(Nt("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(t,n)=>{const{id:a}=n;try{this.isValidPing({topic:t}),await this.sendResult({id:a,topic:t,result:!0}),this.client.events.emit("session_ping",{id:a,topic:t})}catch(c){await this.sendError(a,t,c),this.client.logger.error(c)}},this.onSessionPingResponse=(t,n)=>{const{id:a}=n;setTimeout(()=>{yi(n)?this.events.emit(Nt("session_ping",a),{}):ri(n)&&this.events.emit(Nt("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(t,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:t,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(Bt.publish,async()=>{c(await this.deleteSession(t))})}),this.sendResult({id:a,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:t})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(t,n)=>{const{id:a,params:c}=n;try{this.isValidRequest(or({topic:t},c));const f=hn(JSON.stringify(Vn("wc_sessionRequest",c,a))),d=this.client.session.get(t),_=await this.getVerifyContext(f,d.peer.metadata),v={id:a,topic:t,params:c,verifyContext:_};await this.setPendingSessionRequest(v),this.addSessionRequestToSessionRequestQueue(v),this.processSessionRequestQueue()}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(t,n)=>{const{id:a}=n;yi(n)?this.events.emit(Nt("session_request",a),{result:n.result}):ri(n)&&this.events.emit(Nt("session_request",a),{error:n.error})},this.onSessionEventRequest=async(t,n)=>{const{id:a,params:c}=n;try{const f=`${t}_session_event_${c.event.name}`,d=ra.get(f);if(d&&this.isRequestOutOfSync(d,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(or({topic:t},c)),this.client.events.emit("session_event",{id:a,topic:t,params:c}),ra.set(f,a)}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ti.idle,this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ti.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ti.active,this.client.events.emit("session_request",t)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=t=>{if(t.active)return;const n=this.client.proposal.getAll().find(a=>a.pairingTopic===t.topic);n&&this.onSessionProposeRequest(t.topic,Vn("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async t=>{if(!cr(t)){const{message:_}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(_)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:c,sessionProperties:f,relays:d}=t;if(mi(n)||await this.isValidPairingTopic(n),!C1(d,!0)){const{message:_}=Z("MISSING_OR_INVALID",`connect() relays: ${d}`);throw new Error(_)}!mi(a)&&oa(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!mi(c)&&oa(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),mi(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(t,n)=>{const a=A1(t,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async t=>{if(!cr(t))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:n,namespaces:a,relayProtocol:c,sessionProperties:f}=t;await this.isValidProposalId(n);const d=this.client.proposal.get(n),_=ko(a,"approve()");if(_)throw new Error(_.message);const v=qh(d.requiredNamespaces,a,"approve()");if(v)throw new Error(v.message);if(!cn(c,!0)){const{message:P}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(P)}mi(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async t=>{if(!cr(t)){const{message:c}=Z("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(c)}const{id:n,reason:a}=t;if(await this.isValidProposalId(n),!T1(a)){const{message:c}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(c)}},this.isValidSessionSettleRequest=t=>{if(!cr(t)){const{message:v}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(v)}const{relay:n,controller:a,namespaces:c,expiry:f}=t;if(!R1(n)){const{message:v}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(v)}const d=$1(a,"onSessionSettleRequest()");if(d)throw new Error(d.message);const _=ko(c,"onSessionSettleRequest()");if(_)throw new Error(_.message);if(vi(f)){const{message:v}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(v)}},this.isValidUpdate=async t=>{if(!cr(t)){const{message:_}=Z("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(_)}const{topic:n,namespaces:a}=t;await this.isValidSessionTopic(n);const c=this.client.session.get(n),f=ko(a,"update()");if(f)throw new Error(f.message);const d=qh(c.requiredNamespaces,a,"update()");if(d)throw new Error(d.message)},this.isValidExtend=async t=>{if(!cr(t)){const{message:a}=Z("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionTopic(n)},this.isValidRequest=async t=>{if(!cr(t)){const{message:_}=Z("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(_)}const{topic:n,request:a,chainId:c,expiry:f}=t;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!jh(d,c)){const{message:_}=Z("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(_)}if(!N1(a)){const{message:_}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(_)}if(!F1(d,c,a.method)){const{message:_}=Z("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(_)}if(f&&!D1(f,ec)){const{message:_}=Z("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${ec.min} and ${ec.max}`);throw new Error(_)}},this.isValidRespond=async t=>{if(!cr(t)){const{message:c}=Z("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(c)}const{topic:n,response:a}=t;if(await this.isValidSessionTopic(n),!q1(a)){const{message:c}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(c)}},this.isValidPing=async t=>{if(!cr(t)){const{message:a}=Z("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async t=>{if(!cr(t)){const{message:d}=Z("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(d)}const{topic:n,event:a,chainId:c}=t;await this.isValidSessionTopic(n);const{namespaces:f}=this.client.session.get(n);if(!jh(f,c)){const{message:d}=Z("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(d)}if(!j1(a)){const{message:d}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}if(!L1(f,c,a.name)){const{message:d}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}},this.isValidDisconnect=async t=>{if(!cr(t)){const{message:a}=Z("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(t,n)=>{const a={verified:{verifyUrl:n.verifyUrl||ca,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:t,verifyUrl:n.verifyUrl});c&&(a.verified.origin=c.origin,a.verified.isScam=c.isScam,a.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(t,n)=>{Object.values(t).forEach(a=>{if(!cn(a,!1)){const{message:c}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Bt.message,async i=>{const{topic:t,message:n}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(t,n);try{Sc(a)?(this.client.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Pc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.client.core.history.delete(t,a.id)):this.onRelayEventUnknownPayload({topic:t,payload:a})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Ir.expired,async i=>{const{topic:t,id:n}=Ll(i.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(kn.create,i=>this.onPairingCreated(i))}isValidPairingTopic(i){if(!cn(i,!1)){const{message:t}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:t}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(t)}if(vi(this.client.core.pairing.pairings.get(i).expiry)){const{message:t}=Z("EXPIRED",`pairing topic: ${i}`);throw new Error(t)}}async isValidSessionTopic(i){if(!cn(i,!1)){const{message:t}=Z("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(t)}if(!this.client.session.keys.includes(i)){const{message:t}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(t)}if(vi(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:t}=Z("EXPIRED",`session topic: ${i}`);throw new Error(t)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(cn(i,!1)){const{message:t}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(t)}else{const{message:t}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(t)}}async isValidProposalId(i){if(!M1(i)){const{message:t}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(t)}if(!this.client.proposal.keys.includes(i)){const{message:t}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(t)}if(vi(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:t}=Z("EXPIRED",`proposal id: ${i}`);throw new Error(t)}}}class RE extends va{constructor(i,t){super(i,t,wE,Rc),this.core=i,this.logger=t}}class $E extends va{constructor(i,t){super(i,t,bE,Rc),this.core=i,this.logger=t}}class NE extends va{constructor(i,t){super(i,t,xE,Rc,n=>n.id),this.core=i,this.logger=t}}let FE=class bf extends O_{constructor(i){super(i),this.protocol=vf,this.version=mf,this.name=Xo.name,this.events=new Ur.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(i==null?void 0:i.name)||Xo.name,this.metadata=(i==null?void 0:i.metadata)||I1();const t=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Xo.logger}));this.core=(i==null?void 0:i.core)||new _E(i),this.logger=Ce.generateChildLogger(t,this.name),this.session=new $E(this.core,this.logger),this.proposal=new RE(this.core,this.logger),this.pendingRequest=new NE(this.core,this.logger),this.engine=new TE(this)}static async init(i){const t=new bf(i);return await t.initialize(),t}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const Sl="error",DE="wss://relay.walletconnect.com",qE="wc",jE="universal_provider",Pl=`${qE}@2:${jE}:`,LE="https://rpc.walletconnect.com/v1/",ni={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},mc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,i){(function(){var t,n="4.17.21",a=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",d="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",v=500,P="__lodash_placeholder__",L=1,T=2,U=4,H=1,K=2,ae=1,be=2,de=4,pe=8,ue=16,he=32,$=64,z=128,W=256,ge=512,te=30,Ee="...",Ae=800,et=16,C=1,q=2,Me=3,Te=1/0,J=9007199254740991,V=17976931348623157e292,k=0/0,B=4294967295,ut=B-1,He=B>>>1,Nr=[["ary",z],["bind",ae],["bindKey",be],["curry",pe],["curryRight",ue],["flip",ge],["partial",he],["partialRight",$],["rearg",W]],_e="[object Arguments]",xt="[object Array]",R="[object AsyncFunction]",A="[object Boolean]",S="[object Date]",h="[object DOMException]",b="[object Error]",X="[object Function]",oe="[object GeneratorFunction]",ve="[object Map]",Re="[object Number]",Ne="[object Null]",Ie="[object Object]",It="[object Promise]",mt="[object Proxy]",st="[object RegExp]",De="[object Set]",Je="[object String]",Qe="[object Symbol]",at="[object Undefined]",ze="[object WeakMap]",Ye="[object WeakSet]",$e="[object ArrayBuffer]",ke="[object DataView]",ht="[object Float32Array]",je="[object Float64Array]",St="[object Int8Array]",Ft="[object Int16Array]",zt="[object Int32Array]",Ut="[object Uint8Array]",jt="[object Uint8ClampedArray]",Gt="[object Uint16Array]",tr="[object Uint32Array]",Fr=/\b__p \+= '';/g,Wt=/\b(__p \+=) '' \+/g,Hr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,si=/&(?:amp|lt|gt|quot|#39);/g,Ei=/[&<>"']/g,lt=RegExp(si.source),tt=RegExp(Ei.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,ot=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Ot=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,Ct=RegExp(dt.source),gt=/^\s+/,_t=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,At=/,? & /,Tt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ma=/[()=,{}\[\]\/\s]/,_a=/\\(\\)?/g,wa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gr=/\w*$/,ba=/^[-+]0x[0-9a-f]+$/i,Ea=/^0b[01]+$/i,xa=/^\[object .+?Constructor\]$/,Ia=/^0o[0-7]+$/i,Sa=/^(?:0|[1-9]\d*)$/,kr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,zi=/($^)/,Pa=/['\n\r\u2028\u2029\\]/g,Ui="\\ud800-\\udfff",Oa="\\u0300-\\u036f",Ca="\\ufe20-\\ufe2f",Hi="\\u20d0-\\u20ff",Zn=Oa+Ca+Hi,Xn="\\u2700-\\u27bf",Sr="a-z\\xdf-\\xf6\\xf8-\\xff",Aa="\\xac\\xb1\\xd7\\xf7",Ta="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ra="\\u2000-\\u206f",$a=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",es="A-Z\\xc0-\\xd6\\xd8-\\xde",ts="\\ufe0e\\ufe0f",xi=Aa+Ta+Ra+$a,pn="[']",Ii="["+Ui+"]",dn="["+xi+"]",Si="["+Zn+"]",rs="\\d+",Na="["+Xn+"]",is="["+Sr+"]",ns="[^"+Ui+xi+rs+Xn+Sr+es+"]",ki="\\ud83c[\\udffb-\\udfff]",Fa="(?:"+Si+"|"+ki+")",ss="[^"+Ui+"]",Ki="(?:\\ud83c[\\udde6-\\uddff]){2}",ai="[\\ud800-\\udbff][\\udc00-\\udfff]",ur="["+es+"]",as="\\u200d",os="(?:"+is+"|"+ns+")",Dr="(?:"+ur+"|"+ns+")",cs="(?:"+pn+"(?:d|ll|m|re|s|t|ve))?",us="(?:"+pn+"(?:D|LL|M|RE|S|T|VE))?",hs=Fa+"?",ls="["+ts+"]?",Da="(?:"+as+"(?:"+[ss,Ki,ai].join("|")+")"+ls+hs+")*",Kr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",fs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ps=ls+hs+Da,Vi="(?:"+[Na,Ki,ai].join("|")+")"+ps,qa="(?:"+[ss+Si+"?",Si,Ki,ai,Ii].join("|")+")",gn=RegExp(pn,"g"),ja=RegExp(Si,"g"),Bi=RegExp(ki+"(?="+ki+")|"+qa+ps,"g"),ds=RegExp([ur+"?"+is+"+"+cs+"(?="+[dn,ur,"$"].join("|")+")",Dr+"+"+us+"(?="+[dn,ur+os,"$"].join("|")+")",ur+"?"+os+"+"+cs,ur+"+"+us,fs,Kr,rs,Vi].join("|"),"g"),gs=RegExp("["+as+Ui+Zn+ts+"]"),Pi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ys=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],La=-1,Ke={};Ke[ht]=Ke[je]=Ke[St]=Ke[Ft]=Ke[zt]=Ke[Ut]=Ke[jt]=Ke[Gt]=Ke[tr]=!0,Ke[_e]=Ke[xt]=Ke[$e]=Ke[A]=Ke[ke]=Ke[S]=Ke[b]=Ke[X]=Ke[ve]=Ke[Re]=Ke[Ie]=Ke[st]=Ke[De]=Ke[Je]=Ke[ze]=!1;var Ue={};Ue[_e]=Ue[xt]=Ue[$e]=Ue[ke]=Ue[A]=Ue[S]=Ue[ht]=Ue[je]=Ue[St]=Ue[Ft]=Ue[zt]=Ue[ve]=Ue[Re]=Ue[Ie]=Ue[st]=Ue[De]=Ue[Je]=Ue[Qe]=Ue[Ut]=Ue[jt]=Ue[Gt]=Ue[tr]=!0,Ue[b]=Ue[X]=Ue[ze]=!1;var y={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},j={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,le=parseInt,Ze=typeof Un=="object"&&Un&&Un.Object===Object&&Un,Rt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Ze||Rt||Function("return this")(),Be=i&&!i.nodeType&&i,wt=Be&&!0&&o&&!o.nodeType&&o,rr=wt&&wt.exports===Be,$t=rr&&Ze.process,Xe=function(){try{var x=wt&&wt.require&&wt.require("util").types;return x||$t&&$t.binding&&$t.binding("util")}catch{}}(),Jt=Xe&&Xe.isArrayBuffer,Pr=Xe&&Xe.isDate,yr=Xe&&Xe.isMap,qr=Xe&&Xe.isRegExp,yn=Xe&&Xe.isSet,Oi=Xe&&Xe.isTypedArray;function Lt(x,N,O){switch(O.length){case 0:return x.call(N);case 1:return x.call(N,O[0]);case 2:return x.call(N,O[0],O[1]);case 3:return x.call(N,O[0],O[1],O[2])}return x.apply(N,O)}function If(x,N,O,Y){for(var ce=-1,Fe=x==null?0:x.length;++ce<Fe;){var Dt=x[ce];N(Y,Dt,O(Dt),x)}return Y}function vr(x,N){for(var O=-1,Y=x==null?0:x.length;++O<Y&&N(x[O],O,x)!==!1;);return x}function Sf(x,N){for(var O=x==null?0:x.length;O--&&N(x[O],O,x)!==!1;);return x}function Fc(x,N){for(var O=-1,Y=x==null?0:x.length;++O<Y;)if(!N(x[O],O,x))return!1;return!0}function oi(x,N){for(var O=-1,Y=x==null?0:x.length,ce=0,Fe=[];++O<Y;){var Dt=x[O];N(Dt,O,x)&&(Fe[ce++]=Dt)}return Fe}function vs(x,N){var O=x==null?0:x.length;return!!O&&Gi(x,N,0)>-1}function Ma(x,N,O){for(var Y=-1,ce=x==null?0:x.length;++Y<ce;)if(O(N,x[Y]))return!0;return!1}function it(x,N){for(var O=-1,Y=x==null?0:x.length,ce=Array(Y);++O<Y;)ce[O]=N(x[O],O,x);return ce}function ci(x,N){for(var O=-1,Y=N.length,ce=x.length;++O<Y;)x[ce+O]=N[O];return x}function za(x,N,O,Y){var ce=-1,Fe=x==null?0:x.length;for(Y&&Fe&&(O=x[++ce]);++ce<Fe;)O=N(O,x[ce],ce,x);return O}function Pf(x,N,O,Y){var ce=x==null?0:x.length;for(Y&&ce&&(O=x[--ce]);ce--;)O=N(O,x[ce],ce,x);return O}function Ua(x,N){for(var O=-1,Y=x==null?0:x.length;++O<Y;)if(N(x[O],O,x))return!0;return!1}var Of=Ha("length");function Cf(x){return x.split("")}function Af(x){return x.match(Tt)||[]}function Dc(x,N,O){var Y;return O(x,function(ce,Fe,Dt){if(N(ce,Fe,Dt))return Y=Fe,!1}),Y}function ms(x,N,O,Y){for(var ce=x.length,Fe=O+(Y?1:-1);Y?Fe--:++Fe<ce;)if(N(x[Fe],Fe,x))return Fe;return-1}function Gi(x,N,O){return N===N?Uf(x,N,O):ms(x,qc,O)}function Tf(x,N,O,Y){for(var ce=O-1,Fe=x.length;++ce<Fe;)if(Y(x[ce],N))return ce;return-1}function qc(x){return x!==x}function jc(x,N){var O=x==null?0:x.length;return O?Ka(x,N)/O:k}function Ha(x){return function(N){return N==null?t:N[x]}}function ka(x){return function(N){return x==null?t:x[N]}}function Lc(x,N,O,Y,ce){return ce(x,function(Fe,Dt,Ge){O=Y?(Y=!1,Fe):N(O,Fe,Dt,Ge)}),O}function Rf(x,N){var O=x.length;for(x.sort(N);O--;)x[O]=x[O].value;return x}function Ka(x,N){for(var O,Y=-1,ce=x.length;++Y<ce;){var Fe=N(x[Y]);Fe!==t&&(O=O===t?Fe:O+Fe)}return O}function Va(x,N){for(var O=-1,Y=Array(x);++O<x;)Y[O]=N(O);return Y}function $f(x,N){return it(N,function(O){return[O,x[O]]})}function Mc(x){return x&&x.slice(0,kc(x)+1).replace(gt,"")}function hr(x){return function(N){return x(N)}}function Ba(x,N){return it(N,function(O){return x[O]})}function vn(x,N){return x.has(N)}function zc(x,N){for(var O=-1,Y=x.length;++O<Y&&Gi(N,x[O],0)>-1;);return O}function Uc(x,N){for(var O=x.length;O--&&Gi(N,x[O],0)>-1;);return O}function Nf(x,N){for(var O=x.length,Y=0;O--;)x[O]===N&&++Y;return Y}var Ff=ka(y),Df=ka(E);function qf(x){return"\\"+Q[x]}function jf(x,N){return x==null?t:x[N]}function Wi(x){return gs.test(x)}function Lf(x){return Pi.test(x)}function Mf(x){for(var N,O=[];!(N=x.next()).done;)O.push(N.value);return O}function Ga(x){var N=-1,O=Array(x.size);return x.forEach(function(Y,ce){O[++N]=[ce,Y]}),O}function Hc(x,N){return function(O){return x(N(O))}}function ui(x,N){for(var O=-1,Y=x.length,ce=0,Fe=[];++O<Y;){var Dt=x[O];(Dt===N||Dt===P)&&(x[O]=P,Fe[ce++]=O)}return Fe}function _s(x){var N=-1,O=Array(x.size);return x.forEach(function(Y){O[++N]=Y}),O}function zf(x){var N=-1,O=Array(x.size);return x.forEach(function(Y){O[++N]=[Y,Y]}),O}function Uf(x,N,O){for(var Y=O-1,ce=x.length;++Y<ce;)if(x[Y]===N)return Y;return-1}function Hf(x,N,O){for(var Y=O+1;Y--;)if(x[Y]===N)return Y;return Y}function Ji(x){return Wi(x)?Kf(x):Of(x)}function Or(x){return Wi(x)?Vf(x):Cf(x)}function kc(x){for(var N=x.length;N--&&_t.test(x.charAt(N)););return N}var kf=ka(j);function Kf(x){for(var N=Bi.lastIndex=0;Bi.test(x);)++N;return N}function Vf(x){return x.match(Bi)||[]}function Bf(x){return x.match(ds)||[]}var Gf=function x(N){N=N==null?Pe:Qi.defaults(Pe.Object(),N,Qi.pick(Pe,ys));var O=N.Array,Y=N.Date,ce=N.Error,Fe=N.Function,Dt=N.Math,Ge=N.Object,Wa=N.RegExp,Wf=N.String,mr=N.TypeError,ws=O.prototype,Jf=Fe.prototype,Yi=Ge.prototype,bs=N["__core-js_shared__"],Es=Jf.toString,Le=Yi.hasOwnProperty,Qf=0,Kc=function(){var e=/[^.]+$/.exec(bs&&bs.keys&&bs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),xs=Yi.toString,Yf=Es.call(Ge),Zf=Pe._,Xf=Wa("^"+Es.call(Le).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Is=rr?N.Buffer:t,hi=N.Symbol,Ss=N.Uint8Array,Vc=Is?Is.allocUnsafe:t,Ps=Hc(Ge.getPrototypeOf,Ge),Bc=Ge.create,Gc=Yi.propertyIsEnumerable,Os=ws.splice,Wc=hi?hi.isConcatSpreadable:t,mn=hi?hi.iterator:t,Ci=hi?hi.toStringTag:t,Cs=function(){try{var e=Ni(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),ep=N.clearTimeout!==Pe.clearTimeout&&N.clearTimeout,tp=Y&&Y.now!==Pe.Date.now&&Y.now,rp=N.setTimeout!==Pe.setTimeout&&N.setTimeout,As=Dt.ceil,Ts=Dt.floor,Ja=Ge.getOwnPropertySymbols,ip=Is?Is.isBuffer:t,Jc=N.isFinite,np=ws.join,sp=Hc(Ge.keys,Ge),qt=Dt.max,Kt=Dt.min,ap=Y.now,op=N.parseInt,Qc=Dt.random,cp=ws.reverse,Qa=Ni(N,"DataView"),_n=Ni(N,"Map"),Ya=Ni(N,"Promise"),Zi=Ni(N,"Set"),wn=Ni(N,"WeakMap"),bn=Ni(Ge,"create"),Rs=wn&&new wn,Xi={},up=Fi(Qa),hp=Fi(_n),lp=Fi(Ya),fp=Fi(Zi),pp=Fi(wn),$s=hi?hi.prototype:t,En=$s?$s.valueOf:t,Yc=$s?$s.toString:t;function p(e){if(vt(e)&&!fe(e)&&!(e instanceof Se)){if(e instanceof _r)return e;if(Le.call(e,"__wrapped__"))return Zu(e)}return new _r(e)}var en=function(){function e(){}return function(r){if(!ct(r))return{};if(Bc)return Bc(r);e.prototype=r;var s=new e;return e.prototype=t,s}}();function Ns(){}function _r(e,r){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=t}p.templateSettings={escape:ft,evaluate:pt,interpolate:ot,variable:"",imports:{_:p}},p.prototype=Ns.prototype,p.prototype.constructor=p,_r.prototype=en(Ns.prototype),_r.prototype.constructor=_r;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=B,this.__views__=[]}function dp(){var e=new Se(this.__wrapped__);return e.__actions__=ir(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ir(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ir(this.__views__),e}function gp(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function yp(){var e=this.__wrapped__.value(),r=this.__dir__,s=fe(e),u=r<0,l=s?e.length:0,g=Cd(0,l,this.__views__),m=g.start,w=g.end,I=w-m,F=u?w:m-1,D=this.__iteratees__,M=D.length,G=0,ee=Kt(I,this.__takeCount__);if(!s||!u&&l==I&&ee==I)return bu(e,this.__actions__);var ne=[];e:for(;I--&&G<ee;){F+=r;for(var me=-1,se=e[F];++me<M;){var xe=D[me],Oe=xe.iteratee,pr=xe.type,Zt=Oe(se);if(pr==q)se=Zt;else if(!Zt){if(pr==C)continue e;break e}}ne[G++]=se}return ne}Se.prototype=en(Ns.prototype),Se.prototype.constructor=Se;function Ai(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var u=e[r];this.set(u[0],u[1])}}function vp(){this.__data__=bn?bn(null):{},this.size=0}function mp(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}function _p(e){var r=this.__data__;if(bn){var s=r[e];return s===_?t:s}return Le.call(r,e)?r[e]:t}function wp(e){var r=this.__data__;return bn?r[e]!==t:Le.call(r,e)}function bp(e,r){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=bn&&r===t?_:r,this}Ai.prototype.clear=vp,Ai.prototype.delete=mp,Ai.prototype.get=_p,Ai.prototype.has=wp,Ai.prototype.set=bp;function Vr(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var u=e[r];this.set(u[0],u[1])}}function Ep(){this.__data__=[],this.size=0}function xp(e){var r=this.__data__,s=Fs(r,e);if(s<0)return!1;var u=r.length-1;return s==u?r.pop():Os.call(r,s,1),--this.size,!0}function Ip(e){var r=this.__data__,s=Fs(r,e);return s<0?t:r[s][1]}function Sp(e){return Fs(this.__data__,e)>-1}function Pp(e,r){var s=this.__data__,u=Fs(s,e);return u<0?(++this.size,s.push([e,r])):s[u][1]=r,this}Vr.prototype.clear=Ep,Vr.prototype.delete=xp,Vr.prototype.get=Ip,Vr.prototype.has=Sp,Vr.prototype.set=Pp;function Br(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var u=e[r];this.set(u[0],u[1])}}function Op(){this.size=0,this.__data__={hash:new Ai,map:new(_n||Vr),string:new Ai}}function Cp(e){var r=Bs(this,e).delete(e);return this.size-=r?1:0,r}function Ap(e){return Bs(this,e).get(e)}function Tp(e){return Bs(this,e).has(e)}function Rp(e,r){var s=Bs(this,e),u=s.size;return s.set(e,r),this.size+=s.size==u?0:1,this}Br.prototype.clear=Op,Br.prototype.delete=Cp,Br.prototype.get=Ap,Br.prototype.has=Tp,Br.prototype.set=Rp;function Ti(e){var r=-1,s=e==null?0:e.length;for(this.__data__=new Br;++r<s;)this.add(e[r])}function $p(e){return this.__data__.set(e,_),this}function Np(e){return this.__data__.has(e)}Ti.prototype.add=Ti.prototype.push=$p,Ti.prototype.has=Np;function Cr(e){var r=this.__data__=new Vr(e);this.size=r.size}function Fp(){this.__data__=new Vr,this.size=0}function Dp(e){var r=this.__data__,s=r.delete(e);return this.size=r.size,s}function qp(e){return this.__data__.get(e)}function jp(e){return this.__data__.has(e)}function Lp(e,r){var s=this.__data__;if(s instanceof Vr){var u=s.__data__;if(!_n||u.length<a-1)return u.push([e,r]),this.size=++s.size,this;s=this.__data__=new Br(u)}return s.set(e,r),this.size=s.size,this}Cr.prototype.clear=Fp,Cr.prototype.delete=Dp,Cr.prototype.get=qp,Cr.prototype.has=jp,Cr.prototype.set=Lp;function Zc(e,r){var s=fe(e),u=!s&&Di(e),l=!s&&!u&&gi(e),g=!s&&!u&&!l&&sn(e),m=s||u||l||g,w=m?Va(e.length,Wf):[],I=w.length;for(var F in e)(r||Le.call(e,F))&&!(m&&(F=="length"||l&&(F=="offset"||F=="parent")||g&&(F=="buffer"||F=="byteLength"||F=="byteOffset")||Qr(F,I)))&&w.push(F);return w}function Xc(e){var r=e.length;return r?e[co(0,r-1)]:t}function Mp(e,r){return Gs(ir(e),Ri(r,0,e.length))}function zp(e){return Gs(ir(e))}function Za(e,r,s){(s!==t&&!Ar(e[r],s)||s===t&&!(r in e))&&Gr(e,r,s)}function xn(e,r,s){var u=e[r];(!(Le.call(e,r)&&Ar(u,s))||s===t&&!(r in e))&&Gr(e,r,s)}function Fs(e,r){for(var s=e.length;s--;)if(Ar(e[s][0],r))return s;return-1}function Up(e,r,s,u){return li(e,function(l,g,m){r(u,l,s(l),m)}),u}function eu(e,r){return e&&Lr(r,Mt(r),e)}function Hp(e,r){return e&&Lr(r,sr(r),e)}function Gr(e,r,s){r=="__proto__"&&Cs?Cs(e,r,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[r]=s}function Xa(e,r){for(var s=-1,u=r.length,l=O(u),g=e==null;++s<u;)l[s]=g?t:Fo(e,r[s]);return l}function Ri(e,r,s){return e===e&&(s!==t&&(e=e<=s?e:s),r!==t&&(e=e>=r?e:r)),e}function wr(e,r,s,u,l,g){var m,w=r&L,I=r&T,F=r&U;if(s&&(m=l?s(e,u,l,g):s(e)),m!==t)return m;if(!ct(e))return e;var D=fe(e);if(D){if(m=Td(e),!w)return ir(e,m)}else{var M=Vt(e),G=M==X||M==oe;if(gi(e))return Iu(e,w);if(M==Ie||M==_e||G&&!l){if(m=I||G?{}:ku(e),!w)return I?_d(e,Hp(m,e)):md(e,eu(m,e))}else{if(!Ue[M])return l?e:{};m=Rd(e,M,w)}}g||(g=new Cr);var ee=g.get(e);if(ee)return ee;g.set(e,m),mh(e)?e.forEach(function(se){m.add(wr(se,r,s,se,e,g))}):yh(e)&&e.forEach(function(se,xe){m.set(xe,wr(se,r,s,xe,e,g))});var ne=F?I?wo:_o:I?sr:Mt,me=D?t:ne(e);return vr(me||e,function(se,xe){me&&(xe=se,se=e[xe]),xn(m,xe,wr(se,r,s,xe,e,g))}),m}function kp(e){var r=Mt(e);return function(s){return tu(s,e,r)}}function tu(e,r,s){var u=s.length;if(e==null)return!u;for(e=Ge(e);u--;){var l=s[u],g=r[l],m=e[l];if(m===t&&!(l in e)||!g(m))return!1}return!0}function ru(e,r,s){if(typeof e!="function")throw new mr(f);return Tn(function(){e.apply(t,s)},r)}function In(e,r,s,u){var l=-1,g=vs,m=!0,w=e.length,I=[],F=r.length;if(!w)return I;s&&(r=it(r,hr(s))),u?(g=Ma,m=!1):r.length>=a&&(g=vn,m=!1,r=new Ti(r));e:for(;++l<w;){var D=e[l],M=s==null?D:s(D);if(D=u||D!==0?D:0,m&&M===M){for(var G=F;G--;)if(r[G]===M)continue e;I.push(D)}else g(r,M,u)||I.push(D)}return I}var li=Au(jr),iu=Au(to,!0);function Kp(e,r){var s=!0;return li(e,function(u,l,g){return s=!!r(u,l,g),s}),s}function Ds(e,r,s){for(var u=-1,l=e.length;++u<l;){var g=e[u],m=r(g);if(m!=null&&(w===t?m===m&&!fr(m):s(m,w)))var w=m,I=g}return I}function Vp(e,r,s,u){var l=e.length;for(s=ye(s),s<0&&(s=-s>l?0:l+s),u=u===t||u>l?l:ye(u),u<0&&(u+=l),u=s>u?0:wh(u);s<u;)e[s++]=r;return e}function nu(e,r){var s=[];return li(e,function(u,l,g){r(u,l,g)&&s.push(u)}),s}function Ht(e,r,s,u,l){var g=-1,m=e.length;for(s||(s=Nd),l||(l=[]);++g<m;){var w=e[g];r>0&&s(w)?r>1?Ht(w,r-1,s,u,l):ci(l,w):u||(l[l.length]=w)}return l}var eo=Tu(),su=Tu(!0);function jr(e,r){return e&&eo(e,r,Mt)}function to(e,r){return e&&su(e,r,Mt)}function qs(e,r){return oi(r,function(s){return Yr(e[s])})}function $i(e,r){r=pi(r,e);for(var s=0,u=r.length;e!=null&&s<u;)e=e[Mr(r[s++])];return s&&s==u?e:t}function au(e,r,s){var u=r(e);return fe(e)?u:ci(u,s(e))}function Qt(e){return e==null?e===t?at:Ne:Ci&&Ci in Ge(e)?Od(e):zd(e)}function ro(e,r){return e>r}function Bp(e,r){return e!=null&&Le.call(e,r)}function Gp(e,r){return e!=null&&r in Ge(e)}function Wp(e,r,s){return e>=Kt(r,s)&&e<qt(r,s)}function io(e,r,s){for(var u=s?Ma:vs,l=e[0].length,g=e.length,m=g,w=O(g),I=1/0,F=[];m--;){var D=e[m];m&&r&&(D=it(D,hr(r))),I=Kt(D.length,I),w[m]=!s&&(r||l>=120&&D.length>=120)?new Ti(m&&D):t}D=e[0];var M=-1,G=w[0];e:for(;++M<l&&F.length<I;){var ee=D[M],ne=r?r(ee):ee;if(ee=s||ee!==0?ee:0,!(G?vn(G,ne):u(F,ne,s))){for(m=g;--m;){var me=w[m];if(!(me?vn(me,ne):u(e[m],ne,s)))continue e}G&&G.push(ne),F.push(ee)}}return F}function Jp(e,r,s,u){return jr(e,function(l,g,m){r(u,s(l),g,m)}),u}function Sn(e,r,s){r=pi(r,e),e=Gu(e,r);var u=e==null?e:e[Mr(Er(r))];return u==null?t:Lt(u,e,s)}function ou(e){return vt(e)&&Qt(e)==_e}function Qp(e){return vt(e)&&Qt(e)==$e}function Yp(e){return vt(e)&&Qt(e)==S}function Pn(e,r,s,u,l){return e===r?!0:e==null||r==null||!vt(e)&&!vt(r)?e!==e&&r!==r:Zp(e,r,s,u,Pn,l)}function Zp(e,r,s,u,l,g){var m=fe(e),w=fe(r),I=m?xt:Vt(e),F=w?xt:Vt(r);I=I==_e?Ie:I,F=F==_e?Ie:F;var D=I==Ie,M=F==Ie,G=I==F;if(G&&gi(e)){if(!gi(r))return!1;m=!0,D=!1}if(G&&!D)return g||(g=new Cr),m||sn(e)?zu(e,r,s,u,l,g):Sd(e,r,I,s,u,l,g);if(!(s&H)){var ee=D&&Le.call(e,"__wrapped__"),ne=M&&Le.call(r,"__wrapped__");if(ee||ne){var me=ee?e.value():e,se=ne?r.value():r;return g||(g=new Cr),l(me,se,s,u,g)}}return G?(g||(g=new Cr),Pd(e,r,s,u,l,g)):!1}function Xp(e){return vt(e)&&Vt(e)==ve}function no(e,r,s,u){var l=s.length,g=l,m=!u;if(e==null)return!g;for(e=Ge(e);l--;){var w=s[l];if(m&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++l<g;){w=s[l];var I=w[0],F=e[I],D=w[1];if(m&&w[2]){if(F===t&&!(I in e))return!1}else{var M=new Cr;if(u)var G=u(F,D,I,e,r,M);if(!(G===t?Pn(D,F,H|K,u,M):G))return!1}}return!0}function cu(e){if(!ct(e)||Dd(e))return!1;var r=Yr(e)?Xf:xa;return r.test(Fi(e))}function ed(e){return vt(e)&&Qt(e)==st}function td(e){return vt(e)&&Vt(e)==De}function rd(e){return vt(e)&&Xs(e.length)&&!!Ke[Qt(e)]}function uu(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?fe(e)?fu(e[0],e[1]):lu(e):Rh(e)}function so(e){if(!An(e))return sp(e);var r=[];for(var s in Ge(e))Le.call(e,s)&&s!="constructor"&&r.push(s);return r}function id(e){if(!ct(e))return Md(e);var r=An(e),s=[];for(var u in e)u=="constructor"&&(r||!Le.call(e,u))||s.push(u);return s}function ao(e,r){return e<r}function hu(e,r){var s=-1,u=nr(e)?O(e.length):[];return li(e,function(l,g,m){u[++s]=r(l,g,m)}),u}function lu(e){var r=Eo(e);return r.length==1&&r[0][2]?Vu(r[0][0],r[0][1]):function(s){return s===e||no(s,e,r)}}function fu(e,r){return Io(e)&&Ku(r)?Vu(Mr(e),r):function(s){var u=Fo(s,e);return u===t&&u===r?Do(s,e):Pn(r,u,H|K)}}function js(e,r,s,u,l){e!==r&&eo(r,function(g,m){if(l||(l=new Cr),ct(g))nd(e,r,m,s,js,u,l);else{var w=u?u(Po(e,m),g,m+"",e,r,l):t;w===t&&(w=g),Za(e,m,w)}},sr)}function nd(e,r,s,u,l,g,m){var w=Po(e,s),I=Po(r,s),F=m.get(I);if(F){Za(e,s,F);return}var D=g?g(w,I,s+"",e,r,m):t,M=D===t;if(M){var G=fe(I),ee=!G&&gi(I),ne=!G&&!ee&&sn(I);D=I,G||ee||ne?fe(w)?D=w:bt(w)?D=ir(w):ee?(M=!1,D=Iu(I,!0)):ne?(M=!1,D=Su(I,!0)):D=[]:Rn(I)||Di(I)?(D=w,Di(w)?D=bh(w):(!ct(w)||Yr(w))&&(D=ku(I))):M=!1}M&&(m.set(I,D),l(D,I,u,g,m),m.delete(I)),Za(e,s,D)}function pu(e,r){var s=e.length;if(s)return r+=r<0?s:0,Qr(r,s)?e[r]:t}function du(e,r,s){r.length?r=it(r,function(g){return fe(g)?function(m){return $i(m,g.length===1?g[0]:g)}:g}):r=[ar];var u=-1;r=it(r,hr(ie()));var l=hu(e,function(g,m,w){var I=it(r,function(F){return F(g)});return{criteria:I,index:++u,value:g}});return Rf(l,function(g,m){return vd(g,m,s)})}function sd(e,r){return gu(e,r,function(s,u){return Do(e,u)})}function gu(e,r,s){for(var u=-1,l=r.length,g={};++u<l;){var m=r[u],w=$i(e,m);s(w,m)&&On(g,pi(m,e),w)}return g}function ad(e){return function(r){return $i(r,e)}}function oo(e,r,s,u){var l=u?Tf:Gi,g=-1,m=r.length,w=e;for(e===r&&(r=ir(r)),s&&(w=it(e,hr(s)));++g<m;)for(var I=0,F=r[g],D=s?s(F):F;(I=l(w,D,I,u))>-1;)w!==e&&Os.call(w,I,1),Os.call(e,I,1);return e}function yu(e,r){for(var s=e?r.length:0,u=s-1;s--;){var l=r[s];if(s==u||l!==g){var g=l;Qr(l)?Os.call(e,l,1):lo(e,l)}}return e}function co(e,r){return e+Ts(Qc()*(r-e+1))}function od(e,r,s,u){for(var l=-1,g=qt(As((r-e)/(s||1)),0),m=O(g);g--;)m[u?g:++l]=e,e+=s;return m}function uo(e,r){var s="";if(!e||r<1||r>J)return s;do r%2&&(s+=e),r=Ts(r/2),r&&(e+=e);while(r);return s}function we(e,r){return Oo(Bu(e,r,ar),e+"")}function cd(e){return Xc(an(e))}function ud(e,r){var s=an(e);return Gs(s,Ri(r,0,s.length))}function On(e,r,s,u){if(!ct(e))return e;r=pi(r,e);for(var l=-1,g=r.length,m=g-1,w=e;w!=null&&++l<g;){var I=Mr(r[l]),F=s;if(I==="__proto__"||I==="constructor"||I==="prototype")return e;if(l!=m){var D=w[I];F=u?u(D,I,w):t,F===t&&(F=ct(D)?D:Qr(r[l+1])?[]:{})}xn(w,I,F),w=w[I]}return e}var vu=Rs?function(e,r){return Rs.set(e,r),e}:ar,hd=Cs?function(e,r){return Cs(e,"toString",{configurable:!0,enumerable:!1,value:jo(r),writable:!0})}:ar;function ld(e){return Gs(an(e))}function br(e,r,s){var u=-1,l=e.length;r<0&&(r=-r>l?0:l+r),s=s>l?l:s,s<0&&(s+=l),l=r>s?0:s-r>>>0,r>>>=0;for(var g=O(l);++u<l;)g[u]=e[u+r];return g}function fd(e,r){var s;return li(e,function(u,l,g){return s=r(u,l,g),!s}),!!s}function Ls(e,r,s){var u=0,l=e==null?u:e.length;if(typeof r=="number"&&r===r&&l<=He){for(;u<l;){var g=u+l>>>1,m=e[g];m!==null&&!fr(m)&&(s?m<=r:m<r)?u=g+1:l=g}return l}return ho(e,r,ar,s)}function ho(e,r,s,u){var l=0,g=e==null?0:e.length;if(g===0)return 0;r=s(r);for(var m=r!==r,w=r===null,I=fr(r),F=r===t;l<g;){var D=Ts((l+g)/2),M=s(e[D]),G=M!==t,ee=M===null,ne=M===M,me=fr(M);if(m)var se=u||ne;else F?se=ne&&(u||G):w?se=ne&&G&&(u||!ee):I?se=ne&&G&&!ee&&(u||!me):ee||me?se=!1:se=u?M<=r:M<r;se?l=D+1:g=D}return Kt(g,ut)}function mu(e,r){for(var s=-1,u=e.length,l=0,g=[];++s<u;){var m=e[s],w=r?r(m):m;if(!s||!Ar(w,I)){var I=w;g[l++]=m===0?0:m}}return g}function _u(e){return typeof e=="number"?e:fr(e)?k:+e}function lr(e){if(typeof e=="string")return e;if(fe(e))return it(e,lr)+"";if(fr(e))return Yc?Yc.call(e):"";var r=e+"";return r=="0"&&1/e==-Te?"-0":r}function fi(e,r,s){var u=-1,l=vs,g=e.length,m=!0,w=[],I=w;if(s)m=!1,l=Ma;else if(g>=a){var F=r?null:xd(e);if(F)return _s(F);m=!1,l=vn,I=new Ti}else I=r?[]:w;e:for(;++u<g;){var D=e[u],M=r?r(D):D;if(D=s||D!==0?D:0,m&&M===M){for(var G=I.length;G--;)if(I[G]===M)continue e;r&&I.push(M),w.push(D)}else l(I,M,s)||(I!==w&&I.push(M),w.push(D))}return w}function lo(e,r){return r=pi(r,e),e=Gu(e,r),e==null||delete e[Mr(Er(r))]}function wu(e,r,s,u){return On(e,r,s($i(e,r)),u)}function Ms(e,r,s,u){for(var l=e.length,g=u?l:-1;(u?g--:++g<l)&&r(e[g],g,e););return s?br(e,u?0:g,u?g+1:l):br(e,u?g+1:0,u?l:g)}function bu(e,r){var s=e;return s instanceof Se&&(s=s.value()),za(r,function(u,l){return l.func.apply(l.thisArg,ci([u],l.args))},s)}function fo(e,r,s){var u=e.length;if(u<2)return u?fi(e[0]):[];for(var l=-1,g=O(u);++l<u;)for(var m=e[l],w=-1;++w<u;)w!=l&&(g[l]=In(g[l]||m,e[w],r,s));return fi(Ht(g,1),r,s)}function Eu(e,r,s){for(var u=-1,l=e.length,g=r.length,m={};++u<l;){var w=u<g?r[u]:t;s(m,e[u],w)}return m}function po(e){return bt(e)?e:[]}function go(e){return typeof e=="function"?e:ar}function pi(e,r){return fe(e)?e:Io(e,r)?[e]:Yu(qe(e))}var pd=we;function di(e,r,s){var u=e.length;return s=s===t?u:s,!r&&s>=u?e:br(e,r,s)}var xu=ep||function(e){return Pe.clearTimeout(e)};function Iu(e,r){if(r)return e.slice();var s=e.length,u=Vc?Vc(s):new e.constructor(s);return e.copy(u),u}function yo(e){var r=new e.constructor(e.byteLength);return new Ss(r).set(new Ss(e)),r}function dd(e,r){var s=r?yo(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function gd(e){var r=new e.constructor(e.source,gr.exec(e));return r.lastIndex=e.lastIndex,r}function yd(e){return En?Ge(En.call(e)):{}}function Su(e,r){var s=r?yo(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Pu(e,r){if(e!==r){var s=e!==t,u=e===null,l=e===e,g=fr(e),m=r!==t,w=r===null,I=r===r,F=fr(r);if(!w&&!F&&!g&&e>r||g&&m&&I&&!w&&!F||u&&m&&I||!s&&I||!l)return 1;if(!u&&!g&&!F&&e<r||F&&s&&l&&!u&&!g||w&&s&&l||!m&&l||!I)return-1}return 0}function vd(e,r,s){for(var u=-1,l=e.criteria,g=r.criteria,m=l.length,w=s.length;++u<m;){var I=Pu(l[u],g[u]);if(I){if(u>=w)return I;var F=s[u];return I*(F=="desc"?-1:1)}}return e.index-r.index}function Ou(e,r,s,u){for(var l=-1,g=e.length,m=s.length,w=-1,I=r.length,F=qt(g-m,0),D=O(I+F),M=!u;++w<I;)D[w]=r[w];for(;++l<m;)(M||l<g)&&(D[s[l]]=e[l]);for(;F--;)D[w++]=e[l++];return D}function Cu(e,r,s,u){for(var l=-1,g=e.length,m=-1,w=s.length,I=-1,F=r.length,D=qt(g-w,0),M=O(D+F),G=!u;++l<D;)M[l]=e[l];for(var ee=l;++I<F;)M[ee+I]=r[I];for(;++m<w;)(G||l<g)&&(M[ee+s[m]]=e[l++]);return M}function ir(e,r){var s=-1,u=e.length;for(r||(r=O(u));++s<u;)r[s]=e[s];return r}function Lr(e,r,s,u){var l=!s;s||(s={});for(var g=-1,m=r.length;++g<m;){var w=r[g],I=u?u(s[w],e[w],w,s,e):t;I===t&&(I=e[w]),l?Gr(s,w,I):xn(s,w,I)}return s}function md(e,r){return Lr(e,xo(e),r)}function _d(e,r){return Lr(e,Uu(e),r)}function zs(e,r){return function(s,u){var l=fe(s)?If:Up,g=r?r():{};return l(s,e,ie(u,2),g)}}function tn(e){return we(function(r,s){var u=-1,l=s.length,g=l>1?s[l-1]:t,m=l>2?s[2]:t;for(g=e.length>3&&typeof g=="function"?(l--,g):t,m&&Yt(s[0],s[1],m)&&(g=l<3?t:g,l=1),r=Ge(r);++u<l;){var w=s[u];w&&e(r,w,u,g)}return r})}function Au(e,r){return function(s,u){if(s==null)return s;if(!nr(s))return e(s,u);for(var l=s.length,g=r?l:-1,m=Ge(s);(r?g--:++g<l)&&u(m[g],g,m)!==!1;);return s}}function Tu(e){return function(r,s,u){for(var l=-1,g=Ge(r),m=u(r),w=m.length;w--;){var I=m[e?w:++l];if(s(g[I],I,g)===!1)break}return r}}function wd(e,r,s){var u=r&ae,l=Cn(e);function g(){var m=this&&this!==Pe&&this instanceof g?l:e;return m.apply(u?s:this,arguments)}return g}function Ru(e){return function(r){r=qe(r);var s=Wi(r)?Or(r):t,u=s?s[0]:r.charAt(0),l=s?di(s,1).join(""):r.slice(1);return u[e]()+l}}function rn(e){return function(r){return za(Ah(Ch(r).replace(gn,"")),e,"")}}function Cn(e){return function(){var r=arguments;switch(r.length){case 0:return new e;case 1:return new e(r[0]);case 2:return new e(r[0],r[1]);case 3:return new e(r[0],r[1],r[2]);case 4:return new e(r[0],r[1],r[2],r[3]);case 5:return new e(r[0],r[1],r[2],r[3],r[4]);case 6:return new e(r[0],r[1],r[2],r[3],r[4],r[5]);case 7:return new e(r[0],r[1],r[2],r[3],r[4],r[5],r[6])}var s=en(e.prototype),u=e.apply(s,r);return ct(u)?u:s}}function bd(e,r,s){var u=Cn(e);function l(){for(var g=arguments.length,m=O(g),w=g,I=nn(l);w--;)m[w]=arguments[w];var F=g<3&&m[0]!==I&&m[g-1]!==I?[]:ui(m,I);if(g-=F.length,g<s)return qu(e,r,Us,l.placeholder,t,m,F,t,t,s-g);var D=this&&this!==Pe&&this instanceof l?u:e;return Lt(D,this,m)}return l}function $u(e){return function(r,s,u){var l=Ge(r);if(!nr(r)){var g=ie(s,3);r=Mt(r),s=function(w){return g(l[w],w,l)}}var m=e(r,s,u);return m>-1?l[g?r[m]:m]:t}}function Nu(e){return Jr(function(r){var s=r.length,u=s,l=_r.prototype.thru;for(e&&r.reverse();u--;){var g=r[u];if(typeof g!="function")throw new mr(f);if(l&&!m&&Vs(g)=="wrapper")var m=new _r([],!0)}for(u=m?u:s;++u<s;){g=r[u];var w=Vs(g),I=w=="wrapper"?bo(g):t;I&&So(I[0])&&I[1]==(z|pe|he|W)&&!I[4].length&&I[9]==1?m=m[Vs(I[0])].apply(m,I[3]):m=g.length==1&&So(g)?m[w]():m.thru(g)}return function(){var F=arguments,D=F[0];if(m&&F.length==1&&fe(D))return m.plant(D).value();for(var M=0,G=s?r[M].apply(this,F):D;++M<s;)G=r[M].call(this,G);return G}})}function Us(e,r,s,u,l,g,m,w,I,F){var D=r&z,M=r&ae,G=r&be,ee=r&(pe|ue),ne=r&ge,me=G?t:Cn(e);function se(){for(var xe=arguments.length,Oe=O(xe),pr=xe;pr--;)Oe[pr]=arguments[pr];if(ee)var Zt=nn(se),dr=Nf(Oe,Zt);if(u&&(Oe=Ou(Oe,u,l,ee)),g&&(Oe=Cu(Oe,g,m,ee)),xe-=dr,ee&&xe<F){var Et=ui(Oe,Zt);return qu(e,r,Us,se.placeholder,s,Oe,Et,w,I,F-xe)}var Tr=M?s:this,Xr=G?Tr[e]:e;return xe=Oe.length,w?Oe=Ud(Oe,w):ne&&xe>1&&Oe.reverse(),D&&I<xe&&(Oe.length=I),this&&this!==Pe&&this instanceof se&&(Xr=me||Cn(Xr)),Xr.apply(Tr,Oe)}return se}function Fu(e,r){return function(s,u){return Jp(s,e,r(u),{})}}function Hs(e,r){return function(s,u){var l;if(s===t&&u===t)return r;if(s!==t&&(l=s),u!==t){if(l===t)return u;typeof s=="string"||typeof u=="string"?(s=lr(s),u=lr(u)):(s=_u(s),u=_u(u)),l=e(s,u)}return l}}function vo(e){return Jr(function(r){return r=it(r,hr(ie())),we(function(s){var u=this;return e(r,function(l){return Lt(l,u,s)})})})}function ks(e,r){r=r===t?" ":lr(r);var s=r.length;if(s<2)return s?uo(r,e):r;var u=uo(r,As(e/Ji(r)));return Wi(r)?di(Or(u),0,e).join(""):u.slice(0,e)}function Ed(e,r,s,u){var l=r&ae,g=Cn(e);function m(){for(var w=-1,I=arguments.length,F=-1,D=u.length,M=O(D+I),G=this&&this!==Pe&&this instanceof m?g:e;++F<D;)M[F]=u[F];for(;I--;)M[F++]=arguments[++w];return Lt(G,l?s:this,M)}return m}function Du(e){return function(r,s,u){return u&&typeof u!="number"&&Yt(r,s,u)&&(s=u=t),r=Zr(r),s===t?(s=r,r=0):s=Zr(s),u=u===t?r<s?1:-1:Zr(u),od(r,s,u,e)}}function Ks(e){return function(r,s){return typeof r=="string"&&typeof s=="string"||(r=xr(r),s=xr(s)),e(r,s)}}function qu(e,r,s,u,l,g,m,w,I,F){var D=r&pe,M=D?m:t,G=D?t:m,ee=D?g:t,ne=D?t:g;r|=D?he:$,r&=~(D?$:he),r&de||(r&=~(ae|be));var me=[e,r,l,ee,M,ne,G,w,I,F],se=s.apply(t,me);return So(e)&&Wu(se,me),se.placeholder=u,Ju(se,e,r)}function mo(e){var r=Dt[e];return function(s,u){if(s=xr(s),u=u==null?0:Kt(ye(u),292),u&&Jc(s)){var l=(qe(s)+"e").split("e"),g=r(l[0]+"e"+(+l[1]+u));return l=(qe(g)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return r(s)}}var xd=Zi&&1/_s(new Zi([,-0]))[1]==Te?function(e){return new Zi(e)}:zo;function ju(e){return function(r){var s=Vt(r);return s==ve?Ga(r):s==De?zf(r):$f(r,e(r))}}function Wr(e,r,s,u,l,g,m,w){var I=r&be;if(!I&&typeof e!="function")throw new mr(f);var F=u?u.length:0;if(F||(r&=~(he|$),u=l=t),m=m===t?m:qt(ye(m),0),w=w===t?w:ye(w),F-=l?l.length:0,r&$){var D=u,M=l;u=l=t}var G=I?t:bo(e),ee=[e,r,s,u,l,D,M,g,m,w];if(G&&Ld(ee,G),e=ee[0],r=ee[1],s=ee[2],u=ee[3],l=ee[4],w=ee[9]=ee[9]===t?I?0:e.length:qt(ee[9]-F,0),!w&&r&(pe|ue)&&(r&=~(pe|ue)),!r||r==ae)var ne=wd(e,r,s);else r==pe||r==ue?ne=bd(e,r,w):(r==he||r==(ae|he))&&!l.length?ne=Ed(e,r,s,u):ne=Us.apply(t,ee);var me=G?vu:Wu;return Ju(me(ne,ee),e,r)}function Lu(e,r,s,u){return e===t||Ar(e,Yi[s])&&!Le.call(u,s)?r:e}function Mu(e,r,s,u,l,g){return ct(e)&&ct(r)&&(g.set(r,e),js(e,r,t,Mu,g),g.delete(r)),e}function Id(e){return Rn(e)?t:e}function zu(e,r,s,u,l,g){var m=s&H,w=e.length,I=r.length;if(w!=I&&!(m&&I>w))return!1;var F=g.get(e),D=g.get(r);if(F&&D)return F==r&&D==e;var M=-1,G=!0,ee=s&K?new Ti:t;for(g.set(e,r),g.set(r,e);++M<w;){var ne=e[M],me=r[M];if(u)var se=m?u(me,ne,M,r,e,g):u(ne,me,M,e,r,g);if(se!==t){if(se)continue;G=!1;break}if(ee){if(!Ua(r,function(xe,Oe){if(!vn(ee,Oe)&&(ne===xe||l(ne,xe,s,u,g)))return ee.push(Oe)})){G=!1;break}}else if(!(ne===me||l(ne,me,s,u,g))){G=!1;break}}return g.delete(e),g.delete(r),G}function Sd(e,r,s,u,l,g,m){switch(s){case ke:if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)return!1;e=e.buffer,r=r.buffer;case $e:return!(e.byteLength!=r.byteLength||!g(new Ss(e),new Ss(r)));case A:case S:case Re:return Ar(+e,+r);case b:return e.name==r.name&&e.message==r.message;case st:case Je:return e==r+"";case ve:var w=Ga;case De:var I=u&H;if(w||(w=_s),e.size!=r.size&&!I)return!1;var F=m.get(e);if(F)return F==r;u|=K,m.set(e,r);var D=zu(w(e),w(r),u,l,g,m);return m.delete(e),D;case Qe:if(En)return En.call(e)==En.call(r)}return!1}function Pd(e,r,s,u,l,g){var m=s&H,w=_o(e),I=w.length,F=_o(r),D=F.length;if(I!=D&&!m)return!1;for(var M=I;M--;){var G=w[M];if(!(m?G in r:Le.call(r,G)))return!1}var ee=g.get(e),ne=g.get(r);if(ee&&ne)return ee==r&&ne==e;var me=!0;g.set(e,r),g.set(r,e);for(var se=m;++M<I;){G=w[M];var xe=e[G],Oe=r[G];if(u)var pr=m?u(Oe,xe,G,r,e,g):u(xe,Oe,G,e,r,g);if(!(pr===t?xe===Oe||l(xe,Oe,s,u,g):pr)){me=!1;break}se||(se=G=="constructor")}if(me&&!se){var Zt=e.constructor,dr=r.constructor;Zt!=dr&&"constructor"in e&&"constructor"in r&&!(typeof Zt=="function"&&Zt instanceof Zt&&typeof dr=="function"&&dr instanceof dr)&&(me=!1)}return g.delete(e),g.delete(r),me}function Jr(e){return Oo(Bu(e,t,th),e+"")}function _o(e){return au(e,Mt,xo)}function wo(e){return au(e,sr,Uu)}var bo=Rs?function(e){return Rs.get(e)}:zo;function Vs(e){for(var r=e.name+"",s=Xi[r],u=Le.call(Xi,r)?s.length:0;u--;){var l=s[u],g=l.func;if(g==null||g==e)return l.name}return r}function nn(e){var r=Le.call(p,"placeholder")?p:e;return r.placeholder}function ie(){var e=p.iteratee||Lo;return e=e===Lo?uu:e,arguments.length?e(arguments[0],arguments[1]):e}function Bs(e,r){var s=e.__data__;return Fd(r)?s[typeof r=="string"?"string":"hash"]:s.map}function Eo(e){for(var r=Mt(e),s=r.length;s--;){var u=r[s],l=e[u];r[s]=[u,l,Ku(l)]}return r}function Ni(e,r){var s=jf(e,r);return cu(s)?s:t}function Od(e){var r=Le.call(e,Ci),s=e[Ci];try{e[Ci]=t;var u=!0}catch{}var l=xs.call(e);return u&&(r?e[Ci]=s:delete e[Ci]),l}var xo=Ja?function(e){return e==null?[]:(e=Ge(e),oi(Ja(e),function(r){return Gc.call(e,r)}))}:Uo,Uu=Ja?function(e){for(var r=[];e;)ci(r,xo(e)),e=Ps(e);return r}:Uo,Vt=Qt;(Qa&&Vt(new Qa(new ArrayBuffer(1)))!=ke||_n&&Vt(new _n)!=ve||Ya&&Vt(Ya.resolve())!=It||Zi&&Vt(new Zi)!=De||wn&&Vt(new wn)!=ze)&&(Vt=function(e){var r=Qt(e),s=r==Ie?e.constructor:t,u=s?Fi(s):"";if(u)switch(u){case up:return ke;case hp:return ve;case lp:return It;case fp:return De;case pp:return ze}return r});function Cd(e,r,s){for(var u=-1,l=s.length;++u<l;){var g=s[u],m=g.size;switch(g.type){case"drop":e+=m;break;case"dropRight":r-=m;break;case"take":r=Kt(r,e+m);break;case"takeRight":e=qt(e,r-m);break}}return{start:e,end:r}}function Ad(e){var r=e.match(We);return r?r[1].split(At):[]}function Hu(e,r,s){r=pi(r,e);for(var u=-1,l=r.length,g=!1;++u<l;){var m=Mr(r[u]);if(!(g=e!=null&&s(e,m)))break;e=e[m]}return g||++u!=l?g:(l=e==null?0:e.length,!!l&&Xs(l)&&Qr(m,l)&&(fe(e)||Di(e)))}function Td(e){var r=e.length,s=new e.constructor(r);return r&&typeof e[0]=="string"&&Le.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function ku(e){return typeof e.constructor=="function"&&!An(e)?en(Ps(e)):{}}function Rd(e,r,s){var u=e.constructor;switch(r){case $e:return yo(e);case A:case S:return new u(+e);case ke:return dd(e,s);case ht:case je:case St:case Ft:case zt:case Ut:case jt:case Gt:case tr:return Su(e,s);case ve:return new u;case Re:case Je:return new u(e);case st:return gd(e);case De:return new u;case Qe:return yd(e)}}function $d(e,r){var s=r.length;if(!s)return e;var u=s-1;return r[u]=(s>1?"& ":"")+r[u],r=r.join(s>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+r+`] */
`)}function Nd(e){return fe(e)||Di(e)||!!(Wc&&e&&e[Wc])}function Qr(e,r){var s=typeof e;return r=r??J,!!r&&(s=="number"||s!="symbol"&&Sa.test(e))&&e>-1&&e%1==0&&e<r}function Yt(e,r,s){if(!ct(s))return!1;var u=typeof r;return(u=="number"?nr(s)&&Qr(r,s.length):u=="string"&&r in s)?Ar(s[r],e):!1}function Io(e,r){if(fe(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||fr(e)?!0:Pt.test(e)||!rt.test(e)||r!=null&&e in Ge(r)}function Fd(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function So(e){var r=Vs(e),s=p[r];if(typeof s!="function"||!(r in Se.prototype))return!1;if(e===s)return!0;var u=bo(s);return!!u&&e===u[0]}function Dd(e){return!!Kc&&Kc in e}var qd=bs?Yr:Ho;function An(e){var r=e&&e.constructor,s=typeof r=="function"&&r.prototype||Yi;return e===s}function Ku(e){return e===e&&!ct(e)}function Vu(e,r){return function(s){return s==null?!1:s[e]===r&&(r!==t||e in Ge(s))}}function jd(e){var r=Ys(e,function(u){return s.size===v&&s.clear(),u}),s=r.cache;return r}function Ld(e,r){var s=e[1],u=r[1],l=s|u,g=l<(ae|be|z),m=u==z&&s==pe||u==z&&s==W&&e[7].length<=r[8]||u==(z|W)&&r[7].length<=r[8]&&s==pe;if(!(g||m))return e;u&ae&&(e[2]=r[2],l|=s&ae?0:de);var w=r[3];if(w){var I=e[3];e[3]=I?Ou(I,w,r[4]):w,e[4]=I?ui(e[3],P):r[4]}return w=r[5],w&&(I=e[5],e[5]=I?Cu(I,w,r[6]):w,e[6]=I?ui(e[5],P):r[6]),w=r[7],w&&(e[7]=w),u&z&&(e[8]=e[8]==null?r[8]:Kt(e[8],r[8])),e[9]==null&&(e[9]=r[9]),e[0]=r[0],e[1]=l,e}function Md(e){var r=[];if(e!=null)for(var s in Ge(e))r.push(s);return r}function zd(e){return xs.call(e)}function Bu(e,r,s){return r=qt(r===t?e.length-1:r,0),function(){for(var u=arguments,l=-1,g=qt(u.length-r,0),m=O(g);++l<g;)m[l]=u[r+l];l=-1;for(var w=O(r+1);++l<r;)w[l]=u[l];return w[r]=s(m),Lt(e,this,w)}}function Gu(e,r){return r.length<2?e:$i(e,br(r,0,-1))}function Ud(e,r){for(var s=e.length,u=Kt(r.length,s),l=ir(e);u--;){var g=r[u];e[u]=Qr(g,s)?l[g]:t}return e}function Po(e,r){if(!(r==="constructor"&&typeof e[r]=="function")&&r!="__proto__")return e[r]}var Wu=Qu(vu),Tn=rp||function(e,r){return Pe.setTimeout(e,r)},Oo=Qu(hd);function Ju(e,r,s){var u=r+"";return Oo(e,$d(u,Hd(Ad(u),s)))}function Qu(e){var r=0,s=0;return function(){var u=ap(),l=et-(u-s);if(s=u,l>0){if(++r>=Ae)return arguments[0]}else r=0;return e.apply(t,arguments)}}function Gs(e,r){var s=-1,u=e.length,l=u-1;for(r=r===t?u:r;++s<r;){var g=co(s,l),m=e[g];e[g]=e[s],e[s]=m}return e.length=r,e}var Yu=jd(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(Ot,function(s,u,l,g){r.push(l?g.replace(_a,"$1"):u||s)}),r});function Mr(e){if(typeof e=="string"||fr(e))return e;var r=e+"";return r=="0"&&1/e==-Te?"-0":r}function Fi(e){if(e!=null){try{return Es.call(e)}catch{}try{return e+""}catch{}}return""}function Hd(e,r){return vr(Nr,function(s){var u="_."+s[0];r&s[1]&&!vs(e,u)&&e.push(u)}),e.sort()}function Zu(e){if(e instanceof Se)return e.clone();var r=new _r(e.__wrapped__,e.__chain__);return r.__actions__=ir(e.__actions__),r.__index__=e.__index__,r.__values__=e.__values__,r}function kd(e,r,s){(s?Yt(e,r,s):r===t)?r=1:r=qt(ye(r),0);var u=e==null?0:e.length;if(!u||r<1)return[];for(var l=0,g=0,m=O(As(u/r));l<u;)m[g++]=br(e,l,l+=r);return m}function Kd(e){for(var r=-1,s=e==null?0:e.length,u=0,l=[];++r<s;){var g=e[r];g&&(l[u++]=g)}return l}function Vd(){var e=arguments.length;if(!e)return[];for(var r=O(e-1),s=arguments[0],u=e;u--;)r[u-1]=arguments[u];return ci(fe(s)?ir(s):[s],Ht(r,1))}var Bd=we(function(e,r){return bt(e)?In(e,Ht(r,1,bt,!0)):[]}),Gd=we(function(e,r){var s=Er(r);return bt(s)&&(s=t),bt(e)?In(e,Ht(r,1,bt,!0),ie(s,2)):[]}),Wd=we(function(e,r){var s=Er(r);return bt(s)&&(s=t),bt(e)?In(e,Ht(r,1,bt,!0),t,s):[]});function Jd(e,r,s){var u=e==null?0:e.length;return u?(r=s||r===t?1:ye(r),br(e,r<0?0:r,u)):[]}function Qd(e,r,s){var u=e==null?0:e.length;return u?(r=s||r===t?1:ye(r),r=u-r,br(e,0,r<0?0:r)):[]}function Yd(e,r){return e&&e.length?Ms(e,ie(r,3),!0,!0):[]}function Zd(e,r){return e&&e.length?Ms(e,ie(r,3),!0):[]}function Xd(e,r,s,u){var l=e==null?0:e.length;return l?(s&&typeof s!="number"&&Yt(e,r,s)&&(s=0,u=l),Vp(e,r,s,u)):[]}function Xu(e,r,s){var u=e==null?0:e.length;if(!u)return-1;var l=s==null?0:ye(s);return l<0&&(l=qt(u+l,0)),ms(e,ie(r,3),l)}function eh(e,r,s){var u=e==null?0:e.length;if(!u)return-1;var l=u-1;return s!==t&&(l=ye(s),l=s<0?qt(u+l,0):Kt(l,u-1)),ms(e,ie(r,3),l,!0)}function th(e){var r=e==null?0:e.length;return r?Ht(e,1):[]}function eg(e){var r=e==null?0:e.length;return r?Ht(e,Te):[]}function tg(e,r){var s=e==null?0:e.length;return s?(r=r===t?1:ye(r),Ht(e,r)):[]}function rg(e){for(var r=-1,s=e==null?0:e.length,u={};++r<s;){var l=e[r];u[l[0]]=l[1]}return u}function rh(e){return e&&e.length?e[0]:t}function ig(e,r,s){var u=e==null?0:e.length;if(!u)return-1;var l=s==null?0:ye(s);return l<0&&(l=qt(u+l,0)),Gi(e,r,l)}function ng(e){var r=e==null?0:e.length;return r?br(e,0,-1):[]}var sg=we(function(e){var r=it(e,po);return r.length&&r[0]===e[0]?io(r):[]}),ag=we(function(e){var r=Er(e),s=it(e,po);return r===Er(s)?r=t:s.pop(),s.length&&s[0]===e[0]?io(s,ie(r,2)):[]}),og=we(function(e){var r=Er(e),s=it(e,po);return r=typeof r=="function"?r:t,r&&s.pop(),s.length&&s[0]===e[0]?io(s,t,r):[]});function cg(e,r){return e==null?"":np.call(e,r)}function Er(e){var r=e==null?0:e.length;return r?e[r-1]:t}function ug(e,r,s){var u=e==null?0:e.length;if(!u)return-1;var l=u;return s!==t&&(l=ye(s),l=l<0?qt(u+l,0):Kt(l,u-1)),r===r?Hf(e,r,l):ms(e,qc,l,!0)}function hg(e,r){return e&&e.length?pu(e,ye(r)):t}var lg=we(ih);function ih(e,r){return e&&e.length&&r&&r.length?oo(e,r):e}function fg(e,r,s){return e&&e.length&&r&&r.length?oo(e,r,ie(s,2)):e}function pg(e,r,s){return e&&e.length&&r&&r.length?oo(e,r,t,s):e}var dg=Jr(function(e,r){var s=e==null?0:e.length,u=Xa(e,r);return yu(e,it(r,function(l){return Qr(l,s)?+l:l}).sort(Pu)),u});function gg(e,r){var s=[];if(!(e&&e.length))return s;var u=-1,l=[],g=e.length;for(r=ie(r,3);++u<g;){var m=e[u];r(m,u,e)&&(s.push(m),l.push(u))}return yu(e,l),s}function Co(e){return e==null?e:cp.call(e)}function yg(e,r,s){var u=e==null?0:e.length;return u?(s&&typeof s!="number"&&Yt(e,r,s)?(r=0,s=u):(r=r==null?0:ye(r),s=s===t?u:ye(s)),br(e,r,s)):[]}function vg(e,r){return Ls(e,r)}function mg(e,r,s){return ho(e,r,ie(s,2))}function _g(e,r){var s=e==null?0:e.length;if(s){var u=Ls(e,r);if(u<s&&Ar(e[u],r))return u}return-1}function wg(e,r){return Ls(e,r,!0)}function bg(e,r,s){return ho(e,r,ie(s,2),!0)}function Eg(e,r){var s=e==null?0:e.length;if(s){var u=Ls(e,r,!0)-1;if(Ar(e[u],r))return u}return-1}function xg(e){return e&&e.length?mu(e):[]}function Ig(e,r){return e&&e.length?mu(e,ie(r,2)):[]}function Sg(e){var r=e==null?0:e.length;return r?br(e,1,r):[]}function Pg(e,r,s){return e&&e.length?(r=s||r===t?1:ye(r),br(e,0,r<0?0:r)):[]}function Og(e,r,s){var u=e==null?0:e.length;return u?(r=s||r===t?1:ye(r),r=u-r,br(e,r<0?0:r,u)):[]}function Cg(e,r){return e&&e.length?Ms(e,ie(r,3),!1,!0):[]}function Ag(e,r){return e&&e.length?Ms(e,ie(r,3)):[]}var Tg=we(function(e){return fi(Ht(e,1,bt,!0))}),Rg=we(function(e){var r=Er(e);return bt(r)&&(r=t),fi(Ht(e,1,bt,!0),ie(r,2))}),$g=we(function(e){var r=Er(e);return r=typeof r=="function"?r:t,fi(Ht(e,1,bt,!0),t,r)});function Ng(e){return e&&e.length?fi(e):[]}function Fg(e,r){return e&&e.length?fi(e,ie(r,2)):[]}function Dg(e,r){return r=typeof r=="function"?r:t,e&&e.length?fi(e,t,r):[]}function Ao(e){if(!(e&&e.length))return[];var r=0;return e=oi(e,function(s){if(bt(s))return r=qt(s.length,r),!0}),Va(r,function(s){return it(e,Ha(s))})}function nh(e,r){if(!(e&&e.length))return[];var s=Ao(e);return r==null?s:it(s,function(u){return Lt(r,t,u)})}var qg=we(function(e,r){return bt(e)?In(e,r):[]}),jg=we(function(e){return fo(oi(e,bt))}),Lg=we(function(e){var r=Er(e);return bt(r)&&(r=t),fo(oi(e,bt),ie(r,2))}),Mg=we(function(e){var r=Er(e);return r=typeof r=="function"?r:t,fo(oi(e,bt),t,r)}),zg=we(Ao);function Ug(e,r){return Eu(e||[],r||[],xn)}function Hg(e,r){return Eu(e||[],r||[],On)}var kg=we(function(e){var r=e.length,s=r>1?e[r-1]:t;return s=typeof s=="function"?(e.pop(),s):t,nh(e,s)});function sh(e){var r=p(e);return r.__chain__=!0,r}function Kg(e,r){return r(e),e}function Ws(e,r){return r(e)}var Vg=Jr(function(e){var r=e.length,s=r?e[0]:0,u=this.__wrapped__,l=function(g){return Xa(g,e)};return r>1||this.__actions__.length||!(u instanceof Se)||!Qr(s)?this.thru(l):(u=u.slice(s,+s+(r?1:0)),u.__actions__.push({func:Ws,args:[l],thisArg:t}),new _r(u,this.__chain__).thru(function(g){return r&&!g.length&&g.push(t),g}))});function Bg(){return sh(this)}function Gg(){return new _r(this.value(),this.__chain__)}function Wg(){this.__values__===t&&(this.__values__=_h(this.value()));var e=this.__index__>=this.__values__.length,r=e?t:this.__values__[this.__index__++];return{done:e,value:r}}function Jg(){return this}function Qg(e){for(var r,s=this;s instanceof Ns;){var u=Zu(s);u.__index__=0,u.__values__=t,r?l.__wrapped__=u:r=u;var l=u;s=s.__wrapped__}return l.__wrapped__=e,r}function Yg(){var e=this.__wrapped__;if(e instanceof Se){var r=e;return this.__actions__.length&&(r=new Se(this)),r=r.reverse(),r.__actions__.push({func:Ws,args:[Co],thisArg:t}),new _r(r,this.__chain__)}return this.thru(Co)}function Zg(){return bu(this.__wrapped__,this.__actions__)}var Xg=zs(function(e,r,s){Le.call(e,s)?++e[s]:Gr(e,s,1)});function ey(e,r,s){var u=fe(e)?Fc:Kp;return s&&Yt(e,r,s)&&(r=t),u(e,ie(r,3))}function ty(e,r){var s=fe(e)?oi:nu;return s(e,ie(r,3))}var ry=$u(Xu),iy=$u(eh);function ny(e,r){return Ht(Js(e,r),1)}function sy(e,r){return Ht(Js(e,r),Te)}function ay(e,r,s){return s=s===t?1:ye(s),Ht(Js(e,r),s)}function ah(e,r){var s=fe(e)?vr:li;return s(e,ie(r,3))}function oh(e,r){var s=fe(e)?Sf:iu;return s(e,ie(r,3))}var oy=zs(function(e,r,s){Le.call(e,s)?e[s].push(r):Gr(e,s,[r])});function cy(e,r,s,u){e=nr(e)?e:an(e),s=s&&!u?ye(s):0;var l=e.length;return s<0&&(s=qt(l+s,0)),ea(e)?s<=l&&e.indexOf(r,s)>-1:!!l&&Gi(e,r,s)>-1}var uy=we(function(e,r,s){var u=-1,l=typeof r=="function",g=nr(e)?O(e.length):[];return li(e,function(m){g[++u]=l?Lt(r,m,s):Sn(m,r,s)}),g}),hy=zs(function(e,r,s){Gr(e,s,r)});function Js(e,r){var s=fe(e)?it:hu;return s(e,ie(r,3))}function ly(e,r,s,u){return e==null?[]:(fe(r)||(r=r==null?[]:[r]),s=u?t:s,fe(s)||(s=s==null?[]:[s]),du(e,r,s))}var fy=zs(function(e,r,s){e[s?0:1].push(r)},function(){return[[],[]]});function py(e,r,s){var u=fe(e)?za:Lc,l=arguments.length<3;return u(e,ie(r,4),s,l,li)}function dy(e,r,s){var u=fe(e)?Pf:Lc,l=arguments.length<3;return u(e,ie(r,4),s,l,iu)}function gy(e,r){var s=fe(e)?oi:nu;return s(e,Zs(ie(r,3)))}function yy(e){var r=fe(e)?Xc:cd;return r(e)}function vy(e,r,s){(s?Yt(e,r,s):r===t)?r=1:r=ye(r);var u=fe(e)?Mp:ud;return u(e,r)}function my(e){var r=fe(e)?zp:ld;return r(e)}function _y(e){if(e==null)return 0;if(nr(e))return ea(e)?Ji(e):e.length;var r=Vt(e);return r==ve||r==De?e.size:so(e).length}function wy(e,r,s){var u=fe(e)?Ua:fd;return s&&Yt(e,r,s)&&(r=t),u(e,ie(r,3))}var by=we(function(e,r){if(e==null)return[];var s=r.length;return s>1&&Yt(e,r[0],r[1])?r=[]:s>2&&Yt(r[0],r[1],r[2])&&(r=[r[0]]),du(e,Ht(r,1),[])}),Qs=tp||function(){return Pe.Date.now()};function Ey(e,r){if(typeof r!="function")throw new mr(f);return e=ye(e),function(){if(--e<1)return r.apply(this,arguments)}}function ch(e,r,s){return r=s?t:r,r=e&&r==null?e.length:r,Wr(e,z,t,t,t,t,r)}function uh(e,r){var s;if(typeof r!="function")throw new mr(f);return e=ye(e),function(){return--e>0&&(s=r.apply(this,arguments)),e<=1&&(r=t),s}}var To=we(function(e,r,s){var u=ae;if(s.length){var l=ui(s,nn(To));u|=he}return Wr(e,u,r,s,l)}),hh=we(function(e,r,s){var u=ae|be;if(s.length){var l=ui(s,nn(hh));u|=he}return Wr(r,u,e,s,l)});function lh(e,r,s){r=s?t:r;var u=Wr(e,pe,t,t,t,t,t,r);return u.placeholder=lh.placeholder,u}function fh(e,r,s){r=s?t:r;var u=Wr(e,ue,t,t,t,t,t,r);return u.placeholder=fh.placeholder,u}function ph(e,r,s){var u,l,g,m,w,I,F=0,D=!1,M=!1,G=!0;if(typeof e!="function")throw new mr(f);r=xr(r)||0,ct(s)&&(D=!!s.leading,M="maxWait"in s,g=M?qt(xr(s.maxWait)||0,r):g,G="trailing"in s?!!s.trailing:G);function ee(Et){var Tr=u,Xr=l;return u=l=t,F=Et,m=e.apply(Xr,Tr),m}function ne(Et){return F=Et,w=Tn(xe,r),D?ee(Et):m}function me(Et){var Tr=Et-I,Xr=Et-F,$h=r-Tr;return M?Kt($h,g-Xr):$h}function se(Et){var Tr=Et-I,Xr=Et-F;return I===t||Tr>=r||Tr<0||M&&Xr>=g}function xe(){var Et=Qs();if(se(Et))return Oe(Et);w=Tn(xe,me(Et))}function Oe(Et){return w=t,G&&u?ee(Et):(u=l=t,m)}function pr(){w!==t&&xu(w),F=0,u=I=l=w=t}function Zt(){return w===t?m:Oe(Qs())}function dr(){var Et=Qs(),Tr=se(Et);if(u=arguments,l=this,I=Et,Tr){if(w===t)return ne(I);if(M)return xu(w),w=Tn(xe,r),ee(I)}return w===t&&(w=Tn(xe,r)),m}return dr.cancel=pr,dr.flush=Zt,dr}var xy=we(function(e,r){return ru(e,1,r)}),Iy=we(function(e,r,s){return ru(e,xr(r)||0,s)});function Sy(e){return Wr(e,ge)}function Ys(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new mr(f);var s=function(){var u=arguments,l=r?r.apply(this,u):u[0],g=s.cache;if(g.has(l))return g.get(l);var m=e.apply(this,u);return s.cache=g.set(l,m)||g,m};return s.cache=new(Ys.Cache||Br),s}Ys.Cache=Br;function Zs(e){if(typeof e!="function")throw new mr(f);return function(){var r=arguments;switch(r.length){case 0:return!e.call(this);case 1:return!e.call(this,r[0]);case 2:return!e.call(this,r[0],r[1]);case 3:return!e.call(this,r[0],r[1],r[2])}return!e.apply(this,r)}}function Py(e){return uh(2,e)}var Oy=pd(function(e,r){r=r.length==1&&fe(r[0])?it(r[0],hr(ie())):it(Ht(r,1),hr(ie()));var s=r.length;return we(function(u){for(var l=-1,g=Kt(u.length,s);++l<g;)u[l]=r[l].call(this,u[l]);return Lt(e,this,u)})}),Ro=we(function(e,r){var s=ui(r,nn(Ro));return Wr(e,he,t,r,s)}),dh=we(function(e,r){var s=ui(r,nn(dh));return Wr(e,$,t,r,s)}),Cy=Jr(function(e,r){return Wr(e,W,t,t,t,r)});function Ay(e,r){if(typeof e!="function")throw new mr(f);return r=r===t?r:ye(r),we(e,r)}function Ty(e,r){if(typeof e!="function")throw new mr(f);return r=r==null?0:qt(ye(r),0),we(function(s){var u=s[r],l=di(s,0,r);return u&&ci(l,u),Lt(e,this,l)})}function Ry(e,r,s){var u=!0,l=!0;if(typeof e!="function")throw new mr(f);return ct(s)&&(u="leading"in s?!!s.leading:u,l="trailing"in s?!!s.trailing:l),ph(e,r,{leading:u,maxWait:r,trailing:l})}function $y(e){return ch(e,1)}function Ny(e,r){return Ro(go(r),e)}function Fy(){if(!arguments.length)return[];var e=arguments[0];return fe(e)?e:[e]}function Dy(e){return wr(e,U)}function qy(e,r){return r=typeof r=="function"?r:t,wr(e,U,r)}function jy(e){return wr(e,L|U)}function Ly(e,r){return r=typeof r=="function"?r:t,wr(e,L|U,r)}function My(e,r){return r==null||tu(e,r,Mt(r))}function Ar(e,r){return e===r||e!==e&&r!==r}var zy=Ks(ro),Uy=Ks(function(e,r){return e>=r}),Di=ou(function(){return arguments}())?ou:function(e){return vt(e)&&Le.call(e,"callee")&&!Gc.call(e,"callee")},fe=O.isArray,Hy=Jt?hr(Jt):Qp;function nr(e){return e!=null&&Xs(e.length)&&!Yr(e)}function bt(e){return vt(e)&&nr(e)}function ky(e){return e===!0||e===!1||vt(e)&&Qt(e)==A}var gi=ip||Ho,Ky=Pr?hr(Pr):Yp;function Vy(e){return vt(e)&&e.nodeType===1&&!Rn(e)}function By(e){if(e==null)return!0;if(nr(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||gi(e)||sn(e)||Di(e)))return!e.length;var r=Vt(e);if(r==ve||r==De)return!e.size;if(An(e))return!so(e).length;for(var s in e)if(Le.call(e,s))return!1;return!0}function Gy(e,r){return Pn(e,r)}function Wy(e,r,s){s=typeof s=="function"?s:t;var u=s?s(e,r):t;return u===t?Pn(e,r,t,s):!!u}function $o(e){if(!vt(e))return!1;var r=Qt(e);return r==b||r==h||typeof e.message=="string"&&typeof e.name=="string"&&!Rn(e)}function Jy(e){return typeof e=="number"&&Jc(e)}function Yr(e){if(!ct(e))return!1;var r=Qt(e);return r==X||r==oe||r==R||r==mt}function gh(e){return typeof e=="number"&&e==ye(e)}function Xs(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ct(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}function vt(e){return e!=null&&typeof e=="object"}var yh=yr?hr(yr):Xp;function Qy(e,r){return e===r||no(e,r,Eo(r))}function Yy(e,r,s){return s=typeof s=="function"?s:t,no(e,r,Eo(r),s)}function Zy(e){return vh(e)&&e!=+e}function Xy(e){if(qd(e))throw new ce(c);return cu(e)}function e0(e){return e===null}function t0(e){return e==null}function vh(e){return typeof e=="number"||vt(e)&&Qt(e)==Re}function Rn(e){if(!vt(e)||Qt(e)!=Ie)return!1;var r=Ps(e);if(r===null)return!0;var s=Le.call(r,"constructor")&&r.constructor;return typeof s=="function"&&s instanceof s&&Es.call(s)==Yf}var No=qr?hr(qr):ed;function r0(e){return gh(e)&&e>=-J&&e<=J}var mh=yn?hr(yn):td;function ea(e){return typeof e=="string"||!fe(e)&&vt(e)&&Qt(e)==Je}function fr(e){return typeof e=="symbol"||vt(e)&&Qt(e)==Qe}var sn=Oi?hr(Oi):rd;function i0(e){return e===t}function n0(e){return vt(e)&&Vt(e)==ze}function s0(e){return vt(e)&&Qt(e)==Ye}var a0=Ks(ao),o0=Ks(function(e,r){return e<=r});function _h(e){if(!e)return[];if(nr(e))return ea(e)?Or(e):ir(e);if(mn&&e[mn])return Mf(e[mn]());var r=Vt(e),s=r==ve?Ga:r==De?_s:an;return s(e)}function Zr(e){if(!e)return e===0?e:0;if(e=xr(e),e===Te||e===-Te){var r=e<0?-1:1;return r*V}return e===e?e:0}function ye(e){var r=Zr(e),s=r%1;return r===r?s?r-s:r:0}function wh(e){return e?Ri(ye(e),0,B):0}function xr(e){if(typeof e=="number")return e;if(fr(e))return k;if(ct(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=ct(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=Mc(e);var s=Ea.test(e);return s||Ia.test(e)?le(e.slice(2),s?2:8):ba.test(e)?k:+e}function bh(e){return Lr(e,sr(e))}function c0(e){return e?Ri(ye(e),-J,J):e===0?e:0}function qe(e){return e==null?"":lr(e)}var u0=tn(function(e,r){if(An(r)||nr(r)){Lr(r,Mt(r),e);return}for(var s in r)Le.call(r,s)&&xn(e,s,r[s])}),Eh=tn(function(e,r){Lr(r,sr(r),e)}),ta=tn(function(e,r,s,u){Lr(r,sr(r),e,u)}),h0=tn(function(e,r,s,u){Lr(r,Mt(r),e,u)}),l0=Jr(Xa);function f0(e,r){var s=en(e);return r==null?s:eu(s,r)}var p0=we(function(e,r){e=Ge(e);var s=-1,u=r.length,l=u>2?r[2]:t;for(l&&Yt(r[0],r[1],l)&&(u=1);++s<u;)for(var g=r[s],m=sr(g),w=-1,I=m.length;++w<I;){var F=m[w],D=e[F];(D===t||Ar(D,Yi[F])&&!Le.call(e,F))&&(e[F]=g[F])}return e}),d0=we(function(e){return e.push(t,Mu),Lt(xh,t,e)});function g0(e,r){return Dc(e,ie(r,3),jr)}function y0(e,r){return Dc(e,ie(r,3),to)}function v0(e,r){return e==null?e:eo(e,ie(r,3),sr)}function m0(e,r){return e==null?e:su(e,ie(r,3),sr)}function _0(e,r){return e&&jr(e,ie(r,3))}function w0(e,r){return e&&to(e,ie(r,3))}function b0(e){return e==null?[]:qs(e,Mt(e))}function E0(e){return e==null?[]:qs(e,sr(e))}function Fo(e,r,s){var u=e==null?t:$i(e,r);return u===t?s:u}function x0(e,r){return e!=null&&Hu(e,r,Bp)}function Do(e,r){return e!=null&&Hu(e,r,Gp)}var I0=Fu(function(e,r,s){r!=null&&typeof r.toString!="function"&&(r=xs.call(r)),e[r]=s},jo(ar)),S0=Fu(function(e,r,s){r!=null&&typeof r.toString!="function"&&(r=xs.call(r)),Le.call(e,r)?e[r].push(s):e[r]=[s]},ie),P0=we(Sn);function Mt(e){return nr(e)?Zc(e):so(e)}function sr(e){return nr(e)?Zc(e,!0):id(e)}function O0(e,r){var s={};return r=ie(r,3),jr(e,function(u,l,g){Gr(s,r(u,l,g),u)}),s}function C0(e,r){var s={};return r=ie(r,3),jr(e,function(u,l,g){Gr(s,l,r(u,l,g))}),s}var A0=tn(function(e,r,s){js(e,r,s)}),xh=tn(function(e,r,s,u){js(e,r,s,u)}),T0=Jr(function(e,r){var s={};if(e==null)return s;var u=!1;r=it(r,function(g){return g=pi(g,e),u||(u=g.length>1),g}),Lr(e,wo(e),s),u&&(s=wr(s,L|T|U,Id));for(var l=r.length;l--;)lo(s,r[l]);return s});function R0(e,r){return Ih(e,Zs(ie(r)))}var $0=Jr(function(e,r){return e==null?{}:sd(e,r)});function Ih(e,r){if(e==null)return{};var s=it(wo(e),function(u){return[u]});return r=ie(r),gu(e,s,function(u,l){return r(u,l[0])})}function N0(e,r,s){r=pi(r,e);var u=-1,l=r.length;for(l||(l=1,e=t);++u<l;){var g=e==null?t:e[Mr(r[u])];g===t&&(u=l,g=s),e=Yr(g)?g.call(e):g}return e}function F0(e,r,s){return e==null?e:On(e,r,s)}function D0(e,r,s,u){return u=typeof u=="function"?u:t,e==null?e:On(e,r,s,u)}var Sh=ju(Mt),Ph=ju(sr);function q0(e,r,s){var u=fe(e),l=u||gi(e)||sn(e);if(r=ie(r,4),s==null){var g=e&&e.constructor;l?s=u?new g:[]:ct(e)?s=Yr(g)?en(Ps(e)):{}:s={}}return(l?vr:jr)(e,function(m,w,I){return r(s,m,w,I)}),s}function j0(e,r){return e==null?!0:lo(e,r)}function L0(e,r,s){return e==null?e:wu(e,r,go(s))}function M0(e,r,s,u){return u=typeof u=="function"?u:t,e==null?e:wu(e,r,go(s),u)}function an(e){return e==null?[]:Ba(e,Mt(e))}function z0(e){return e==null?[]:Ba(e,sr(e))}function U0(e,r,s){return s===t&&(s=r,r=t),s!==t&&(s=xr(s),s=s===s?s:0),r!==t&&(r=xr(r),r=r===r?r:0),Ri(xr(e),r,s)}function H0(e,r,s){return r=Zr(r),s===t?(s=r,r=0):s=Zr(s),e=xr(e),Wp(e,r,s)}function k0(e,r,s){if(s&&typeof s!="boolean"&&Yt(e,r,s)&&(r=s=t),s===t&&(typeof r=="boolean"?(s=r,r=t):typeof e=="boolean"&&(s=e,e=t)),e===t&&r===t?(e=0,r=1):(e=Zr(e),r===t?(r=e,e=0):r=Zr(r)),e>r){var u=e;e=r,r=u}if(s||e%1||r%1){var l=Qc();return Kt(e+l*(r-e+Ve("1e-"+((l+"").length-1))),r)}return co(e,r)}var K0=rn(function(e,r,s){return r=r.toLowerCase(),e+(s?Oh(r):r)});function Oh(e){return qo(qe(e).toLowerCase())}function Ch(e){return e=qe(e),e&&e.replace(kr,Ff).replace(ja,"")}function V0(e,r,s){e=qe(e),r=lr(r);var u=e.length;s=s===t?u:Ri(ye(s),0,u);var l=s;return s-=r.length,s>=0&&e.slice(s,l)==r}function B0(e){return e=qe(e),e&&tt.test(e)?e.replace(Ei,Df):e}function G0(e){return e=qe(e),e&&Ct.test(e)?e.replace(dt,"\\$&"):e}var W0=rn(function(e,r,s){return e+(s?"-":"")+r.toLowerCase()}),J0=rn(function(e,r,s){return e+(s?" ":"")+r.toLowerCase()}),Q0=Ru("toLowerCase");function Y0(e,r,s){e=qe(e),r=ye(r);var u=r?Ji(e):0;if(!r||u>=r)return e;var l=(r-u)/2;return ks(Ts(l),s)+e+ks(As(l),s)}function Z0(e,r,s){e=qe(e),r=ye(r);var u=r?Ji(e):0;return r&&u<r?e+ks(r-u,s):e}function X0(e,r,s){e=qe(e),r=ye(r);var u=r?Ji(e):0;return r&&u<r?ks(r-u,s)+e:e}function ev(e,r,s){return s||r==null?r=0:r&&(r=+r),op(qe(e).replace(gt,""),r||0)}function tv(e,r,s){return(s?Yt(e,r,s):r===t)?r=1:r=ye(r),uo(qe(e),r)}function rv(){var e=arguments,r=qe(e[0]);return e.length<3?r:r.replace(e[1],e[2])}var iv=rn(function(e,r,s){return e+(s?"_":"")+r.toLowerCase()});function nv(e,r,s){return s&&typeof s!="number"&&Yt(e,r,s)&&(r=s=t),s=s===t?B:s>>>0,s?(e=qe(e),e&&(typeof r=="string"||r!=null&&!No(r))&&(r=lr(r),!r&&Wi(e))?di(Or(e),0,s):e.split(r,s)):[]}var sv=rn(function(e,r,s){return e+(s?" ":"")+qo(r)});function av(e,r,s){return e=qe(e),s=s==null?0:Ri(ye(s),0,e.length),r=lr(r),e.slice(s,s+r.length)==r}function ov(e,r,s){var u=p.templateSettings;s&&Yt(e,r,s)&&(r=t),e=qe(e),r=ta({},r,u,Lu);var l=ta({},r.imports,u.imports,Lu),g=Mt(l),m=Ba(l,g),w,I,F=0,D=r.interpolate||zi,M="__p += '",G=Wa((r.escape||zi).source+"|"+D.source+"|"+(D===ot?wa:zi).source+"|"+(r.evaluate||zi).source+"|$","g"),ee="//# sourceURL="+(Le.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++La+"]")+`
`;e.replace(G,function(se,xe,Oe,pr,Zt,dr){return Oe||(Oe=pr),M+=e.slice(F,dr).replace(Pa,qf),xe&&(w=!0,M+=`' +
__e(`+xe+`) +
'`),Zt&&(I=!0,M+=`';
`+Zt+`;
__p += '`),Oe&&(M+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),F=dr+se.length,se}),M+=`';
`;var ne=Le.call(r,"variable")&&r.variable;if(!ne)M=`with (obj) {
`+M+`
}
`;else if(ma.test(ne))throw new ce(d);M=(I?M.replace(Fr,""):M).replace(Wt,"$1").replace(Hr,"$1;"),M="function("+(ne||"obj")+`) {
`+(ne?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(I?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+M+`return __p
}`;var me=Th(function(){return Fe(g,ee+"return "+M).apply(t,m)});if(me.source=M,$o(me))throw me;return me}function cv(e){return qe(e).toLowerCase()}function uv(e){return qe(e).toUpperCase()}function hv(e,r,s){if(e=qe(e),e&&(s||r===t))return Mc(e);if(!e||!(r=lr(r)))return e;var u=Or(e),l=Or(r),g=zc(u,l),m=Uc(u,l)+1;return di(u,g,m).join("")}function lv(e,r,s){if(e=qe(e),e&&(s||r===t))return e.slice(0,kc(e)+1);if(!e||!(r=lr(r)))return e;var u=Or(e),l=Uc(u,Or(r))+1;return di(u,0,l).join("")}function fv(e,r,s){if(e=qe(e),e&&(s||r===t))return e.replace(gt,"");if(!e||!(r=lr(r)))return e;var u=Or(e),l=zc(u,Or(r));return di(u,l).join("")}function pv(e,r){var s=te,u=Ee;if(ct(r)){var l="separator"in r?r.separator:l;s="length"in r?ye(r.length):s,u="omission"in r?lr(r.omission):u}e=qe(e);var g=e.length;if(Wi(e)){var m=Or(e);g=m.length}if(s>=g)return e;var w=s-Ji(u);if(w<1)return u;var I=m?di(m,0,w).join(""):e.slice(0,w);if(l===t)return I+u;if(m&&(w+=I.length-w),No(l)){if(e.slice(w).search(l)){var F,D=I;for(l.global||(l=Wa(l.source,qe(gr.exec(l))+"g")),l.lastIndex=0;F=l.exec(D);)var M=F.index;I=I.slice(0,M===t?w:M)}}else if(e.indexOf(lr(l),w)!=w){var G=I.lastIndexOf(l);G>-1&&(I=I.slice(0,G))}return I+u}function dv(e){return e=qe(e),e&&lt.test(e)?e.replace(si,kf):e}var gv=rn(function(e,r,s){return e+(s?" ":"")+r.toUpperCase()}),qo=Ru("toUpperCase");function Ah(e,r,s){return e=qe(e),r=s?t:r,r===t?Lf(e)?Bf(e):Af(e):e.match(r)||[]}var Th=we(function(e,r){try{return Lt(e,t,r)}catch(s){return $o(s)?s:new ce(s)}}),yv=Jr(function(e,r){return vr(r,function(s){s=Mr(s),Gr(e,s,To(e[s],e))}),e});function vv(e){var r=e==null?0:e.length,s=ie();return e=r?it(e,function(u){if(typeof u[1]!="function")throw new mr(f);return[s(u[0]),u[1]]}):[],we(function(u){for(var l=-1;++l<r;){var g=e[l];if(Lt(g[0],this,u))return Lt(g[1],this,u)}})}function mv(e){return kp(wr(e,L))}function jo(e){return function(){return e}}function _v(e,r){return e==null||e!==e?r:e}var wv=Nu(),bv=Nu(!0);function ar(e){return e}function Lo(e){return uu(typeof e=="function"?e:wr(e,L))}function Ev(e){return lu(wr(e,L))}function xv(e,r){return fu(e,wr(r,L))}var Iv=we(function(e,r){return function(s){return Sn(s,e,r)}}),Sv=we(function(e,r){return function(s){return Sn(e,s,r)}});function Mo(e,r,s){var u=Mt(r),l=qs(r,u);s==null&&!(ct(r)&&(l.length||!u.length))&&(s=r,r=e,e=this,l=qs(r,Mt(r)));var g=!(ct(s)&&"chain"in s)||!!s.chain,m=Yr(e);return vr(l,function(w){var I=r[w];e[w]=I,m&&(e.prototype[w]=function(){var F=this.__chain__;if(g||F){var D=e(this.__wrapped__),M=D.__actions__=ir(this.__actions__);return M.push({func:I,args:arguments,thisArg:e}),D.__chain__=F,D}return I.apply(e,ci([this.value()],arguments))})}),e}function Pv(){return Pe._===this&&(Pe._=Zf),this}function zo(){}function Ov(e){return e=ye(e),we(function(r){return pu(r,e)})}var Cv=vo(it),Av=vo(Fc),Tv=vo(Ua);function Rh(e){return Io(e)?Ha(Mr(e)):ad(e)}function Rv(e){return function(r){return e==null?t:$i(e,r)}}var $v=Du(),Nv=Du(!0);function Uo(){return[]}function Ho(){return!1}function Fv(){return{}}function Dv(){return""}function qv(){return!0}function jv(e,r){if(e=ye(e),e<1||e>J)return[];var s=B,u=Kt(e,B);r=ie(r),e-=B;for(var l=Va(u,r);++s<e;)r(s);return l}function Lv(e){return fe(e)?it(e,Mr):fr(e)?[e]:ir(Yu(qe(e)))}function Mv(e){var r=++Qf;return qe(e)+r}var zv=Hs(function(e,r){return e+r},0),Uv=mo("ceil"),Hv=Hs(function(e,r){return e/r},1),kv=mo("floor");function Kv(e){return e&&e.length?Ds(e,ar,ro):t}function Vv(e,r){return e&&e.length?Ds(e,ie(r,2),ro):t}function Bv(e){return jc(e,ar)}function Gv(e,r){return jc(e,ie(r,2))}function Wv(e){return e&&e.length?Ds(e,ar,ao):t}function Jv(e,r){return e&&e.length?Ds(e,ie(r,2),ao):t}var Qv=Hs(function(e,r){return e*r},1),Yv=mo("round"),Zv=Hs(function(e,r){return e-r},0);function Xv(e){return e&&e.length?Ka(e,ar):0}function e1(e,r){return e&&e.length?Ka(e,ie(r,2)):0}return p.after=Ey,p.ary=ch,p.assign=u0,p.assignIn=Eh,p.assignInWith=ta,p.assignWith=h0,p.at=l0,p.before=uh,p.bind=To,p.bindAll=yv,p.bindKey=hh,p.castArray=Fy,p.chain=sh,p.chunk=kd,p.compact=Kd,p.concat=Vd,p.cond=vv,p.conforms=mv,p.constant=jo,p.countBy=Xg,p.create=f0,p.curry=lh,p.curryRight=fh,p.debounce=ph,p.defaults=p0,p.defaultsDeep=d0,p.defer=xy,p.delay=Iy,p.difference=Bd,p.differenceBy=Gd,p.differenceWith=Wd,p.drop=Jd,p.dropRight=Qd,p.dropRightWhile=Yd,p.dropWhile=Zd,p.fill=Xd,p.filter=ty,p.flatMap=ny,p.flatMapDeep=sy,p.flatMapDepth=ay,p.flatten=th,p.flattenDeep=eg,p.flattenDepth=tg,p.flip=Sy,p.flow=wv,p.flowRight=bv,p.fromPairs=rg,p.functions=b0,p.functionsIn=E0,p.groupBy=oy,p.initial=ng,p.intersection=sg,p.intersectionBy=ag,p.intersectionWith=og,p.invert=I0,p.invertBy=S0,p.invokeMap=uy,p.iteratee=Lo,p.keyBy=hy,p.keys=Mt,p.keysIn=sr,p.map=Js,p.mapKeys=O0,p.mapValues=C0,p.matches=Ev,p.matchesProperty=xv,p.memoize=Ys,p.merge=A0,p.mergeWith=xh,p.method=Iv,p.methodOf=Sv,p.mixin=Mo,p.negate=Zs,p.nthArg=Ov,p.omit=T0,p.omitBy=R0,p.once=Py,p.orderBy=ly,p.over=Cv,p.overArgs=Oy,p.overEvery=Av,p.overSome=Tv,p.partial=Ro,p.partialRight=dh,p.partition=fy,p.pick=$0,p.pickBy=Ih,p.property=Rh,p.propertyOf=Rv,p.pull=lg,p.pullAll=ih,p.pullAllBy=fg,p.pullAllWith=pg,p.pullAt=dg,p.range=$v,p.rangeRight=Nv,p.rearg=Cy,p.reject=gy,p.remove=gg,p.rest=Ay,p.reverse=Co,p.sampleSize=vy,p.set=F0,p.setWith=D0,p.shuffle=my,p.slice=yg,p.sortBy=by,p.sortedUniq=xg,p.sortedUniqBy=Ig,p.split=nv,p.spread=Ty,p.tail=Sg,p.take=Pg,p.takeRight=Og,p.takeRightWhile=Cg,p.takeWhile=Ag,p.tap=Kg,p.throttle=Ry,p.thru=Ws,p.toArray=_h,p.toPairs=Sh,p.toPairsIn=Ph,p.toPath=Lv,p.toPlainObject=bh,p.transform=q0,p.unary=$y,p.union=Tg,p.unionBy=Rg,p.unionWith=$g,p.uniq=Ng,p.uniqBy=Fg,p.uniqWith=Dg,p.unset=j0,p.unzip=Ao,p.unzipWith=nh,p.update=L0,p.updateWith=M0,p.values=an,p.valuesIn=z0,p.without=qg,p.words=Ah,p.wrap=Ny,p.xor=jg,p.xorBy=Lg,p.xorWith=Mg,p.zip=zg,p.zipObject=Ug,p.zipObjectDeep=Hg,p.zipWith=kg,p.entries=Sh,p.entriesIn=Ph,p.extend=Eh,p.extendWith=ta,Mo(p,p),p.add=zv,p.attempt=Th,p.camelCase=K0,p.capitalize=Oh,p.ceil=Uv,p.clamp=U0,p.clone=Dy,p.cloneDeep=jy,p.cloneDeepWith=Ly,p.cloneWith=qy,p.conformsTo=My,p.deburr=Ch,p.defaultTo=_v,p.divide=Hv,p.endsWith=V0,p.eq=Ar,p.escape=B0,p.escapeRegExp=G0,p.every=ey,p.find=ry,p.findIndex=Xu,p.findKey=g0,p.findLast=iy,p.findLastIndex=eh,p.findLastKey=y0,p.floor=kv,p.forEach=ah,p.forEachRight=oh,p.forIn=v0,p.forInRight=m0,p.forOwn=_0,p.forOwnRight=w0,p.get=Fo,p.gt=zy,p.gte=Uy,p.has=x0,p.hasIn=Do,p.head=rh,p.identity=ar,p.includes=cy,p.indexOf=ig,p.inRange=H0,p.invoke=P0,p.isArguments=Di,p.isArray=fe,p.isArrayBuffer=Hy,p.isArrayLike=nr,p.isArrayLikeObject=bt,p.isBoolean=ky,p.isBuffer=gi,p.isDate=Ky,p.isElement=Vy,p.isEmpty=By,p.isEqual=Gy,p.isEqualWith=Wy,p.isError=$o,p.isFinite=Jy,p.isFunction=Yr,p.isInteger=gh,p.isLength=Xs,p.isMap=yh,p.isMatch=Qy,p.isMatchWith=Yy,p.isNaN=Zy,p.isNative=Xy,p.isNil=t0,p.isNull=e0,p.isNumber=vh,p.isObject=ct,p.isObjectLike=vt,p.isPlainObject=Rn,p.isRegExp=No,p.isSafeInteger=r0,p.isSet=mh,p.isString=ea,p.isSymbol=fr,p.isTypedArray=sn,p.isUndefined=i0,p.isWeakMap=n0,p.isWeakSet=s0,p.join=cg,p.kebabCase=W0,p.last=Er,p.lastIndexOf=ug,p.lowerCase=J0,p.lowerFirst=Q0,p.lt=a0,p.lte=o0,p.max=Kv,p.maxBy=Vv,p.mean=Bv,p.meanBy=Gv,p.min=Wv,p.minBy=Jv,p.stubArray=Uo,p.stubFalse=Ho,p.stubObject=Fv,p.stubString=Dv,p.stubTrue=qv,p.multiply=Qv,p.nth=hg,p.noConflict=Pv,p.noop=zo,p.now=Qs,p.pad=Y0,p.padEnd=Z0,p.padStart=X0,p.parseInt=ev,p.random=k0,p.reduce=py,p.reduceRight=dy,p.repeat=tv,p.replace=rv,p.result=N0,p.round=Yv,p.runInContext=x,p.sample=yy,p.size=_y,p.snakeCase=iv,p.some=wy,p.sortedIndex=vg,p.sortedIndexBy=mg,p.sortedIndexOf=_g,p.sortedLastIndex=wg,p.sortedLastIndexBy=bg,p.sortedLastIndexOf=Eg,p.startCase=sv,p.startsWith=av,p.subtract=Zv,p.sum=Xv,p.sumBy=e1,p.template=ov,p.times=jv,p.toFinite=Zr,p.toInteger=ye,p.toLength=wh,p.toLower=cv,p.toNumber=xr,p.toSafeInteger=c0,p.toString=qe,p.toUpper=uv,p.trim=hv,p.trimEnd=lv,p.trimStart=fv,p.truncate=pv,p.unescape=dv,p.uniqueId=Mv,p.upperCase=gv,p.upperFirst=qo,p.each=ah,p.eachRight=oh,p.first=rh,Mo(p,function(){var e={};return jr(p,function(r,s){Le.call(p.prototype,s)||(e[s]=r)}),e}(),{chain:!1}),p.VERSION=n,vr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),vr(["drop","take"],function(e,r){Se.prototype[e]=function(s){s=s===t?1:qt(ye(s),0);var u=this.__filtered__&&!r?new Se(this):this.clone();return u.__filtered__?u.__takeCount__=Kt(s,u.__takeCount__):u.__views__.push({size:Kt(s,B),type:e+(u.__dir__<0?"Right":"")}),u},Se.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),vr(["filter","map","takeWhile"],function(e,r){var s=r+1,u=s==C||s==Me;Se.prototype[e]=function(l){var g=this.clone();return g.__iteratees__.push({iteratee:ie(l,3),type:s}),g.__filtered__=g.__filtered__||u,g}}),vr(["head","last"],function(e,r){var s="take"+(r?"Right":"");Se.prototype[e]=function(){return this[s](1).value()[0]}}),vr(["initial","tail"],function(e,r){var s="drop"+(r?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[s](1)}}),Se.prototype.compact=function(){return this.filter(ar)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=we(function(e,r){return typeof e=="function"?new Se(this):this.map(function(s){return Sn(s,e,r)})}),Se.prototype.reject=function(e){return this.filter(Zs(ie(e)))},Se.prototype.slice=function(e,r){e=ye(e);var s=this;return s.__filtered__&&(e>0||r<0)?new Se(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),r!==t&&(r=ye(r),s=r<0?s.dropRight(-r):s.take(r-e)),s)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(B)},jr(Se.prototype,function(e,r){var s=/^(?:filter|find|map|reject)|While$/.test(r),u=/^(?:head|last)$/.test(r),l=p[u?"take"+(r=="last"?"Right":""):r],g=u||/^find/.test(r);l&&(p.prototype[r]=function(){var m=this.__wrapped__,w=u?[1]:arguments,I=m instanceof Se,F=w[0],D=I||fe(m),M=function(xe){var Oe=l.apply(p,ci([xe],w));return u&&G?Oe[0]:Oe};D&&s&&typeof F=="function"&&F.length!=1&&(I=D=!1);var G=this.__chain__,ee=!!this.__actions__.length,ne=g&&!G,me=I&&!ee;if(!g&&D){m=me?m:new Se(this);var se=e.apply(m,w);return se.__actions__.push({func:Ws,args:[M],thisArg:t}),new _r(se,G)}return ne&&me?e.apply(this,w):(se=this.thru(M),ne?u?se.value()[0]:se.value():se)})}),vr(["pop","push","shift","sort","splice","unshift"],function(e){var r=ws[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(u&&!this.__chain__){var g=this.value();return r.apply(fe(g)?g:[],l)}return this[s](function(m){return r.apply(fe(m)?m:[],l)})}}),jr(Se.prototype,function(e,r){var s=p[r];if(s){var u=s.name+"";Le.call(Xi,u)||(Xi[u]=[]),Xi[u].push({name:r,func:s})}}),Xi[Us(t,be).name]=[{name:"wrapper",func:t}],Se.prototype.clone=dp,Se.prototype.reverse=gp,Se.prototype.value=yp,p.prototype.at=Vg,p.prototype.chain=Bg,p.prototype.commit=Gg,p.prototype.next=Wg,p.prototype.plant=Qg,p.prototype.reverse=Yg,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=Zg,p.prototype.first=p.prototype.head,mn&&(p.prototype[mn]=Jg),p},Qi=Gf();wt?((wt.exports=Qi)._=Qi,Be._=Qi):Pe._=Qi}).call(Un)})(mc,mc.exports);var ME=Object.defineProperty,zE=Object.defineProperties,UE=Object.getOwnPropertyDescriptors,Ol=Object.getOwnPropertySymbols,HE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,Cl=(o,i,t)=>i in o?ME(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,na=(o,i)=>{for(var t in i||(i={}))HE.call(i,t)&&Cl(o,t,i[t]);if(Ol)for(var t of Ol(i))kE.call(i,t)&&Cl(o,t,i[t]);return o},KE=(o,i)=>zE(o,UE(i));function wi(o,i,t){var n;const a=z1(o);return((n=i.rpcMap)==null?void 0:n[a.reference])||`${LE}?chainId=${a.namespace}:${a.reference}&projectId=${t}`}function Mi(o){return o.includes(":")?o.split(":")[1]:o}function Ef(o){return o.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function VE(o,i){const t=Object.keys(i.namespaces).filter(a=>a.includes(o));if(!t.length)return[];const n=[];return t.forEach(a=>{const c=i.namespaces[a].accounts;n.push(...c)}),n}function BE(o={},i={}){const t=Al(o),n=Al(i);return mc.exports.merge(t,n)}function Al(o){var i,t,n,a;const c={};if(!oa(o))return c;for(const[f,d]of Object.entries(o)){const _=Hl(f)?[f]:d.chains,v=d.methods||[],P=d.events||[],L=d.rpcMap||{},T=Hn(f);c[T]=KE(na(na({},c[T]),d),{chains:Ko(_,(i=c[T])==null?void 0:i.chains),methods:Ko(v,(t=c[T])==null?void 0:t.methods),events:Ko(P,(n=c[T])==null?void 0:n.events),rpcMap:na(na({},L),(a=c[T])==null?void 0:a.rpcMap)})}return c}function GE(o){return o.includes(":")?o.split(":")[2]:o}function WE(o){const i={};for(const[t,n]of Object.entries(o)){const a=n.methods||[],c=n.events||[],f=n.accounts||[],d=Hl(t)?[t]:n.chains?n.chains:Ef(n.accounts);i[t]={chains:d,methods:a,events:c,accounts:f}}return i}function tc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const xf={},nt=o=>xf[o],rc=(o,i)=>{xf[o]=i};class JE{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Mi(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||wi(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ii(new bi(n,nt("disableProviderPing")))}}class QE{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=nt("events"),this.client=nt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(parseInt(i),t),this.chainId=parseInt(i),this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,t){const n=t||wi(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ii(new bi(n,nt("disableProviderPing")))}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=parseInt(Mi(t));i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}async handleSwitchChain(i){var t,n;let a=i.request.params?(t=i.request.params[0])==null?void 0:t.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const c=parseInt(a,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class YE{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Mi(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||wi(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ii(new bi(n,nt("disableProviderPing")))}}class ZE{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Mi(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||wi(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ii(new bi(n,nt("disableProviderPing")))}}class XE{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{const n=this.getCardanoRPCUrl(t),a=Mi(t);i[a]=this.createHttpProvider(a,n)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}getCardanoRPCUrl(i){const t=this.namespace.rpcMap;if(t)return t[i]}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||this.getCardanoRPCUrl(i);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ii(new bi(n,nt("disableProviderPing")))}}class ex{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Mi(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||wi(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ii(new bi(n,nt("disableProviderPing")))}}class tx{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Mi(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||wi(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new ii(new bi(n,nt("disableProviderPing")))}}class rx{constructor(i){this.name="near",this.namespace=i.namespace,this.events=nt("events"),this.client=nt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){if(this.chainId=i,!this.httpProviders[i]){const n=t||wi(`${this.name}:${i}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;i[t]=this.createHttpProvider(t,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||wi(i,this.namespace);return typeof n>"u"?void 0:new ii(new bi(n,nt("disableProviderPing")))}}var ix=Object.defineProperty,nx=Object.defineProperties,sx=Object.getOwnPropertyDescriptors,Tl=Object.getOwnPropertySymbols,ax=Object.prototype.hasOwnProperty,ox=Object.prototype.propertyIsEnumerable,Rl=(o,i,t)=>i in o?ix(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,sa=(o,i)=>{for(var t in i||(i={}))ax.call(i,t)&&Rl(o,t,i[t]);if(Tl)for(var t of Tl(i))ox.call(i,t)&&Rl(o,t,i[t]);return o},ic=(o,i)=>nx(o,sx(i));class $c{constructor(i){this.events=new Ec,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Sl})),this.disableProviderPing=(i==null?void 0:i.disableProviderPing)||!1}static async init(i){const t=new $c(i);return await t.initialize(),t}async request(i,t){const[n,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:sa({},i),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(i,t,n){this.request(i,n).then(a=>t(null,a)).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:er("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}removeListener(i,t){this.events.removeListener(i,t)}off(i,t){this.events.off(i,t)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(c=>{this.session=c,this.namespaces||(this.namespaces=WE(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==wf)throw c;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,t){try{if(!this.session)return;const[n,a]=this.validateChain(i);this.getProvider(n).setDefaultChain(a,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(ln(t)){for(const n of t)i.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await FE.init({logger:this.providerOpts.logger||Sl,relayUrl:this.providerOpts.relayUrl||DE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(t=>Hn(t)))];rc("client",this.client),rc("events",this.events),rc("disableProviderPing",this.disableProviderPing),i.forEach(t=>{if(!this.session)return;const n=VE(t,this.session),a=Ef(n),c=BE(this.namespaces,this.optionalNamespaces),f=ic(sa({},c[t]),{accounts:n,chains:a});switch(t){case"eip155":this.rpcProviders[t]=new QE({namespace:f});break;case"solana":this.rpcProviders[t]=new YE({namespace:f});break;case"cosmos":this.rpcProviders[t]=new ZE({namespace:f});break;case"polkadot":this.rpcProviders[t]=new JE({namespace:f});break;case"cip34":this.rpcProviders[t]=new XE({namespace:f});break;case"elrond":this.rpcProviders[t]=new ex({namespace:f});break;case"multiversx":this.rpcProviders[t]=new tx({namespace:f});break;case"near":this.rpcProviders[t]=new rx({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:t}=i,{event:n}=t;if(n.name==="accountsChanged"){const a=n.data;a&&ln(a)&&this.events.emit("accountsChanged",a.map(GE))}else if(n.name==="chainChanged"){const a=t.chainId,c=t.event.data,f=Hn(a),d=tc(a)!==tc(c)?`${f}:${tc(c)}`:a;this.onChainChanged(d)}else this.events.emit(n.name,n.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:t})=>{var n;const{namespaces:a}=t,c=(n=this.client)==null?void 0:n.session.get(i);this.session=ic(sa({},c),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:t})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",ic(sa({},er("USER_DISCONNECTED")),{data:i.topic}))}),this.on(ni.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var t;this.getProvider(i).updateNamespace((t=this.session)==null?void 0:t.namespaces[i])})}setNamespaces(i){const{namespaces:t,optionalNamespaces:n,sessionProperties:a}=i;t&&Object.keys(t).length&&(this.namespaces=t),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",t),this.persist("optionalNamespaces",n)}validateChain(i){const[t,n]=(i==null?void 0:i.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(f=>Hn(f)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];const a=Hn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[a].getDefaultChain();return[a,c]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,t=!1){var n;if(!this.namespaces)return;const[a,c]=this.validateChain(i);t||this.getProvider(a).setDefaultChain(c),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,t){this.client.core.storage.setItem(`${Pl}/${i}`,t)}async getFromStore(i){return await this.client.core.storage.getItem(`${Pl}/${i}`)}}const cx=$c,ux="wc",hx="ethereum_provider",lx=`${ux}@2:${hx}:`,fx="https://rpc.walletconnect.com/v1/",_c=["eth_sendTransaction","personal_sign"],px=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],wc=["chainChanged","accountsChanged"],dx=["chainChanged","accountsChanged","message","disconnect","connect"];var gx=Object.defineProperty,yx=Object.defineProperties,vx=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,mx=Object.prototype.hasOwnProperty,_x=Object.prototype.propertyIsEnumerable,Nl=(o,i,t)=>i in o?gx(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Kn=(o,i)=>{for(var t in i||(i={}))mx.call(i,t)&&Nl(o,t,i[t]);if($l)for(var t of $l(i))_x.call(i,t)&&Nl(o,t,i[t]);return o},Fl=(o,i)=>yx(o,vx(i));function la(o){return Number(o[0].split(":")[1])}function nc(o){return`0x${o.toString(16)}`}function wx(o){const{chains:i,optionalChains:t,methods:n,optionalMethods:a,events:c,optionalEvents:f,rpcMap:d}=o;if(!ln(i))throw new Error("Invalid chains");const _={chains:i,methods:n||_c,events:c||wc,rpcMap:Kn({},i.length?{[la(i)]:d[la(i)]}:{})},v=c==null?void 0:c.filter(U=>!wc.includes(U)),P=n==null?void 0:n.filter(U=>!_c.includes(U));if(!t&&!f&&!a&&!(v!=null&&v.length)&&!(P!=null&&P.length))return{required:i.length?_:void 0};const L=(v==null?void 0:v.length)&&(P==null?void 0:P.length)||!t,T={chains:[...new Set(L?_.chains.concat(t||[]):t)],methods:[...new Set(_.methods.concat(a!=null&&a.length?a:px))],events:[...new Set(_.events.concat(f!=null&&f.length?f:dx))],rpcMap:d};return{required:i.length?_:void 0,optional:t.length?T:void 0}}class Nc{constructor(){this.events=new Ur.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=lx,this.on=(i,t)=>(this.events.on(i,t),this),this.once=(i,t)=>(this.events.once(i,t),this),this.removeListener=(i,t)=>(this.events.removeListener(i,t),this),this.off=(i,t)=>(this.events.off(i,t),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const t=new Nc;return await t.initialize(i),t}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,t){this.signer.sendAsync(i,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:t,optional:n}=wx(this.rpc);try{const a=await new Promise(async(f,d)=>{var _;this.rpc.showQrModal&&((_=this.modal)==null||_.subscribeModal(v=>{!v.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),d(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Fl(Kn({namespaces:Kn({},t&&{[this.namespace]:t})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:i==null?void 0:i.pairingTopic})).then(v=>{f(v)}).catch(v=>{d(new Error(v.message))})});if(!a)return;const c=U1(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:nc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:t}=i,{event:n}=t;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const t=parseInt(i);this.chainId=t,this.events.emit("chainChanged",nc(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",Fl(Kn({},er("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var t,n;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(n=this.modal)==null||n.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const t=i.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",nc(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const t=this.parseChainId(i);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(i){const[t,n,a]=i.split(":");return{chainId:`${t}:${n}`,address:a}}setAccounts(i){this.accounts=i.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var t,n;const a=(t=i==null?void 0:i.chains)!=null?t:[],c=(n=i==null?void 0:i.optionalChains)!=null?n:[],f=a.concat(c);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const d=a.length?(i==null?void 0:i.methods)||_c:[],_=a.length?(i==null?void 0:i.events)||wc:[],v=(i==null?void 0:i.optionalMethods)||[],P=(i==null?void 0:i.optionalEvents)||[],L=(i==null?void 0:i.rpcMap)||this.buildRpcMap(f,i.projectId),T=(i==null?void 0:i.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(U=>this.formatChainId(U)),optionalChains:c.map(U=>this.formatChainId(U)),methods:d,events:_,optionalMethods:v,optionalEvents:P,rpcMap:L,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:T,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,t){const n={};return i.forEach(a=>{n[a]=this.getRpcUrl(a,t)}),n}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?la(this.rpc.chains):la(this.rpc.optionalChains),this.signer=await cx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:n}=await H1(()=>import("./index-44ee5a24.js").then(a=>a.i),["assets/index-44ee5a24.js","assets/index-a8ded276.js","assets/index-882a2daf.css"]);t=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(Kn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:t,optionalChains:n,rpcMap:a}=i;t&&ln(t)&&(this.rpc.chains=t.map(c=>this.formatChainId(c)),t.forEach(c=>{this.rpc.rpcMap[c]=(a==null?void 0:a[c])||this.getRpcUrl(c)})),n&&ln(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(a==null?void 0:a[c])||this.getRpcUrl(c)}))}getRpcUrl(i,t){var n;return((n=this.rpc.rpcMap)==null?void 0:n[i])||`${fx}?chainId=eip155:${i}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(t=>this.parseAccount(t))}}const Nx=Nc;export{Nx as EthereumProvider,dx as OPTIONAL_EVENTS,px as OPTIONAL_METHODS,wc as REQUIRED_EVENTS,_c as REQUIRED_METHODS,Nc as default};
