import{e as H}from"./events-4e609687.js";import{r as ie,m as oe}from"./index-9c13c2fd.js";const ae=r=>JSON.stringify(r,(t,s)=>typeof s=="bigint"?s.toString()+"n":s),ce=r=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,s=r.replace(t,'$1"$2n"$3');return JSON.parse(s,(f,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function fe(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return ce(r)}catch{return r}}function C(r){return typeof r=="string"?r:ae(r)||""}const he="PARSE_ERROR",ue="INVALID_REQUEST",le="METHOD_NOT_FOUND",de="INVALID_PARAMS",q="INTERNAL_ERROR",P="SERVER_ERROR",pe=[-32700,-32600,-32601,-32602,-32603],v={[he]:{code:-32700,message:"Parse error"},[ue]:{code:-32600,message:"Invalid Request"},[le]:{code:-32601,message:"Method not found"},[de]:{code:-32602,message:"Invalid params"},[q]:{code:-32603,message:"Internal error"},[P]:{code:-32e3,message:"Server error"}},J=P;function ye(r){return pe.includes(r)}function L(r){return Object.keys(v).includes(r)?v[r]:v[J]}function be(r){const t=Object.values(v).find(s=>s.code===r);return t||v[J]}function ge(r,t,s){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${s} RPC url at ${t}`):r}var me={},y={},I;function Ee(){if(I)return y;I=1,Object.defineProperty(y,"__esModule",{value:!0}),y.isBrowserCryptoAvailable=y.getSubtleCrypto=y.getBrowerCrypto=void 0;function r(){return(globalThis==null?void 0:globalThis.crypto)||(globalThis==null?void 0:globalThis.msCrypto)||{}}y.getBrowerCrypto=r;function t(){const f=r();return f.subtle||f.webkitSubtle}y.getSubtleCrypto=t;function s(){return!!r()&&!!t()}return y.isBrowserCryptoAvailable=s,y}var b={},U;function ve(){if(U)return b;U=1,Object.defineProperty(b,"__esModule",{value:!0}),b.isBrowser=b.isNode=b.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}b.isReactNative=r;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}b.isNode=t;function s(){return!r()&&!t()}return b.isBrowser=s,b}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const t=ie;t.__exportStar(Ee(),r),t.__exportStar(ve(),r)})(me);function $(r=3){const t=Date.now()*Math.pow(10,r),s=Math.floor(Math.random()*Math.pow(10,r));return t+s}function we(r=6){return BigInt($(r))}function Re(r,t,s){return{id:s||$(),jsonrpc:"2.0",method:r,params:t}}function je(r,t){return{id:r,jsonrpc:"2.0",result:t}}function _e(r,t,s){return{id:r,jsonrpc:"2.0",error:Te(t,s)}}function Te(r,t){return typeof r>"u"?L(q):(typeof r=="string"&&(r=Object.assign(Object.assign({},L(P)),{message:r})),typeof t<"u"&&(r.data=t),ye(r.code)&&(r=be(r.code)),r)}class V{}class Ne extends V{constructor(t){super()}}class Ae extends V{constructor(){super()}}class Oe extends Ae{constructor(t){super()}}const Pe="^https?:",Be="^wss?:";function Se(r){const t=r.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function k(r,t){const s=Se(r);return typeof s>"u"?!1:new RegExp(t).test(s)}function M(r){return k(r,Pe)}function Fe(r){return k(r,Be)}function He(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function G(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function qe(r){return G(r)&&"method"in r}function De(r){return G(r)&&(xe(r)||X(r))}function xe(r){return"result"in r}function X(r){return"error"in r}class Je extends Oe{constructor(t){super(t),this.events=new H.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,s){this.events.on(t,s)}once(t,s){this.events.once(t,s)}off(t,s){this.events.off(t,s)}removeListener(t,s){this.events.removeListener(t,s)}async request(t,s){return this.requestStrict(Re(t.method,t.params||[],t.id||we().toString()),s)}async requestStrict(t,s){return new Promise(async(f,o)=>{if(!this.connection.connected)try{await this.open()}catch(a){o(a)}this.events.on(`${t.id}`,a=>{X(a)?o(a.error):f(a.result)});try{await this.connection.send(t,s)}catch(a){o(a)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),De(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}var O={exports:{}};(function(r,t){var s=function(){function o(){this.fetch=!1,this.DOMException=globalThis.DOMException}return o.prototype=globalThis,new o}();(function(o){(function(a){var d={searchParams:"URLSearchParams"in o,iterable:"Symbol"in o&&"iterator"in Symbol,blob:"FileReader"in o&&"Blob"in o&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in o,arrayBuffer:"ArrayBuffer"in o};function z(e){return e&&DataView.prototype.isPrototypeOf(e)}if(d.arrayBuffer)var W=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Q=ArrayBuffer.isView||function(e){return e&&W.indexOf(Object.prototype.toString.call(e))>-1};function m(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function B(e){return typeof e!="string"&&(e=String(e)),e}function R(e){var n={next:function(){var i=e.shift();return{done:i===void 0,value:i}}};return d.iterable&&(n[Symbol.iterator]=function(){return n}),n}function h(e){this.map={},e instanceof h?e.forEach(function(n,i){this.append(i,n)},this):Array.isArray(e)?e.forEach(function(n){this.append(n[0],n[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(n){this.append(n,e[n])},this)}h.prototype.append=function(e,n){e=m(e),n=B(n);var i=this.map[e];this.map[e]=i?i+", "+n:n},h.prototype.delete=function(e){delete this.map[m(e)]},h.prototype.get=function(e){return e=m(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(m(e))},h.prototype.set=function(e,n){this.map[m(e)]=B(n)},h.prototype.forEach=function(e,n){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(n,this.map[i],i,this)},h.prototype.keys=function(){var e=[];return this.forEach(function(n,i){e.push(i)}),R(e)},h.prototype.values=function(){var e=[];return this.forEach(function(n){e.push(n)}),R(e)},h.prototype.entries=function(){var e=[];return this.forEach(function(n,i){e.push([i,n])}),R(e)},d.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);function _(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function S(e){return new Promise(function(n,i){e.onload=function(){n(e.result)},e.onerror=function(){i(e.error)}})}function K(e){var n=new FileReader,i=S(n);return n.readAsArrayBuffer(e),i}function Y(e){var n=new FileReader,i=S(n);return n.readAsText(e),i}function Z(e){for(var n=new Uint8Array(e),i=new Array(n.length),l=0;l<n.length;l++)i[l]=String.fromCharCode(n[l]);return i.join("")}function D(e){if(e.slice)return e.slice(0);var n=new Uint8Array(e.byteLength);return n.set(new Uint8Array(e)),n.buffer}function x(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:d.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:d.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:d.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():d.arrayBuffer&&d.blob&&z(e)?(this._bodyArrayBuffer=D(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):d.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||Q(e))?this._bodyArrayBuffer=D(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):d.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},d.blob&&(this.blob=function(){var e=_(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?_(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(K)}),this.text=function(){var e=_(this);if(e)return e;if(this._bodyBlob)return Y(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Z(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},d.formData&&(this.formData=function(){return this.text().then(re)}),this.json=function(){return this.text().then(JSON.parse)},this}var ee=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function te(e){var n=e.toUpperCase();return ee.indexOf(n)>-1?n:e}function g(e,n){n=n||{};var i=n.body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,n.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!i&&e._bodyInit!=null&&(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=n.credentials||this.credentials||"same-origin",(n.headers||!this.headers)&&(this.headers=new h(n.headers)),this.method=te(n.method||this.method||"GET"),this.mode=n.mode||this.mode||null,this.signal=n.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})};function re(e){var n=new FormData;return e.trim().split("&").forEach(function(i){if(i){var l=i.split("="),u=l.shift().replace(/\+/g," "),c=l.join("=").replace(/\+/g," ");n.append(decodeURIComponent(u),decodeURIComponent(c))}}),n}function ne(e){var n=new h,i=e.replace(/\r?\n[\t ]+/g," ");return i.split(/\r?\n/).forEach(function(l){var u=l.split(":"),c=u.shift().trim();if(c){var w=u.join(":").trim();n.append(c,w)}}),n}x.call(g.prototype);function p(e,n){n||(n={}),this.type="default",this.status=n.status===void 0?200:n.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in n?n.statusText:"OK",this.headers=new h(n.headers),this.url=n.url||"",this._initBody(e)}x.call(p.prototype),p.prototype.clone=function(){return new p(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},p.error=function(){var e=new p(null,{status:0,statusText:""});return e.type="error",e};var se=[301,302,303,307,308];p.redirect=function(e,n){if(se.indexOf(n)===-1)throw new RangeError("Invalid status code");return new p(null,{status:n,headers:{location:e}})},a.DOMException=o.DOMException;try{new a.DOMException}catch{a.DOMException=function(n,i){this.message=n,this.name=i;var l=Error(n);this.stack=l.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function T(e,n){return new Promise(function(i,l){var u=new g(e,n);if(u.signal&&u.signal.aborted)return l(new a.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function w(){c.abort()}c.onload=function(){var E={status:c.status,statusText:c.statusText,headers:ne(c.getAllResponseHeaders()||"")};E.url="responseURL"in c?c.responseURL:E.headers.get("X-Request-URL");var A="response"in c?c.response:c.responseText;i(new p(A,E))},c.onerror=function(){l(new TypeError("Network request failed"))},c.ontimeout=function(){l(new TypeError("Network request failed"))},c.onabort=function(){l(new a.DOMException("Aborted","AbortError"))},c.open(u.method,u.url,!0),u.credentials==="include"?c.withCredentials=!0:u.credentials==="omit"&&(c.withCredentials=!1),"responseType"in c&&d.blob&&(c.responseType="blob"),u.headers.forEach(function(E,A){c.setRequestHeader(A,E)}),u.signal&&(u.signal.addEventListener("abort",w),c.onreadystatechange=function(){c.readyState===4&&u.signal.removeEventListener("abort",w)}),c.send(typeof u._bodyInit>"u"?null:u._bodyInit)})}return T.polyfill=!0,o.fetch||(o.fetch=T,o.Headers=h,o.Request=g,o.Response=p),a.Headers=h,a.Request=g,a.Response=p,a.fetch=T,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var f=s;t=f.fetch,t.default=f.fetch,t.fetch=f.fetch,t.Headers=f.Headers,t.Request=f.Request,t.Response=f.Response,r.exports=t})(O,O.exports);var Ce=O.exports;const j=oe(Ce),Le={Accept:"application/json","Content-Type":"application/json"},Ie="POST",N={headers:Le,method:Ie},F=10;class $e{constructor(t,s=!1){if(this.url=t,this.disableProviderPing=s,this.events=new H.EventEmitter,this.isAvailable=!1,this.registering=!1,!M(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=s}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,s){this.events.on(t,s)}once(t,s){this.events.once(t,s)}off(t,s){this.events.off(t,s)}removeListener(t,s){this.events.removeListener(t,s)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,s){this.isAvailable||await this.register();try{const f=C(t),a=await(await j(this.url,Object.assign(Object.assign({},N),{body:f}))).json();this.onPayload({data:a})}catch(f){this.onError(t.id,f)}}async register(t=this.url){if(!M(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const s=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=s||this.events.listenerCount("open")>=s)&&this.events.setMaxListeners(s+1),new Promise((f,o)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),o(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));f()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const s=C({id:1,jsonrpc:"2.0",method:"test",params:[]});await j(t,Object.assign(Object.assign({},N),{body:s}))}this.onOpen()}catch(s){const f=this.parseError(s);throw this.events.emit("register_error",f),this.onClose(),f}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const s=typeof t.data=="string"?fe(t.data):t.data;this.events.emit("payload",s)}onError(t,s){const f=this.parseError(s),o=f.message||f.toString(),a=_e(t,o);this.events.emit("payload",a)}parseError(t,s=this.url){return ge(t,s,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>F&&this.events.setMaxListeners(F)}}export{$e as H,Ne as I,Je as J,fe as a,He as b,me as c,qe as d,De as e,_e as f,je as g,xe as h,Fe as i,X as j,Re as k,we as l,$ as m,ge as p,C as s};
