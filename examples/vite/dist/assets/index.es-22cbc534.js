import{r as qr,g as My,c as ie,b as jy,w as El,a as xl,f as cc,t as ha,d as zy,e as Uy,h as vr,D as ky,k as Hy,N as X,j as Ky,i as tc,l as Vy,V as By,R as Gy,F as _h,K as Wy,x as Jy,L as Qy,m as bh,$ as Yy,p as Xy,n as Bs,Z as Eh,J as Zy,X as e1,_ as Il,o as Ti,q as t1,s as i1,u as as,v as Ft,U as ei,y as gr,z as ci,A as r1,B as os,C as Sl,E as s1,G as n1,H as a1,I as Pl,M as o1,O as Cl,P as Al,Q as us,S as ic,T as sa,W as hs,Y as c1,a0 as na,a1 as u1,a2 as h1,a3 as l1,a4 as ea,a5 as f1,a6 as p1,a7 as jo,a8 as xh,a9 as d1,aa as g1,ab as v1,ac as Ih,ad as y1,ae as m1,af as w1,ag as _1,ah as b1,ai as E1,aj as x1,ak as ks,al as Ol,am as zo,an as I1,ao as S1,ap as P1}from"./index-82a775d5.js";import{e as Ui,E as uc}from"./events-5a661317.js";import{s as hc,i as Sh,c as C1,a as A1,b as Rl,f as lc,p as O1,J as mr,d as fc,e as pc,g as dc,h as dr,j as ir,k as Vs,l as R1,m as T1,H as Lr}from"./http-a41e4300.js";import"@safe-globalThis/safe-apps-provider";import"@safe-globalThis/safe-apps-sdk";var la={},Gs={};Object.defineProperty(Gs,"__esModule",{value:!0});function N1(h){if(typeof h!="string")throw new Error(`Cannot safe json parse value of type ${typeof h}`);try{return JSON.parse(h)}catch{return h}}Gs.safeJsonParse=N1;function F1(h){return typeof h=="string"?h:JSON.stringify(h,(r,i)=>typeof i>"u"?null:i)}Gs.safeJsonStringify=F1;var Ns={exports:{}},Ph;function D1(){return Ph||(Ph=1,function(){let h;function r(){}h=r,h.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},h.prototype.setItem=function(i,n){this[i]=String(n)},h.prototype.removeItem=function(i){delete this[i]},h.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(n){i[n]=void 0,delete i[n]})},h.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},h.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof globalThis<"u"&&globalThis.localStorage?Ns.exports=globalThis.localStorage:typeof window<"u"&&window.localStorage?Ns.exports=window.localStorage:Ns.exports=new r}()),Ns.exports}var Uo={},Fs={},Ch;function $1(){if(Ch)return Fs;Ch=1,Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.IKeyValueStorage=void 0;class h{}return Fs.IKeyValueStorage=h,Fs}var Ds={},Ah;function q1(){if(Ah)return Ds;Ah=1,Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.parseEntry=void 0;const h=Gs;function r(i){var n;return[i[0],h.safeJsonParse((n=i[1])!==null&&n!==void 0?n:"")]}return Ds.parseEntry=r,Ds}var Oh;function L1(){return Oh||(Oh=1,function(h){Object.defineProperty(h,"__esModule",{value:!0});const r=qr;r.__exportStar($1(),h),r.__exportStar(q1(),h)}(Uo)),Uo}Object.defineProperty(la,"__esModule",{value:!0});la.KeyValueStorage=void 0;const cs=qr,Rh=Gs,M1=cs.__importDefault(D1()),j1=L1();class Tl{constructor(){this.localStorage=M1.default}getKeys(){return cs.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return cs.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(j1.parseEntry)})}getItem(r){return cs.__awaiter(this,void 0,void 0,function*(){const i=this.localStorage.getItem(r);if(i!==null)return Rh.safeJsonParse(i)})}setItem(r,i){return cs.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(r,Rh.safeJsonStringify(i))})}removeItem(r){return cs.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(r)})}}la.KeyValueStorage=Tl;var z1=la.default=Tl,ls={},$s={},ko={},qs={};class Mr{}const U1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Mr},Symbol.toStringTag,{value:"Module"})),k1=My(U1);var Th;function H1(){if(Th)return qs;Th=1,Object.defineProperty(qs,"__esModule",{value:!0}),qs.IHeartBeat=void 0;const h=k1;class r extends h.IEvents{constructor(n){super()}}return qs.IHeartBeat=r,qs}var Nh;function Nl(){return Nh||(Nh=1,function(h){Object.defineProperty(h,"__esModule",{value:!0}),qr.__exportStar(H1(),h)}(ko)),ko}var Ho={},Dr={},Fh;function K1(){if(Fh)return Dr;Fh=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.HEARTBEAT_EVENTS=Dr.HEARTBEAT_INTERVAL=void 0;const h=ie;return Dr.HEARTBEAT_INTERVAL=h.FIVE_SECONDS,Dr.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Dr}var Dh;function Fl(){return Dh||(Dh=1,function(h){Object.defineProperty(h,"__esModule",{value:!0}),qr.__exportStar(K1(),h)}(Ho)),Ho}var $h;function V1(){if($h)return $s;$h=1,Object.defineProperty($s,"__esModule",{value:!0}),$s.HeartBeat=void 0;const h=qr,r=Ui,i=ie,n=Nl(),a=Fl();class l extends n.IHeartBeat{constructor(v){super(v),this.events=new r.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(v==null?void 0:v.interval)||a.HEARTBEAT_INTERVAL}static init(v){return h.__awaiter(this,void 0,void 0,function*(){const w=new l(v);return yield w.init(),w})}init(){return h.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(v,w){this.events.on(v,w)}once(v,w){this.events.once(v,w)}off(v,w){this.events.off(v,w)}removeListener(v,w){this.events.removeListener(v,w)}initialize(){return h.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),i.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return $s.HeartBeat=l,$s}(function(h){Object.defineProperty(h,"__esModule",{value:!0});const r=qr;r.__exportStar(V1(),h),r.__exportStar(Nl(),h),r.__exportStar(Fl(),h)})(ls);var Ae={},Ko,qh;function B1(){if(qh)return Ko;qh=1;function h(i){try{return JSON.stringify(i)}catch{return'"[Circular]"'}}Ko=r;function r(i,n,a){var l=a&&a.stringify||h,d=1;if(typeof i=="object"&&i!==null){var v=n.length+d;if(v===1)return i;var w=new Array(v);w[0]=l(i);for(var I=1;I<v;I++)w[I]=l(n[I]);return w.join(" ")}if(typeof i!="string")return i;var F=n.length;if(F===0)return i;for(var U="",k=1-d,H=-1,z=i&&i.length||0,G=0;G<z;){if(i.charCodeAt(G)===37&&G+1<z){switch(H=H>-1?H:0,i.charCodeAt(G+1)){case 100:case 102:if(k>=F||n[k]==null)break;H<G&&(U+=i.slice(H,G)),U+=Number(n[k]),H=G+2,G++;break;case 105:if(k>=F||n[k]==null)break;H<G&&(U+=i.slice(H,G)),U+=Math.floor(Number(n[k])),H=G+2,G++;break;case 79:case 111:case 106:if(k>=F||n[k]===void 0)break;H<G&&(U+=i.slice(H,G));var ae=typeof n[k];if(ae==="string"){U+="'"+n[k]+"'",H=G+2,G++;break}if(ae==="function"){U+=n[k].name||"<anonymous>",H=G+2,G++;break}U+=l(n[k]),H=G+2,G++;break;case 115:if(k>=F)break;H<G&&(U+=i.slice(H,G)),U+=String(n[k]),H=G+2,G++;break;case 37:H<G&&(U+=i.slice(H,G)),U+="%",H=G+2,G++,k--;break}++k}++G}return H===-1?i:(H<z&&(U+=i.slice(H)),U)}return Ko}var Vo,Lh;function G1(){if(Lh)return Vo;Lh=1;const h=B1();Vo=a;const r=he().console||{},i={mapHttpRequest:z,mapHttpResponse:z,wrapRequestSerializer:G,wrapResponseSerializer:G,wrapErrorSerializer:G,req:z,res:z,err:k};function n(R,M){return Array.isArray(R)?R.filter(function(ge){return ge!=="!stdSerializers.err"}):R===!0?Object.keys(M):!1}function a(R){R=R||{},R.browser=R.browser||{};const M=R.browser.transmit;if(M&&typeof M.send!="function")throw Error("pino: transmit option must have a send function");const W=R.browser.write||r;R.browser.write&&(R.browser.asObject=!0);const ge=R.serializers||{},te=n(R.browser.serialize,ge);let Ee=R.browser.serialize;Array.isArray(R.browser.serialize)&&R.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Oe=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),R.enabled===!1&&(R.level="silent");const et=R.level||"info",C=Object.create(W);C.log||(C.log=ae),Object.defineProperty(C,"levelVal",{get:je}),Object.defineProperty(C,"level",{get:Re,set:J});const $={transmit:M,serialize:te,asObject:R.browser.asObject,levels:Oe,timestamp:H(R)};C.levels=a.levels,C.level=et,C.setMaxListeners=C.getMaxListeners=C.emit=C.addListener=C.on=C.prependListener=C.once=C.prependOnceListener=C.removeListener=C.removeAllListeners=C.listeners=C.listenerCount=C.eventNames=C.write=C.flush=ae,C.serializers=ge,C._serialize=te,C._stdErrSerialize=Ee,C.child=K,M&&(C._logEvent=U());function je(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Re(){return this._level}function J(j){if(j!=="silent"&&!this.levels.values[j])throw Error("unknown level "+j);this._level=j,l($,C,"error","log"),l($,C,"fatal","error"),l($,C,"warn","error"),l($,C,"info","log"),l($,C,"debug","log"),l($,C,"trace","log")}function K(j,V){if(!j)throw new Error("missing bindings for child Pino");V=V||{},te&&j.serializers&&(V.serializers=j.serializers);const ct=V.serializers;if(te&&ct){var ke=Object.assign({},ge,ct),Ni=R.browser.serialize===!0?Object.keys(ke):te;delete j.serializers,w([j],Ni,ke,this._stdErrSerialize)}function we(xt){this._childLevel=(xt._childLevel|0)+1,this.error=I(xt,j,"error"),this.fatal=I(xt,j,"fatal"),this.warn=I(xt,j,"warn"),this.info=I(xt,j,"info"),this.debug=I(xt,j,"debug"),this.trace=I(xt,j,"trace"),ke&&(this.serializers=ke,this._serialize=Ni),M&&(this._logEvent=U([].concat(xt._logEvent.bindings,j)))}return we.prototype=this,new we(this)}return C}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=i,a.stdTimeFunctions=Object.assign({},{nullTime:be,epochTime:de,unixTime:pe,isoTime:ue});function l(R,M,W,ge){const te=Object.getPrototypeOf(M);M[W]=M.levelVal>M.levels.values[W]?ae:te[W]?te[W]:r[W]||r[ge]||ae,d(R,M,W)}function d(R,M,W){!R.transmit&&M[W]===ae||(M[W]=function(ge){return function(){const Ee=R.timestamp(),Oe=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===r?r:this;for(var C=0;C<Oe.length;C++)Oe[C]=arguments[C];if(R.serialize&&!R.asObject&&w(Oe,this._serialize,this.serializers,this._stdErrSerialize),R.asObject?ge.call(et,v(this,W,Oe,Ee)):ge.apply(et,Oe),R.transmit){const $=R.transmit.level||M.level,je=a.levels.values[$],Re=a.levels.values[W];if(Re<je)return;F(this,{ts:Ee,methodLevel:W,methodValue:Re,transmitLevel:$,transmitValue:a.levels.values[R.transmit.level||M.level],send:R.transmit.send,val:M.levelVal},Oe)}}}(M[W]))}function v(R,M,W,ge){R._serialize&&w(W,R._serialize,R.serializers,R._stdErrSerialize);const te=W.slice();let Ee=te[0];const Oe={};ge&&(Oe.time=ge),Oe.level=a.levels.values[M];let et=(R._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof te[0]=="object";)Object.assign(Oe,te.shift());Ee=te.length?h(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=h(te.shift(),te));return Ee!==void 0&&(Oe.msg=Ee),Oe}function w(R,M,W,ge){for(const te in R)if(ge&&R[te]instanceof Error)R[te]=a.stdSerializers.err(R[te]);else if(typeof R[te]=="object"&&!Array.isArray(R[te]))for(const Ee in R[te])M&&M.indexOf(Ee)>-1&&Ee in W&&(R[te][Ee]=W[Ee](R[te][Ee]))}function I(R,M,W){return function(){const ge=new Array(1+arguments.length);ge[0]=M;for(var te=1;te<ge.length;te++)ge[te]=arguments[te-1];return R[W].apply(this,ge)}}function F(R,M,W){const ge=M.send,te=M.ts,Ee=M.methodLevel,Oe=M.methodValue,et=M.val,C=R._logEvent.bindings;w(W,R._serialize||Object.keys(R.serializers),R.serializers,R._stdErrSerialize===void 0?!0:R._stdErrSerialize),R._logEvent.ts=te,R._logEvent.messages=W.filter(function($){return C.indexOf($)===-1}),R._logEvent.level.label=Ee,R._logEvent.level.value=Oe,ge(Ee,R._logEvent,et),R._logEvent=U(C)}function U(R){return{ts:0,messages:[],bindings:R||[],level:{label:"",value:0}}}function k(R){const M={type:R.constructor.name,msg:R.message,stack:R.stack};for(const W in R)M[W]===void 0&&(M[W]=R[W]);return M}function H(R){return typeof R.timestamp=="function"?R.timestamp:R.timestamp===!1?be:de}function z(){return{}}function G(R){return R}function ae(){}function be(){return!1}function de(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function ue(){return new Date(Date.now()).toISOString()}function he(){function R(M){return typeof M<"u"&&M}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return R(self)||R(window)||R(this)||{}}}return Vo}var $r={},Mh;function Dl(){return Mh||(Mh=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.PINO_CUSTOM_CONTEXT_KEY=$r.PINO_LOGGER_DEFAULTS=void 0,$r.PINO_LOGGER_DEFAULTS={level:"info"},$r.PINO_CUSTOM_CONTEXT_KEY="custom_context"),$r}var Zt={},jh;function W1(){if(jh)return Zt;jh=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.generateChildLogger=Zt.formatChildLoggerContext=Zt.getLoggerContext=Zt.setBrowserLoggerContext=Zt.getBrowserLoggerContext=Zt.getDefaultLoggerOptions=void 0;const h=Dl();function r(v){return Object.assign(Object.assign({},v),{level:(v==null?void 0:v.level)||h.PINO_LOGGER_DEFAULTS.level})}Zt.getDefaultLoggerOptions=r;function i(v,w=h.PINO_CUSTOM_CONTEXT_KEY){return v[w]||""}Zt.getBrowserLoggerContext=i;function n(v,w,I=h.PINO_CUSTOM_CONTEXT_KEY){return v[I]=w,v}Zt.setBrowserLoggerContext=n;function a(v,w=h.PINO_CUSTOM_CONTEXT_KEY){let I="";return typeof v.bindings>"u"?I=i(v,w):I=v.bindings().context||"",I}Zt.getLoggerContext=a;function l(v,w,I=h.PINO_CUSTOM_CONTEXT_KEY){const F=a(v,I);return F.trim()?`${F}/${w}`:w}Zt.formatChildLoggerContext=l;function d(v,w,I=h.PINO_CUSTOM_CONTEXT_KEY){const F=l(v,w,I),U=v.child({context:F});return n(U,F,I)}return Zt.generateChildLogger=d,Zt}(function(h){Object.defineProperty(h,"__esModule",{value:!0}),h.pino=void 0;const r=qr,i=r.__importDefault(G1());Object.defineProperty(h,"pino",{enumerable:!0,get:function(){return i.default}}),r.__exportStar(Dl(),h),r.__exportStar(W1(),h)})(Ae);class J1 extends Mr{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class Q1 extends Mr{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}}class Y1{constructor(r,i){this.logger=r,this.core=i}}let X1=class extends Mr{constructor(r,i){super(),this.relayer=r,this.logger=i}},Z1=class extends Mr{constructor(r){super()}},em=class{constructor(r,i,n,a){this.core=r,this.logger=i,this.name=n}};class tm extends Mr{constructor(r,i){super(),this.relayer=r,this.logger=i}}let im=class extends Mr{constructor(r,i){super(),this.core=r,this.logger=i}},rm=class{constructor(r,i){this.projectId=r,this.logger=i}},sm=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},nm=class{constructor(r){this.client=r}};var gc={},$l={};(function(h){Object.defineProperty(h,"__esModule",{value:!0});var r=jy,i=El;h.DIGEST_LENGTH=64,h.BLOCK_SIZE=128;var n=function(){function v(){this.digestLength=h.DIGEST_LENGTH,this.blockSize=h.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return v.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},v.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},v.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._tempHi),i.wipe(this._tempLo),this.reset()},v.prototype.update=function(w,I){if(I===void 0&&(I=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var F=0;if(this._bytesHashed+=I,this._bufferLength>0){for(;this._bufferLength<h.BLOCK_SIZE&&I>0;)this._buffer[this._bufferLength++]=w[F++],I--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(I>=this.blockSize&&(F=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,F,I),I%=this.blockSize);I>0;)this._buffer[this._bufferLength++]=w[F++],I--;return this},v.prototype.finish=function(w){if(!this._finished){var I=this._bytesHashed,F=this._bufferLength,U=I/536870912|0,k=I<<3,H=I%128<112?128:256;this._buffer[F]=128;for(var z=F+1;z<H-8;z++)this._buffer[z]=0;r.writeUint32BE(U,this._buffer,H-8),r.writeUint32BE(k,this._buffer,H-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,H),this._finished=!0}for(var z=0;z<this.digestLength/8;z++)r.writeUint32BE(this._stateHi[z],w,z*8),r.writeUint32BE(this._stateLo[z],w,z*8+4);return this},v.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},v.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},v.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},v.prototype.cleanSavedState=function(w){i.wipe(w.stateHi),i.wipe(w.stateLo),w.buffer&&i.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},v}();h.SHA512=n;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(v,w,I,F,U,k,H){for(var z=I[0],G=I[1],ae=I[2],be=I[3],de=I[4],pe=I[5],ue=I[6],he=I[7],R=F[0],M=F[1],W=F[2],ge=F[3],te=F[4],Ee=F[5],Oe=F[6],et=F[7],C,$,je,Re,J,K,j,V;H>=128;){for(var ct=0;ct<16;ct++){var ke=8*ct+k;v[ct]=r.readUint32BE(U,ke),w[ct]=r.readUint32BE(U,ke+4)}for(var ct=0;ct<80;ct++){var Ni=z,we=G,xt=ae,O=be,A=de,S=pe,c=ue,_=he,Z=R,oe=M,ye=W,Te=ge,Fe=te,Ie=Ee,It=Oe,yt=et;if(C=he,$=et,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=(de>>>14|te<<32-14)^(de>>>18|te<<32-18)^(te>>>41-32|de<<32-(41-32)),$=(te>>>14|de<<32-14)^(te>>>18|de<<32-18)^(de>>>41-32|te<<32-(41-32)),J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,C=de&pe^~de&ue,$=te&Ee^~te&Oe,J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,C=a[ct*2],$=a[ct*2+1],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,C=v[ct%16],$=w[ct%16],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,je=j&65535|V<<16,Re=J&65535|K<<16,C=je,$=Re,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=(z>>>28|R<<32-28)^(R>>>34-32|z<<32-(34-32))^(R>>>39-32|z<<32-(39-32)),$=(R>>>28|z<<32-28)^(z>>>34-32|R<<32-(34-32))^(z>>>39-32|R<<32-(39-32)),J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,C=z&G^z&ae^G&ae,$=R&M^R&W^M&W,J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,_=j&65535|V<<16,yt=J&65535|K<<16,C=O,$=Te,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=je,$=Re,J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,O=j&65535|V<<16,Te=J&65535|K<<16,G=Ni,ae=we,be=xt,de=O,pe=A,ue=S,he=c,z=_,M=Z,W=oe,ge=ye,te=Te,Ee=Fe,Oe=Ie,et=It,R=yt,ct%16===15)for(var ke=0;ke<16;ke++)C=v[ke],$=w[ke],J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=v[(ke+9)%16],$=w[(ke+9)%16],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,je=v[(ke+1)%16],Re=w[(ke+1)%16],C=(je>>>1|Re<<32-1)^(je>>>8|Re<<32-8)^je>>>7,$=(Re>>>1|je<<32-1)^(Re>>>8|je<<32-8)^(Re>>>7|je<<32-7),J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,je=v[(ke+14)%16],Re=w[(ke+14)%16],C=(je>>>19|Re<<32-19)^(Re>>>61-32|je<<32-(61-32))^je>>>6,$=(Re>>>19|je<<32-19)^(je>>>61-32|Re<<32-(61-32))^(Re>>>6|je<<32-6),J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,v[ke]=j&65535|V<<16,w[ke]=J&65535|K<<16}C=z,$=R,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=I[0],$=F[0],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,I[0]=z=j&65535|V<<16,F[0]=R=J&65535|K<<16,C=G,$=M,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=I[1],$=F[1],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,I[1]=G=j&65535|V<<16,F[1]=M=J&65535|K<<16,C=ae,$=W,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=I[2],$=F[2],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,I[2]=ae=j&65535|V<<16,F[2]=W=J&65535|K<<16,C=be,$=ge,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=I[3],$=F[3],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,I[3]=be=j&65535|V<<16,F[3]=ge=J&65535|K<<16,C=de,$=te,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=I[4],$=F[4],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,I[4]=de=j&65535|V<<16,F[4]=te=J&65535|K<<16,C=pe,$=Ee,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=I[5],$=F[5],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,I[5]=pe=j&65535|V<<16,F[5]=Ee=J&65535|K<<16,C=ue,$=Oe,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=I[6],$=F[6],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,I[6]=ue=j&65535|V<<16,F[6]=Oe=J&65535|K<<16,C=he,$=et,J=$&65535,K=$>>>16,j=C&65535,V=C>>>16,C=I[7],$=F[7],J+=$&65535,K+=$>>>16,j+=C&65535,V+=C>>>16,K+=J>>>16,j+=K>>>16,V+=j>>>16,I[7]=he=j&65535|V<<16,F[7]=et=J&65535|K<<16,k+=128,H-=128}return k}function d(v){var w=new n;w.update(v);var I=w.digest();return w.clean(),I}h.hash=d})($l);(function(h){Object.defineProperty(h,"__esModule",{value:!0}),h.convertSecretKeyToX25519=h.convertPublicKeyToX25519=h.verify=h.sign=h.extractPublicKeyFromSecretKey=h.generateKeyPair=h.generateKeyPairFromSeed=h.SEED_LENGTH=h.SECRET_KEY_LENGTH=h.PUBLIC_KEY_LENGTH=h.SIGNATURE_LENGTH=void 0;const r=xl,i=$l,n=El;h.SIGNATURE_LENGTH=64,h.PUBLIC_KEY_LENGTH=32,h.SECRET_KEY_LENGTH=64,h.SEED_LENGTH=32;function a(O){const A=new Float64Array(16);if(O)for(let S=0;S<O.length;S++)A[S]=O[S];return A}const l=new Uint8Array(32);l[0]=9;const d=a(),v=a([1]),w=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),I=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),F=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),U=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),k=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function H(O,A){for(let S=0;S<16;S++)O[S]=A[S]|0}function z(O){let A=1;for(let S=0;S<16;S++){let c=O[S]+A+65535;A=Math.floor(c/65536),O[S]=c-A*65536}O[0]+=A-1+37*(A-1)}function G(O,A,S){const c=~(S-1);for(let _=0;_<16;_++){const Z=c&(O[_]^A[_]);O[_]^=Z,A[_]^=Z}}function ae(O,A){const S=a(),c=a();for(let _=0;_<16;_++)c[_]=A[_];z(c),z(c),z(c);for(let _=0;_<2;_++){S[0]=c[0]-65517;for(let oe=1;oe<15;oe++)S[oe]=c[oe]-65535-(S[oe-1]>>16&1),S[oe-1]&=65535;S[15]=c[15]-32767-(S[14]>>16&1);const Z=S[15]>>16&1;S[14]&=65535,G(c,S,1-Z)}for(let _=0;_<16;_++)O[2*_]=c[_]&255,O[2*_+1]=c[_]>>8}function be(O,A){let S=0;for(let c=0;c<32;c++)S|=O[c]^A[c];return(1&S-1>>>8)-1}function de(O,A){const S=new Uint8Array(32),c=new Uint8Array(32);return ae(S,O),ae(c,A),be(S,c)}function pe(O){const A=new Uint8Array(32);return ae(A,O),A[0]&1}function ue(O,A){for(let S=0;S<16;S++)O[S]=A[2*S]+(A[2*S+1]<<8);O[15]&=32767}function he(O,A,S){for(let c=0;c<16;c++)O[c]=A[c]+S[c]}function R(O,A,S){for(let c=0;c<16;c++)O[c]=A[c]-S[c]}function M(O,A,S){let c,_,Z=0,oe=0,ye=0,Te=0,Fe=0,Ie=0,It=0,yt=0,st=0,$e=0,Je=0,Qe=0,nt=0,ze=0,Ye=0,Ne=0,He=0,ut=0,Le=0,St=0,Dt=0,zt=0,Ut=0,Lt=0,Gt=0,ti=0,Fi=0,Wt=0,ki=0,rr=0,_r=0,ht=S[0],tt=S[1],lt=S[2],ft=S[3],at=S[4],it=S[5],Pt=S[6],Ct=S[7],pt=S[8],At=S[9],dt=S[10],mt=S[11],gt=S[12],We=S[13],Ot=S[14],Rt=S[15];c=A[0],Z+=c*ht,oe+=c*tt,ye+=c*lt,Te+=c*ft,Fe+=c*at,Ie+=c*it,It+=c*Pt,yt+=c*Ct,st+=c*pt,$e+=c*At,Je+=c*dt,Qe+=c*mt,nt+=c*gt,ze+=c*We,Ye+=c*Ot,Ne+=c*Rt,c=A[1],oe+=c*ht,ye+=c*tt,Te+=c*lt,Fe+=c*ft,Ie+=c*at,It+=c*it,yt+=c*Pt,st+=c*Ct,$e+=c*pt,Je+=c*At,Qe+=c*dt,nt+=c*mt,ze+=c*gt,Ye+=c*We,Ne+=c*Ot,He+=c*Rt,c=A[2],ye+=c*ht,Te+=c*tt,Fe+=c*lt,Ie+=c*ft,It+=c*at,yt+=c*it,st+=c*Pt,$e+=c*Ct,Je+=c*pt,Qe+=c*At,nt+=c*dt,ze+=c*mt,Ye+=c*gt,Ne+=c*We,He+=c*Ot,ut+=c*Rt,c=A[3],Te+=c*ht,Fe+=c*tt,Ie+=c*lt,It+=c*ft,yt+=c*at,st+=c*it,$e+=c*Pt,Je+=c*Ct,Qe+=c*pt,nt+=c*At,ze+=c*dt,Ye+=c*mt,Ne+=c*gt,He+=c*We,ut+=c*Ot,Le+=c*Rt,c=A[4],Fe+=c*ht,Ie+=c*tt,It+=c*lt,yt+=c*ft,st+=c*at,$e+=c*it,Je+=c*Pt,Qe+=c*Ct,nt+=c*pt,ze+=c*At,Ye+=c*dt,Ne+=c*mt,He+=c*gt,ut+=c*We,Le+=c*Ot,St+=c*Rt,c=A[5],Ie+=c*ht,It+=c*tt,yt+=c*lt,st+=c*ft,$e+=c*at,Je+=c*it,Qe+=c*Pt,nt+=c*Ct,ze+=c*pt,Ye+=c*At,Ne+=c*dt,He+=c*mt,ut+=c*gt,Le+=c*We,St+=c*Ot,Dt+=c*Rt,c=A[6],It+=c*ht,yt+=c*tt,st+=c*lt,$e+=c*ft,Je+=c*at,Qe+=c*it,nt+=c*Pt,ze+=c*Ct,Ye+=c*pt,Ne+=c*At,He+=c*dt,ut+=c*mt,Le+=c*gt,St+=c*We,Dt+=c*Ot,zt+=c*Rt,c=A[7],yt+=c*ht,st+=c*tt,$e+=c*lt,Je+=c*ft,Qe+=c*at,nt+=c*it,ze+=c*Pt,Ye+=c*Ct,Ne+=c*pt,He+=c*At,ut+=c*dt,Le+=c*mt,St+=c*gt,Dt+=c*We,zt+=c*Ot,Ut+=c*Rt,c=A[8],st+=c*ht,$e+=c*tt,Je+=c*lt,Qe+=c*ft,nt+=c*at,ze+=c*it,Ye+=c*Pt,Ne+=c*Ct,He+=c*pt,ut+=c*At,Le+=c*dt,St+=c*mt,Dt+=c*gt,zt+=c*We,Ut+=c*Ot,Lt+=c*Rt,c=A[9],$e+=c*ht,Je+=c*tt,Qe+=c*lt,nt+=c*ft,ze+=c*at,Ye+=c*it,Ne+=c*Pt,He+=c*Ct,ut+=c*pt,Le+=c*At,St+=c*dt,Dt+=c*mt,zt+=c*gt,Ut+=c*We,Lt+=c*Ot,Gt+=c*Rt,c=A[10],Je+=c*ht,Qe+=c*tt,nt+=c*lt,ze+=c*ft,Ye+=c*at,Ne+=c*it,He+=c*Pt,ut+=c*Ct,Le+=c*pt,St+=c*At,Dt+=c*dt,zt+=c*mt,Ut+=c*gt,Lt+=c*We,Gt+=c*Ot,ti+=c*Rt,c=A[11],Qe+=c*ht,nt+=c*tt,ze+=c*lt,Ye+=c*ft,Ne+=c*at,He+=c*it,ut+=c*Pt,Le+=c*Ct,St+=c*pt,Dt+=c*At,zt+=c*dt,Ut+=c*mt,Lt+=c*gt,Gt+=c*We,ti+=c*Ot,Fi+=c*Rt,c=A[12],nt+=c*ht,ze+=c*tt,Ye+=c*lt,Ne+=c*ft,He+=c*at,ut+=c*it,Le+=c*Pt,St+=c*Ct,Dt+=c*pt,zt+=c*At,Ut+=c*dt,Lt+=c*mt,Gt+=c*gt,ti+=c*We,Fi+=c*Ot,Wt+=c*Rt,c=A[13],ze+=c*ht,Ye+=c*tt,Ne+=c*lt,He+=c*ft,ut+=c*at,Le+=c*it,St+=c*Pt,Dt+=c*Ct,zt+=c*pt,Ut+=c*At,Lt+=c*dt,Gt+=c*mt,ti+=c*gt,Fi+=c*We,Wt+=c*Ot,ki+=c*Rt,c=A[14],Ye+=c*ht,Ne+=c*tt,He+=c*lt,ut+=c*ft,Le+=c*at,St+=c*it,Dt+=c*Pt,zt+=c*Ct,Ut+=c*pt,Lt+=c*At,Gt+=c*dt,ti+=c*mt,Fi+=c*gt,Wt+=c*We,ki+=c*Ot,rr+=c*Rt,c=A[15],Ne+=c*ht,He+=c*tt,ut+=c*lt,Le+=c*ft,St+=c*at,Dt+=c*it,zt+=c*Pt,Ut+=c*Ct,Lt+=c*pt,Gt+=c*At,ti+=c*dt,Fi+=c*mt,Wt+=c*gt,ki+=c*We,rr+=c*Ot,_r+=c*Rt,Z+=38*He,oe+=38*ut,ye+=38*Le,Te+=38*St,Fe+=38*Dt,Ie+=38*zt,It+=38*Ut,yt+=38*Lt,st+=38*Gt,$e+=38*ti,Je+=38*Fi,Qe+=38*Wt,nt+=38*ki,ze+=38*rr,Ye+=38*_r,_=1,c=Z+_+65535,_=Math.floor(c/65536),Z=c-_*65536,c=oe+_+65535,_=Math.floor(c/65536),oe=c-_*65536,c=ye+_+65535,_=Math.floor(c/65536),ye=c-_*65536,c=Te+_+65535,_=Math.floor(c/65536),Te=c-_*65536,c=Fe+_+65535,_=Math.floor(c/65536),Fe=c-_*65536,c=Ie+_+65535,_=Math.floor(c/65536),Ie=c-_*65536,c=It+_+65535,_=Math.floor(c/65536),It=c-_*65536,c=yt+_+65535,_=Math.floor(c/65536),yt=c-_*65536,c=st+_+65535,_=Math.floor(c/65536),st=c-_*65536,c=$e+_+65535,_=Math.floor(c/65536),$e=c-_*65536,c=Je+_+65535,_=Math.floor(c/65536),Je=c-_*65536,c=Qe+_+65535,_=Math.floor(c/65536),Qe=c-_*65536,c=nt+_+65535,_=Math.floor(c/65536),nt=c-_*65536,c=ze+_+65535,_=Math.floor(c/65536),ze=c-_*65536,c=Ye+_+65535,_=Math.floor(c/65536),Ye=c-_*65536,c=Ne+_+65535,_=Math.floor(c/65536),Ne=c-_*65536,Z+=_-1+37*(_-1),_=1,c=Z+_+65535,_=Math.floor(c/65536),Z=c-_*65536,c=oe+_+65535,_=Math.floor(c/65536),oe=c-_*65536,c=ye+_+65535,_=Math.floor(c/65536),ye=c-_*65536,c=Te+_+65535,_=Math.floor(c/65536),Te=c-_*65536,c=Fe+_+65535,_=Math.floor(c/65536),Fe=c-_*65536,c=Ie+_+65535,_=Math.floor(c/65536),Ie=c-_*65536,c=It+_+65535,_=Math.floor(c/65536),It=c-_*65536,c=yt+_+65535,_=Math.floor(c/65536),yt=c-_*65536,c=st+_+65535,_=Math.floor(c/65536),st=c-_*65536,c=$e+_+65535,_=Math.floor(c/65536),$e=c-_*65536,c=Je+_+65535,_=Math.floor(c/65536),Je=c-_*65536,c=Qe+_+65535,_=Math.floor(c/65536),Qe=c-_*65536,c=nt+_+65535,_=Math.floor(c/65536),nt=c-_*65536,c=ze+_+65535,_=Math.floor(c/65536),ze=c-_*65536,c=Ye+_+65535,_=Math.floor(c/65536),Ye=c-_*65536,c=Ne+_+65535,_=Math.floor(c/65536),Ne=c-_*65536,Z+=_-1+37*(_-1),O[0]=Z,O[1]=oe,O[2]=ye,O[3]=Te,O[4]=Fe,O[5]=Ie,O[6]=It,O[7]=yt,O[8]=st,O[9]=$e,O[10]=Je,O[11]=Qe,O[12]=nt,O[13]=ze,O[14]=Ye,O[15]=Ne}function W(O,A){M(O,A,A)}function ge(O,A){const S=a();let c;for(c=0;c<16;c++)S[c]=A[c];for(c=253;c>=0;c--)W(S,S),c!==2&&c!==4&&M(S,S,A);for(c=0;c<16;c++)O[c]=S[c]}function te(O,A){const S=a();let c;for(c=0;c<16;c++)S[c]=A[c];for(c=250;c>=0;c--)W(S,S),c!==1&&M(S,S,A);for(c=0;c<16;c++)O[c]=S[c]}function Ee(O,A){const S=a(),c=a(),_=a(),Z=a(),oe=a(),ye=a(),Te=a(),Fe=a(),Ie=a();R(S,O[1],O[0]),R(Ie,A[1],A[0]),M(S,S,Ie),he(c,O[0],O[1]),he(Ie,A[0],A[1]),M(c,c,Ie),M(_,O[3],A[3]),M(_,_,I),M(Z,O[2],A[2]),he(Z,Z,Z),R(oe,c,S),R(ye,Z,_),he(Te,Z,_),he(Fe,c,S),M(O[0],oe,ye),M(O[1],Fe,Te),M(O[2],Te,ye),M(O[3],oe,Fe)}function Oe(O,A,S){for(let c=0;c<4;c++)G(O[c],A[c],S)}function et(O,A){const S=a(),c=a(),_=a();ge(_,A[2]),M(S,A[0],_),M(c,A[1],_),ae(O,c),O[31]^=pe(S)<<7}function C(O,A,S){H(O[0],d),H(O[1],v),H(O[2],v),H(O[3],d);for(let c=255;c>=0;--c){const _=S[c/8|0]>>(c&7)&1;Oe(O,A,_),Ee(A,O),Ee(O,O),Oe(O,A,_)}}function $(O,A){const S=[a(),a(),a(),a()];H(S[0],F),H(S[1],U),H(S[2],v),M(S[3],F,U),C(O,S,A)}function je(O){if(O.length!==h.SEED_LENGTH)throw new Error(`ed25519: seed must be ${h.SEED_LENGTH} bytes`);const A=(0,i.hash)(O);A[0]&=248,A[31]&=127,A[31]|=64;const S=new Uint8Array(32),c=[a(),a(),a(),a()];$(c,A),et(S,c);const _=new Uint8Array(64);return _.set(O),_.set(S,32),{publicKey:S,secretKey:_}}h.generateKeyPairFromSeed=je;function Re(O){const A=(0,r.randomBytes)(32,O),S=je(A);return(0,n.wipe)(A),S}h.generateKeyPair=Re;function J(O){if(O.length!==h.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${h.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}h.extractPublicKeyFromSecretKey=J;const K=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function j(O,A){let S,c,_,Z;for(c=63;c>=32;--c){for(S=0,_=c-32,Z=c-12;_<Z;++_)A[_]+=S-16*A[c]*K[_-(c-32)],S=Math.floor((A[_]+128)/256),A[_]-=S*256;A[_]+=S,A[c]=0}for(S=0,_=0;_<32;_++)A[_]+=S-(A[31]>>4)*K[_],S=A[_]>>8,A[_]&=255;for(_=0;_<32;_++)A[_]-=S*K[_];for(c=0;c<32;c++)A[c+1]+=A[c]>>8,O[c]=A[c]&255}function V(O){const A=new Float64Array(64);for(let S=0;S<64;S++)A[S]=O[S];for(let S=0;S<64;S++)O[S]=0;j(O,A)}function ct(O,A){const S=new Float64Array(64),c=[a(),a(),a(),a()],_=(0,i.hash)(O.subarray(0,32));_[0]&=248,_[31]&=127,_[31]|=64;const Z=new Uint8Array(64);Z.set(_.subarray(32),32);const oe=new i.SHA512;oe.update(Z.subarray(32)),oe.update(A);const ye=oe.digest();oe.clean(),V(ye),$(c,ye),et(Z,c),oe.reset(),oe.update(Z.subarray(0,32)),oe.update(O.subarray(32)),oe.update(A);const Te=oe.digest();V(Te);for(let Fe=0;Fe<32;Fe++)S[Fe]=ye[Fe];for(let Fe=0;Fe<32;Fe++)for(let Ie=0;Ie<32;Ie++)S[Fe+Ie]+=Te[Fe]*_[Ie];return j(Z.subarray(32),S),Z}h.sign=ct;function ke(O,A){const S=a(),c=a(),_=a(),Z=a(),oe=a(),ye=a(),Te=a();return H(O[2],v),ue(O[1],A),W(_,O[1]),M(Z,_,w),R(_,_,O[2]),he(Z,O[2],Z),W(oe,Z),W(ye,oe),M(Te,ye,oe),M(S,Te,_),M(S,S,Z),te(S,S),M(S,S,_),M(S,S,Z),M(S,S,Z),M(O[0],S,Z),W(c,O[0]),M(c,c,Z),de(c,_)&&M(O[0],O[0],k),W(c,O[0]),M(c,c,Z),de(c,_)?-1:(pe(O[0])===A[31]>>7&&R(O[0],d,O[0]),M(O[3],O[0],O[1]),0)}function Ni(O,A,S){const c=new Uint8Array(32),_=[a(),a(),a(),a()],Z=[a(),a(),a(),a()];if(S.length!==h.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${h.SIGNATURE_LENGTH} bytes`);if(ke(Z,O))return!1;const oe=new i.SHA512;oe.update(S.subarray(0,32)),oe.update(O),oe.update(A);const ye=oe.digest();return V(ye),C(_,Z,ye),$(Z,S.subarray(32)),Ee(_,Z),et(c,_),!be(S,c)}h.verify=Ni;function we(O){let A=[a(),a(),a(),a()];if(ke(A,O))throw new Error("Ed25519: invalid public key");let S=a(),c=a(),_=A[1];he(S,v,_),R(c,v,_),ge(c,c),M(S,S,c);let Z=new Uint8Array(32);return ae(Z,S),Z}h.convertPublicKeyToX25519=we;function xt(O){const A=(0,i.hash)(O.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const S=new Uint8Array(A.subarray(0,32));return(0,n.wipe)(A),S}h.convertSecretKeyToX25519=xt})(gc);const am="EdDSA",om="JWT",ql=".",Ll="base64url",cm="utf8",um="utf8",hm=":",lm="did",fm="key",zh="base58btc",pm="z",dm="K36",gm=32;function oa(h){return ha(cc(hc(h),cm),Ll)}function Ml(h){const r=cc(dm,zh),i=pm+ha(zy([r,h]),zh);return[lm,fm,i].join(hm)}function vm(h){return ha(h,Ll)}function ym(h){return cc([oa(h.header),oa(h.payload)].join(ql),um)}function mm(h){return[oa(h.header),oa(h.payload),vm(h.signature)].join(ql)}function Uh(h=xl.randomBytes(gm)){return gc.generateKeyPairFromSeed(h)}async function wm(h,r,i,n,a=ie.fromMiliseconds(Date.now())){const l={alg:am,typ:om},d=Ml(n.publicKey),v=a+i,w={iss:d,sub:h,aud:r,iat:a,exp:v},I=ym({header:l,payload:w}),F=gc.sign(n.secretKey,I);return mm({header:l,payload:w,signature:F})}const _m=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),bm=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",kh=h=>h.split("?")[0],Hh=10,Em=_m();class xm{constructor(r){if(this.url=r,this.events=new Ui.EventEmitter,this.registering=!1,!Sh(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),r()},this.socket.close()})}async send(r,i){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(hc(r))}catch(n){this.onError(r.id,n)}}register(r=this.url){if(!Sh(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,a)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),a(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=r,this.registering=!0,new Promise((i,n)=>{const a=C1.isReactNative()?void 0:{rejectUnauthorized:!A1(r)},l=new Em(r,[],a);bm()?l.onerror=d=>{const v=d;n(this.emitError(v.error))}:l.on("error",d=>{n(this.emitError(d))}),l.onopen=()=>{this.onOpen(l),i(l)}})}onOpen(r){r.onmessage=i=>this.onPayload(i),r.onclose=i=>this.onClose(i),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?Rl(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),a=n.message||n.toString(),l=lc(r,a);this.events.emit("payload",l)}parseError(r,i=this.url){return O1(r,kh(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Hh&&this.events.setMaxListeners(Hh)}emitError(r){const i=this.parseError(new Error((r==null?void 0:r.message)||`WebSocket connection failed for host: ${kh(this.url)}`));return this.events.emit("register_error",i),i}}var ca={exports:{}};ca.exports;(function(h,r){var i=200,n="__lodash_hash_undefined__",a=1,l=2,d=9007199254740991,v="[object Arguments]",w="[object Array]",I="[object AsyncFunction]",F="[object Boolean]",U="[object Date]",k="[object Error]",H="[object Function]",z="[object GeneratorFunction]",G="[object Map]",ae="[object Number]",be="[object Null]",de="[object Object]",pe="[object Promise]",ue="[object Proxy]",he="[object RegExp]",R="[object Set]",M="[object String]",W="[object Symbol]",ge="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Oe="[object DataView]",et="[object Float32Array]",C="[object Float64Array]",$="[object Int8Array]",je="[object Int16Array]",Re="[object Int32Array]",J="[object Uint8Array]",K="[object Uint8ClampedArray]",j="[object Uint16Array]",V="[object Uint32Array]",ct=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,Ni=/^(?:0|[1-9]\d*)$/,we={};we[et]=we[C]=we[$]=we[je]=we[Re]=we[J]=we[K]=we[j]=we[V]=!0,we[v]=we[w]=we[Ee]=we[F]=we[Oe]=we[U]=we[k]=we[H]=we[G]=we[ae]=we[de]=we[he]=we[R]=we[M]=we[te]=!1;var xt=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,O=typeof self=="object"&&self&&self.Object===Object&&self,A=xt||O||Function("return this")(),S=r&&!r.nodeType&&r,c=S&&!0&&h&&!h.nodeType&&h,_=c&&c.exports===S,Z=_&&xt.process,oe=function(){try{return Z&&Z.binding&&Z.binding("util")}catch{}}(),ye=oe&&oe.isTypedArray;function Te(g,b){for(var q=-1,Q=g==null?0:g.length,Ve=0,le=[];++q<Q;){var Xe=g[q];b(Xe,q,g)&&(le[Ve++]=Xe)}return le}function Fe(g,b){for(var q=-1,Q=b.length,Ve=g.length;++q<Q;)g[Ve+q]=b[q];return g}function Ie(g,b){for(var q=-1,Q=g==null?0:g.length;++q<Q;)if(b(g[q],q,g))return!0;return!1}function It(g,b){for(var q=-1,Q=Array(g);++q<g;)Q[q]=b(q);return Q}function yt(g){return function(b){return g(b)}}function st(g,b){return g.has(b)}function $e(g,b){return g==null?void 0:g[b]}function Je(g){var b=-1,q=Array(g.size);return g.forEach(function(Q,Ve){q[++b]=[Ve,Q]}),q}function Qe(g,b){return function(q){return g(b(q))}}function nt(g){var b=-1,q=Array(g.size);return g.forEach(function(Q){q[++b]=Q}),q}var ze=Array.prototype,Ye=Function.prototype,Ne=Object.prototype,He=A["__core-js_shared__"],ut=Ye.toString,Le=Ne.hasOwnProperty,St=function(){var g=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Dt=Ne.toString,zt=RegExp("^"+ut.call(Le).replace(ct,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ut=_?A.Buffer:void 0,Lt=A.Symbol,Gt=A.Uint8Array,ti=Ne.propertyIsEnumerable,Fi=ze.splice,Wt=Lt?Lt.toStringTag:void 0,ki=Object.getOwnPropertySymbols,rr=Ut?Ut.isBuffer:void 0,_r=Qe(Object.keys,Object),ht=ui(A,"DataView"),tt=ui(A,"Map"),lt=ui(A,"Promise"),ft=ui(A,"Set"),at=ui(A,"WeakMap"),it=ui(Object,"create"),Pt=Ki(ht),Ct=Ki(tt),pt=Ki(lt),At=Ki(ft),dt=Ki(at),mt=Lt?Lt.prototype:void 0,gt=mt?mt.valueOf:void 0;function We(g){var b=-1,q=g==null?0:g.length;for(this.clear();++b<q;){var Q=g[b];this.set(Q[0],Q[1])}}function Ot(){this.__data__=it?it(null):{},this.size=0}function Rt(g){var b=this.has(g)&&delete this.__data__[g];return this.size-=b?1:0,b}function da(g){var b=this.__data__;if(it){var q=b[g];return q===n?void 0:q}return Le.call(b,g)?b[g]:void 0}function ga(g){var b=this.__data__;return it?b[g]!==void 0:Le.call(b,g)}function va(g,b){var q=this.__data__;return this.size+=this.has(g)?0:1,q[g]=it&&b===void 0?n:b,this}We.prototype.clear=Ot,We.prototype.delete=Rt,We.prototype.get=da,We.prototype.has=ga,We.prototype.set=va;function gi(g){var b=-1,q=g==null?0:g.length;for(this.clear();++b<q;){var Q=g[b];this.set(Q[0],Q[1])}}function ya(){this.__data__=[],this.size=0}function ma(g){var b=this.__data__,q=br(b,g);if(q<0)return!1;var Q=b.length-1;return q==Q?b.pop():Fi.call(b,q,1),--this.size,!0}function wa(g){var b=this.__data__,q=br(b,g);return q<0?void 0:b[q][1]}function _a(g){return br(this.__data__,g)>-1}function ba(g,b){var q=this.__data__,Q=br(q,g);return Q<0?(++this.size,q.push([g,b])):q[Q][1]=b,this}gi.prototype.clear=ya,gi.prototype.delete=ma,gi.prototype.get=wa,gi.prototype.has=_a,gi.prototype.set=ba;function Hi(g){var b=-1,q=g==null?0:g.length;for(this.clear();++b<q;){var Q=g[b];this.set(Q[0],Q[1])}}function zr(){this.size=0,this.__data__={hash:new We,map:new(tt||gi),string:new We}}function Ea(g){var b=sr(this,g).delete(g);return this.size-=b?1:0,b}function Ur(g){return sr(this,g).get(g)}function xa(g){return sr(this,g).has(g)}function Ia(g,b){var q=sr(this,g),Q=q.size;return q.set(g,b),this.size+=q.size==Q?0:1,this}Hi.prototype.clear=zr,Hi.prototype.delete=Ea,Hi.prototype.get=Ur,Hi.prototype.has=xa,Hi.prototype.set=Ia;function kr(g){var b=-1,q=g==null?0:g.length;for(this.__data__=new Hi;++b<q;)this.add(g[b])}function Js(g){return this.__data__.set(g,n),this}function Qs(g){return this.__data__.has(g)}kr.prototype.add=kr.prototype.push=Js,kr.prototype.has=Qs;function Si(g){var b=this.__data__=new gi(g);this.size=b.size}function Sa(){this.__data__=new gi,this.size=0}function Pa(g){var b=this.__data__,q=b.delete(g);return this.size=b.size,q}function Ca(g){return this.__data__.get(g)}function Aa(g){return this.__data__.has(g)}function Ys(g,b){var q=this.__data__;if(q instanceof gi){var Q=q.__data__;if(!tt||Q.length<i-1)return Q.push([g,b]),this.size=++q.size,this;q=this.__data__=new Hi(Q)}return q.set(g,b),this.size=q.size,this}Si.prototype.clear=Sa,Si.prototype.delete=Pa,Si.prototype.get=Ca,Si.prototype.has=Aa,Si.prototype.set=Ys;function Xs(g,b){var q=Vr(g),Q=!q&&ln(g),Ve=!q&&!Q&&gs(g),le=!q&&!Q&&!Ve&&dn(g),Xe=q||Q||Ve||le,Tt=Xe?It(g.length,String):[],Pe=Tt.length;for(var Be in g)(b||Le.call(g,Be))&&!(Xe&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||le&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||an(Be,Pe)))&&Tt.push(Be);return Tt}function br(g,b){for(var q=g.length;q--;)if(hn(g[q][0],b))return q;return-1}function ps(g,b,q){var Q=b(g);return Vr(g)?Q:Fe(Q,q(g))}function Er(g){return g==null?g===void 0?ge:be:Wt&&Wt in Object(g)?sn(g):Ta(g)}function ds(g){return Ir(g)&&Er(g)==v}function xr(g,b,q,Q,Ve){return g===b?!0:g==null||b==null||!Ir(g)&&!Ir(b)?g!==g&&b!==b:Zs(g,b,q,Q,xr,Ve)}function Zs(g,b,q,Q,Ve,le){var Xe=Vr(g),Tt=Vr(b),Pe=Xe?w:Di(g),Be=Tt?w:Di(b);Pe=Pe==v?de:Pe,Be=Be==v?de:Be;var wt=Pe==de,ii=Be==de,Nt=Pe==Be;if(Nt&&gs(g)){if(!gs(b))return!1;Xe=!0,wt=!1}if(Nt&&!wt)return le||(le=new Si),Xe||dn(g)?Hr(g,b,q,Q,Ve,le):Ra(g,b,Pe,q,Q,Ve,le);if(!(q&a)){var Ze=wt&&Le.call(g,"__wrapped__"),Jt=ii&&Le.call(b,"__wrapped__");if(Ze||Jt){var Pi=Ze?g.value():g,vi=Jt?b.value():b;return le||(le=new Si),Ve(Pi,vi,q,Q,le)}}return Nt?(le||(le=new Si),rn(g,b,q,Q,Ve,le)):!1}function Oa(g){if(!pn(g)||cn(g))return!1;var b=Br(g)?zt:ke;return b.test(Ki(g))}function en(g){return Ir(g)&&fn(g.length)&&!!we[Er(g)]}function tn(g){if(!un(g))return _r(g);var b=[];for(var q in Object(g))Le.call(g,q)&&q!="constructor"&&b.push(q);return b}function Hr(g,b,q,Q,Ve,le){var Xe=q&a,Tt=g.length,Pe=b.length;if(Tt!=Pe&&!(Xe&&Pe>Tt))return!1;var Be=le.get(g);if(Be&&le.get(b))return Be==b;var wt=-1,ii=!0,Nt=q&l?new kr:void 0;for(le.set(g,b),le.set(b,g);++wt<Tt;){var Ze=g[wt],Jt=b[wt];if(Q)var Pi=Xe?Q(Jt,Ze,wt,b,g,le):Q(Ze,Jt,wt,g,b,le);if(Pi!==void 0){if(Pi)continue;ii=!1;break}if(Nt){if(!Ie(b,function(vi,$i){if(!st(Nt,$i)&&(Ze===vi||Ve(Ze,vi,q,Q,le)))return Nt.push($i)})){ii=!1;break}}else if(!(Ze===Jt||Ve(Ze,Jt,q,Q,le))){ii=!1;break}}return le.delete(g),le.delete(b),ii}function Ra(g,b,q,Q,Ve,le,Xe){switch(q){case Oe:if(g.byteLength!=b.byteLength||g.byteOffset!=b.byteOffset)return!1;g=g.buffer,b=b.buffer;case Ee:return!(g.byteLength!=b.byteLength||!le(new Gt(g),new Gt(b)));case F:case U:case ae:return hn(+g,+b);case k:return g.name==b.name&&g.message==b.message;case he:case M:return g==b+"";case G:var Tt=Je;case R:var Pe=Q&a;if(Tt||(Tt=nt),g.size!=b.size&&!Pe)return!1;var Be=Xe.get(g);if(Be)return Be==b;Q|=l,Xe.set(g,b);var wt=Hr(Tt(g),Tt(b),Q,Ve,le,Xe);return Xe.delete(g),wt;case W:if(gt)return gt.call(g)==gt.call(b)}return!1}function rn(g,b,q,Q,Ve,le){var Xe=q&a,Tt=Kr(g),Pe=Tt.length,Be=Kr(b),wt=Be.length;if(Pe!=wt&&!Xe)return!1;for(var ii=Pe;ii--;){var Nt=Tt[ii];if(!(Xe?Nt in b:Le.call(b,Nt)))return!1}var Ze=le.get(g);if(Ze&&le.get(b))return Ze==b;var Jt=!0;le.set(g,b),le.set(b,g);for(var Pi=Xe;++ii<Pe;){Nt=Tt[ii];var vi=g[Nt],$i=b[Nt];if(Q)var vs=Xe?Q($i,vi,Nt,b,g,le):Q(vi,$i,Nt,g,b,le);if(!(vs===void 0?vi===$i||Ve(vi,$i,q,Q,le):vs)){Jt=!1;break}Pi||(Pi=Nt=="constructor")}if(Jt&&!Pi){var Sr=g.constructor,Mt=b.constructor;Sr!=Mt&&"constructor"in g&&"constructor"in b&&!(typeof Sr=="function"&&Sr instanceof Sr&&typeof Mt=="function"&&Mt instanceof Mt)&&(Jt=!1)}return le.delete(g),le.delete(b),Jt}function Kr(g){return ps(g,Da,nn)}function sr(g,b){var q=g.__data__;return on(b)?q[typeof b=="string"?"string":"hash"]:q.map}function ui(g,b){var q=$e(g,b);return Oa(q)?q:void 0}function sn(g){var b=Le.call(g,Wt),q=g[Wt];try{g[Wt]=void 0;var Q=!0}catch{}var Ve=Dt.call(g);return Q&&(b?g[Wt]=q:delete g[Wt]),Ve}var nn=ki?function(g){return g==null?[]:(g=Object(g),Te(ki(g),function(b){return ti.call(g,b)}))}:Ke,Di=Er;(ht&&Di(new ht(new ArrayBuffer(1)))!=Oe||tt&&Di(new tt)!=G||lt&&Di(lt.resolve())!=pe||ft&&Di(new ft)!=R||at&&Di(new at)!=te)&&(Di=function(g){var b=Er(g),q=b==de?g.constructor:void 0,Q=q?Ki(q):"";if(Q)switch(Q){case Pt:return Oe;case Ct:return G;case pt:return pe;case At:return R;case dt:return te}return b});function an(g,b){return b=b??d,!!b&&(typeof g=="number"||Ni.test(g))&&g>-1&&g%1==0&&g<b}function on(g){var b=typeof g;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?g!=="__proto__":g===null}function cn(g){return!!St&&St in g}function un(g){var b=g&&g.constructor,q=typeof b=="function"&&b.prototype||Ne;return g===q}function Ta(g){return Dt.call(g)}function Ki(g){if(g!=null){try{return ut.call(g)}catch{}try{return g+""}catch{}}return""}function hn(g,b){return g===b||g!==g&&b!==b}var ln=ds(function(){return arguments}())?ds:function(g){return Ir(g)&&Le.call(g,"callee")&&!ti.call(g,"callee")},Vr=Array.isArray;function Na(g){return g!=null&&fn(g.length)&&!Br(g)}var gs=rr||Ue;function Fa(g,b){return xr(g,b)}function Br(g){if(!pn(g))return!1;var b=Er(g);return b==H||b==z||b==I||b==ue}function fn(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=d}function pn(g){var b=typeof g;return g!=null&&(b=="object"||b=="function")}function Ir(g){return g!=null&&typeof g=="object"}var dn=ye?yt(ye):en;function Da(g){return Na(g)?Xs(g):tn(g)}function Ke(){return[]}function Ue(){return!1}h.exports=Fa})(ca,ca.exports);var Im=ca.exports;const Sm=Uy(Im);function Pm(h,r){if(h.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var a=0;a<h.length;a++){var l=h.charAt(a),d=l.charCodeAt(0);if(i[d]!==255)throw new TypeError(l+" is ambiguous");i[d]=a}var v=h.length,w=h.charAt(0),I=Math.log(v)/Math.log(256),F=Math.log(256)/Math.log(v);function U(z){if(z instanceof Uint8Array||(ArrayBuffer.isView(z)?z=new Uint8Array(z.buffer,z.byteOffset,z.byteLength):Array.isArray(z)&&(z=Uint8Array.from(z))),!(z instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(z.length===0)return"";for(var G=0,ae=0,be=0,de=z.length;be!==de&&z[be]===0;)be++,G++;for(var pe=(de-be)*F+1>>>0,ue=new Uint8Array(pe);be!==de;){for(var he=z[be],R=0,M=pe-1;(he!==0||R<ae)&&M!==-1;M--,R++)he+=256*ue[M]>>>0,ue[M]=he%v>>>0,he=he/v>>>0;if(he!==0)throw new Error("Non-zero carry");ae=R,be++}for(var W=pe-ae;W!==pe&&ue[W]===0;)W++;for(var ge=w.repeat(G);W<pe;++W)ge+=h.charAt(ue[W]);return ge}function k(z){if(typeof z!="string")throw new TypeError("Expected String");if(z.length===0)return new Uint8Array;var G=0;if(z[G]!==" "){for(var ae=0,be=0;z[G]===w;)ae++,G++;for(var de=(z.length-G)*I+1>>>0,pe=new Uint8Array(de);z[G];){var ue=i[z.charCodeAt(G)];if(ue===255)return;for(var he=0,R=de-1;(ue!==0||he<be)&&R!==-1;R--,he++)ue+=v*pe[R]>>>0,pe[R]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");be=he,G++}if(z[G]!==" "){for(var M=de-be;M!==de&&pe[M]===0;)M++;for(var W=new Uint8Array(ae+(de-M)),ge=ae;M!==de;)W[ge++]=pe[M++];return W}}}function H(z){var G=k(z);if(G)return G;throw new Error(`Non-${r} character`)}return{encode:U,decodeUnsafe:k,decode:H}}var Cm=Pm,Am=Cm;const jl=h=>{if(h instanceof Uint8Array&&h.constructor.name==="Uint8Array")return h;if(h instanceof ArrayBuffer)return new Uint8Array(h);if(ArrayBuffer.isView(h))return new Uint8Array(h.buffer,h.byteOffset,h.byteLength);throw new Error("Unknown type, must be binary type")},Om=h=>new TextEncoder().encode(h),Rm=h=>new TextDecoder().decode(h);class Tm{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Nm{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return zl(this,r)}}class Fm{constructor(r){this.decoders=r}or(r){return zl(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const zl=(h,r)=>new Fm({...h.decoders||{[h.prefix]:h},...r.decoders||{[r.prefix]:r}});class Dm{constructor(r,i,n,a){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=a,this.encoder=new Tm(r,i,n),this.decoder=new Nm(r,i,a)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const fa=({name:h,prefix:r,encode:i,decode:n})=>new Dm(h,r,i,n),Ws=({prefix:h,name:r,alphabet:i})=>{const{encode:n,decode:a}=Am(i,r);return fa({prefix:h,name:r,encode:n,decode:l=>jl(a(l))})},$m=(h,r,i,n)=>{const a={};for(let F=0;F<r.length;++F)a[r[F]]=F;let l=h.length;for(;h[l-1]==="=";)--l;const d=new Uint8Array(l*i/8|0);let v=0,w=0,I=0;for(let F=0;F<l;++F){const U=a[h[F]];if(U===void 0)throw new SyntaxError(`Non-${n} character`);w=w<<i|U,v+=i,v>=8&&(v-=8,d[I++]=255&w>>v)}if(v>=i||255&w<<8-v)throw new SyntaxError("Unexpected end of data");return d},qm=(h,r,i)=>{const n=r[r.length-1]==="=",a=(1<<i)-1;let l="",d=0,v=0;for(let w=0;w<h.length;++w)for(v=v<<8|h[w],d+=8;d>i;)d-=i,l+=r[a&v>>d];if(d&&(l+=r[a&v<<i-d]),n)for(;l.length*i&7;)l+="=";return l},Ht=({name:h,prefix:r,bitsPerChar:i,alphabet:n})=>fa({prefix:r,name:h,encode(a){return qm(a,n,i)},decode(a){return $m(a,n,i,h)}}),Lm=fa({prefix:"\0",name:"identity",encode:h=>Rm(h),decode:h=>Om(h)});var Mm=Object.freeze({__proto__:null,identity:Lm});const jm=Ht({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var zm=Object.freeze({__proto__:null,base2:jm});const Um=Ht({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var km=Object.freeze({__proto__:null,base8:Um});const Hm=Ws({prefix:"9",name:"base10",alphabet:"0123456789"});var Km=Object.freeze({__proto__:null,base10:Hm});const Vm=Ht({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Bm=Ht({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Gm=Object.freeze({__proto__:null,base16:Vm,base16upper:Bm});const Wm=Ht({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Jm=Ht({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qm=Ht({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ym=Ht({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Xm=Ht({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Zm=Ht({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ew=Ht({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),tw=Ht({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),iw=Ht({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var rw=Object.freeze({__proto__:null,base32:Wm,base32upper:Jm,base32pad:Qm,base32padupper:Ym,base32hex:Xm,base32hexupper:Zm,base32hexpad:ew,base32hexpadupper:tw,base32z:iw});const sw=Ws({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),nw=Ws({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var aw=Object.freeze({__proto__:null,base36:sw,base36upper:nw});const ow=Ws({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),cw=Ws({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var uw=Object.freeze({__proto__:null,base58btc:ow,base58flickr:cw});const hw=Ht({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),lw=Ht({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),fw=Ht({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),pw=Ht({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var dw=Object.freeze({__proto__:null,base64:hw,base64pad:lw,base64url:fw,base64urlpad:pw});const Ul=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),gw=Ul.reduce((h,r,i)=>(h[i]=r,h),[]),vw=Ul.reduce((h,r,i)=>(h[r.codePointAt(0)]=i,h),[]);function yw(h){return h.reduce((r,i)=>(r+=gw[i],r),"")}function mw(h){const r=[];for(const i of h){const n=vw[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const ww=fa({prefix:"🚀",name:"base256emoji",encode:yw,decode:mw});var _w=Object.freeze({__proto__:null,base256emoji:ww}),bw=kl,Kh=128,Ew=127,xw=~Ew,Iw=Math.pow(2,31);function kl(h,r,i){r=r||[],i=i||0;for(var n=i;h>=Iw;)r[i++]=h&255|Kh,h/=128;for(;h&xw;)r[i++]=h&255|Kh,h>>>=7;return r[i]=h|0,kl.bytes=i-n+1,r}var Sw=rc,Pw=128,Vh=127;function rc(h,n){var i=0,n=n||0,a=0,l=n,d,v=h.length;do{if(l>=v)throw rc.bytes=0,new RangeError("Could not decode varint");d=h[l++],i+=a<28?(d&Vh)<<a:(d&Vh)*Math.pow(2,a),a+=7}while(d>=Pw);return rc.bytes=l-n,i}var Cw=Math.pow(2,7),Aw=Math.pow(2,14),Ow=Math.pow(2,21),Rw=Math.pow(2,28),Tw=Math.pow(2,35),Nw=Math.pow(2,42),Fw=Math.pow(2,49),Dw=Math.pow(2,56),$w=Math.pow(2,63),qw=function(h){return h<Cw?1:h<Aw?2:h<Ow?3:h<Rw?4:h<Tw?5:h<Nw?6:h<Fw?7:h<Dw?8:h<$w?9:10},Lw={encode:bw,decode:Sw,encodingLength:qw},Hl=Lw;const Bh=(h,r,i=0)=>(Hl.encode(h,r,i),r),Gh=h=>Hl.encodingLength(h),sc=(h,r)=>{const i=r.byteLength,n=Gh(h),a=n+Gh(i),l=new Uint8Array(a+i);return Bh(h,l,0),Bh(i,l,n),l.set(r,a),new Mw(h,i,r,l)};class Mw{constructor(r,i,n,a){this.code=r,this.size=i,this.digest=n,this.bytes=a}}const Kl=({name:h,code:r,encode:i})=>new jw(h,r,i);class jw{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?sc(this.code,i):i.then(n=>sc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Vl=h=>async r=>new Uint8Array(await crypto.subtle.digest(h,r)),zw=Kl({name:"sha2-256",code:18,encode:Vl("SHA-256")}),Uw=Kl({name:"sha2-512",code:19,encode:Vl("SHA-512")});var kw=Object.freeze({__proto__:null,sha256:zw,sha512:Uw});const Bl=0,Hw="identity",Gl=jl,Kw=h=>sc(Bl,Gl(h)),Vw={code:Bl,name:Hw,encode:Gl,digest:Kw};var Bw=Object.freeze({__proto__:null,identity:Vw});new TextEncoder,new TextDecoder;const Wh={...Mm,...zm,...km,...Km,...Gm,...rw,...aw,...uw,...dw,..._w};({...kw,...Bw});function Wl(h){return globalThis.Buffer!=null?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):h}function Gw(h=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Wl(globalThis.Buffer.allocUnsafe(h)):new Uint8Array(h)}function Jl(h,r,i,n){return{name:h,prefix:r,encoder:{name:h,prefix:r,encode:i},decoder:{decode:n}}}const Jh=Jl("utf8","u",h=>"u"+new TextDecoder("utf8").decode(h),h=>new TextEncoder().encode(h.substring(1))),Bo=Jl("ascii","a",h=>{let r="a";for(let i=0;i<h.length;i++)r+=String.fromCharCode(h[i]);return r},h=>{h=h.substring(1);const r=Gw(h.length);for(let i=0;i<h.length;i++)r[i]=h.charCodeAt(i);return r}),Ww={utf8:Jh,"utf-8":Jh,hex:Wh.base16,latin1:Bo,ascii:Bo,binary:Bo,...Wh};function Jw(h,r="utf8"){const i=Ww[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Wl(globalThis.Buffer.from(h,"utf-8")):i.decoder.decode(`${i.prefix}${h}`)}const Ql="wc",Qw=2,vc="core",yr=`${Ql}@2:${vc}:`,Yw={name:vc,logger:"error"},Xw={database:":memory:"},Zw="crypto",Qh="client_ed25519_seed",e_=ie.ONE_DAY,t_="keychain",i_="0.3",r_="messages",s_="0.3",n_=ie.SIX_HOURS,a_="publisher",Yl="irn",o_="error",Xl="wss://relay.walletconnect.com",Yh="wss://relay.walletconnect.org",c_="relayer",Bt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},u_="_subscription",er={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},h_=ie.ONE_SECOND,l_="2.10.1",f_=1e4,p_="0.3",d_="WALLETCONNECT_CLIENT_ID",zi={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},g_="subscription",v_="0.3",y_=ie.FIVE_SECONDS*1e3,m_="pairing",w_="0.3",Ls={wc_pairingDelete:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:0},res:{ttl:ie.ONE_DAY,prompt:!1,tag:0}}},Hs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ji={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},__="history",b_="0.3",E_="expirer",Ii={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},x_="0.3",Go="verify-api",aa="https://verify.walletconnect.com",Xh="https://verify.walletconnect.org";class I_{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=t_,this.version=i_,this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:l}=X("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(l)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Ae.generateChildLogger(i,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,Cl(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Al(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class S_{constructor(r,i,n){this.core=r,this.logger=i,this.name=Zw,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),l=Uh(a);return Ml(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=Ky();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const l=await this.getClientSeed(),d=Uh(l),v=tc();return await wm(v,a,e_,d)},this.generateSharedKey=(a,l,d)=>{this.isInitialized();const v=this.getPrivateKey(a),w=Vy(v,l);return this.setSymKey(w,d)},this.setSymKey=async(a,l)=>{this.isInitialized();const d=l||By(a);return await this.keychain.set(d,a),d},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,l,d)=>{this.isInitialized();const v=Gy(d),w=hc(l);if(_h(v)){const k=v.senderPublicKey,H=v.receiverPublicKey;a=await this.generateSharedKey(k,H)}const I=this.getSymKey(a),{type:F,senderPublicKey:U}=v;return Wy({type:F,symKey:I,message:w,senderPublicKey:U})},this.decode=async(a,l,d)=>{this.isInitialized();const v=Jy(l,d);if(_h(v)){const w=v.receiverPublicKey,I=v.senderPublicKey;a=await this.generateSharedKey(w,I)}try{const w=this.getSymKey(a),I=Qy({symKey:w,encoded:l});return Rl(I)}catch(w){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=a=>{const l=bh(a);return Yy(l.type)},this.getPayloadSenderPublicKey=a=>{const l=bh(a);return l.senderPublicKey?ha(l.senderPublicKey,Xy):void 0},this.core=r,this.logger=Ae.generateChildLogger(i,this.name),this.keychain=n||new I_(this.core,this.logger)}get context(){return Ae.getLoggerContext(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(Qh)}catch{r=tc(),await this.keychain.set(Qh,r)}return Jw(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class P_ extends Y1{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=r_,this.version=s_,this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const l=us(a);let d=this.messages.get(n);return typeof d>"u"&&(d={}),typeof d[l]<"u"||(d[l]=a,this.messages.set(n,d),await this.persist()),l},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const l=this.get(n),d=us(a);return typeof l[d]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ae.generateChildLogger(r,this.name),this.core=i}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,Cl(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Al(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class C_ extends X1{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new Ui.EventEmitter,this.name=a_,this.queue=new Map,this.publishTimeout=ie.toMiliseconds(ie.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,l)=>{var d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:l}});try{const v=(l==null?void 0:l.ttl)||n_,w=ic(l),I=(l==null?void 0:l.prompt)||!1,F=(l==null?void 0:l.tag)||0,U=(l==null?void 0:l.id)||R1().toString(),k={topic:n,message:a,opts:{ttl:v,relay:w,prompt:I,tag:F,id:U}},H=setTimeout(()=>this.queue.set(U,k),this.publishTimeout);try{await await Bs(this.rpcPublish(n,a,v,w,I,F,U),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(U),this.relayer.events.emit(Bt.publish,k)}catch(z){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(d=l==null?void 0:l.internal)!=null&&d.throwOnFailedPublish)throw this.removeRequestFromQueue(U),z;return}finally{clearTimeout(H)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:l}})}catch(v){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(v),v}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=r,this.logger=Ae.generateChildLogger(i,this.name),this.registerEventListeners()}get context(){return Ae.getLoggerContext(this.logger)}rpcPublish(r,i,n,a,l,d,v){var w,I,F,U;const k={method:sa(a.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:l,tag:d},id:v};return vr((w=k.params)==null?void 0:w.prompt)&&((I=k.params)==null||delete I.prompt),vr((F=k.params)==null?void 0:F.tag)&&((U=k.params)==null||delete U.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:k}),this.relayer.request(k)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:a}=r;await this.publish(i,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(ls.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Bt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Bt.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class A_{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const a=n.filter(l=>l!==i);if(!a.length){this.map.delete(r);return}this.map.set(r,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var O_=Object.defineProperty,R_=Object.defineProperties,T_=Object.getOwnPropertyDescriptors,Zh=Object.getOwnPropertySymbols,N_=Object.prototype.hasOwnProperty,F_=Object.prototype.propertyIsEnumerable,el=(h,r,i)=>r in h?O_(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,Ms=(h,r)=>{for(var i in r||(r={}))N_.call(r,i)&&el(h,i,r[i]);if(Zh)for(var i of Zh(r))F_.call(r,i)&&el(h,i,r[i]);return h},Wo=(h,r)=>R_(h,T_(r));class D_ extends tm{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new A_,this.events=new Ui.EventEmitter,this.name=g_,this.version=v_,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=yr,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const l=ic(a),d={topic:n,relay:l};this.pending.set(n,d);const v=await this.rpcSubscribe(n,l);return this.onSubscribe(v,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),v}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,l)=>{const d=new ie.Watch;d.start(this.pendingSubscriptionWatchLabel);const v=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(v),d.stop(this.pendingSubscriptionWatchLabel),a(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=y_&&(clearInterval(v),d.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Ae.generateChildLogger(i,this.name),this.clientId=""}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async a=>await this.unsubscribeById(r,a,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const a=ic(n);await this.rpcUnsubscribe(r,i,a);const l=ei("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(r,i){const n={method:sa(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Bs(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Bt.connection_stalled)}return us(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:sa(i.protocol).batchSubscribe,params:{topics:r.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Bs(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Bt.connection_stalled)}}rpcUnsubscribe(r,i,n){const a={method:sa(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(r,i){this.setSubscription(r,Wo(Ms({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,Ms({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i))}addSubscription(r,i){this.subscriptions.set(r,Ms({},i)),this.topicMap.set(i.topic,r),this.events.emit(zi.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(zi.deleted,Wo(Ms({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(zi.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(zi.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);hs(i)&&this.onBatchSubscribe(i.map((n,a)=>Wo(Ms({},r[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(ls.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Bt.connect,async()=>{await this.onConnect()}),this.relayer.on(Bt.disconnect,()=>{this.onDisconnect()}),this.events.on(zi.created,async r=>{const i=zi.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(zi.deleted,async r=>{const i=zi.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var $_=Object.defineProperty,tl=Object.getOwnPropertySymbols,q_=Object.prototype.hasOwnProperty,L_=Object.prototype.propertyIsEnumerable,il=(h,r,i)=>r in h?$_(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,M_=(h,r)=>{for(var i in r||(r={}))q_.call(r,i)&&il(h,i,r[i]);if(tl)for(var i of tl(r))L_.call(r,i)&&il(h,i,r[i]);return h};class j_ extends Z1{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Ui.EventEmitter,this.name=c_,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async i=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(i)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=i=>{this.onProviderPayload(i)},this.onConnectHandler=()=>{this.events.emit(Bt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=i=>{this.logger.error(i),this.events.emit(Bt.error,i),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(er.payload,this.onPayloadHandler),this.provider.on(er.connect,this.onConnectHandler),this.provider.on(er.disconnect,this.onDisconnectHandler),this.provider.on(er.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Ae.generateChildLogger(r.logger,this.name):Ae.pino(Ae.getDefaultLoggerOptions({level:r.logger||o_})),this.messages=new P_(this.logger,r.core),this.subscriber=new D_(this,this.logger),this.publisher=new C_(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||Xl,this.projectId=r.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Yh}...`),await this.restartTransport(Yh)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},f_)}get context(){return Ae.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";return a||(await Promise.all([new Promise(l=>{this.subscriber.once(zi.created,d=>{d.topic===r&&l()})}),new Promise(async l=>{a=await this.subscriber.subscribe(r,i),l()})]),a)}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Bs(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(i=>{if(!this.initialized)return i();this.subscriber.once(zi.resubscribed,()=>{i()})}),new Promise(async(i,n)=>{try{await Bs(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){n(a);return}i()})])}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i;this.provider.events.emit(er.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Eh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new mr(new xm(Zy({sdkVersion:l_,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const a=this.messages.has(i,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),fc(r)){if(!r.method.endsWith(u_))return;const i=r.params,{topic:n,message:a,publishedAt:l}=i.data,d={topic:n,message:a,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(M_({type:"event",event:i.id},d)),this.events.emit(i.id,d),await this.acknowledgePayload(r),await this.onMessageEvent(d)}else pc(r)&&this.events.emit(Bt.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Bt.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=dc(r.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(er.payload,this.onPayloadHandler),this.provider.off(er.connect,this.onConnectHandler),this.provider.off(er.disconnect,this.onDisconnectHandler),this.provider.off(er.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Bt.connection_stalled,()=>{this.restartTransport().catch(i=>this.logger.error(i))});let r=await Eh();e1(async i=>{this.initialized&&r!==i&&(r=i,i?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Bt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},ie.toMiliseconds(h_)))}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var z_=Object.defineProperty,rl=Object.getOwnPropertySymbols,U_=Object.prototype.hasOwnProperty,k_=Object.prototype.propertyIsEnumerable,sl=(h,r,i)=>r in h?z_(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,nl=(h,r)=>{for(var i in r||(r={}))U_.call(r,i)&&sl(h,i,r[i]);if(rl)for(var i of rl(r))k_.call(r,i)&&sl(h,i,r[i]);return h};class pa extends em{constructor(r,i,n,a=yr,l=void 0){super(r,i,n,a),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=p_,this.cached=[],this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!vr(d)?this.map.set(this.getKey(d),d):ky(d)?this.map.set(d.id,d):Hy(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,v)=>{this.isInitialized(),this.map.has(d)?await this.update(d,v):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:v}),this.map.set(d,v),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(v=>Object.keys(d).every(w=>Sm(v[w],d[w]))):this.values),this.update=async(d,v)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:v});const w=nl(nl({},this.getData(d)),v);this.map.set(d,w),await this.persist()},this.delete=async(d,v)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:v}),this.map.delete(d),await this.persist())},this.logger=Ae.generateChildLogger(i,this.name),this.storagePrefix=a,this.getKey=l}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class H_{constructor(r,i){this.core=r,this.logger=i,this.name=m_,this.version=w_,this.events=new uc,this.initialized=!1,this.storagePrefix=yr,this.ignoredPayloadTypes=[Il],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=tc(),a=await this.core.crypto.setSymKey(n),l=Ti(ie.FIVE_MINUTES),d={protocol:Yl},v={topic:a,expiry:l,relay:d,active:!1},w=t1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:d});return await this.pairings.set(a,v),await this.core.relayer.subscribe(a),this.core.expirer.set(a,l),{topic:a,uri:w}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:l,relay:d}=i1(n.uri);let v;if(this.pairings.keys.includes(a)&&(v=this.pairings.get(a),v.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(l,a),await this.core.relayer.subscribe(a,{relay:d}));const w=Ti(ie.FIVE_MINUTES),I={topic:a,relay:d,expiry:w,active:!1};return await this.pairings.set(a,I),this.core.expirer.set(a,w),n.activatePairing&&await this.activate({topic:a}),this.events.emit(Hs.create,I),I},this.activate=async({topic:n})=>{this.isInitialized();const a=Ti(ie.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const l=await this.sendRequest(a,"wc_pairingPing",{}),{done:d,resolve:v,reject:w}=as();this.events.once(Ft("pairing_ping",l),({error:I})=>{I?w(I):v()}),await d()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",ei("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,l)=>{const d=Vs(a,l),v=await this.core.crypto.encode(n,d),w=Ls[a].req;return this.core.history.set(n,d),this.core.relayer.publish(n,v,w),d.id},this.sendResult=async(n,a,l)=>{const d=dc(n,l),v=await this.core.crypto.encode(a,d),w=await this.core.history.get(a,n),I=Ls[w.request.method].res;await this.core.relayer.publish(a,v,I),await this.core.history.resolve(d)},this.sendError=async(n,a,l)=>{const d=lc(n,l),v=await this.core.crypto.encode(a,d),w=await this.core.history.get(a,n),I=Ls[w.request.method]?Ls[w.request.method].res:Ls.unregistered_method.res;await this.core.relayer.publish(a,v,I),await this.core.history.resolve(d)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,ei("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>gr(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:l}=n;switch(l.method){case"wc_pairingPing":return this.onPairingPingRequest(a,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,l);default:return this.onUnknownRpcMethodRequest(a,l)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:l}=n,d=(await this.core.history.get(a,l.id)).request.method;switch(d){case"wc_pairingPing":return this.onPairingPingResponse(a,l);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(n,a)=>{const{id:l}=a;try{this.isValidPing({topic:n}),await this.sendResult(l,n,!0),this.events.emit(Hs.ping,{id:l,topic:n})}catch(d){await this.sendError(l,n,d),this.logger.error(d)}},this.onPairingPingResponse=(n,a)=>{const{id:l}=a;setTimeout(()=>{dr(a)?this.events.emit(Ft("pairing_ping",l),{}):ir(a)&&this.events.emit(Ft("pairing_ping",l),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:l}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Hs.delete,{id:l,topic:n})}catch(d){await this.sendError(l,n,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:l,method:d}=a;try{if(this.registeredMethods.includes(d))return;const v=ei("WC_METHOD_UNSUPPORTED",d);await this.sendError(l,n,v),this.logger.error(v)}catch(v){await this.sendError(l,n,v),this.logger.error(v)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(ei("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!ci(n)){const{message:a}=X("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(a)}if(!r1(n.uri)){const{message:a}=X("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(a)}},this.isValidPing=async n=>{if(!ci(n)){const{message:l}=X("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(l)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!ci(n)){const{message:l}=X("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(l)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!os(n,!1)){const{message:a}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(gr(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=X("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=r,this.logger=Ae.generateChildLogger(i,this.name),this.pairings=new pa(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ae.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Bt.message,async r=>{const{topic:i,message:n}=r;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(i,n);try{fc(a)?(this.core.history.set(i,a),this.onRelayEventRequest({topic:i,payload:a})):pc(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a}),this.core.history.delete(i,a.id))}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(Ii.expired,async r=>{const{topic:i}=Sl(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(Hs.expire,{topic:i}))})}}class K_ extends Q1{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new Ui.EventEmitter,this.name=__,this.version=b_,this.cached=[],this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:l}),this.records.has(a.id))return;const d={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:l,expiry:Ti(ie.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(ji.created,d)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=ir(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(ji.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(l=>{if(l.topic===n){if(typeof a<"u"&&l.id!==a)return;this.records.delete(l.id),this.events.emit(ji.deleted,l)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ae.generateChildLogger(i,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:Vs(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ji.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(ji.created,r=>{const i=ji.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(ji.updated,r=>{const i=ji.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(ji.deleted,r=>{const i=ji.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.core.heartbeat.on(ls.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{ie.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class V_ extends im{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new Ui.EventEmitter,this.name=E_,this.version=x_,this.cached=[],this.initialized=!1,this.storagePrefix=yr,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const l=this.formatTarget(n),d={target:l,expiry:a};this.expirations.set(l,d),this.checkExpiry(l,d),this.events.emit(Ii.created,{target:l,expiration:d})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),l=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ii.deleted,{target:a,expiration:l})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ae.generateChildLogger(i,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return s1(r);if(typeof r=="number")return n1(r);const{message:i}=X("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ii.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;ie.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(Ii.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(ls.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ii.created,r=>{const i=Ii.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Ii.expired,r=>{const i=Ii.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Ii.deleted,r=>{const i=Ii.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}}}class B_ extends rm{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=Go,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||a1()||!Pl())return;const a=(n==null?void 0:n.verifyUrl)||aa;this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Xh;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const a=(n==null?void 0:n.verifyUrl)||aa;let l;try{l=await this.fetchAttestation(n.attestationId,a)}catch(d){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${a}`),this.logger.info(d),l=await this.fetchAttestation(n.attestationId,Xh)}return l},this.fetchAttestation=async(n,a)=>{this.logger.info(`resolving attestation: ${n} from url: ${a}`);const l=this.startAbortTimer(ie.ONE_SECOND*2),d=await fetch(`${a}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(l),d.status===200?await d.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const a=l=>{l.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),n())};await Promise.race([new Promise(l=>{if(document.getElementById(Go))return l();window.addEventListener("message",a);const d=document.createElement("iframe");d.id=Go,d.src=`${this.verifyUrl}/${this.projectId}`,d.style.display="none",document.body.append(d),this.iframe=d,n=l}),new Promise((l,d)=>setTimeout(()=>{window.removeEventListener("message",a),d("verify iframe load timeout")},ie.toMiliseconds(ie.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ae.generateChildLogger(i,this.name),this.verifyUrl=aa,this.abortController=new AbortController,this.isDevEnv=o1()&&{}.IS_VITEST}get context(){return Ae.getLoggerContext(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ie.toMiliseconds(r))}}var G_=Object.defineProperty,al=Object.getOwnPropertySymbols,W_=Object.prototype.hasOwnProperty,J_=Object.prototype.propertyIsEnumerable,ol=(h,r,i)=>r in h?G_(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,cl=(h,r)=>{for(var i in r||(r={}))W_.call(r,i)&&ol(h,i,r[i]);if(al)for(var i of al(r))J_.call(r,i)&&ol(h,i,r[i]);return h};class yc extends J1{constructor(r){super(r),this.protocol=Ql,this.version=Qw,this.name=vc,this.events=new Ui.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||Xl;const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Yw.logger}));this.logger=Ae.generateChildLogger(i,this.name),this.heartbeat=new ls.HeartBeat,this.crypto=new S_(this,this.logger,r==null?void 0:r.keychain),this.history=new K_(this,this.logger),this.expirer=new V_(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new z1(cl(cl({},Xw),r==null?void 0:r.storageOptions)),this.relayer=new j_({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new H_(this,this.logger),this.verify=new B_(this.projectId||"",this.logger)}static async init(r){const i=new yc(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(d_,n),i}get context(){return Ae.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const Q_=yc,Zl="wc",ef=2,tf="client",mc=`${Zl}@${ef}:${tf}:`,Jo={name:tf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},ul="WALLETCONNECT_DEEPLINK_CHOICE",Y_="proposal",rf="Proposal expired",X_="session",ta=ie.SEVEN_DAYS,Z_="engine",js={wc_sessionPropose:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1115}}},Qo={min:ie.FIVE_MINUTES,max:ie.SEVEN_DAYS},tr={idle:"IDLE",active:"ACTIVE"},eb="request",tb=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var ib=Object.defineProperty,rb=Object.defineProperties,sb=Object.getOwnPropertyDescriptors,hl=Object.getOwnPropertySymbols,nb=Object.prototype.hasOwnProperty,ab=Object.prototype.propertyIsEnumerable,ll=(h,r,i)=>r in h?ib(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,oi=(h,r)=>{for(var i in r||(r={}))nb.call(r,i)&&ll(h,i,r[i]);if(hl)for(var i of hl(r))ab.call(r,i)&&ll(h,i,r[i]);return h},zs=(h,r)=>rb(h,sb(r));class ob extends nm{constructor(r){super(r),this.name=Z_,this.events=new uc,this.initialized=!1,this.ignoredPayloadTypes=[Il],this.requestQueue={state:tr.idle,queue:[]},this.sessionRequestQueue={state:tr.idle,queue:[]},this.requestQueueDelay=ie.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(js)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ie.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{await this.isInitialized();const n=zs(oi({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:l,optionalNamespaces:d,sessionProperties:v,relays:w}=n;let I=a,F,U=!1;if(I&&(U=this.client.core.pairing.pairings.get(I).active),!I||!U){const{topic:pe,uri:ue}=await this.client.core.pairing.create();I=pe,F=ue}const k=await this.client.core.crypto.generateKeyPair(),H=oi({requiredNamespaces:l,optionalNamespaces:d,relays:w??[{protocol:Yl}],proposer:{publicKey:k,metadata:this.client.metadata}},v&&{sessionProperties:v}),{reject:z,resolve:G,done:ae}=as(ie.FIVE_MINUTES,rf);if(this.events.once(Ft("session_connect"),async({error:pe,session:ue})=>{if(pe)z(pe);else if(ue){ue.self.publicKey=k;const he=zs(oi({},ue),{requiredNamespaces:ue.requiredNamespaces,optionalNamespaces:ue.optionalNamespaces});await this.client.session.set(ue.topic,he),await this.setExpiry(ue.topic,ue.expiry),I&&await this.client.core.pairing.updateMetadata({topic:I,metadata:ue.peer.metadata}),G(he)}}),!I){const{message:pe}=X("NO_MATCHING_KEY",`connect() pairing topic: ${I}`);throw new Error(pe)}const be=await this.sendRequest({topic:I,method:"wc_sessionPropose",params:H}),de=Ti(ie.FIVE_MINUTES);return await this.setProposal(be,oi({id:be,expiry:de},H)),{uri:F,approval:ae}},this.pair=async i=>(await this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{await this.isInitialized(),await this.isValidApprove(i);const{id:n,relayProtocol:a,namespaces:l,sessionProperties:d}=i,v=this.client.proposal.get(n);let{pairingTopic:w,proposer:I,requiredNamespaces:F,optionalNamespaces:U}=v;w=w||"",na(F)||(F=u1(l,"approve()"));const k=await this.client.core.crypto.generateKeyPair(),H=I.publicKey,z=await this.client.core.crypto.generateSharedKey(k,H);w&&n&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:I.metadata}),await this.sendResult({id:n,topic:w,result:{relay:{protocol:a??"irn"},responderPublicKey:k}}),await this.client.proposal.delete(n,ei("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const G=oi({relay:{protocol:a??"irn"},namespaces:l,requiredNamespaces:F,optionalNamespaces:U,pairingTopic:w,controller:{publicKey:k,metadata:this.client.metadata},expiry:Ti(ta)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(z),await this.sendRequest({topic:z,method:"wc_sessionSettle",params:G,throwOnFailedPublish:!0});const ae=zs(oi({},G),{topic:z,pairingTopic:w,acknowledged:!1,self:G.controller,peer:{publicKey:I.publicKey,metadata:I.metadata},controller:k});return await this.client.session.set(z,ae),await this.setExpiry(z,Ti(ta)),{topic:z,acknowledged:()=>new Promise(be=>setTimeout(()=>be(this.client.session.get(z)),500))}},this.reject=async i=>{await this.isInitialized(),await this.isValidReject(i);const{id:n,reason:a}=i,{pairingTopic:l}=this.client.proposal.get(n);l&&(await this.sendError(n,l,a),await this.client.proposal.delete(n,ei("USER_DISCONNECTED")))},this.update=async i=>{await this.isInitialized(),await this.isValidUpdate(i);const{topic:n,namespaces:a}=i,l=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:d,resolve:v,reject:w}=as();return this.events.once(Ft("session_update",l),({error:I})=>{I?w(I):v()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:d}},this.extend=async i=>{await this.isInitialized(),await this.isValidExtend(i);const{topic:n}=i,a=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:l,resolve:d,reject:v}=as();return this.events.once(Ft("session_extend",a),({error:w})=>{w?v(w):d()}),await this.setExpiry(n,Ti(ta)),{acknowledged:l}},this.request=async i=>{await this.isInitialized(),await this.isValidRequest(i);const{chainId:n,request:a,topic:l,expiry:d}=i,v=T1(),{done:w,resolve:I,reject:F}=as(d);return this.events.once(Ft("session_request",v),({error:U,result:k})=>{U?F(U):I(k)}),await Promise.all([new Promise(async U=>{await this.sendRequest({clientRpcId:v,topic:l,method:"wc_sessionRequest",params:{request:a,chainId:n},expiry:d,throwOnFailedPublish:!0}).catch(k=>F(k)),this.client.events.emit("session_request_sent",{topic:l,request:a,chainId:n,id:v}),U()}),new Promise(async U=>{const k=await this.client.core.storage.getItem(ul);h1({id:v,topic:l,wcDeepLink:k}),U()}),w()]).then(U=>U[2])},this.respond=async i=>{await this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:a}=i,{id:l}=a;dr(a)?await this.sendResult({id:l,topic:n,result:a.result,throwOnFailedPublish:!0}):ir(a)&&await this.sendError(l,n,a.error),this.cleanupAfterResponse(i)},this.ping=async i=>{await this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const a=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:l,resolve:d,reject:v}=as();this.events.once(Ft("session_ping",a),({error:w})=>{w?v(w):d()}),await l()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{await this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:a,chainId:l}=i;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:a,chainId:l}})},this.disconnect=async i=>{await this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:ei("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>l1(n,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(l=>{var d,v;return((d=l.peerMetadata)==null?void 0:d.url)&&((v=l.peerMetadata)==null?void 0:v.url)===i.peer.metadata.url&&l.topic&&l.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(i,n)=>{const{self:a}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),this.client.session.delete(i,ei("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(ul).catch(l=>this.client.logger.warn(l))},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,ei("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),a?Promise.resolve():this.client.core.expirer.del(i)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(l=>l.id!==i),a&&(this.sessionRequestQueue.state=tr.idle)},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,n.expiry)},this.setPendingSessionRequest=async i=>{const n=js.wc_sessionRequest.req.ttl,{id:a,topic:l,params:d,verifyContext:v}=i;await this.client.pendingRequest.set(a,{id:a,topic:l,params:d,verifyContext:v}),n&&this.client.core.expirer.set(a,Ti(n))},this.sendRequest=async i=>{const{topic:n,method:a,params:l,expiry:d,relayRpcId:v,clientRpcId:w,throwOnFailedPublish:I}=i,F=Vs(a,l,w);if(Pl()&&tb.includes(a)){const H=us(JSON.stringify(F));this.client.core.verify.register({attestationId:H})}const U=await this.client.core.crypto.encode(n,F),k=js[a].req;return d&&(k.ttl=d),v&&(k.id=v),this.client.core.history.set(n,F),I?(k.internal=zs(oi({},k.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,U,k)):this.client.core.relayer.publish(n,U,k).catch(H=>this.client.logger.error(H)),F.id},this.sendResult=async i=>{const{id:n,topic:a,result:l,throwOnFailedPublish:d}=i,v=dc(n,l),w=await this.client.core.crypto.encode(a,v),I=await this.client.core.history.get(a,n),F=js[I.request.method].res;d?(F.internal=zs(oi({},F.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,w,F)):this.client.core.relayer.publish(a,w,F).catch(U=>this.client.logger.error(U)),await this.client.core.history.resolve(v)},this.sendError=async(i,n,a)=>{const l=lc(i,a),d=await this.client.core.crypto.encode(n,l),v=await this.client.core.history.get(n,i),w=js[v.request.method].res;this.client.core.relayer.publish(n,d,w),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(a=>{gr(a.expiry)&&i.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{gr(a.expiry)&&n.push(a.id)}),await Promise.all([...i.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===tr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=tr.active;const i=this.requestQueue.queue.shift();if(i)try{this.processRequest(i),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=tr.idle},this.processRequest=i=>{const{topic:n,payload:a}=i,l=a.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:a}=i,l=(await this.client.core.history.get(n,a.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:a}=X("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(i,n)=>{const{params:a,id:l}=n;try{this.isValidConnect(oi({},n.params));const d=Ti(ie.FIVE_MINUTES),v=oi({id:l,pairingTopic:i,expiry:d},a);await this.setProposal(l,v);const w=us(JSON.stringify(n)),I=await this.getVerifyContext(w,v.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:v,verifyContext:I})}catch(d){await this.sendError(l,i,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(i,n)=>{const{id:a}=n;if(dr(n)){const{result:l}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const d=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const v=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:v});const w=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const I=await this.client.core.crypto.generateSharedKey(v,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:I});const F=await this.client.core.relayer.subscribe(I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:F}),await this.client.core.pairing.activate({topic:i})}else ir(n)&&(await this.client.proposal.delete(a,ei("USER_DISCONNECTED")),this.events.emit(Ft("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(i,n)=>{const{id:a,params:l}=n;try{this.isValidSessionSettleRequest(l);const{relay:d,controller:v,expiry:w,namespaces:I,requiredNamespaces:F,optionalNamespaces:U,sessionProperties:k,pairingTopic:H}=n.params,z=oi({topic:i,relay:d,expiry:w,namespaces:I,acknowledged:!0,pairingTopic:H,requiredNamespaces:F,optionalNamespaces:U,controller:v.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:v.publicKey,metadata:v.metadata}},k&&{sessionProperties:k});await this.sendResult({id:n.id,topic:i,result:!0}),this.events.emit(Ft("session_connect"),{session:z}),this.cleanupDuplicatePairings(z)}catch(d){await this.sendError(a,i,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(i,n)=>{const{id:a}=n;dr(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(Ft("session_approve",a),{})):ir(n)&&(await this.client.session.delete(i,ei("USER_DISCONNECTED")),this.events.emit(Ft("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:a,id:l}=n;try{const d=`${i}_session_update`,v=ea.get(d);if(v&&this.isRequestOutOfSync(v,l)){this.client.logger.info(`Discarding out of sync request - ${l}`);return}this.isValidUpdate(oi({topic:i},a)),await this.client.session.update(i,{namespaces:a.namespaces}),await this.sendResult({id:l,topic:i,result:!0}),this.client.events.emit("session_update",{id:l,topic:i,params:a}),ea.set(d,l)}catch(d){await this.sendError(l,i,d),this.client.logger.error(d)}},this.isRequestOutOfSync=(i,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(i.toString().slice(0,-3)),this.onSessionUpdateResponse=(i,n)=>{const{id:a}=n;dr(n)?this.events.emit(Ft("session_update",a),{}):ir(n)&&this.events.emit(Ft("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:a}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,Ti(ta)),await this.sendResult({id:a,topic:i,result:!0}),this.client.events.emit("session_extend",{id:a,topic:i})}catch(l){await this.sendError(a,i,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(i,n)=>{const{id:a}=n;dr(n)?this.events.emit(Ft("session_extend",a),{}):ir(n)&&this.events.emit(Ft("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:a}=n;try{this.isValidPing({topic:i}),await this.sendResult({id:a,topic:i,result:!0}),this.client.events.emit("session_ping",{id:a,topic:i})}catch(l){await this.sendError(a,i,l),this.client.logger.error(l)}},this.onSessionPingResponse=(i,n)=>{const{id:a}=n;setTimeout(()=>{dr(n)?this.events.emit(Ft("session_ping",a),{}):ir(n)&&this.events.emit(Ft("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(Bt.publish,async()=>{l(await this.deleteSession(i))})}),this.sendResult({id:a,topic:i,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:i})}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(i,n)=>{const{id:a,params:l}=n;try{this.isValidRequest(oi({topic:i},l));const d=us(JSON.stringify(Vs("wc_sessionRequest",l,a))),v=this.client.session.get(i),w=await this.getVerifyContext(d,v.peer.metadata),I={id:a,topic:i,params:l,verifyContext:w};await this.setPendingSessionRequest(I),this.addSessionRequestToSessionRequestQueue(I),this.processSessionRequestQueue()}catch(d){await this.sendError(a,i,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(i,n)=>{const{id:a}=n;dr(n)?this.events.emit(Ft("session_request",a),{result:n.result}):ir(n)&&this.events.emit(Ft("session_request",a),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:a,params:l}=n;try{const d=`${i}_session_event_${l.event.name}`,v=ea.get(d);if(v&&this.isRequestOutOfSync(v,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(oi({topic:i},l)),this.client.events.emit("session_event",{id:a,topic:i,params:l}),ea.set(d,a)}catch(d){await this.sendError(a,i,d),this.client.logger.error(d)}},this.addSessionRequestToSessionRequestQueue=i=>{this.sessionRequestQueue.queue.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=tr.idle,this.processSessionRequestQueue()},ie.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===tr.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=tr.active,this.client.events.emit("session_request",i)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=i=>{if(i.active)return;const n=this.client.proposal.getAll().find(a=>a.pairingTopic===i.topic);n&&this.onSessionProposeRequest(i.topic,Vs("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async i=>{if(!ci(i)){const{message:w}=X("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(w)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:l,sessionProperties:d,relays:v}=i;if(vr(n)||await this.isValidPairingTopic(n),!f1(v,!0)){const{message:w}=X("MISSING_OR_INVALID",`connect() relays: ${v}`);throw new Error(w)}!vr(a)&&na(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!vr(l)&&na(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),vr(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(i,n)=>{const a=p1(i,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async i=>{if(!ci(i))throw new Error(X("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:a,relayProtocol:l,sessionProperties:d}=i;await this.isValidProposalId(n);const v=this.client.proposal.get(n),w=jo(a,"approve()");if(w)throw new Error(w.message);const I=xh(v.requiredNamespaces,a,"approve()");if(I)throw new Error(I.message);if(!os(l,!0)){const{message:F}=X("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(F)}vr(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async i=>{if(!ci(i)){const{message:l}=X("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(l)}const{id:n,reason:a}=i;if(await this.isValidProposalId(n),!d1(a)){const{message:l}=X("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidSessionSettleRequest=i=>{if(!ci(i)){const{message:I}=X("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(I)}const{relay:n,controller:a,namespaces:l,expiry:d}=i;if(!g1(n)){const{message:I}=X("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(I)}const v=v1(a,"onSessionSettleRequest()");if(v)throw new Error(v.message);const w=jo(l,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(gr(d)){const{message:I}=X("EXPIRED","onSessionSettleRequest()");throw new Error(I)}},this.isValidUpdate=async i=>{if(!ci(i)){const{message:w}=X("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(w)}const{topic:n,namespaces:a}=i;await this.isValidSessionTopic(n);const l=this.client.session.get(n),d=jo(a,"update()");if(d)throw new Error(d.message);const v=xh(l.requiredNamespaces,a,"update()");if(v)throw new Error(v.message)},this.isValidExtend=async i=>{if(!ci(i)){const{message:a}=X("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(a)}const{topic:n}=i;await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!ci(i)){const{message:w}=X("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(w)}const{topic:n,request:a,chainId:l,expiry:d}=i;await this.isValidSessionTopic(n);const{namespaces:v}=this.client.session.get(n);if(!Ih(v,l)){const{message:w}=X("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(w)}if(!y1(a)){const{message:w}=X("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(w)}if(!m1(v,l,a.method)){const{message:w}=X("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(w)}if(d&&!w1(d,Qo)){const{message:w}=X("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${Qo.min} and ${Qo.max}`);throw new Error(w)}},this.isValidRespond=async i=>{if(!ci(i)){const{message:l}=X("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(l)}const{topic:n,response:a}=i;if(await this.isValidSessionTopic(n),!_1(a)){const{message:l}=X("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidPing=async i=>{if(!ci(i)){const{message:a}=X("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(a)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!ci(i)){const{message:v}=X("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(v)}const{topic:n,event:a,chainId:l}=i;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!Ih(d,l)){const{message:v}=X("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(v)}if(!b1(a)){const{message:v}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}if(!E1(d,l,a.name)){const{message:v}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}},this.isValidDisconnect=async i=>{if(!ci(i)){const{message:a}=X("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(a)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(i,n)=>{const a={verified:{verifyUrl:n.verifyUrl||aa,validation:"UNKNOWN",origin:n.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});l&&(a.verified.origin=l.origin,a.verified.isScam=l.isScam,a.verified.validation=l.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.info(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(a=>{if(!os(a,!1)){const{message:l}=X("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(l)}})}}async isInitialized(){if(!this.initialized){const{message:r}=X("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Bt.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(i,n);try{fc(a)?(this.client.core.history.set(i,a),this.onRelayEventRequest({topic:i,payload:a})):pc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a}),this.client.core.history.delete(i,a.id)):this.onRelayEventUnknownPayload({topic:i,payload:a})}catch(l){this.client.logger.error(l)}})}registerExpirerEvents(){this.client.core.expirer.on(Ii.expired,async r=>{const{topic:i,id:n}=Sl(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,X("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Hs.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!os(r,!1)){const{message:i}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(gr(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=X("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!os(r,!1)){const{message:i}=X("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(!this.client.session.keys.includes(r)){const{message:i}=X("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(gr(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:i}=X("EXPIRED",`session topic: ${r}`);throw new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(os(r,!1)){const{message:i}=X("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=X("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!x1(r)){const{message:i}=X("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=X("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(gr(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:i}=X("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class cb extends pa{constructor(r,i){super(r,i,Y_,mc),this.core=r,this.logger=i}}class ub extends pa{constructor(r,i){super(r,i,X_,mc),this.core=r,this.logger=i}}class hb extends pa{constructor(r,i){super(r,i,eb,mc,n=>n.id),this.core=r,this.logger=i}}let lb=class sf extends sm{constructor(r){super(r),this.protocol=Zl,this.version=ef,this.name=Jo.name,this.events=new Ui.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(r==null?void 0:r.name)||Jo.name,this.metadata=(r==null?void 0:r.metadata)||c1();const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Jo.logger}));this.core=(r==null?void 0:r.core)||new Q_(r),this.logger=Ae.generateChildLogger(i,this.name),this.session=new ub(this.core,this.logger),this.proposal=new cb(this.core,this.logger),this.pendingRequest=new hb(this.core,this.logger),this.engine=new ob(this)}static async init(r){const i=new sf(r);return await i.initialize(),i}get context(){return Ae.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};const fl="error",fb="wss://relay.walletconnect.com",pb="wc",db="universal_provider",pl=`${pb}@2:${db}:`,gb="https://rpc.walletconnect.com/v1/",wr={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Us=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},nc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(h,r){(function(){var i,n="4.17.21",a=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",v="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",I=500,F="__lodash_placeholder__",U=1,k=2,H=4,z=1,G=2,ae=1,be=2,de=4,pe=8,ue=16,he=32,R=64,M=128,W=256,ge=512,te=30,Ee="...",Oe=800,et=16,C=1,$=2,je=3,Re=1/0,J=9007199254740991,K=17976931348623157e292,j=0/0,V=4294967295,ct=V-1,ke=V>>>1,Ni=[["ary",M],["bind",ae],["bindKey",be],["curry",pe],["curryRight",ue],["flip",ge],["partial",he],["partialRight",R],["rearg",W]],we="[object Arguments]",xt="[object Array]",O="[object AsyncFunction]",A="[object Boolean]",S="[object Date]",c="[object DOMException]",_="[object Error]",Z="[object Function]",oe="[object GeneratorFunction]",ye="[object Map]",Te="[object Number]",Fe="[object Null]",Ie="[object Object]",It="[object Promise]",yt="[object Proxy]",st="[object RegExp]",$e="[object Set]",Je="[object String]",Qe="[object Symbol]",nt="[object Undefined]",ze="[object WeakMap]",Ye="[object WeakSet]",Ne="[object ArrayBuffer]",He="[object DataView]",ut="[object Float32Array]",Le="[object Float64Array]",St="[object Int8Array]",Dt="[object Int16Array]",zt="[object Int32Array]",Ut="[object Uint8Array]",Lt="[object Uint8ClampedArray]",Gt="[object Uint16Array]",ti="[object Uint32Array]",Fi=/\b__p \+= '';/g,Wt=/\b(__p \+=) '' \+/g,ki=/(__e\(.*?\)|\b__t\)) \+\n'';/g,rr=/&(?:amp|lt|gt|quot|#39);/g,_r=/[&<>"']/g,ht=RegExp(rr.source),tt=RegExp(_r.source),lt=/<%-([\s\S]+?)%>/g,ft=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,it=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(pt.source),dt=/^\s+/,mt=/\s/,gt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Ot=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,da=/[()=,{}\[\]\/\s]/,ga=/\\(\\)?/g,va=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gi=/\w*$/,ya=/^[-+]0x[0-9a-f]+$/i,ma=/^0b[01]+$/i,wa=/^\[object .+?Constructor\]$/,_a=/^0o[0-7]+$/i,ba=/^(?:0|[1-9]\d*)$/,Hi=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,zr=/($^)/,Ea=/['\n\r\u2028\u2029\\]/g,Ur="\\ud800-\\udfff",xa="\\u0300-\\u036f",Ia="\\ufe20-\\ufe2f",kr="\\u20d0-\\u20ff",Js=xa+Ia+kr,Qs="\\u2700-\\u27bf",Si="a-z\\xdf-\\xf6\\xf8-\\xff",Sa="\\xac\\xb1\\xd7\\xf7",Pa="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ca="\\u2000-\\u206f",Aa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ys="A-Z\\xc0-\\xd6\\xd8-\\xde",Xs="\\ufe0e\\ufe0f",br=Sa+Pa+Ca+Aa,ps="['’]",Er="["+Ur+"]",ds="["+br+"]",xr="["+Js+"]",Zs="\\d+",Oa="["+Qs+"]",en="["+Si+"]",tn="[^"+Ur+br+Zs+Qs+Si+Ys+"]",Hr="\\ud83c[\\udffb-\\udfff]",Ra="(?:"+xr+"|"+Hr+")",rn="[^"+Ur+"]",Kr="(?:\\ud83c[\\udde6-\\uddff]){2}",sr="[\\ud800-\\udbff][\\udc00-\\udfff]",ui="["+Ys+"]",sn="\\u200d",nn="(?:"+en+"|"+tn+")",Di="(?:"+ui+"|"+tn+")",an="(?:"+ps+"(?:d|ll|m|re|s|t|ve))?",on="(?:"+ps+"(?:D|LL|M|RE|S|T|VE))?",cn=Ra+"?",un="["+Xs+"]?",Ta="(?:"+sn+"(?:"+[rn,Kr,sr].join("|")+")"+un+cn+")*",Ki="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",hn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ln=un+cn+Ta,Vr="(?:"+[Oa,Kr,sr].join("|")+")"+ln,Na="(?:"+[rn+xr+"?",xr,Kr,sr,Er].join("|")+")",gs=RegExp(ps,"g"),Fa=RegExp(xr,"g"),Br=RegExp(Hr+"(?="+Hr+")|"+Na+ln,"g"),fn=RegExp([ui+"?"+en+"+"+an+"(?="+[ds,ui,"$"].join("|")+")",Di+"+"+on+"(?="+[ds,ui+nn,"$"].join("|")+")",ui+"?"+nn+"+"+an,ui+"+"+on,hn,Ki,Zs,Vr].join("|"),"g"),pn=RegExp("["+sn+Ur+Js+Xs+"]"),Ir=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,dn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Da=-1,Ke={};Ke[ut]=Ke[Le]=Ke[St]=Ke[Dt]=Ke[zt]=Ke[Ut]=Ke[Lt]=Ke[Gt]=Ke[ti]=!0,Ke[we]=Ke[xt]=Ke[Ne]=Ke[A]=Ke[He]=Ke[S]=Ke[_]=Ke[Z]=Ke[ye]=Ke[Te]=Ke[Ie]=Ke[st]=Ke[$e]=Ke[Je]=Ke[ze]=!1;var Ue={};Ue[we]=Ue[xt]=Ue[Ne]=Ue[He]=Ue[A]=Ue[S]=Ue[ut]=Ue[Le]=Ue[St]=Ue[Dt]=Ue[zt]=Ue[ye]=Ue[Te]=Ue[Ie]=Ue[st]=Ue[$e]=Ue[Je]=Ue[Qe]=Ue[Ut]=Ue[Lt]=Ue[Gt]=Ue[ti]=!0,Ue[_]=Ue[Z]=Ue[ze]=!1;var g={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},q={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,le=parseInt,Xe=typeof Us=="object"&&Us&&Us.Object===Object&&Us,Tt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Xe||Tt||Function("return this")(),Be=r&&!r.nodeType&&r,wt=Be&&!0&&h&&!h.nodeType&&h,ii=wt&&wt.exports===Be,Nt=ii&&Xe.process,Ze=function(){try{var E=wt&&wt.require&&wt.require("util").types;return E||Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),Jt=Ze&&Ze.isArrayBuffer,Pi=Ze&&Ze.isDate,vi=Ze&&Ze.isMap,$i=Ze&&Ze.isRegExp,vs=Ze&&Ze.isSet,Sr=Ze&&Ze.isTypedArray;function Mt(E,T,P){switch(P.length){case 0:return E.call(T);case 1:return E.call(T,P[0]);case 2:return E.call(T,P[0],P[1]);case 3:return E.call(T,P[0],P[1],P[2])}return E.apply(T,P)}function of(E,T,P,Y){for(var ce=-1,De=E==null?0:E.length;++ce<De;){var $t=E[ce];T(Y,$t,P($t),E)}return Y}function yi(E,T){for(var P=-1,Y=E==null?0:E.length;++P<Y&&T(E[P],P,E)!==!1;);return E}function cf(E,T){for(var P=E==null?0:E.length;P--&&T(E[P],P,E)!==!1;);return E}function bc(E,T){for(var P=-1,Y=E==null?0:E.length;++P<Y;)if(!T(E[P],P,E))return!1;return!0}function nr(E,T){for(var P=-1,Y=E==null?0:E.length,ce=0,De=[];++P<Y;){var $t=E[P];T($t,P,E)&&(De[ce++]=$t)}return De}function gn(E,T){var P=E==null?0:E.length;return!!P&&Gr(E,T,0)>-1}function $a(E,T,P){for(var Y=-1,ce=E==null?0:E.length;++Y<ce;)if(P(T,E[Y]))return!0;return!1}function rt(E,T){for(var P=-1,Y=E==null?0:E.length,ce=Array(Y);++P<Y;)ce[P]=T(E[P],P,E);return ce}function ar(E,T){for(var P=-1,Y=T.length,ce=E.length;++P<Y;)E[ce+P]=T[P];return E}function qa(E,T,P,Y){var ce=-1,De=E==null?0:E.length;for(Y&&De&&(P=E[++ce]);++ce<De;)P=T(P,E[ce],ce,E);return P}function uf(E,T,P,Y){var ce=E==null?0:E.length;for(Y&&ce&&(P=E[--ce]);ce--;)P=T(P,E[ce],ce,E);return P}function La(E,T){for(var P=-1,Y=E==null?0:E.length;++P<Y;)if(T(E[P],P,E))return!0;return!1}var hf=Ma("length");function lf(E){return E.split("")}function ff(E){return E.match(Rt)||[]}function Ec(E,T,P){var Y;return P(E,function(ce,De,$t){if(T(ce,De,$t))return Y=De,!1}),Y}function vn(E,T,P,Y){for(var ce=E.length,De=P+(Y?1:-1);Y?De--:++De<ce;)if(T(E[De],De,E))return De;return-1}function Gr(E,T,P){return T===T?If(E,T,P):vn(E,xc,P)}function pf(E,T,P,Y){for(var ce=P-1,De=E.length;++ce<De;)if(Y(E[ce],T))return ce;return-1}function xc(E){return E!==E}function Ic(E,T){var P=E==null?0:E.length;return P?za(E,T)/P:j}function Ma(E){return function(T){return T==null?i:T[E]}}function ja(E){return function(T){return E==null?i:E[T]}}function Sc(E,T,P,Y,ce){return ce(E,function(De,$t,Ge){P=Y?(Y=!1,De):T(P,De,$t,Ge)}),P}function df(E,T){var P=E.length;for(E.sort(T);P--;)E[P]=E[P].value;return E}function za(E,T){for(var P,Y=-1,ce=E.length;++Y<ce;){var De=T(E[Y]);De!==i&&(P=P===i?De:P+De)}return P}function Ua(E,T){for(var P=-1,Y=Array(E);++P<E;)Y[P]=T(P);return Y}function gf(E,T){return rt(T,function(P){return[P,E[P]]})}function Pc(E){return E&&E.slice(0,Rc(E)+1).replace(dt,"")}function hi(E){return function(T){return E(T)}}function ka(E,T){return rt(T,function(P){return E[P]})}function ys(E,T){return E.has(T)}function Cc(E,T){for(var P=-1,Y=E.length;++P<Y&&Gr(T,E[P],0)>-1;);return P}function Ac(E,T){for(var P=E.length;P--&&Gr(T,E[P],0)>-1;);return P}function vf(E,T){for(var P=E.length,Y=0;P--;)E[P]===T&&++Y;return Y}var yf=ja(g),mf=ja(b);function wf(E){return"\\"+Q[E]}function _f(E,T){return E==null?i:E[T]}function Wr(E){return pn.test(E)}function bf(E){return Ir.test(E)}function Ef(E){for(var T,P=[];!(T=E.next()).done;)P.push(T.value);return P}function Ha(E){var T=-1,P=Array(E.size);return E.forEach(function(Y,ce){P[++T]=[ce,Y]}),P}function Oc(E,T){return function(P){return E(T(P))}}function or(E,T){for(var P=-1,Y=E.length,ce=0,De=[];++P<Y;){var $t=E[P];($t===T||$t===F)&&(E[P]=F,De[ce++]=P)}return De}function yn(E){var T=-1,P=Array(E.size);return E.forEach(function(Y){P[++T]=Y}),P}function xf(E){var T=-1,P=Array(E.size);return E.forEach(function(Y){P[++T]=[Y,Y]}),P}function If(E,T,P){for(var Y=P-1,ce=E.length;++Y<ce;)if(E[Y]===T)return Y;return-1}function Sf(E,T,P){for(var Y=P+1;Y--;)if(E[Y]===T)return Y;return Y}function Jr(E){return Wr(E)?Cf(E):hf(E)}function Ci(E){return Wr(E)?Af(E):lf(E)}function Rc(E){for(var T=E.length;T--&&mt.test(E.charAt(T)););return T}var Pf=ja(q);function Cf(E){for(var T=Br.lastIndex=0;Br.test(E);)++T;return T}function Af(E){return E.match(Br)||[]}function Of(E){return E.match(fn)||[]}var Rf=function E(T){T=T==null?Pe:Qr.defaults(Pe.Object(),T,Qr.pick(Pe,dn));var P=T.Array,Y=T.Date,ce=T.Error,De=T.Function,$t=T.Math,Ge=T.Object,Ka=T.RegExp,Tf=T.String,mi=T.TypeError,mn=P.prototype,Nf=De.prototype,Yr=Ge.prototype,wn=T["__core-js_shared__"],_n=Nf.toString,Me=Yr.hasOwnProperty,Ff=0,Tc=function(){var e=/[^.]+$/.exec(wn&&wn.keys&&wn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),bn=Yr.toString,Df=_n.call(Ge),$f=Pe._,qf=Ka("^"+_n.call(Me).replace(pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),En=ii?T.Buffer:i,cr=T.Symbol,xn=T.Uint8Array,Nc=En?En.allocUnsafe:i,In=Oc(Ge.getPrototypeOf,Ge),Fc=Ge.create,Dc=Yr.propertyIsEnumerable,Sn=mn.splice,$c=cr?cr.isConcatSpreadable:i,ms=cr?cr.iterator:i,Pr=cr?cr.toStringTag:i,Pn=function(){try{var e=Tr(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),Lf=T.clearTimeout!==Pe.clearTimeout&&T.clearTimeout,Mf=Y&&Y.now!==Pe.Date.now&&Y.now,jf=T.setTimeout!==Pe.setTimeout&&T.setTimeout,Cn=$t.ceil,An=$t.floor,Va=Ge.getOwnPropertySymbols,zf=En?En.isBuffer:i,qc=T.isFinite,Uf=mn.join,kf=Oc(Ge.keys,Ge),qt=$t.max,Kt=$t.min,Hf=Y.now,Kf=T.parseInt,Lc=$t.random,Vf=mn.reverse,Ba=Tr(T,"DataView"),ws=Tr(T,"Map"),Ga=Tr(T,"Promise"),Xr=Tr(T,"Set"),_s=Tr(T,"WeakMap"),bs=Tr(Ge,"create"),On=_s&&new _s,Zr={},Bf=Nr(Ba),Gf=Nr(ws),Wf=Nr(Ga),Jf=Nr(Xr),Qf=Nr(_s),Rn=cr?cr.prototype:i,Es=Rn?Rn.valueOf:i,Mc=Rn?Rn.toString:i;function f(e){if(vt(e)&&!fe(e)&&!(e instanceof Se)){if(e instanceof wi)return e;if(Me.call(e,"__wrapped__"))return ju(e)}return new wi(e)}var es=function(){function e(){}return function(t){if(!ot(t))return{};if(Fc)return Fc(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function Tn(){}function wi(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}f.templateSettings={escape:lt,evaluate:ft,interpolate:at,variable:"",imports:{_:f}},f.prototype=Tn.prototype,f.prototype.constructor=f,wi.prototype=es(Tn.prototype),wi.prototype.constructor=wi;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function Yf(){var e=new Se(this.__wrapped__);return e.__actions__=ri(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ri(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ri(this.__views__),e}function Xf(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Zf(){var e=this.__wrapped__.value(),t=this.__dir__,s=fe(e),o=t<0,u=s?e.length:0,p=ld(0,u,this.__views__),y=p.start,m=p.end,x=m-y,N=o?m:y-1,D=this.__iteratees__,L=D.length,B=0,ee=Kt(x,this.__takeCount__);if(!s||!o&&u==x&&ee==x)return cu(e,this.__actions__);var se=[];e:for(;x--&&B<ee;){N+=t;for(var me=-1,ne=e[N];++me<L;){var xe=D[me],Ce=xe.iteratee,pi=xe.type,Xt=Ce(ne);if(pi==$)ne=Xt;else if(!Xt){if(pi==C)continue e;break e}}se[B++]=ne}return se}Se.prototype=es(Tn.prototype),Se.prototype.constructor=Se;function Cr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function ep(){this.__data__=bs?bs(null):{},this.size=0}function tp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function ip(e){var t=this.__data__;if(bs){var s=t[e];return s===w?i:s}return Me.call(t,e)?t[e]:i}function rp(e){var t=this.__data__;return bs?t[e]!==i:Me.call(t,e)}function sp(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=bs&&t===i?w:t,this}Cr.prototype.clear=ep,Cr.prototype.delete=tp,Cr.prototype.get=ip,Cr.prototype.has=rp,Cr.prototype.set=sp;function Vi(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function np(){this.__data__=[],this.size=0}function ap(e){var t=this.__data__,s=Nn(t,e);if(s<0)return!1;var o=t.length-1;return s==o?t.pop():Sn.call(t,s,1),--this.size,!0}function op(e){var t=this.__data__,s=Nn(t,e);return s<0?i:t[s][1]}function cp(e){return Nn(this.__data__,e)>-1}function up(e,t){var s=this.__data__,o=Nn(s,e);return o<0?(++this.size,s.push([e,t])):s[o][1]=t,this}Vi.prototype.clear=np,Vi.prototype.delete=ap,Vi.prototype.get=op,Vi.prototype.has=cp,Vi.prototype.set=up;function Bi(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function hp(){this.size=0,this.__data__={hash:new Cr,map:new(ws||Vi),string:new Cr}}function lp(e){var t=Kn(this,e).delete(e);return this.size-=t?1:0,t}function fp(e){return Kn(this,e).get(e)}function pp(e){return Kn(this,e).has(e)}function dp(e,t){var s=Kn(this,e),o=s.size;return s.set(e,t),this.size+=s.size==o?0:1,this}Bi.prototype.clear=hp,Bi.prototype.delete=lp,Bi.prototype.get=fp,Bi.prototype.has=pp,Bi.prototype.set=dp;function Ar(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Bi;++t<s;)this.add(e[t])}function gp(e){return this.__data__.set(e,w),this}function vp(e){return this.__data__.has(e)}Ar.prototype.add=Ar.prototype.push=gp,Ar.prototype.has=vp;function Ai(e){var t=this.__data__=new Vi(e);this.size=t.size}function yp(){this.__data__=new Vi,this.size=0}function mp(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function wp(e){return this.__data__.get(e)}function _p(e){return this.__data__.has(e)}function bp(e,t){var s=this.__data__;if(s instanceof Vi){var o=s.__data__;if(!ws||o.length<a-1)return o.push([e,t]),this.size=++s.size,this;s=this.__data__=new Bi(o)}return s.set(e,t),this.size=s.size,this}Ai.prototype.clear=yp,Ai.prototype.delete=mp,Ai.prototype.get=wp,Ai.prototype.has=_p,Ai.prototype.set=bp;function jc(e,t){var s=fe(e),o=!s&&Fr(e),u=!s&&!o&&pr(e),p=!s&&!o&&!u&&ss(e),y=s||o||u||p,m=y?Ua(e.length,Tf):[],x=m.length;for(var N in e)(t||Me.call(e,N))&&!(y&&(N=="length"||u&&(N=="offset"||N=="parent")||p&&(N=="buffer"||N=="byteLength"||N=="byteOffset")||Qi(N,x)))&&m.push(N);return m}function zc(e){var t=e.length;return t?e[so(0,t-1)]:i}function Ep(e,t){return Vn(ri(e),Or(t,0,e.length))}function xp(e){return Vn(ri(e))}function Wa(e,t,s){(s!==i&&!Oi(e[t],s)||s===i&&!(t in e))&&Gi(e,t,s)}function xs(e,t,s){var o=e[t];(!(Me.call(e,t)&&Oi(o,s))||s===i&&!(t in e))&&Gi(e,t,s)}function Nn(e,t){for(var s=e.length;s--;)if(Oi(e[s][0],t))return s;return-1}function Ip(e,t,s,o){return ur(e,function(u,p,y){t(o,u,s(u),y)}),o}function Uc(e,t){return e&&Li(t,jt(t),e)}function Sp(e,t){return e&&Li(t,ni(t),e)}function Gi(e,t,s){t=="__proto__"&&Pn?Pn(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function Ja(e,t){for(var s=-1,o=t.length,u=P(o),p=e==null;++s<o;)u[s]=p?i:Ro(e,t[s]);return u}function Or(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function _i(e,t,s,o,u,p){var y,m=t&U,x=t&k,N=t&H;if(s&&(y=u?s(e,o,u,p):s(e)),y!==i)return y;if(!ot(e))return e;var D=fe(e);if(D){if(y=pd(e),!m)return ri(e,y)}else{var L=Vt(e),B=L==Z||L==oe;if(pr(e))return lu(e,m);if(L==Ie||L==we||B&&!u){if(y=x||B?{}:Ru(e),!m)return x?id(e,Sp(y,e)):td(e,Uc(y,e))}else{if(!Ue[L])return u?e:{};y=dd(e,L,m)}}p||(p=new Ai);var ee=p.get(e);if(ee)return ee;p.set(e,y),nh(e)?e.forEach(function(ne){y.add(_i(ne,t,s,ne,e,p))}):rh(e)&&e.forEach(function(ne,xe){y.set(xe,_i(ne,t,s,xe,e,p))});var se=N?x?vo:go:x?ni:jt,me=D?i:se(e);return yi(me||e,function(ne,xe){me&&(xe=ne,ne=e[xe]),xs(y,xe,_i(ne,t,s,xe,e,p))}),y}function Pp(e){var t=jt(e);return function(s){return kc(s,e,t)}}function kc(e,t,s){var o=s.length;if(e==null)return!o;for(e=Ge(e);o--;){var u=s[o],p=t[u],y=e[u];if(y===i&&!(u in e)||!p(y))return!1}return!0}function Hc(e,t,s){if(typeof e!="function")throw new mi(d);return Rs(function(){e.apply(i,s)},t)}function Is(e,t,s,o){var u=-1,p=gn,y=!0,m=e.length,x=[],N=t.length;if(!m)return x;s&&(t=rt(t,hi(s))),o?(p=$a,y=!1):t.length>=a&&(p=ys,y=!1,t=new Ar(t));e:for(;++u<m;){var D=e[u],L=s==null?D:s(D);if(D=o||D!==0?D:0,y&&L===L){for(var B=N;B--;)if(t[B]===L)continue e;x.push(D)}else p(t,L,o)||x.push(D)}return x}var ur=vu(qi),Kc=vu(Ya,!0);function Cp(e,t){var s=!0;return ur(e,function(o,u,p){return s=!!t(o,u,p),s}),s}function Fn(e,t,s){for(var o=-1,u=e.length;++o<u;){var p=e[o],y=t(p);if(y!=null&&(m===i?y===y&&!fi(y):s(y,m)))var m=y,x=p}return x}function Ap(e,t,s,o){var u=e.length;for(s=ve(s),s<0&&(s=-s>u?0:u+s),o=o===i||o>u?u:ve(o),o<0&&(o+=u),o=s>o?0:oh(o);s<o;)e[s++]=t;return e}function Vc(e,t){var s=[];return ur(e,function(o,u,p){t(o,u,p)&&s.push(o)}),s}function kt(e,t,s,o,u){var p=-1,y=e.length;for(s||(s=vd),u||(u=[]);++p<y;){var m=e[p];t>0&&s(m)?t>1?kt(m,t-1,s,o,u):ar(u,m):o||(u[u.length]=m)}return u}var Qa=yu(),Bc=yu(!0);function qi(e,t){return e&&Qa(e,t,jt)}function Ya(e,t){return e&&Bc(e,t,jt)}function Dn(e,t){return nr(t,function(s){return Yi(e[s])})}function Rr(e,t){t=lr(t,e);for(var s=0,o=t.length;e!=null&&s<o;)e=e[Mi(t[s++])];return s&&s==o?e:i}function Gc(e,t,s){var o=t(e);return fe(e)?o:ar(o,s(e))}function Qt(e){return e==null?e===i?nt:Fe:Pr&&Pr in Ge(e)?hd(e):xd(e)}function Xa(e,t){return e>t}function Op(e,t){return e!=null&&Me.call(e,t)}function Rp(e,t){return e!=null&&t in Ge(e)}function Tp(e,t,s){return e>=Kt(t,s)&&e<qt(t,s)}function Za(e,t,s){for(var o=s?$a:gn,u=e[0].length,p=e.length,y=p,m=P(p),x=1/0,N=[];y--;){var D=e[y];y&&t&&(D=rt(D,hi(t))),x=Kt(D.length,x),m[y]=!s&&(t||u>=120&&D.length>=120)?new Ar(y&&D):i}D=e[0];var L=-1,B=m[0];e:for(;++L<u&&N.length<x;){var ee=D[L],se=t?t(ee):ee;if(ee=s||ee!==0?ee:0,!(B?ys(B,se):o(N,se,s))){for(y=p;--y;){var me=m[y];if(!(me?ys(me,se):o(e[y],se,s)))continue e}B&&B.push(se),N.push(ee)}}return N}function Np(e,t,s,o){return qi(e,function(u,p,y){t(o,s(u),p,y)}),o}function Ss(e,t,s){t=lr(t,e),e=Du(e,t);var o=e==null?e:e[Mi(Ei(t))];return o==null?i:Mt(o,e,s)}function Wc(e){return vt(e)&&Qt(e)==we}function Fp(e){return vt(e)&&Qt(e)==Ne}function Dp(e){return vt(e)&&Qt(e)==S}function Ps(e,t,s,o,u){return e===t?!0:e==null||t==null||!vt(e)&&!vt(t)?e!==e&&t!==t:$p(e,t,s,o,Ps,u)}function $p(e,t,s,o,u,p){var y=fe(e),m=fe(t),x=y?xt:Vt(e),N=m?xt:Vt(t);x=x==we?Ie:x,N=N==we?Ie:N;var D=x==Ie,L=N==Ie,B=x==N;if(B&&pr(e)){if(!pr(t))return!1;y=!0,D=!1}if(B&&!D)return p||(p=new Ai),y||ss(e)?Cu(e,t,s,o,u,p):cd(e,t,x,s,o,u,p);if(!(s&z)){var ee=D&&Me.call(e,"__wrapped__"),se=L&&Me.call(t,"__wrapped__");if(ee||se){var me=ee?e.value():e,ne=se?t.value():t;return p||(p=new Ai),u(me,ne,s,o,p)}}return B?(p||(p=new Ai),ud(e,t,s,o,u,p)):!1}function qp(e){return vt(e)&&Vt(e)==ye}function eo(e,t,s,o){var u=s.length,p=u,y=!o;if(e==null)return!p;for(e=Ge(e);u--;){var m=s[u];if(y&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++u<p;){m=s[u];var x=m[0],N=e[x],D=m[1];if(y&&m[2]){if(N===i&&!(x in e))return!1}else{var L=new Ai;if(o)var B=o(N,D,x,e,t,L);if(!(B===i?Ps(D,N,z|G,o,L):B))return!1}}return!0}function Jc(e){if(!ot(e)||md(e))return!1;var t=Yi(e)?qf:wa;return t.test(Nr(e))}function Lp(e){return vt(e)&&Qt(e)==st}function Mp(e){return vt(e)&&Vt(e)==$e}function jp(e){return vt(e)&&Yn(e.length)&&!!Ke[Qt(e)]}function Qc(e){return typeof e=="function"?e:e==null?ai:typeof e=="object"?fe(e)?Zc(e[0],e[1]):Xc(e):mh(e)}function to(e){if(!Os(e))return kf(e);var t=[];for(var s in Ge(e))Me.call(e,s)&&s!="constructor"&&t.push(s);return t}function zp(e){if(!ot(e))return Ed(e);var t=Os(e),s=[];for(var o in e)o=="constructor"&&(t||!Me.call(e,o))||s.push(o);return s}function io(e,t){return e<t}function Yc(e,t){var s=-1,o=si(e)?P(e.length):[];return ur(e,function(u,p,y){o[++s]=t(u,p,y)}),o}function Xc(e){var t=mo(e);return t.length==1&&t[0][2]?Nu(t[0][0],t[0][1]):function(s){return s===e||eo(s,e,t)}}function Zc(e,t){return _o(e)&&Tu(t)?Nu(Mi(e),t):function(s){var o=Ro(s,e);return o===i&&o===t?To(s,e):Ps(t,o,z|G)}}function $n(e,t,s,o,u){e!==t&&Qa(t,function(p,y){if(u||(u=new Ai),ot(p))Up(e,t,y,s,$n,o,u);else{var m=o?o(Eo(e,y),p,y+"",e,t,u):i;m===i&&(m=p),Wa(e,y,m)}},ni)}function Up(e,t,s,o,u,p,y){var m=Eo(e,s),x=Eo(t,s),N=y.get(x);if(N){Wa(e,s,N);return}var D=p?p(m,x,s+"",e,t,y):i,L=D===i;if(L){var B=fe(x),ee=!B&&pr(x),se=!B&&!ee&&ss(x);D=x,B||ee||se?fe(m)?D=m:_t(m)?D=ri(m):ee?(L=!1,D=lu(x,!0)):se?(L=!1,D=fu(x,!0)):D=[]:Ts(x)||Fr(x)?(D=m,Fr(m)?D=ch(m):(!ot(m)||Yi(m))&&(D=Ru(x))):L=!1}L&&(y.set(x,D),u(D,x,o,p,y),y.delete(x)),Wa(e,s,D)}function eu(e,t){var s=e.length;if(s)return t+=t<0?s:0,Qi(t,s)?e[t]:i}function tu(e,t,s){t.length?t=rt(t,function(p){return fe(p)?function(y){return Rr(y,p.length===1?p[0]:p)}:p}):t=[ai];var o=-1;t=rt(t,hi(re()));var u=Yc(e,function(p,y,m){var x=rt(t,function(N){return N(p)});return{criteria:x,index:++o,value:p}});return df(u,function(p,y){return ed(p,y,s)})}function kp(e,t){return iu(e,t,function(s,o){return To(e,o)})}function iu(e,t,s){for(var o=-1,u=t.length,p={};++o<u;){var y=t[o],m=Rr(e,y);s(m,y)&&Cs(p,lr(y,e),m)}return p}function Hp(e){return function(t){return Rr(t,e)}}function ro(e,t,s,o){var u=o?pf:Gr,p=-1,y=t.length,m=e;for(e===t&&(t=ri(t)),s&&(m=rt(e,hi(s)));++p<y;)for(var x=0,N=t[p],D=s?s(N):N;(x=u(m,D,x,o))>-1;)m!==e&&Sn.call(m,x,1),Sn.call(e,x,1);return e}function ru(e,t){for(var s=e?t.length:0,o=s-1;s--;){var u=t[s];if(s==o||u!==p){var p=u;Qi(u)?Sn.call(e,u,1):oo(e,u)}}return e}function so(e,t){return e+An(Lc()*(t-e+1))}function Kp(e,t,s,o){for(var u=-1,p=qt(Cn((t-e)/(s||1)),0),y=P(p);p--;)y[o?p:++u]=e,e+=s;return y}function no(e,t){var s="";if(!e||t<1||t>J)return s;do t%2&&(s+=e),t=An(t/2),t&&(e+=e);while(t);return s}function _e(e,t){return xo(Fu(e,t,ai),e+"")}function Vp(e){return zc(ns(e))}function Bp(e,t){var s=ns(e);return Vn(s,Or(t,0,s.length))}function Cs(e,t,s,o){if(!ot(e))return e;t=lr(t,e);for(var u=-1,p=t.length,y=p-1,m=e;m!=null&&++u<p;){var x=Mi(t[u]),N=s;if(x==="__proto__"||x==="constructor"||x==="prototype")return e;if(u!=y){var D=m[x];N=o?o(D,x,m):i,N===i&&(N=ot(D)?D:Qi(t[u+1])?[]:{})}xs(m,x,N),m=m[x]}return e}var su=On?function(e,t){return On.set(e,t),e}:ai,Gp=Pn?function(e,t){return Pn(e,"toString",{configurable:!0,enumerable:!1,value:Fo(t),writable:!0})}:ai;function Wp(e){return Vn(ns(e))}function bi(e,t,s){var o=-1,u=e.length;t<0&&(t=-t>u?0:u+t),s=s>u?u:s,s<0&&(s+=u),u=t>s?0:s-t>>>0,t>>>=0;for(var p=P(u);++o<u;)p[o]=e[o+t];return p}function Jp(e,t){var s;return ur(e,function(o,u,p){return s=t(o,u,p),!s}),!!s}function qn(e,t,s){var o=0,u=e==null?o:e.length;if(typeof t=="number"&&t===t&&u<=ke){for(;o<u;){var p=o+u>>>1,y=e[p];y!==null&&!fi(y)&&(s?y<=t:y<t)?o=p+1:u=p}return u}return ao(e,t,ai,s)}function ao(e,t,s,o){var u=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var y=t!==t,m=t===null,x=fi(t),N=t===i;u<p;){var D=An((u+p)/2),L=s(e[D]),B=L!==i,ee=L===null,se=L===L,me=fi(L);if(y)var ne=o||se;else N?ne=se&&(o||B):m?ne=se&&B&&(o||!ee):x?ne=se&&B&&!ee&&(o||!me):ee||me?ne=!1:ne=o?L<=t:L<t;ne?u=D+1:p=D}return Kt(p,ct)}function nu(e,t){for(var s=-1,o=e.length,u=0,p=[];++s<o;){var y=e[s],m=t?t(y):y;if(!s||!Oi(m,x)){var x=m;p[u++]=y===0?0:y}}return p}function au(e){return typeof e=="number"?e:fi(e)?j:+e}function li(e){if(typeof e=="string")return e;if(fe(e))return rt(e,li)+"";if(fi(e))return Mc?Mc.call(e):"";var t=e+"";return t=="0"&&1/e==-Re?"-0":t}function hr(e,t,s){var o=-1,u=gn,p=e.length,y=!0,m=[],x=m;if(s)y=!1,u=$a;else if(p>=a){var N=t?null:ad(e);if(N)return yn(N);y=!1,u=ys,x=new Ar}else x=t?[]:m;e:for(;++o<p;){var D=e[o],L=t?t(D):D;if(D=s||D!==0?D:0,y&&L===L){for(var B=x.length;B--;)if(x[B]===L)continue e;t&&x.push(L),m.push(D)}else u(x,L,s)||(x!==m&&x.push(L),m.push(D))}return m}function oo(e,t){return t=lr(t,e),e=Du(e,t),e==null||delete e[Mi(Ei(t))]}function ou(e,t,s,o){return Cs(e,t,s(Rr(e,t)),o)}function Ln(e,t,s,o){for(var u=e.length,p=o?u:-1;(o?p--:++p<u)&&t(e[p],p,e););return s?bi(e,o?0:p,o?p+1:u):bi(e,o?p+1:0,o?u:p)}function cu(e,t){var s=e;return s instanceof Se&&(s=s.value()),qa(t,function(o,u){return u.func.apply(u.thisArg,ar([o],u.args))},s)}function co(e,t,s){var o=e.length;if(o<2)return o?hr(e[0]):[];for(var u=-1,p=P(o);++u<o;)for(var y=e[u],m=-1;++m<o;)m!=u&&(p[u]=Is(p[u]||y,e[m],t,s));return hr(kt(p,1),t,s)}function uu(e,t,s){for(var o=-1,u=e.length,p=t.length,y={};++o<u;){var m=o<p?t[o]:i;s(y,e[o],m)}return y}function uo(e){return _t(e)?e:[]}function ho(e){return typeof e=="function"?e:ai}function lr(e,t){return fe(e)?e:_o(e,t)?[e]:Mu(qe(e))}var Qp=_e;function fr(e,t,s){var o=e.length;return s=s===i?o:s,!t&&s>=o?e:bi(e,t,s)}var hu=Lf||function(e){return Pe.clearTimeout(e)};function lu(e,t){if(t)return e.slice();var s=e.length,o=Nc?Nc(s):new e.constructor(s);return e.copy(o),o}function lo(e){var t=new e.constructor(e.byteLength);return new xn(t).set(new xn(e)),t}function Yp(e,t){var s=t?lo(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Xp(e){var t=new e.constructor(e.source,gi.exec(e));return t.lastIndex=e.lastIndex,t}function Zp(e){return Es?Ge(Es.call(e)):{}}function fu(e,t){var s=t?lo(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function pu(e,t){if(e!==t){var s=e!==i,o=e===null,u=e===e,p=fi(e),y=t!==i,m=t===null,x=t===t,N=fi(t);if(!m&&!N&&!p&&e>t||p&&y&&x&&!m&&!N||o&&y&&x||!s&&x||!u)return 1;if(!o&&!p&&!N&&e<t||N&&s&&u&&!o&&!p||m&&s&&u||!y&&u||!x)return-1}return 0}function ed(e,t,s){for(var o=-1,u=e.criteria,p=t.criteria,y=u.length,m=s.length;++o<y;){var x=pu(u[o],p[o]);if(x){if(o>=m)return x;var N=s[o];return x*(N=="desc"?-1:1)}}return e.index-t.index}function du(e,t,s,o){for(var u=-1,p=e.length,y=s.length,m=-1,x=t.length,N=qt(p-y,0),D=P(x+N),L=!o;++m<x;)D[m]=t[m];for(;++u<y;)(L||u<p)&&(D[s[u]]=e[u]);for(;N--;)D[m++]=e[u++];return D}function gu(e,t,s,o){for(var u=-1,p=e.length,y=-1,m=s.length,x=-1,N=t.length,D=qt(p-m,0),L=P(D+N),B=!o;++u<D;)L[u]=e[u];for(var ee=u;++x<N;)L[ee+x]=t[x];for(;++y<m;)(B||u<p)&&(L[ee+s[y]]=e[u++]);return L}function ri(e,t){var s=-1,o=e.length;for(t||(t=P(o));++s<o;)t[s]=e[s];return t}function Li(e,t,s,o){var u=!s;s||(s={});for(var p=-1,y=t.length;++p<y;){var m=t[p],x=o?o(s[m],e[m],m,s,e):i;x===i&&(x=e[m]),u?Gi(s,m,x):xs(s,m,x)}return s}function td(e,t){return Li(e,wo(e),t)}function id(e,t){return Li(e,Au(e),t)}function Mn(e,t){return function(s,o){var u=fe(s)?of:Ip,p=t?t():{};return u(s,e,re(o,2),p)}}function ts(e){return _e(function(t,s){var o=-1,u=s.length,p=u>1?s[u-1]:i,y=u>2?s[2]:i;for(p=e.length>3&&typeof p=="function"?(u--,p):i,y&&Yt(s[0],s[1],y)&&(p=u<3?i:p,u=1),t=Ge(t);++o<u;){var m=s[o];m&&e(t,m,o,p)}return t})}function vu(e,t){return function(s,o){if(s==null)return s;if(!si(s))return e(s,o);for(var u=s.length,p=t?u:-1,y=Ge(s);(t?p--:++p<u)&&o(y[p],p,y)!==!1;);return s}}function yu(e){return function(t,s,o){for(var u=-1,p=Ge(t),y=o(t),m=y.length;m--;){var x=y[e?m:++u];if(s(p[x],x,p)===!1)break}return t}}function rd(e,t,s){var o=t&ae,u=As(e);function p(){var y=this&&this!==Pe&&this instanceof p?u:e;return y.apply(o?s:this,arguments)}return p}function mu(e){return function(t){t=qe(t);var s=Wr(t)?Ci(t):i,o=s?s[0]:t.charAt(0),u=s?fr(s,1).join(""):t.slice(1);return o[e]()+u}}function is(e){return function(t){return qa(vh(gh(t).replace(gs,"")),e,"")}}function As(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=es(e.prototype),o=e.apply(s,t);return ot(o)?o:s}}function sd(e,t,s){var o=As(e);function u(){for(var p=arguments.length,y=P(p),m=p,x=rs(u);m--;)y[m]=arguments[m];var N=p<3&&y[0]!==x&&y[p-1]!==x?[]:or(y,x);if(p-=N.length,p<s)return xu(e,t,jn,u.placeholder,i,y,N,i,i,s-p);var D=this&&this!==Pe&&this instanceof u?o:e;return Mt(D,this,y)}return u}function wu(e){return function(t,s,o){var u=Ge(t);if(!si(t)){var p=re(s,3);t=jt(t),s=function(m){return p(u[m],m,u)}}var y=e(t,s,o);return y>-1?u[p?t[y]:y]:i}}function _u(e){return Ji(function(t){var s=t.length,o=s,u=wi.prototype.thru;for(e&&t.reverse();o--;){var p=t[o];if(typeof p!="function")throw new mi(d);if(u&&!y&&Hn(p)=="wrapper")var y=new wi([],!0)}for(o=y?o:s;++o<s;){p=t[o];var m=Hn(p),x=m=="wrapper"?yo(p):i;x&&bo(x[0])&&x[1]==(M|pe|he|W)&&!x[4].length&&x[9]==1?y=y[Hn(x[0])].apply(y,x[3]):y=p.length==1&&bo(p)?y[m]():y.thru(p)}return function(){var N=arguments,D=N[0];if(y&&N.length==1&&fe(D))return y.plant(D).value();for(var L=0,B=s?t[L].apply(this,N):D;++L<s;)B=t[L].call(this,B);return B}})}function jn(e,t,s,o,u,p,y,m,x,N){var D=t&M,L=t&ae,B=t&be,ee=t&(pe|ue),se=t&ge,me=B?i:As(e);function ne(){for(var xe=arguments.length,Ce=P(xe),pi=xe;pi--;)Ce[pi]=arguments[pi];if(ee)var Xt=rs(ne),di=vf(Ce,Xt);if(o&&(Ce=du(Ce,o,u,ee)),p&&(Ce=gu(Ce,p,y,ee)),xe-=di,ee&&xe<N){var bt=or(Ce,Xt);return xu(e,t,jn,ne.placeholder,s,Ce,bt,m,x,N-xe)}var Ri=L?s:this,Zi=B?Ri[e]:e;return xe=Ce.length,m?Ce=Id(Ce,m):se&&xe>1&&Ce.reverse(),D&&x<xe&&(Ce.length=x),this&&this!==Pe&&this instanceof ne&&(Zi=me||As(Zi)),Zi.apply(Ri,Ce)}return ne}function bu(e,t){return function(s,o){return Np(s,e,t(o),{})}}function zn(e,t){return function(s,o){var u;if(s===i&&o===i)return t;if(s!==i&&(u=s),o!==i){if(u===i)return o;typeof s=="string"||typeof o=="string"?(s=li(s),o=li(o)):(s=au(s),o=au(o)),u=e(s,o)}return u}}function fo(e){return Ji(function(t){return t=rt(t,hi(re())),_e(function(s){var o=this;return e(t,function(u){return Mt(u,o,s)})})})}function Un(e,t){t=t===i?" ":li(t);var s=t.length;if(s<2)return s?no(t,e):t;var o=no(t,Cn(e/Jr(t)));return Wr(t)?fr(Ci(o),0,e).join(""):o.slice(0,e)}function nd(e,t,s,o){var u=t&ae,p=As(e);function y(){for(var m=-1,x=arguments.length,N=-1,D=o.length,L=P(D+x),B=this&&this!==Pe&&this instanceof y?p:e;++N<D;)L[N]=o[N];for(;x--;)L[N++]=arguments[++m];return Mt(B,u?s:this,L)}return y}function Eu(e){return function(t,s,o){return o&&typeof o!="number"&&Yt(t,s,o)&&(s=o=i),t=Xi(t),s===i?(s=t,t=0):s=Xi(s),o=o===i?t<s?1:-1:Xi(o),Kp(t,s,o,e)}}function kn(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=xi(t),s=xi(s)),e(t,s)}}function xu(e,t,s,o,u,p,y,m,x,N){var D=t&pe,L=D?y:i,B=D?i:y,ee=D?p:i,se=D?i:p;t|=D?he:R,t&=~(D?R:he),t&de||(t&=~(ae|be));var me=[e,t,u,ee,L,se,B,m,x,N],ne=s.apply(i,me);return bo(e)&&$u(ne,me),ne.placeholder=o,qu(ne,e,t)}function po(e){var t=$t[e];return function(s,o){if(s=xi(s),o=o==null?0:Kt(ve(o),292),o&&qc(s)){var u=(qe(s)+"e").split("e"),p=t(u[0]+"e"+(+u[1]+o));return u=(qe(p)+"e").split("e"),+(u[0]+"e"+(+u[1]-o))}return t(s)}}var ad=Xr&&1/yn(new Xr([,-0]))[1]==Re?function(e){return new Xr(e)}:qo;function Iu(e){return function(t){var s=Vt(t);return s==ye?Ha(t):s==$e?xf(t):gf(t,e(t))}}function Wi(e,t,s,o,u,p,y,m){var x=t&be;if(!x&&typeof e!="function")throw new mi(d);var N=o?o.length:0;if(N||(t&=~(he|R),o=u=i),y=y===i?y:qt(ve(y),0),m=m===i?m:ve(m),N-=u?u.length:0,t&R){var D=o,L=u;o=u=i}var B=x?i:yo(e),ee=[e,t,s,o,u,D,L,p,y,m];if(B&&bd(ee,B),e=ee[0],t=ee[1],s=ee[2],o=ee[3],u=ee[4],m=ee[9]=ee[9]===i?x?0:e.length:qt(ee[9]-N,0),!m&&t&(pe|ue)&&(t&=~(pe|ue)),!t||t==ae)var se=rd(e,t,s);else t==pe||t==ue?se=sd(e,t,m):(t==he||t==(ae|he))&&!u.length?se=nd(e,t,s,o):se=jn.apply(i,ee);var me=B?su:$u;return qu(me(se,ee),e,t)}function Su(e,t,s,o){return e===i||Oi(e,Yr[s])&&!Me.call(o,s)?t:e}function Pu(e,t,s,o,u,p){return ot(e)&&ot(t)&&(p.set(t,e),$n(e,t,i,Pu,p),p.delete(t)),e}function od(e){return Ts(e)?i:e}function Cu(e,t,s,o,u,p){var y=s&z,m=e.length,x=t.length;if(m!=x&&!(y&&x>m))return!1;var N=p.get(e),D=p.get(t);if(N&&D)return N==t&&D==e;var L=-1,B=!0,ee=s&G?new Ar:i;for(p.set(e,t),p.set(t,e);++L<m;){var se=e[L],me=t[L];if(o)var ne=y?o(me,se,L,t,e,p):o(se,me,L,e,t,p);if(ne!==i){if(ne)continue;B=!1;break}if(ee){if(!La(t,function(xe,Ce){if(!ys(ee,Ce)&&(se===xe||u(se,xe,s,o,p)))return ee.push(Ce)})){B=!1;break}}else if(!(se===me||u(se,me,s,o,p))){B=!1;break}}return p.delete(e),p.delete(t),B}function cd(e,t,s,o,u,p,y){switch(s){case He:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ne:return!(e.byteLength!=t.byteLength||!p(new xn(e),new xn(t)));case A:case S:case Te:return Oi(+e,+t);case _:return e.name==t.name&&e.message==t.message;case st:case Je:return e==t+"";case ye:var m=Ha;case $e:var x=o&z;if(m||(m=yn),e.size!=t.size&&!x)return!1;var N=y.get(e);if(N)return N==t;o|=G,y.set(e,t);var D=Cu(m(e),m(t),o,u,p,y);return y.delete(e),D;case Qe:if(Es)return Es.call(e)==Es.call(t)}return!1}function ud(e,t,s,o,u,p){var y=s&z,m=go(e),x=m.length,N=go(t),D=N.length;if(x!=D&&!y)return!1;for(var L=x;L--;){var B=m[L];if(!(y?B in t:Me.call(t,B)))return!1}var ee=p.get(e),se=p.get(t);if(ee&&se)return ee==t&&se==e;var me=!0;p.set(e,t),p.set(t,e);for(var ne=y;++L<x;){B=m[L];var xe=e[B],Ce=t[B];if(o)var pi=y?o(Ce,xe,B,t,e,p):o(xe,Ce,B,e,t,p);if(!(pi===i?xe===Ce||u(xe,Ce,s,o,p):pi)){me=!1;break}ne||(ne=B=="constructor")}if(me&&!ne){var Xt=e.constructor,di=t.constructor;Xt!=di&&"constructor"in e&&"constructor"in t&&!(typeof Xt=="function"&&Xt instanceof Xt&&typeof di=="function"&&di instanceof di)&&(me=!1)}return p.delete(e),p.delete(t),me}function Ji(e){return xo(Fu(e,i,ku),e+"")}function go(e){return Gc(e,jt,wo)}function vo(e){return Gc(e,ni,Au)}var yo=On?function(e){return On.get(e)}:qo;function Hn(e){for(var t=e.name+"",s=Zr[t],o=Me.call(Zr,t)?s.length:0;o--;){var u=s[o],p=u.func;if(p==null||p==e)return u.name}return t}function rs(e){var t=Me.call(f,"placeholder")?f:e;return t.placeholder}function re(){var e=f.iteratee||Do;return e=e===Do?Qc:e,arguments.length?e(arguments[0],arguments[1]):e}function Kn(e,t){var s=e.__data__;return yd(t)?s[typeof t=="string"?"string":"hash"]:s.map}function mo(e){for(var t=jt(e),s=t.length;s--;){var o=t[s],u=e[o];t[s]=[o,u,Tu(u)]}return t}function Tr(e,t){var s=_f(e,t);return Jc(s)?s:i}function hd(e){var t=Me.call(e,Pr),s=e[Pr];try{e[Pr]=i;var o=!0}catch{}var u=bn.call(e);return o&&(t?e[Pr]=s:delete e[Pr]),u}var wo=Va?function(e){return e==null?[]:(e=Ge(e),nr(Va(e),function(t){return Dc.call(e,t)}))}:Lo,Au=Va?function(e){for(var t=[];e;)ar(t,wo(e)),e=In(e);return t}:Lo,Vt=Qt;(Ba&&Vt(new Ba(new ArrayBuffer(1)))!=He||ws&&Vt(new ws)!=ye||Ga&&Vt(Ga.resolve())!=It||Xr&&Vt(new Xr)!=$e||_s&&Vt(new _s)!=ze)&&(Vt=function(e){var t=Qt(e),s=t==Ie?e.constructor:i,o=s?Nr(s):"";if(o)switch(o){case Bf:return He;case Gf:return ye;case Wf:return It;case Jf:return $e;case Qf:return ze}return t});function ld(e,t,s){for(var o=-1,u=s.length;++o<u;){var p=s[o],y=p.size;switch(p.type){case"drop":e+=y;break;case"dropRight":t-=y;break;case"take":t=Kt(t,e+y);break;case"takeRight":e=qt(e,t-y);break}}return{start:e,end:t}}function fd(e){var t=e.match(We);return t?t[1].split(Ot):[]}function Ou(e,t,s){t=lr(t,e);for(var o=-1,u=t.length,p=!1;++o<u;){var y=Mi(t[o]);if(!(p=e!=null&&s(e,y)))break;e=e[y]}return p||++o!=u?p:(u=e==null?0:e.length,!!u&&Yn(u)&&Qi(y,u)&&(fe(e)||Fr(e)))}function pd(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&Me.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Ru(e){return typeof e.constructor=="function"&&!Os(e)?es(In(e)):{}}function dd(e,t,s){var o=e.constructor;switch(t){case Ne:return lo(e);case A:case S:return new o(+e);case He:return Yp(e,s);case ut:case Le:case St:case Dt:case zt:case Ut:case Lt:case Gt:case ti:return fu(e,s);case ye:return new o;case Te:case Je:return new o(e);case st:return Xp(e);case $e:return new o;case Qe:return Zp(e)}}function gd(e,t){var s=t.length;if(!s)return e;var o=s-1;return t[o]=(s>1?"& ":"")+t[o],t=t.join(s>2?", ":" "),e.replace(gt,`{
/* [wrapped with `+t+`] */
`)}function vd(e){return fe(e)||Fr(e)||!!($c&&e&&e[$c])}function Qi(e,t){var s=typeof e;return t=t??J,!!t&&(s=="number"||s!="symbol"&&ba.test(e))&&e>-1&&e%1==0&&e<t}function Yt(e,t,s){if(!ot(s))return!1;var o=typeof t;return(o=="number"?si(s)&&Qi(t,s.length):o=="string"&&t in s)?Oi(s[t],e):!1}function _o(e,t){if(fe(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||fi(e)?!0:Pt.test(e)||!it.test(e)||t!=null&&e in Ge(t)}function yd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function bo(e){var t=Hn(e),s=f[t];if(typeof s!="function"||!(t in Se.prototype))return!1;if(e===s)return!0;var o=yo(s);return!!o&&e===o[0]}function md(e){return!!Tc&&Tc in e}var wd=wn?Yi:Mo;function Os(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||Yr;return e===s}function Tu(e){return e===e&&!ot(e)}function Nu(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in Ge(s))}}function _d(e){var t=Jn(e,function(o){return s.size===I&&s.clear(),o}),s=t.cache;return t}function bd(e,t){var s=e[1],o=t[1],u=s|o,p=u<(ae|be|M),y=o==M&&s==pe||o==M&&s==W&&e[7].length<=t[8]||o==(M|W)&&t[7].length<=t[8]&&s==pe;if(!(p||y))return e;o&ae&&(e[2]=t[2],u|=s&ae?0:de);var m=t[3];if(m){var x=e[3];e[3]=x?du(x,m,t[4]):m,e[4]=x?or(e[3],F):t[4]}return m=t[5],m&&(x=e[5],e[5]=x?gu(x,m,t[6]):m,e[6]=x?or(e[5],F):t[6]),m=t[7],m&&(e[7]=m),o&M&&(e[8]=e[8]==null?t[8]:Kt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=u,e}function Ed(e){var t=[];if(e!=null)for(var s in Ge(e))t.push(s);return t}function xd(e){return bn.call(e)}function Fu(e,t,s){return t=qt(t===i?e.length-1:t,0),function(){for(var o=arguments,u=-1,p=qt(o.length-t,0),y=P(p);++u<p;)y[u]=o[t+u];u=-1;for(var m=P(t+1);++u<t;)m[u]=o[u];return m[t]=s(y),Mt(e,this,m)}}function Du(e,t){return t.length<2?e:Rr(e,bi(t,0,-1))}function Id(e,t){for(var s=e.length,o=Kt(t.length,s),u=ri(e);o--;){var p=t[o];e[o]=Qi(p,s)?u[p]:i}return e}function Eo(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var $u=Lu(su),Rs=jf||function(e,t){return Pe.setTimeout(e,t)},xo=Lu(Gp);function qu(e,t,s){var o=t+"";return xo(e,gd(o,Sd(fd(o),s)))}function Lu(e){var t=0,s=0;return function(){var o=Hf(),u=et-(o-s);if(s=o,u>0){if(++t>=Oe)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Vn(e,t){var s=-1,o=e.length,u=o-1;for(t=t===i?o:t;++s<t;){var p=so(s,u),y=e[p];e[p]=e[s],e[s]=y}return e.length=t,e}var Mu=_d(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Ct,function(s,o,u,p){t.push(u?p.replace(ga,"$1"):o||s)}),t});function Mi(e){if(typeof e=="string"||fi(e))return e;var t=e+"";return t=="0"&&1/e==-Re?"-0":t}function Nr(e){if(e!=null){try{return _n.call(e)}catch{}try{return e+""}catch{}}return""}function Sd(e,t){return yi(Ni,function(s){var o="_."+s[0];t&s[1]&&!gn(e,o)&&e.push(o)}),e.sort()}function ju(e){if(e instanceof Se)return e.clone();var t=new wi(e.__wrapped__,e.__chain__);return t.__actions__=ri(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Pd(e,t,s){(s?Yt(e,t,s):t===i)?t=1:t=qt(ve(t),0);var o=e==null?0:e.length;if(!o||t<1)return[];for(var u=0,p=0,y=P(Cn(o/t));u<o;)y[p++]=bi(e,u,u+=t);return y}function Cd(e){for(var t=-1,s=e==null?0:e.length,o=0,u=[];++t<s;){var p=e[t];p&&(u[o++]=p)}return u}function Ad(){var e=arguments.length;if(!e)return[];for(var t=P(e-1),s=arguments[0],o=e;o--;)t[o-1]=arguments[o];return ar(fe(s)?ri(s):[s],kt(t,1))}var Od=_e(function(e,t){return _t(e)?Is(e,kt(t,1,_t,!0)):[]}),Rd=_e(function(e,t){var s=Ei(t);return _t(s)&&(s=i),_t(e)?Is(e,kt(t,1,_t,!0),re(s,2)):[]}),Td=_e(function(e,t){var s=Ei(t);return _t(s)&&(s=i),_t(e)?Is(e,kt(t,1,_t,!0),i,s):[]});function Nd(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===i?1:ve(t),bi(e,t<0?0:t,o)):[]}function Fd(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===i?1:ve(t),t=o-t,bi(e,0,t<0?0:t)):[]}function Dd(e,t){return e&&e.length?Ln(e,re(t,3),!0,!0):[]}function $d(e,t){return e&&e.length?Ln(e,re(t,3),!0):[]}function qd(e,t,s,o){var u=e==null?0:e.length;return u?(s&&typeof s!="number"&&Yt(e,t,s)&&(s=0,o=u),Ap(e,t,s,o)):[]}function zu(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var u=s==null?0:ve(s);return u<0&&(u=qt(o+u,0)),vn(e,re(t,3),u)}function Uu(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var u=o-1;return s!==i&&(u=ve(s),u=s<0?qt(o+u,0):Kt(u,o-1)),vn(e,re(t,3),u,!0)}function ku(e){var t=e==null?0:e.length;return t?kt(e,1):[]}function Ld(e){var t=e==null?0:e.length;return t?kt(e,Re):[]}function Md(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:ve(t),kt(e,t)):[]}function jd(e){for(var t=-1,s=e==null?0:e.length,o={};++t<s;){var u=e[t];o[u[0]]=u[1]}return o}function Hu(e){return e&&e.length?e[0]:i}function zd(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var u=s==null?0:ve(s);return u<0&&(u=qt(o+u,0)),Gr(e,t,u)}function Ud(e){var t=e==null?0:e.length;return t?bi(e,0,-1):[]}var kd=_e(function(e){var t=rt(e,uo);return t.length&&t[0]===e[0]?Za(t):[]}),Hd=_e(function(e){var t=Ei(e),s=rt(e,uo);return t===Ei(s)?t=i:s.pop(),s.length&&s[0]===e[0]?Za(s,re(t,2)):[]}),Kd=_e(function(e){var t=Ei(e),s=rt(e,uo);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?Za(s,i,t):[]});function Vd(e,t){return e==null?"":Uf.call(e,t)}function Ei(e){var t=e==null?0:e.length;return t?e[t-1]:i}function Bd(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var u=o;return s!==i&&(u=ve(s),u=u<0?qt(o+u,0):Kt(u,o-1)),t===t?Sf(e,t,u):vn(e,xc,u,!0)}function Gd(e,t){return e&&e.length?eu(e,ve(t)):i}var Wd=_e(Ku);function Ku(e,t){return e&&e.length&&t&&t.length?ro(e,t):e}function Jd(e,t,s){return e&&e.length&&t&&t.length?ro(e,t,re(s,2)):e}function Qd(e,t,s){return e&&e.length&&t&&t.length?ro(e,t,i,s):e}var Yd=Ji(function(e,t){var s=e==null?0:e.length,o=Ja(e,t);return ru(e,rt(t,function(u){return Qi(u,s)?+u:u}).sort(pu)),o});function Xd(e,t){var s=[];if(!(e&&e.length))return s;var o=-1,u=[],p=e.length;for(t=re(t,3);++o<p;){var y=e[o];t(y,o,e)&&(s.push(y),u.push(o))}return ru(e,u),s}function Io(e){return e==null?e:Vf.call(e)}function Zd(e,t,s){var o=e==null?0:e.length;return o?(s&&typeof s!="number"&&Yt(e,t,s)?(t=0,s=o):(t=t==null?0:ve(t),s=s===i?o:ve(s)),bi(e,t,s)):[]}function eg(e,t){return qn(e,t)}function tg(e,t,s){return ao(e,t,re(s,2))}function ig(e,t){var s=e==null?0:e.length;if(s){var o=qn(e,t);if(o<s&&Oi(e[o],t))return o}return-1}function rg(e,t){return qn(e,t,!0)}function sg(e,t,s){return ao(e,t,re(s,2),!0)}function ng(e,t){var s=e==null?0:e.length;if(s){var o=qn(e,t,!0)-1;if(Oi(e[o],t))return o}return-1}function ag(e){return e&&e.length?nu(e):[]}function og(e,t){return e&&e.length?nu(e,re(t,2)):[]}function cg(e){var t=e==null?0:e.length;return t?bi(e,1,t):[]}function ug(e,t,s){return e&&e.length?(t=s||t===i?1:ve(t),bi(e,0,t<0?0:t)):[]}function hg(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===i?1:ve(t),t=o-t,bi(e,t<0?0:t,o)):[]}function lg(e,t){return e&&e.length?Ln(e,re(t,3),!1,!0):[]}function fg(e,t){return e&&e.length?Ln(e,re(t,3)):[]}var pg=_e(function(e){return hr(kt(e,1,_t,!0))}),dg=_e(function(e){var t=Ei(e);return _t(t)&&(t=i),hr(kt(e,1,_t,!0),re(t,2))}),gg=_e(function(e){var t=Ei(e);return t=typeof t=="function"?t:i,hr(kt(e,1,_t,!0),i,t)});function vg(e){return e&&e.length?hr(e):[]}function yg(e,t){return e&&e.length?hr(e,re(t,2)):[]}function mg(e,t){return t=typeof t=="function"?t:i,e&&e.length?hr(e,i,t):[]}function So(e){if(!(e&&e.length))return[];var t=0;return e=nr(e,function(s){if(_t(s))return t=qt(s.length,t),!0}),Ua(t,function(s){return rt(e,Ma(s))})}function Vu(e,t){if(!(e&&e.length))return[];var s=So(e);return t==null?s:rt(s,function(o){return Mt(t,i,o)})}var wg=_e(function(e,t){return _t(e)?Is(e,t):[]}),_g=_e(function(e){return co(nr(e,_t))}),bg=_e(function(e){var t=Ei(e);return _t(t)&&(t=i),co(nr(e,_t),re(t,2))}),Eg=_e(function(e){var t=Ei(e);return t=typeof t=="function"?t:i,co(nr(e,_t),i,t)}),xg=_e(So);function Ig(e,t){return uu(e||[],t||[],xs)}function Sg(e,t){return uu(e||[],t||[],Cs)}var Pg=_e(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,Vu(e,s)});function Bu(e){var t=f(e);return t.__chain__=!0,t}function Cg(e,t){return t(e),e}function Bn(e,t){return t(e)}var Ag=Ji(function(e){var t=e.length,s=t?e[0]:0,o=this.__wrapped__,u=function(p){return Ja(p,e)};return t>1||this.__actions__.length||!(o instanceof Se)||!Qi(s)?this.thru(u):(o=o.slice(s,+s+(t?1:0)),o.__actions__.push({func:Bn,args:[u],thisArg:i}),new wi(o,this.__chain__).thru(function(p){return t&&!p.length&&p.push(i),p}))});function Og(){return Bu(this)}function Rg(){return new wi(this.value(),this.__chain__)}function Tg(){this.__values__===i&&(this.__values__=ah(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function Ng(){return this}function Fg(e){for(var t,s=this;s instanceof Tn;){var o=ju(s);o.__index__=0,o.__values__=i,t?u.__wrapped__=o:t=o;var u=o;s=s.__wrapped__}return u.__wrapped__=e,t}function Dg(){var e=this.__wrapped__;if(e instanceof Se){var t=e;return this.__actions__.length&&(t=new Se(this)),t=t.reverse(),t.__actions__.push({func:Bn,args:[Io],thisArg:i}),new wi(t,this.__chain__)}return this.thru(Io)}function $g(){return cu(this.__wrapped__,this.__actions__)}var qg=Mn(function(e,t,s){Me.call(e,s)?++e[s]:Gi(e,s,1)});function Lg(e,t,s){var o=fe(e)?bc:Cp;return s&&Yt(e,t,s)&&(t=i),o(e,re(t,3))}function Mg(e,t){var s=fe(e)?nr:Vc;return s(e,re(t,3))}var jg=wu(zu),zg=wu(Uu);function Ug(e,t){return kt(Gn(e,t),1)}function kg(e,t){return kt(Gn(e,t),Re)}function Hg(e,t,s){return s=s===i?1:ve(s),kt(Gn(e,t),s)}function Gu(e,t){var s=fe(e)?yi:ur;return s(e,re(t,3))}function Wu(e,t){var s=fe(e)?cf:Kc;return s(e,re(t,3))}var Kg=Mn(function(e,t,s){Me.call(e,s)?e[s].push(t):Gi(e,s,[t])});function Vg(e,t,s,o){e=si(e)?e:ns(e),s=s&&!o?ve(s):0;var u=e.length;return s<0&&(s=qt(u+s,0)),Xn(e)?s<=u&&e.indexOf(t,s)>-1:!!u&&Gr(e,t,s)>-1}var Bg=_e(function(e,t,s){var o=-1,u=typeof t=="function",p=si(e)?P(e.length):[];return ur(e,function(y){p[++o]=u?Mt(t,y,s):Ss(y,t,s)}),p}),Gg=Mn(function(e,t,s){Gi(e,s,t)});function Gn(e,t){var s=fe(e)?rt:Yc;return s(e,re(t,3))}function Wg(e,t,s,o){return e==null?[]:(fe(t)||(t=t==null?[]:[t]),s=o?i:s,fe(s)||(s=s==null?[]:[s]),tu(e,t,s))}var Jg=Mn(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function Qg(e,t,s){var o=fe(e)?qa:Sc,u=arguments.length<3;return o(e,re(t,4),s,u,ur)}function Yg(e,t,s){var o=fe(e)?uf:Sc,u=arguments.length<3;return o(e,re(t,4),s,u,Kc)}function Xg(e,t){var s=fe(e)?nr:Vc;return s(e,Qn(re(t,3)))}function Zg(e){var t=fe(e)?zc:Vp;return t(e)}function e0(e,t,s){(s?Yt(e,t,s):t===i)?t=1:t=ve(t);var o=fe(e)?Ep:Bp;return o(e,t)}function t0(e){var t=fe(e)?xp:Wp;return t(e)}function i0(e){if(e==null)return 0;if(si(e))return Xn(e)?Jr(e):e.length;var t=Vt(e);return t==ye||t==$e?e.size:to(e).length}function r0(e,t,s){var o=fe(e)?La:Jp;return s&&Yt(e,t,s)&&(t=i),o(e,re(t,3))}var s0=_e(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Yt(e,t[0],t[1])?t=[]:s>2&&Yt(t[0],t[1],t[2])&&(t=[t[0]]),tu(e,kt(t,1),[])}),Wn=Mf||function(){return Pe.Date.now()};function n0(e,t){if(typeof t!="function")throw new mi(d);return e=ve(e),function(){if(--e<1)return t.apply(this,arguments)}}function Ju(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,Wi(e,M,i,i,i,i,t)}function Qu(e,t){var s;if(typeof t!="function")throw new mi(d);return e=ve(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var Po=_e(function(e,t,s){var o=ae;if(s.length){var u=or(s,rs(Po));o|=he}return Wi(e,o,t,s,u)}),Yu=_e(function(e,t,s){var o=ae|be;if(s.length){var u=or(s,rs(Yu));o|=he}return Wi(t,o,e,s,u)});function Xu(e,t,s){t=s?i:t;var o=Wi(e,pe,i,i,i,i,i,t);return o.placeholder=Xu.placeholder,o}function Zu(e,t,s){t=s?i:t;var o=Wi(e,ue,i,i,i,i,i,t);return o.placeholder=Zu.placeholder,o}function eh(e,t,s){var o,u,p,y,m,x,N=0,D=!1,L=!1,B=!0;if(typeof e!="function")throw new mi(d);t=xi(t)||0,ot(s)&&(D=!!s.leading,L="maxWait"in s,p=L?qt(xi(s.maxWait)||0,t):p,B="trailing"in s?!!s.trailing:B);function ee(bt){var Ri=o,Zi=u;return o=u=i,N=bt,y=e.apply(Zi,Ri),y}function se(bt){return N=bt,m=Rs(xe,t),D?ee(bt):y}function me(bt){var Ri=bt-x,Zi=bt-N,wh=t-Ri;return L?Kt(wh,p-Zi):wh}function ne(bt){var Ri=bt-x,Zi=bt-N;return x===i||Ri>=t||Ri<0||L&&Zi>=p}function xe(){var bt=Wn();if(ne(bt))return Ce(bt);m=Rs(xe,me(bt))}function Ce(bt){return m=i,B&&o?ee(bt):(o=u=i,y)}function pi(){m!==i&&hu(m),N=0,o=x=u=m=i}function Xt(){return m===i?y:Ce(Wn())}function di(){var bt=Wn(),Ri=ne(bt);if(o=arguments,u=this,x=bt,Ri){if(m===i)return se(x);if(L)return hu(m),m=Rs(xe,t),ee(x)}return m===i&&(m=Rs(xe,t)),y}return di.cancel=pi,di.flush=Xt,di}var a0=_e(function(e,t){return Hc(e,1,t)}),o0=_e(function(e,t,s){return Hc(e,xi(t)||0,s)});function c0(e){return Wi(e,ge)}function Jn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new mi(d);var s=function(){var o=arguments,u=t?t.apply(this,o):o[0],p=s.cache;if(p.has(u))return p.get(u);var y=e.apply(this,o);return s.cache=p.set(u,y)||p,y};return s.cache=new(Jn.Cache||Bi),s}Jn.Cache=Bi;function Qn(e){if(typeof e!="function")throw new mi(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function u0(e){return Qu(2,e)}var h0=Qp(function(e,t){t=t.length==1&&fe(t[0])?rt(t[0],hi(re())):rt(kt(t,1),hi(re()));var s=t.length;return _e(function(o){for(var u=-1,p=Kt(o.length,s);++u<p;)o[u]=t[u].call(this,o[u]);return Mt(e,this,o)})}),Co=_e(function(e,t){var s=or(t,rs(Co));return Wi(e,he,i,t,s)}),th=_e(function(e,t){var s=or(t,rs(th));return Wi(e,R,i,t,s)}),l0=Ji(function(e,t){return Wi(e,W,i,i,i,t)});function f0(e,t){if(typeof e!="function")throw new mi(d);return t=t===i?t:ve(t),_e(e,t)}function p0(e,t){if(typeof e!="function")throw new mi(d);return t=t==null?0:qt(ve(t),0),_e(function(s){var o=s[t],u=fr(s,0,t);return o&&ar(u,o),Mt(e,this,u)})}function d0(e,t,s){var o=!0,u=!0;if(typeof e!="function")throw new mi(d);return ot(s)&&(o="leading"in s?!!s.leading:o,u="trailing"in s?!!s.trailing:u),eh(e,t,{leading:o,maxWait:t,trailing:u})}function g0(e){return Ju(e,1)}function v0(e,t){return Co(ho(t),e)}function y0(){if(!arguments.length)return[];var e=arguments[0];return fe(e)?e:[e]}function m0(e){return _i(e,H)}function w0(e,t){return t=typeof t=="function"?t:i,_i(e,H,t)}function _0(e){return _i(e,U|H)}function b0(e,t){return t=typeof t=="function"?t:i,_i(e,U|H,t)}function E0(e,t){return t==null||kc(e,t,jt(t))}function Oi(e,t){return e===t||e!==e&&t!==t}var x0=kn(Xa),I0=kn(function(e,t){return e>=t}),Fr=Wc(function(){return arguments}())?Wc:function(e){return vt(e)&&Me.call(e,"callee")&&!Dc.call(e,"callee")},fe=P.isArray,S0=Jt?hi(Jt):Fp;function si(e){return e!=null&&Yn(e.length)&&!Yi(e)}function _t(e){return vt(e)&&si(e)}function P0(e){return e===!0||e===!1||vt(e)&&Qt(e)==A}var pr=zf||Mo,C0=Pi?hi(Pi):Dp;function A0(e){return vt(e)&&e.nodeType===1&&!Ts(e)}function O0(e){if(e==null)return!0;if(si(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||pr(e)||ss(e)||Fr(e)))return!e.length;var t=Vt(e);if(t==ye||t==$e)return!e.size;if(Os(e))return!to(e).length;for(var s in e)if(Me.call(e,s))return!1;return!0}function R0(e,t){return Ps(e,t)}function T0(e,t,s){s=typeof s=="function"?s:i;var o=s?s(e,t):i;return o===i?Ps(e,t,i,s):!!o}function Ao(e){if(!vt(e))return!1;var t=Qt(e);return t==_||t==c||typeof e.message=="string"&&typeof e.name=="string"&&!Ts(e)}function N0(e){return typeof e=="number"&&qc(e)}function Yi(e){if(!ot(e))return!1;var t=Qt(e);return t==Z||t==oe||t==O||t==yt}function ih(e){return typeof e=="number"&&e==ve(e)}function Yn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ot(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function vt(e){return e!=null&&typeof e=="object"}var rh=vi?hi(vi):qp;function F0(e,t){return e===t||eo(e,t,mo(t))}function D0(e,t,s){return s=typeof s=="function"?s:i,eo(e,t,mo(t),s)}function $0(e){return sh(e)&&e!=+e}function q0(e){if(wd(e))throw new ce(l);return Jc(e)}function L0(e){return e===null}function M0(e){return e==null}function sh(e){return typeof e=="number"||vt(e)&&Qt(e)==Te}function Ts(e){if(!vt(e)||Qt(e)!=Ie)return!1;var t=In(e);if(t===null)return!0;var s=Me.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&_n.call(s)==Df}var Oo=$i?hi($i):Lp;function j0(e){return ih(e)&&e>=-J&&e<=J}var nh=vs?hi(vs):Mp;function Xn(e){return typeof e=="string"||!fe(e)&&vt(e)&&Qt(e)==Je}function fi(e){return typeof e=="symbol"||vt(e)&&Qt(e)==Qe}var ss=Sr?hi(Sr):jp;function z0(e){return e===i}function U0(e){return vt(e)&&Vt(e)==ze}function k0(e){return vt(e)&&Qt(e)==Ye}var H0=kn(io),K0=kn(function(e,t){return e<=t});function ah(e){if(!e)return[];if(si(e))return Xn(e)?Ci(e):ri(e);if(ms&&e[ms])return Ef(e[ms]());var t=Vt(e),s=t==ye?Ha:t==$e?yn:ns;return s(e)}function Xi(e){if(!e)return e===0?e:0;if(e=xi(e),e===Re||e===-Re){var t=e<0?-1:1;return t*K}return e===e?e:0}function ve(e){var t=Xi(e),s=t%1;return t===t?s?t-s:t:0}function oh(e){return e?Or(ve(e),0,V):0}function xi(e){if(typeof e=="number")return e;if(fi(e))return j;if(ot(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ot(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Pc(e);var s=ma.test(e);return s||_a.test(e)?le(e.slice(2),s?2:8):ya.test(e)?j:+e}function ch(e){return Li(e,ni(e))}function V0(e){return e?Or(ve(e),-J,J):e===0?e:0}function qe(e){return e==null?"":li(e)}var B0=ts(function(e,t){if(Os(t)||si(t)){Li(t,jt(t),e);return}for(var s in t)Me.call(t,s)&&xs(e,s,t[s])}),uh=ts(function(e,t){Li(t,ni(t),e)}),Zn=ts(function(e,t,s,o){Li(t,ni(t),e,o)}),G0=ts(function(e,t,s,o){Li(t,jt(t),e,o)}),W0=Ji(Ja);function J0(e,t){var s=es(e);return t==null?s:Uc(s,t)}var Q0=_e(function(e,t){e=Ge(e);var s=-1,o=t.length,u=o>2?t[2]:i;for(u&&Yt(t[0],t[1],u)&&(o=1);++s<o;)for(var p=t[s],y=ni(p),m=-1,x=y.length;++m<x;){var N=y[m],D=e[N];(D===i||Oi(D,Yr[N])&&!Me.call(e,N))&&(e[N]=p[N])}return e}),Y0=_e(function(e){return e.push(i,Pu),Mt(hh,i,e)});function X0(e,t){return Ec(e,re(t,3),qi)}function Z0(e,t){return Ec(e,re(t,3),Ya)}function ev(e,t){return e==null?e:Qa(e,re(t,3),ni)}function tv(e,t){return e==null?e:Bc(e,re(t,3),ni)}function iv(e,t){return e&&qi(e,re(t,3))}function rv(e,t){return e&&Ya(e,re(t,3))}function sv(e){return e==null?[]:Dn(e,jt(e))}function nv(e){return e==null?[]:Dn(e,ni(e))}function Ro(e,t,s){var o=e==null?i:Rr(e,t);return o===i?s:o}function av(e,t){return e!=null&&Ou(e,t,Op)}function To(e,t){return e!=null&&Ou(e,t,Rp)}var ov=bu(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=bn.call(t)),e[t]=s},Fo(ai)),cv=bu(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=bn.call(t)),Me.call(e,t)?e[t].push(s):e[t]=[s]},re),uv=_e(Ss);function jt(e){return si(e)?jc(e):to(e)}function ni(e){return si(e)?jc(e,!0):zp(e)}function hv(e,t){var s={};return t=re(t,3),qi(e,function(o,u,p){Gi(s,t(o,u,p),o)}),s}function lv(e,t){var s={};return t=re(t,3),qi(e,function(o,u,p){Gi(s,u,t(o,u,p))}),s}var fv=ts(function(e,t,s){$n(e,t,s)}),hh=ts(function(e,t,s,o){$n(e,t,s,o)}),pv=Ji(function(e,t){var s={};if(e==null)return s;var o=!1;t=rt(t,function(p){return p=lr(p,e),o||(o=p.length>1),p}),Li(e,vo(e),s),o&&(s=_i(s,U|k|H,od));for(var u=t.length;u--;)oo(s,t[u]);return s});function dv(e,t){return lh(e,Qn(re(t)))}var gv=Ji(function(e,t){return e==null?{}:kp(e,t)});function lh(e,t){if(e==null)return{};var s=rt(vo(e),function(o){return[o]});return t=re(t),iu(e,s,function(o,u){return t(o,u[0])})}function vv(e,t,s){t=lr(t,e);var o=-1,u=t.length;for(u||(u=1,e=i);++o<u;){var p=e==null?i:e[Mi(t[o])];p===i&&(o=u,p=s),e=Yi(p)?p.call(e):p}return e}function yv(e,t,s){return e==null?e:Cs(e,t,s)}function mv(e,t,s,o){return o=typeof o=="function"?o:i,e==null?e:Cs(e,t,s,o)}var fh=Iu(jt),ph=Iu(ni);function wv(e,t,s){var o=fe(e),u=o||pr(e)||ss(e);if(t=re(t,4),s==null){var p=e&&e.constructor;u?s=o?new p:[]:ot(e)?s=Yi(p)?es(In(e)):{}:s={}}return(u?yi:qi)(e,function(y,m,x){return t(s,y,m,x)}),s}function _v(e,t){return e==null?!0:oo(e,t)}function bv(e,t,s){return e==null?e:ou(e,t,ho(s))}function Ev(e,t,s,o){return o=typeof o=="function"?o:i,e==null?e:ou(e,t,ho(s),o)}function ns(e){return e==null?[]:ka(e,jt(e))}function xv(e){return e==null?[]:ka(e,ni(e))}function Iv(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=xi(s),s=s===s?s:0),t!==i&&(t=xi(t),t=t===t?t:0),Or(xi(e),t,s)}function Sv(e,t,s){return t=Xi(t),s===i?(s=t,t=0):s=Xi(s),e=xi(e),Tp(e,t,s)}function Pv(e,t,s){if(s&&typeof s!="boolean"&&Yt(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=Xi(e),t===i?(t=e,e=0):t=Xi(t)),e>t){var o=e;e=t,t=o}if(s||e%1||t%1){var u=Lc();return Kt(e+u*(t-e+Ve("1e-"+((u+"").length-1))),t)}return so(e,t)}var Cv=is(function(e,t,s){return t=t.toLowerCase(),e+(s?dh(t):t)});function dh(e){return No(qe(e).toLowerCase())}function gh(e){return e=qe(e),e&&e.replace(Hi,yf).replace(Fa,"")}function Av(e,t,s){e=qe(e),t=li(t);var o=e.length;s=s===i?o:Or(ve(s),0,o);var u=s;return s-=t.length,s>=0&&e.slice(s,u)==t}function Ov(e){return e=qe(e),e&&tt.test(e)?e.replace(_r,mf):e}function Rv(e){return e=qe(e),e&&At.test(e)?e.replace(pt,"\\$&"):e}var Tv=is(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),Nv=is(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),Fv=mu("toLowerCase");function Dv(e,t,s){e=qe(e),t=ve(t);var o=t?Jr(e):0;if(!t||o>=t)return e;var u=(t-o)/2;return Un(An(u),s)+e+Un(Cn(u),s)}function $v(e,t,s){e=qe(e),t=ve(t);var o=t?Jr(e):0;return t&&o<t?e+Un(t-o,s):e}function qv(e,t,s){e=qe(e),t=ve(t);var o=t?Jr(e):0;return t&&o<t?Un(t-o,s)+e:e}function Lv(e,t,s){return s||t==null?t=0:t&&(t=+t),Kf(qe(e).replace(dt,""),t||0)}function Mv(e,t,s){return(s?Yt(e,t,s):t===i)?t=1:t=ve(t),no(qe(e),t)}function jv(){var e=arguments,t=qe(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var zv=is(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function Uv(e,t,s){return s&&typeof s!="number"&&Yt(e,t,s)&&(t=s=i),s=s===i?V:s>>>0,s?(e=qe(e),e&&(typeof t=="string"||t!=null&&!Oo(t))&&(t=li(t),!t&&Wr(e))?fr(Ci(e),0,s):e.split(t,s)):[]}var kv=is(function(e,t,s){return e+(s?" ":"")+No(t)});function Hv(e,t,s){return e=qe(e),s=s==null?0:Or(ve(s),0,e.length),t=li(t),e.slice(s,s+t.length)==t}function Kv(e,t,s){var o=f.templateSettings;s&&Yt(e,t,s)&&(t=i),e=qe(e),t=Zn({},t,o,Su);var u=Zn({},t.imports,o.imports,Su),p=jt(u),y=ka(u,p),m,x,N=0,D=t.interpolate||zr,L="__p += '",B=Ka((t.escape||zr).source+"|"+D.source+"|"+(D===at?va:zr).source+"|"+(t.evaluate||zr).source+"|$","g"),ee="//# sourceURL="+(Me.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Da+"]")+`
`;e.replace(B,function(ne,xe,Ce,pi,Xt,di){return Ce||(Ce=pi),L+=e.slice(N,di).replace(Ea,wf),xe&&(m=!0,L+=`' +
__e(`+xe+`) +
'`),Xt&&(x=!0,L+=`';
`+Xt+`;
__p += '`),Ce&&(L+=`' +
((__t = (`+Ce+`)) == null ? '' : __t) +
'`),N=di+ne.length,ne}),L+=`';
`;var se=Me.call(t,"variable")&&t.variable;if(!se)L=`with (obj) {
`+L+`
}
`;else if(da.test(se))throw new ce(v);L=(x?L.replace(Fi,""):L).replace(Wt,"$1").replace(ki,"$1;"),L="function("+(se||"obj")+`) {
`+(se?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+L+`return __p
}`;var me=yh(function(){return De(p,ee+"return "+L).apply(i,y)});if(me.source=L,Ao(me))throw me;return me}function Vv(e){return qe(e).toLowerCase()}function Bv(e){return qe(e).toUpperCase()}function Gv(e,t,s){if(e=qe(e),e&&(s||t===i))return Pc(e);if(!e||!(t=li(t)))return e;var o=Ci(e),u=Ci(t),p=Cc(o,u),y=Ac(o,u)+1;return fr(o,p,y).join("")}function Wv(e,t,s){if(e=qe(e),e&&(s||t===i))return e.slice(0,Rc(e)+1);if(!e||!(t=li(t)))return e;var o=Ci(e),u=Ac(o,Ci(t))+1;return fr(o,0,u).join("")}function Jv(e,t,s){if(e=qe(e),e&&(s||t===i))return e.replace(dt,"");if(!e||!(t=li(t)))return e;var o=Ci(e),u=Cc(o,Ci(t));return fr(o,u).join("")}function Qv(e,t){var s=te,o=Ee;if(ot(t)){var u="separator"in t?t.separator:u;s="length"in t?ve(t.length):s,o="omission"in t?li(t.omission):o}e=qe(e);var p=e.length;if(Wr(e)){var y=Ci(e);p=y.length}if(s>=p)return e;var m=s-Jr(o);if(m<1)return o;var x=y?fr(y,0,m).join(""):e.slice(0,m);if(u===i)return x+o;if(y&&(m+=x.length-m),Oo(u)){if(e.slice(m).search(u)){var N,D=x;for(u.global||(u=Ka(u.source,qe(gi.exec(u))+"g")),u.lastIndex=0;N=u.exec(D);)var L=N.index;x=x.slice(0,L===i?m:L)}}else if(e.indexOf(li(u),m)!=m){var B=x.lastIndexOf(u);B>-1&&(x=x.slice(0,B))}return x+o}function Yv(e){return e=qe(e),e&&ht.test(e)?e.replace(rr,Pf):e}var Xv=is(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),No=mu("toUpperCase");function vh(e,t,s){return e=qe(e),t=s?i:t,t===i?bf(e)?Of(e):ff(e):e.match(t)||[]}var yh=_e(function(e,t){try{return Mt(e,i,t)}catch(s){return Ao(s)?s:new ce(s)}}),Zv=Ji(function(e,t){return yi(t,function(s){s=Mi(s),Gi(e,s,Po(e[s],e))}),e});function ey(e){var t=e==null?0:e.length,s=re();return e=t?rt(e,function(o){if(typeof o[1]!="function")throw new mi(d);return[s(o[0]),o[1]]}):[],_e(function(o){for(var u=-1;++u<t;){var p=e[u];if(Mt(p[0],this,o))return Mt(p[1],this,o)}})}function ty(e){return Pp(_i(e,U))}function Fo(e){return function(){return e}}function iy(e,t){return e==null||e!==e?t:e}var ry=_u(),sy=_u(!0);function ai(e){return e}function Do(e){return Qc(typeof e=="function"?e:_i(e,U))}function ny(e){return Xc(_i(e,U))}function ay(e,t){return Zc(e,_i(t,U))}var oy=_e(function(e,t){return function(s){return Ss(s,e,t)}}),cy=_e(function(e,t){return function(s){return Ss(e,s,t)}});function $o(e,t,s){var o=jt(t),u=Dn(t,o);s==null&&!(ot(t)&&(u.length||!o.length))&&(s=t,t=e,e=this,u=Dn(t,jt(t)));var p=!(ot(s)&&"chain"in s)||!!s.chain,y=Yi(e);return yi(u,function(m){var x=t[m];e[m]=x,y&&(e.prototype[m]=function(){var N=this.__chain__;if(p||N){var D=e(this.__wrapped__),L=D.__actions__=ri(this.__actions__);return L.push({func:x,args:arguments,thisArg:e}),D.__chain__=N,D}return x.apply(e,ar([this.value()],arguments))})}),e}function uy(){return Pe._===this&&(Pe._=$f),this}function qo(){}function hy(e){return e=ve(e),_e(function(t){return eu(t,e)})}var ly=fo(rt),fy=fo(bc),py=fo(La);function mh(e){return _o(e)?Ma(Mi(e)):Hp(e)}function dy(e){return function(t){return e==null?i:Rr(e,t)}}var gy=Eu(),vy=Eu(!0);function Lo(){return[]}function Mo(){return!1}function yy(){return{}}function my(){return""}function wy(){return!0}function _y(e,t){if(e=ve(e),e<1||e>J)return[];var s=V,o=Kt(e,V);t=re(t),e-=V;for(var u=Ua(o,t);++s<e;)t(s);return u}function by(e){return fe(e)?rt(e,Mi):fi(e)?[e]:ri(Mu(qe(e)))}function Ey(e){var t=++Ff;return qe(e)+t}var xy=zn(function(e,t){return e+t},0),Iy=po("ceil"),Sy=zn(function(e,t){return e/t},1),Py=po("floor");function Cy(e){return e&&e.length?Fn(e,ai,Xa):i}function Ay(e,t){return e&&e.length?Fn(e,re(t,2),Xa):i}function Oy(e){return Ic(e,ai)}function Ry(e,t){return Ic(e,re(t,2))}function Ty(e){return e&&e.length?Fn(e,ai,io):i}function Ny(e,t){return e&&e.length?Fn(e,re(t,2),io):i}var Fy=zn(function(e,t){return e*t},1),Dy=po("round"),$y=zn(function(e,t){return e-t},0);function qy(e){return e&&e.length?za(e,ai):0}function Ly(e,t){return e&&e.length?za(e,re(t,2)):0}return f.after=n0,f.ary=Ju,f.assign=B0,f.assignIn=uh,f.assignInWith=Zn,f.assignWith=G0,f.at=W0,f.before=Qu,f.bind=Po,f.bindAll=Zv,f.bindKey=Yu,f.castArray=y0,f.chain=Bu,f.chunk=Pd,f.compact=Cd,f.concat=Ad,f.cond=ey,f.conforms=ty,f.constant=Fo,f.countBy=qg,f.create=J0,f.curry=Xu,f.curryRight=Zu,f.debounce=eh,f.defaults=Q0,f.defaultsDeep=Y0,f.defer=a0,f.delay=o0,f.difference=Od,f.differenceBy=Rd,f.differenceWith=Td,f.drop=Nd,f.dropRight=Fd,f.dropRightWhile=Dd,f.dropWhile=$d,f.fill=qd,f.filter=Mg,f.flatMap=Ug,f.flatMapDeep=kg,f.flatMapDepth=Hg,f.flatten=ku,f.flattenDeep=Ld,f.flattenDepth=Md,f.flip=c0,f.flow=ry,f.flowRight=sy,f.fromPairs=jd,f.functions=sv,f.functionsIn=nv,f.groupBy=Kg,f.initial=Ud,f.intersection=kd,f.intersectionBy=Hd,f.intersectionWith=Kd,f.invert=ov,f.invertBy=cv,f.invokeMap=Bg,f.iteratee=Do,f.keyBy=Gg,f.keys=jt,f.keysIn=ni,f.map=Gn,f.mapKeys=hv,f.mapValues=lv,f.matches=ny,f.matchesProperty=ay,f.memoize=Jn,f.merge=fv,f.mergeWith=hh,f.method=oy,f.methodOf=cy,f.mixin=$o,f.negate=Qn,f.nthArg=hy,f.omit=pv,f.omitBy=dv,f.once=u0,f.orderBy=Wg,f.over=ly,f.overArgs=h0,f.overEvery=fy,f.overSome=py,f.partial=Co,f.partialRight=th,f.partition=Jg,f.pick=gv,f.pickBy=lh,f.property=mh,f.propertyOf=dy,f.pull=Wd,f.pullAll=Ku,f.pullAllBy=Jd,f.pullAllWith=Qd,f.pullAt=Yd,f.range=gy,f.rangeRight=vy,f.rearg=l0,f.reject=Xg,f.remove=Xd,f.rest=f0,f.reverse=Io,f.sampleSize=e0,f.set=yv,f.setWith=mv,f.shuffle=t0,f.slice=Zd,f.sortBy=s0,f.sortedUniq=ag,f.sortedUniqBy=og,f.split=Uv,f.spread=p0,f.tail=cg,f.take=ug,f.takeRight=hg,f.takeRightWhile=lg,f.takeWhile=fg,f.tap=Cg,f.throttle=d0,f.thru=Bn,f.toArray=ah,f.toPairs=fh,f.toPairsIn=ph,f.toPath=by,f.toPlainObject=ch,f.transform=wv,f.unary=g0,f.union=pg,f.unionBy=dg,f.unionWith=gg,f.uniq=vg,f.uniqBy=yg,f.uniqWith=mg,f.unset=_v,f.unzip=So,f.unzipWith=Vu,f.update=bv,f.updateWith=Ev,f.values=ns,f.valuesIn=xv,f.without=wg,f.words=vh,f.wrap=v0,f.xor=_g,f.xorBy=bg,f.xorWith=Eg,f.zip=xg,f.zipObject=Ig,f.zipObjectDeep=Sg,f.zipWith=Pg,f.entries=fh,f.entriesIn=ph,f.extend=uh,f.extendWith=Zn,$o(f,f),f.add=xy,f.attempt=yh,f.camelCase=Cv,f.capitalize=dh,f.ceil=Iy,f.clamp=Iv,f.clone=m0,f.cloneDeep=_0,f.cloneDeepWith=b0,f.cloneWith=w0,f.conformsTo=E0,f.deburr=gh,f.defaultTo=iy,f.divide=Sy,f.endsWith=Av,f.eq=Oi,f.escape=Ov,f.escapeRegExp=Rv,f.every=Lg,f.find=jg,f.findIndex=zu,f.findKey=X0,f.findLast=zg,f.findLastIndex=Uu,f.findLastKey=Z0,f.floor=Py,f.forEach=Gu,f.forEachRight=Wu,f.forIn=ev,f.forInRight=tv,f.forOwn=iv,f.forOwnRight=rv,f.get=Ro,f.gt=x0,f.gte=I0,f.has=av,f.hasIn=To,f.head=Hu,f.identity=ai,f.includes=Vg,f.indexOf=zd,f.inRange=Sv,f.invoke=uv,f.isArguments=Fr,f.isArray=fe,f.isArrayBuffer=S0,f.isArrayLike=si,f.isArrayLikeObject=_t,f.isBoolean=P0,f.isBuffer=pr,f.isDate=C0,f.isElement=A0,f.isEmpty=O0,f.isEqual=R0,f.isEqualWith=T0,f.isError=Ao,f.isFinite=N0,f.isFunction=Yi,f.isInteger=ih,f.isLength=Yn,f.isMap=rh,f.isMatch=F0,f.isMatchWith=D0,f.isNaN=$0,f.isNative=q0,f.isNil=M0,f.isNull=L0,f.isNumber=sh,f.isObject=ot,f.isObjectLike=vt,f.isPlainObject=Ts,f.isRegExp=Oo,f.isSafeInteger=j0,f.isSet=nh,f.isString=Xn,f.isSymbol=fi,f.isTypedArray=ss,f.isUndefined=z0,f.isWeakMap=U0,f.isWeakSet=k0,f.join=Vd,f.kebabCase=Tv,f.last=Ei,f.lastIndexOf=Bd,f.lowerCase=Nv,f.lowerFirst=Fv,f.lt=H0,f.lte=K0,f.max=Cy,f.maxBy=Ay,f.mean=Oy,f.meanBy=Ry,f.min=Ty,f.minBy=Ny,f.stubArray=Lo,f.stubFalse=Mo,f.stubObject=yy,f.stubString=my,f.stubTrue=wy,f.multiply=Fy,f.nth=Gd,f.noConflict=uy,f.noop=qo,f.now=Wn,f.pad=Dv,f.padEnd=$v,f.padStart=qv,f.parseInt=Lv,f.random=Pv,f.reduce=Qg,f.reduceRight=Yg,f.repeat=Mv,f.replace=jv,f.result=vv,f.round=Dy,f.runInContext=E,f.sample=Zg,f.size=i0,f.snakeCase=zv,f.some=r0,f.sortedIndex=eg,f.sortedIndexBy=tg,f.sortedIndexOf=ig,f.sortedLastIndex=rg,f.sortedLastIndexBy=sg,f.sortedLastIndexOf=ng,f.startCase=kv,f.startsWith=Hv,f.subtract=$y,f.sum=qy,f.sumBy=Ly,f.template=Kv,f.times=_y,f.toFinite=Xi,f.toInteger=ve,f.toLength=oh,f.toLower=Vv,f.toNumber=xi,f.toSafeInteger=V0,f.toString=qe,f.toUpper=Bv,f.trim=Gv,f.trimEnd=Wv,f.trimStart=Jv,f.truncate=Qv,f.unescape=Yv,f.uniqueId=Ey,f.upperCase=Xv,f.upperFirst=No,f.each=Gu,f.eachRight=Wu,f.first=Hu,$o(f,function(){var e={};return qi(f,function(t,s){Me.call(f.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),f.VERSION=n,yi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),yi(["drop","take"],function(e,t){Se.prototype[e]=function(s){s=s===i?1:qt(ve(s),0);var o=this.__filtered__&&!t?new Se(this):this.clone();return o.__filtered__?o.__takeCount__=Kt(s,o.__takeCount__):o.__views__.push({size:Kt(s,V),type:e+(o.__dir__<0?"Right":"")}),o},Se.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),yi(["filter","map","takeWhile"],function(e,t){var s=t+1,o=s==C||s==je;Se.prototype[e]=function(u){var p=this.clone();return p.__iteratees__.push({iteratee:re(u,3),type:s}),p.__filtered__=p.__filtered__||o,p}}),yi(["head","last"],function(e,t){var s="take"+(t?"Right":"");Se.prototype[e]=function(){return this[s](1).value()[0]}}),yi(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[s](1)}}),Se.prototype.compact=function(){return this.filter(ai)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=_e(function(e,t){return typeof e=="function"?new Se(this):this.map(function(s){return Ss(s,e,t)})}),Se.prototype.reject=function(e){return this.filter(Qn(re(e)))},Se.prototype.slice=function(e,t){e=ve(e);var s=this;return s.__filtered__&&(e>0||t<0)?new Se(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=ve(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(V)},qi(Se.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),u=f[o?"take"+(t=="last"?"Right":""):t],p=o||/^find/.test(t);u&&(f.prototype[t]=function(){var y=this.__wrapped__,m=o?[1]:arguments,x=y instanceof Se,N=m[0],D=x||fe(y),L=function(xe){var Ce=u.apply(f,ar([xe],m));return o&&B?Ce[0]:Ce};D&&s&&typeof N=="function"&&N.length!=1&&(x=D=!1);var B=this.__chain__,ee=!!this.__actions__.length,se=p&&!B,me=x&&!ee;if(!p&&D){y=me?y:new Se(this);var ne=e.apply(y,m);return ne.__actions__.push({func:Bn,args:[L],thisArg:i}),new wi(ne,B)}return se&&me?e.apply(this,m):(ne=this.thru(L),se?o?ne.value()[0]:ne.value():ne)})}),yi(["pop","push","shift","sort","splice","unshift"],function(e){var t=mn[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",o=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var u=arguments;if(o&&!this.__chain__){var p=this.value();return t.apply(fe(p)?p:[],u)}return this[s](function(y){return t.apply(fe(y)?y:[],u)})}}),qi(Se.prototype,function(e,t){var s=f[t];if(s){var o=s.name+"";Me.call(Zr,o)||(Zr[o]=[]),Zr[o].push({name:t,func:s})}}),Zr[jn(i,be).name]=[{name:"wrapper",func:i}],Se.prototype.clone=Yf,Se.prototype.reverse=Xf,Se.prototype.value=Zf,f.prototype.at=Ag,f.prototype.chain=Og,f.prototype.commit=Rg,f.prototype.next=Tg,f.prototype.plant=Fg,f.prototype.reverse=Dg,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=$g,f.prototype.first=f.prototype.head,ms&&(f.prototype[ms]=Ng),f},Qr=Rf();wt?((wt.exports=Qr)._=Qr,Be._=Qr):Pe._=Qr}).call(Us)})(nc,nc.exports);var vb=Object.defineProperty,yb=Object.defineProperties,mb=Object.getOwnPropertyDescriptors,dl=Object.getOwnPropertySymbols,wb=Object.prototype.hasOwnProperty,_b=Object.prototype.propertyIsEnumerable,gl=(h,r,i)=>r in h?vb(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,ia=(h,r)=>{for(var i in r||(r={}))wb.call(r,i)&&gl(h,i,r[i]);if(dl)for(var i of dl(r))_b.call(r,i)&&gl(h,i,r[i]);return h},bb=(h,r)=>yb(h,mb(r));function fs(h,r,i){var n;const a=I1(h);return((n=r.rpcMap)==null?void 0:n[a.reference])||`${gb}?chainId=${a.namespace}:${a.reference}&projectId=${i}`}function jr(h){return h.includes(":")?h.split(":")[1]:h}function nf(h){return h.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function Eb(h,r){const i=Object.keys(r.namespaces).filter(a=>a.includes(h));if(!i.length)return[];const n=[];return i.forEach(a=>{const l=r.namespaces[a].accounts;n.push(...l)}),n}function xb(h={},r={}){const i=vl(h),n=vl(r);return nc.exports.merge(i,n)}function vl(h){var r,i,n,a;const l={};if(!na(h))return l;for(const[d,v]of Object.entries(h)){const w=Ol(d)?[d]:v.chains,I=v.methods||[],F=v.events||[],U=v.rpcMap||{},k=ks(d);l[k]=bb(ia(ia({},l[k]),v),{chains:zo(w,(r=l[k])==null?void 0:r.chains),methods:zo(I,(i=l[k])==null?void 0:i.methods),events:zo(F,(n=l[k])==null?void 0:n.events),rpcMap:ia(ia({},U),(a=l[k])==null?void 0:a.rpcMap)})}return l}function Ib(h){return h.includes(":")?h.split(":")[2]:h}function Sb(h){const r={};for(const[i,n]of Object.entries(h)){const a=n.methods||[],l=n.events||[],d=n.accounts||[],v=Ol(i)?[i]:n.chains?n.chains:nf(n.accounts);r[i]={chains:v,methods:a,events:l,accounts:d}}return r}function Yo(h){return typeof h=="number"?h:h.includes("0x")?parseInt(h,16):h.includes(":")?Number(h.split(":")[1]):Number(h)}const af={},Et=h=>af[h],Xo=(h,r)=>{af[h]=r};class Pb{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const a=jr(i);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||fs(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new mr(new Lr(n,Et("disableProviderPing")))}}class Cb{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=Et("events"),this.client=Et("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(parseInt(r),i),this.chainId=parseInt(r),this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||fs(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new mr(new Lr(n,Et("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const a=parseInt(jr(i));r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let a=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const l=parseInt(a,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class Ab{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const a=jr(i);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||fs(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new mr(new Lr(n,Et("disableProviderPing")))}}class Ob{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const a=jr(i);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||fs(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new mr(new Lr(n,Et("disableProviderPing")))}}class Rb{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i),a=jr(i);r[a]=this.createHttpProvider(a,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new mr(new Lr(n,Et("disableProviderPing")))}}class Tb{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const a=jr(i);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||fs(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new mr(new Lr(n,Et("disableProviderPing")))}}class Nb{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(wr.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const a=jr(i);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||fs(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new mr(new Lr(n,Et("disableProviderPing")))}}var Fb=Object.defineProperty,Db=Object.defineProperties,$b=Object.getOwnPropertyDescriptors,yl=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,Lb=Object.prototype.propertyIsEnumerable,ml=(h,r,i)=>r in h?Fb(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,ra=(h,r)=>{for(var i in r||(r={}))qb.call(r,i)&&ml(h,i,r[i]);if(yl)for(var i of yl(r))Lb.call(r,i)&&ml(h,i,r[i]);return h},Zo=(h,r)=>Db(h,$b(r));class wc{constructor(r){this.events=new uc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||fl})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const i=new wc(r);return await i.initialize(),i}async request(r,i){const[n,a]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:ra({},r),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(r,i,n){this.request(r,n).then(a=>i(null,a)).catch(a=>i(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:ei("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(l=>{this.session=l,this.namespaces||(this.namespaces=Sb(l.namespaces),this.persist("namespaces",this.namespaces))}).catch(l=>{if(l.message!==rf)throw l;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,a]=this.validateChain(r);this.getProvider(n).setDefaultChain(a,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(hs(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await lb.init({logger:this.providerOpts.logger||fl,relayUrl:this.providerOpts.relayUrl||fb,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>ks(i)))];Xo("client",this.client),Xo("events",this.events),Xo("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=Eb(i,this.session),a=nf(n),l=xb(this.namespaces,this.optionalNamespaces),d=Zo(ra({},l[i]),{accounts:n,chains:a});switch(i){case"eip155":this.rpcProviders[i]=new Cb({namespace:d});break;case"solana":this.rpcProviders[i]=new Ab({namespace:d});break;case"cosmos":this.rpcProviders[i]=new Ob({namespace:d});break;case"polkadot":this.rpcProviders[i]=new Pb({namespace:d});break;case"cip34":this.rpcProviders[i]=new Rb({namespace:d});break;case"elrond":this.rpcProviders[i]=new Tb({namespace:d});break;case"multiversx":this.rpcProviders[i]=new Nb({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const a=n.data;a&&hs(a)&&this.events.emit("accountsChanged",a.map(Ib))}else if(n.name==="chainChanged"){const a=i.chainId,l=i.event.data,d=ks(a),v=Yo(a)!==Yo(l)?`${d}:${Yo(l)}`:a;this.onChainChanged(v)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:a}=i,l=(n=this.client)==null?void 0:n.session.get(r);this.session=Zo(ra({},l),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",Zo(ra({},ei("USER_DISCONNECTED")),{data:r.topic}))}),this.on(wr.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:a}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(d=>ks(d)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const a=ks(Object.keys(this.namespaces)[0]),l=this.rpcProviders[a].getDefaultChain();return[a,l]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){var n;if(!this.namespaces)return;const[a,l]=this.validateChain(r);i||this.getProvider(a).setDefaultChain(l),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${pl}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${pl}/${r}`)}}const Mb=wc,jb="wc",zb="ethereum_provider",Ub=`${jb}@2:${zb}:`,kb="https://rpc.walletconnect.com/v1/",ac=["eth_sendTransaction","personal_sign"],Hb=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],oc=["chainChanged","accountsChanged"],Kb=["chainChanged","accountsChanged","message","disconnect","connect"];var Vb=Object.defineProperty,Bb=Object.defineProperties,Gb=Object.getOwnPropertyDescriptors,wl=Object.getOwnPropertySymbols,Wb=Object.prototype.hasOwnProperty,Jb=Object.prototype.propertyIsEnumerable,_l=(h,r,i)=>r in h?Vb(h,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):h[r]=i,Ks=(h,r)=>{for(var i in r||(r={}))Wb.call(r,i)&&_l(h,i,r[i]);if(wl)for(var i of wl(r))Jb.call(r,i)&&_l(h,i,r[i]);return h},bl=(h,r)=>Bb(h,Gb(r));function ua(h){return Number(h[0].split(":")[1])}function ec(h){return`0x${h.toString(16)}`}function Qb(h){const{chains:r,optionalChains:i,methods:n,optionalMethods:a,events:l,optionalEvents:d,rpcMap:v}=h;if(!hs(r))throw new Error("Invalid chains");const w={chains:r,methods:n||ac,events:l||oc,rpcMap:Ks({},r.length?{[ua(r)]:v[ua(r)]}:{})},I=l==null?void 0:l.filter(H=>!oc.includes(H)),F=n==null?void 0:n.filter(H=>!ac.includes(H));if(!i&&!d&&!a&&!(I!=null&&I.length)&&!(F!=null&&F.length))return{required:r.length?w:void 0};const U=(I==null?void 0:I.length)&&(F==null?void 0:F.length)||!i,k={chains:[...new Set(U?w.chains.concat(i||[]):i)],methods:[...new Set(w.methods.concat(a!=null&&a.length?a:Hb))],events:[...new Set(w.events.concat(d!=null&&d.length?d:Kb))],rpcMap:v};return{required:r.length?w:void 0,optional:i.length?k:void 0}}class _c{constructor(){this.events=new Ui.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Ub,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new _c;return await i.initialize(r),i}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,i){this.signer.sendAsync(r,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=Qb(this.rpc);try{const a=await new Promise(async(d,v)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(I=>{!I.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),v(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(bl(Ks({namespaces:Ks({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(I=>{d(I)}).catch(I=>{v(new Error(I.message))})});if(!a)return;const l=S1(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:l),this.setAccounts(l),this.events.emit("connect",{chainId:ec(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",ec(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",bl(Ks({},ei("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",ec(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,a]=r.split(":");return{chainId:`${i}:${n}`,address:a}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const a=(i=r==null?void 0:r.chains)!=null?i:[],l=(n=r==null?void 0:r.optionalChains)!=null?n:[],d=a.concat(l);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const v=a.length?(r==null?void 0:r.methods)||ac:[],w=a.length?(r==null?void 0:r.events)||oc:[],I=(r==null?void 0:r.optionalMethods)||[],F=(r==null?void 0:r.optionalEvents)||[],U=(r==null?void 0:r.rpcMap)||this.buildRpcMap(d,r.projectId),k=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(H=>this.formatChainId(H)),optionalChains:l.map(H=>this.formatChainId(H)),methods:v,events:w,optionalMethods:I,optionalEvents:F,rpcMap:U,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:k,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(a=>{n[a]=this.getRpcUrl(a,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?ua(this.rpc.chains):ua(this.rpc.optionalChains),this.signer=await Mb.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await P1(()=>import("./index-87d98877.js").then(a=>a.i),["assets/index-87d98877.js","assets/index-82a775d5.js","assets/index-8bcad974.css"]);i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(Ks({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:a}=r;i&&hs(i)&&(this.rpc.chains=i.map(l=>this.formatChainId(l)),i.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)})),n&&hs(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(l=>this.formatChainId(l)),n.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${kb}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i==null?void 0:i.accounts),this.setAccounts(i==null?void 0:i.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const uE=_c;export{uE as EthereumProvider,Kb as OPTIONAL_EVENTS,Hb as OPTIONAL_METHODS,oc as REQUIRED_EVENTS,ac as REQUIRED_METHODS,_c as default};
