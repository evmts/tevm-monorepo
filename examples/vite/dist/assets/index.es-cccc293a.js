import{e as fa,f as re,h as t1,w as Dl,r as ql,i as bc,t as pa,j as r1,k as i1,m as yi,D as n1,o as s1,N as X,p as a1,q as sc,s as o1,V as c1,R as u1,F as $h,K as h1,x as l1,L as f1,u as Fh,$ as p1,v as d1,y as Bn,Z as Dh,J as g1,X as y1,_ as jl,z as Rr,A as v1,B as _1,C as an,E as $t,U as er,G as gi,H as cr,I as m1,M as on,O as Ll,P as w1,Q as b1,S as E1,T as Ml,W as x1,Y as zl,a0 as Ul,a1 as un,a2 as ac,a3 as aa,a4 as hn,a5 as I1,a6 as oa,a7 as S1,a8 as P1,a9 as O1,aa as ra,ab as C1,ac as A1,ad as Ho,ae as qh,af as T1,ag as R1,ah as N1,ai as jh,aj as $1,ak as F1,al as D1,am as q1,an as j1,ao as L1,ap as M1,aq as kn,ar as kl,as as Ko,at as z1,au as U1,av as k1}from"./index-9fd9e1d6.js";import{e as Ur,E as Ec}from"./events-db1d9fc4.js";import{s as xc,i as Lh,c as H1,a as K1,b as Hl,f as Ic,p as V1,J as _i,d as Sc,e as Pc,g as Oc,h as di,j as ri,k as Vn,l as B1,m as G1,H as qi}from"./http-d435a746.js";import"@safe-globalThis/safe-apps-provider";import"@safe-globalThis/safe-apps-sdk";var da={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var oc=function(o,i){return oc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},oc(o,i)};function W1(o,i){oc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var cc=function(){return cc=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(i[c]=t[c])}return i},cc.apply(this,arguments)};function J1(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function Q1(o,i,t,n){var a=arguments.length,c=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,i,t,n);else for(var g=o.length-1;g>=0;g--)(f=o[g])&&(c=(a<3?f(c):a>3?f(i,t,c):f(i,t))||c);return a>3&&c&&Object.defineProperty(i,t,c),c}function Y1(o,i){return function(t,n){i(t,n,o)}}function X1(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function Z1(o,i,t,n){function a(c){return c instanceof t?c:new t(function(f){f(c)})}return new(t||(t=Promise))(function(c,f){function g(P){try{v(n.next(P))}catch(L){f(L)}}function m(P){try{v(n.throw(P))}catch(L){f(L)}}function v(P){P.done?c(P.value):a(P.value).then(g,m)}v((n=n.apply(o,i||[])).next())})}function e_(o,i){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,a,c,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(v){return function(P){return m([v,P])}}function m(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(c=v[0]&2?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[v[0]&2,c.value]),v[0]){case 0:case 1:c=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){t.label=v[1];break}if(v[0]===6&&t.label<c[1]){t.label=c[1],c=v;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(v);break}c[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=c=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function t_(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function r_(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function uc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kl(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,c=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(g){f={error:g}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return c}function i_(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Kl(arguments[i]));return o}function n_(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var c=arguments[i],f=0,g=c.length;f<g;f++,a++)n[a]=c[f];return n}function Gn(o){return this instanceof Gn?(this.v=o,this):new Gn(o)}function s_(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,c=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(T){n[T]&&(a[T]=function(U){return new Promise(function(k,K){c.push([T,U,k,K])>1||g(T,U)})})}function g(T,U){try{m(n[T](U))}catch(k){L(c[0][3],k)}}function m(T){T.value instanceof Gn?Promise.resolve(T.value.v).then(v,P):L(c[0][2],T)}function v(T){g("next",T)}function P(T){g("throw",T)}function L(T,U){T(U),c.shift(),c.length&&g(c[0][0],c[0][1])}}function a_(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,c){i[a]=o[a]?function(f){return(t=!t)?{value:Gn(o[a](f)),done:a==="return"}:c?c(f):f}:c}}function o_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof uc=="function"?uc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(f){return new Promise(function(g,m){f=o[c](f),a(g,m,f.done,f.value)})}}function a(c,f,g,m){Promise.resolve(m).then(function(v){c({value:v,done:g})},f)}}function c_(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function u_(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function h_(o){return o&&o.__esModule?o:{default:o}}function l_(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function f_(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const p_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return cc},__asyncDelegator:a_,__asyncGenerator:s_,__asyncValues:o_,__await:Gn,__awaiter:Z1,__classPrivateFieldGet:l_,__classPrivateFieldSet:f_,__createBinding:t_,__decorate:Q1,__exportStar:r_,__extends:W1,__generator:e_,__importDefault:h_,__importStar:u_,__makeTemplateObject:c_,__metadata:X1,__param:Y1,__read:Kl,__rest:J1,__spread:i_,__spreadArrays:n_,__values:uc},Symbol.toStringTag,{value:"Module"})),Vl=fa(p_);var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0});function d_(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return JSON.parse(o)}catch{return o}}Qn.safeJsonParse=d_;function g_(o){return typeof o=="string"?o:JSON.stringify(o,(i,t)=>typeof t>"u"?null:t)}Qn.safeJsonStringify=g_;var Nn={exports:{}},Mh;function y_(){return Mh||(Mh=1,function(){let o;function i(){}o=i,o.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},o.prototype.setItem=function(t,n){this[t]=String(n)},o.prototype.removeItem=function(t){delete this[t]},o.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(n){t[n]=void 0,delete t[n]})},o.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof globalThis<"u"&&globalThis.localStorage?Nn.exports=globalThis.localStorage:typeof window<"u"&&window.localStorage?Nn.exports=window.localStorage:Nn.exports=new i}()),Nn.exports}var Vo={},$n={},zh;function v_(){if(zh)return $n;zh=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.IKeyValueStorage=void 0;class o{}return $n.IKeyValueStorage=o,$n}var Fn={},Uh;function __(){if(Uh)return Fn;Uh=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.parseEntry=void 0;const o=Qn;function i(t){var n;return[t[0],o.safeJsonParse((n=t[1])!==null&&n!==void 0?n:"")]}return Fn.parseEntry=i,Fn}var kh;function m_(){return kh||(kh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0});const i=Vl;i.__exportStar(v_(),o),i.__exportStar(__(),o)}(Vo)),Vo}Object.defineProperty(da,"__esModule",{value:!0});da.KeyValueStorage=void 0;const cn=Vl,Hh=Qn,w_=cn.__importDefault(y_()),b_=m_();class Bl{constructor(){this.localStorage=w_.default}getKeys(){return cn.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return cn.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(b_.parseEntry)})}getItem(i){return cn.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(i);if(t!==null)return Hh.safeJsonParse(t)})}setItem(i,t){return cn.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(i,Hh.safeJsonStringify(t))})}removeItem(i){return cn.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(i)})}}da.KeyValueStorage=Bl;var E_=da.default=Bl,ln={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var hc=function(o,i){return hc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},hc(o,i)};function x_(o,i){hc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var lc=function(){return lc=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(i[c]=t[c])}return i},lc.apply(this,arguments)};function I_(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function S_(o,i,t,n){var a=arguments.length,c=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,i,t,n);else for(var g=o.length-1;g>=0;g--)(f=o[g])&&(c=(a<3?f(c):a>3?f(i,t,c):f(i,t))||c);return a>3&&c&&Object.defineProperty(i,t,c),c}function P_(o,i){return function(t,n){i(t,n,o)}}function O_(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function C_(o,i,t,n){function a(c){return c instanceof t?c:new t(function(f){f(c)})}return new(t||(t=Promise))(function(c,f){function g(P){try{v(n.next(P))}catch(L){f(L)}}function m(P){try{v(n.throw(P))}catch(L){f(L)}}function v(P){P.done?c(P.value):a(P.value).then(g,m)}v((n=n.apply(o,i||[])).next())})}function A_(o,i){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,a,c,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(v){return function(P){return m([v,P])}}function m(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(c=v[0]&2?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[v[0]&2,c.value]),v[0]){case 0:case 1:c=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){t.label=v[1];break}if(v[0]===6&&t.label<c[1]){t.label=c[1],c=v;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(v);break}c[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=c=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function T_(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function R_(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function fc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gl(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,c=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(g){f={error:g}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return c}function N_(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Gl(arguments[i]));return o}function $_(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var c=arguments[i],f=0,g=c.length;f<g;f++,a++)n[a]=c[f];return n}function Wn(o){return this instanceof Wn?(this.v=o,this):new Wn(o)}function F_(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,c=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(T){n[T]&&(a[T]=function(U){return new Promise(function(k,K){c.push([T,U,k,K])>1||g(T,U)})})}function g(T,U){try{m(n[T](U))}catch(k){L(c[0][3],k)}}function m(T){T.value instanceof Wn?Promise.resolve(T.value.v).then(v,P):L(c[0][2],T)}function v(T){g("next",T)}function P(T){g("throw",T)}function L(T,U){T(U),c.shift(),c.length&&g(c[0][0],c[0][1])}}function D_(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,c){i[a]=o[a]?function(f){return(t=!t)?{value:Wn(o[a](f)),done:a==="return"}:c?c(f):f}:c}}function q_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof fc=="function"?fc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(f){return new Promise(function(g,m){f=o[c](f),a(g,m,f.done,f.value)})}}function a(c,f,g,m){Promise.resolve(m).then(function(v){c({value:v,done:g})},f)}}function j_(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function L_(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function M_(o){return o&&o.__esModule?o:{default:o}}function z_(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function U_(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const k_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return lc},__asyncDelegator:D_,__asyncGenerator:F_,__asyncValues:q_,__await:Wn,__awaiter:C_,__classPrivateFieldGet:z_,__classPrivateFieldSet:U_,__createBinding:T_,__decorate:S_,__exportStar:R_,__extends:x_,__generator:A_,__importDefault:M_,__importStar:L_,__makeTemplateObject:j_,__metadata:O_,__param:P_,__read:Gl,__rest:I_,__spread:N_,__spreadArrays:$_,__values:fc},Symbol.toStringTag,{value:"Module"})),ga=fa(k_);var Dn={},Bo={},qn={};class ji{}const H_=Object.freeze(Object.defineProperty({__proto__:null,IEvents:ji},Symbol.toStringTag,{value:"Module"})),K_=fa(H_);var Kh;function V_(){if(Kh)return qn;Kh=1,Object.defineProperty(qn,"__esModule",{value:!0}),qn.IHeartBeat=void 0;const o=K_;class i extends o.IEvents{constructor(n){super()}}return qn.IHeartBeat=i,qn}var Vh;function Wl(){return Vh||(Vh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),ga.__exportStar(V_(),o)}(Bo)),Bo}var Go={},Fi={},Bh;function B_(){if(Bh)return Fi;Bh=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.HEARTBEAT_EVENTS=Fi.HEARTBEAT_INTERVAL=void 0;const o=re;return Fi.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Fi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Fi}var Gh;function Jl(){return Gh||(Gh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),ga.__exportStar(B_(),o)}(Go)),Go}var Wh;function G_(){if(Wh)return Dn;Wh=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.HeartBeat=void 0;const o=ga,i=Ur,t=re,n=Wl(),a=Jl();class c extends n.IHeartBeat{constructor(g){super(g),this.events=new i.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const m=new c(g);return yield m.init(),m})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,m){this.events.on(g,m)}once(g,m){this.events.once(g,m)}off(g,m){this.events.off(g,m)}removeListener(g,m){this.events.removeListener(g,m)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Dn.HeartBeat=c,Dn}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const i=ga;i.__exportStar(G_(),o),i.__exportStar(Wl(),o),i.__exportStar(Jl(),o)})(ln);var Ce={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var pc=function(o,i){return pc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},pc(o,i)};function W_(o,i){pc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var dc=function(){return dc=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(i[c]=t[c])}return i},dc.apply(this,arguments)};function J_(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function Q_(o,i,t,n){var a=arguments.length,c=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,i,t,n);else for(var g=o.length-1;g>=0;g--)(f=o[g])&&(c=(a<3?f(c):a>3?f(i,t,c):f(i,t))||c);return a>3&&c&&Object.defineProperty(i,t,c),c}function Y_(o,i){return function(t,n){i(t,n,o)}}function X_(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function Z_(o,i,t,n){function a(c){return c instanceof t?c:new t(function(f){f(c)})}return new(t||(t=Promise))(function(c,f){function g(P){try{v(n.next(P))}catch(L){f(L)}}function m(P){try{v(n.throw(P))}catch(L){f(L)}}function v(P){P.done?c(P.value):a(P.value).then(g,m)}v((n=n.apply(o,i||[])).next())})}function em(o,i){var t={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},n,a,c,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(v){return function(P){return m([v,P])}}function m(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(c=v[0]&2?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[v[0]&2,c.value]),v[0]){case 0:case 1:c=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(c=t.trys,!(c=c.length>0&&c[c.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){t.label=v[1];break}if(v[0]===6&&t.label<c[1]){t.label=c[1],c=v;break}if(c&&t.label<c[2]){t.label=c[2],t.ops.push(v);break}c[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=c=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function tm(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function rm(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function gc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ql(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,c=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)c.push(a.value)}catch(g){f={error:g}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return c}function im(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Ql(arguments[i]));return o}function nm(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var c=arguments[i],f=0,g=c.length;f<g;f++,a++)n[a]=c[f];return n}function Jn(o){return this instanceof Jn?(this.v=o,this):new Jn(o)}function sm(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,c=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(T){n[T]&&(a[T]=function(U){return new Promise(function(k,K){c.push([T,U,k,K])>1||g(T,U)})})}function g(T,U){try{m(n[T](U))}catch(k){L(c[0][3],k)}}function m(T){T.value instanceof Jn?Promise.resolve(T.value.v).then(v,P):L(c[0][2],T)}function v(T){g("next",T)}function P(T){g("throw",T)}function L(T,U){T(U),c.shift(),c.length&&g(c[0][0],c[0][1])}}function am(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,c){i[a]=o[a]?function(f){return(t=!t)?{value:Jn(o[a](f)),done:a==="return"}:c?c(f):f}:c}}function om(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof gc=="function"?gc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(c){t[c]=o[c]&&function(f){return new Promise(function(g,m){f=o[c](f),a(g,m,f.done,f.value)})}}function a(c,f,g,m){Promise.resolve(m).then(function(v){c({value:v,done:g})},f)}}function cm(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function um(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function hm(o){return o&&o.__esModule?o:{default:o}}function lm(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function fm(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const pm=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return dc},__asyncDelegator:am,__asyncGenerator:sm,__asyncValues:om,__await:Jn,__awaiter:Z_,__classPrivateFieldGet:lm,__classPrivateFieldSet:fm,__createBinding:tm,__decorate:Q_,__exportStar:rm,__extends:W_,__generator:em,__importDefault:hm,__importStar:um,__makeTemplateObject:cm,__metadata:X_,__param:Y_,__read:Ql,__rest:J_,__spread:im,__spreadArrays:nm,__values:gc},Symbol.toStringTag,{value:"Module"})),dm=fa(pm);var Wo,Jh;function gm(){if(Jh)return Wo;Jh=1;function o(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}Wo=i;function i(t,n,a){var c=a&&a.stringify||o,f=1;if(typeof t=="object"&&t!==null){var g=n.length+f;if(g===1)return t;var m=new Array(g);m[0]=c(t);for(var v=1;v<g;v++)m[v]=c(n[v]);return m.join(" ")}if(typeof t!="string")return t;var P=n.length;if(P===0)return t;for(var L="",T=1-f,U=-1,k=t&&t.length||0,K=0;K<k;){if(t.charCodeAt(K)===37&&K+1<k){switch(U=U>-1?U:0,t.charCodeAt(K+1)){case 100:case 102:if(T>=P||n[T]==null)break;U<K&&(L+=t.slice(U,K)),L+=Number(n[T]),U=K+2,K++;break;case 105:if(T>=P||n[T]==null)break;U<K&&(L+=t.slice(U,K)),L+=Math.floor(Number(n[T])),U=K+2,K++;break;case 79:case 111:case 106:if(T>=P||n[T]===void 0)break;U<K&&(L+=t.slice(U,K));var ae=typeof n[T];if(ae==="string"){L+="'"+n[T]+"'",U=K+2,K++;break}if(ae==="function"){L+=n[T].name||"<anonymous>",U=K+2,K++;break}L+=c(n[T]),U=K+2,K++;break;case 115:if(T>=P)break;U<K&&(L+=t.slice(U,K)),L+=String(n[T]),U=K+2,K++;break;case 37:U<K&&(L+=t.slice(U,K)),L+="%",U=K+2,K++,T--;break}++T}++K}return U===-1?t:(U<k&&(L+=t.slice(U)),L)}return Wo}var Jo,Qh;function ym(){if(Qh)return Jo;Qh=1;const o=gm();Jo=a;const i=he().console||{},t={mapHttpRequest:k,mapHttpResponse:k,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:k,res:k,err:T};function n(N,z){return Array.isArray(N)?N.filter(function(ge){return ge!=="!stdSerializers.err"}):N===!0?Object.keys(z):!1}function a(N){N=N||{},N.browser=N.browser||{};const z=N.browser.transmit;if(z&&typeof z.send!="function")throw Error("pino: transmit option must have a send function");const W=N.browser.write||i;N.browser.write&&(N.browser.asObject=!0);const ge=N.serializers||{},te=n(N.browser.serialize,ge);let Ee=N.browser.serialize;Array.isArray(N.browser.serialize)&&N.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ae=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),N.enabled===!1&&(N.level="silent");const et=N.level||"info",C=Object.create(W);C.log||(C.log=ae),Object.defineProperty(C,"levelVal",{get:Me}),Object.defineProperty(C,"level",{get:Te,set:J});const q={transmit:z,serialize:te,asObject:N.browser.asObject,levels:Ae,timestamp:U(N)};C.levels=a.levels,C.level=et,C.setMaxListeners=C.getMaxListeners=C.emit=C.addListener=C.on=C.prependListener=C.once=C.prependOnceListener=C.removeListener=C.removeAllListeners=C.listeners=C.listenerCount=C.eventNames=C.write=C.flush=ae,C.serializers=ge,C._serialize=te,C._stdErrSerialize=Ee,C.child=V,z&&(C._logEvent=L());function Me(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Te(){return this._level}function J(H){if(H!=="silent"&&!this.levels.values[H])throw Error("unknown level "+H);this._level=H,c(q,C,"error","log"),c(q,C,"fatal","error"),c(q,C,"warn","error"),c(q,C,"info","log"),c(q,C,"debug","log"),c(q,C,"trace","log")}function V(H,B){if(!H)throw new Error("missing bindings for child Pino");B=B||{},te&&H.serializers&&(B.serializers=H.serializers);const ct=B.serializers;if(te&&ct){var ke=Object.assign({},ge,ct),Nr=N.browser.serialize===!0?Object.keys(ke):te;delete H.serializers,m([H],Nr,ke,this._stdErrSerialize)}function me(xt){this._childLevel=(xt._childLevel|0)+1,this.error=v(xt,H,"error"),this.fatal=v(xt,H,"fatal"),this.warn=v(xt,H,"warn"),this.info=v(xt,H,"info"),this.debug=v(xt,H,"debug"),this.trace=v(xt,H,"trace"),ke&&(this.serializers=ke,this._serialize=Nr),z&&(this._logEvent=L([].concat(xt._logEvent.bindings,H)))}return me.prototype=this,new me(this)}return C}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=t,a.stdTimeFunctions=Object.assign({},{nullTime:be,epochTime:de,unixTime:pe,isoTime:ue});function c(N,z,W,ge){const te=Object.getPrototypeOf(z);z[W]=z.levelVal>z.levels.values[W]?ae:te[W]?te[W]:i[W]||i[ge]||ae,f(N,z,W)}function f(N,z,W){!N.transmit&&z[W]===ae||(z[W]=function(ge){return function(){const Ee=N.timestamp(),Ae=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var C=0;C<Ae.length;C++)Ae[C]=arguments[C];if(N.serialize&&!N.asObject&&m(Ae,this._serialize,this.serializers,this._stdErrSerialize),N.asObject?ge.call(et,g(this,W,Ae,Ee)):ge.apply(et,Ae),N.transmit){const q=N.transmit.level||z.level,Me=a.levels.values[q],Te=a.levels.values[W];if(Te<Me)return;P(this,{ts:Ee,methodLevel:W,methodValue:Te,transmitLevel:q,transmitValue:a.levels.values[N.transmit.level||z.level],send:N.transmit.send,val:z.levelVal},Ae)}}}(z[W]))}function g(N,z,W,ge){N._serialize&&m(W,N._serialize,N.serializers,N._stdErrSerialize);const te=W.slice();let Ee=te[0];const Ae={};ge&&(Ae.time=ge),Ae.level=a.levels.values[z];let et=(N._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof te[0]=="object";)Object.assign(Ae,te.shift());Ee=te.length?o(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=o(te.shift(),te));return Ee!==void 0&&(Ae.msg=Ee),Ae}function m(N,z,W,ge){for(const te in N)if(ge&&N[te]instanceof Error)N[te]=a.stdSerializers.err(N[te]);else if(typeof N[te]=="object"&&!Array.isArray(N[te]))for(const Ee in N[te])z&&z.indexOf(Ee)>-1&&Ee in W&&(N[te][Ee]=W[Ee](N[te][Ee]))}function v(N,z,W){return function(){const ge=new Array(1+arguments.length);ge[0]=z;for(var te=1;te<ge.length;te++)ge[te]=arguments[te-1];return N[W].apply(this,ge)}}function P(N,z,W){const ge=z.send,te=z.ts,Ee=z.methodLevel,Ae=z.methodValue,et=z.val,C=N._logEvent.bindings;m(W,N._serialize||Object.keys(N.serializers),N.serializers,N._stdErrSerialize===void 0?!0:N._stdErrSerialize),N._logEvent.ts=te,N._logEvent.messages=W.filter(function(q){return C.indexOf(q)===-1}),N._logEvent.level.label=Ee,N._logEvent.level.value=Ae,ge(Ee,N._logEvent,et),N._logEvent=L(C)}function L(N){return{ts:0,messages:[],bindings:N||[],level:{label:"",value:0}}}function T(N){const z={type:N.constructor.name,msg:N.message,stack:N.stack};for(const W in N)z[W]===void 0&&(z[W]=N[W]);return z}function U(N){return typeof N.timestamp=="function"?N.timestamp:N.timestamp===!1?be:de}function k(){return{}}function K(N){return N}function ae(){}function be(){return!1}function de(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function ue(){return new Date(Date.now()).toISOString()}function he(){function N(z){return typeof z<"u"&&z}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return N(self)||N(window)||N(this)||{}}}return Jo}var Di={},Yh;function Yl(){return Yh||(Yh=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.PINO_CUSTOM_CONTEXT_KEY=Di.PINO_LOGGER_DEFAULTS=void 0,Di.PINO_LOGGER_DEFAULTS={level:"info"},Di.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Di}var Zt={},Xh;function vm(){if(Xh)return Zt;Xh=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.generateChildLogger=Zt.formatChildLoggerContext=Zt.getLoggerContext=Zt.setBrowserLoggerContext=Zt.getBrowserLoggerContext=Zt.getDefaultLoggerOptions=void 0;const o=Yl();function i(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||o.PINO_LOGGER_DEFAULTS.level})}Zt.getDefaultLoggerOptions=i;function t(g,m=o.PINO_CUSTOM_CONTEXT_KEY){return g[m]||""}Zt.getBrowserLoggerContext=t;function n(g,m,v=o.PINO_CUSTOM_CONTEXT_KEY){return g[v]=m,g}Zt.setBrowserLoggerContext=n;function a(g,m=o.PINO_CUSTOM_CONTEXT_KEY){let v="";return typeof g.bindings>"u"?v=t(g,m):v=g.bindings().context||"",v}Zt.getLoggerContext=a;function c(g,m,v=o.PINO_CUSTOM_CONTEXT_KEY){const P=a(g,v);return P.trim()?`${P}/${m}`:m}Zt.formatChildLoggerContext=c;function f(g,m,v=o.PINO_CUSTOM_CONTEXT_KEY){const P=c(g,m,v),L=g.child({context:P});return n(L,P,v)}return Zt.generateChildLogger=f,Zt}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const i=dm,t=i.__importDefault(ym());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return t.default}}),i.__exportStar(Yl(),o),i.__exportStar(vm(),o)})(Ce);class _m extends ji{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class mm extends ji{constructor(i,t){super(),this.core=i,this.logger=t,this.records=new Map}}class wm{constructor(i,t){this.logger=i,this.core=t}}let bm=class extends ji{constructor(i,t){super(),this.relayer=i,this.logger=t}},Em=class extends ji{constructor(i){super()}},xm=class{constructor(i,t,n,a){this.core=i,this.logger=t,this.name=n}};class Im extends ji{constructor(i,t){super(),this.relayer=i,this.logger=t}}let Sm=class extends ji{constructor(i,t){super(),this.core=i,this.logger=t}},Pm=class{constructor(i,t){this.projectId=i,this.logger=t}},Om=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}},Cm=class{constructor(i){this.client=i}};var Cc={},Xl={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var i=t1,t=Dl;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var n=function(){function g(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},g.prototype.update=function(m,v){if(v===void 0&&(v=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var P=0;if(this._bytesHashed+=v,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&v>0;)this._buffer[this._bufferLength++]=m[P++],v--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(v>=this.blockSize&&(P=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,P,v),v%=this.blockSize);v>0;)this._buffer[this._bufferLength++]=m[P++],v--;return this},g.prototype.finish=function(m){if(!this._finished){var v=this._bytesHashed,P=this._bufferLength,L=v/536870912|0,T=v<<3,U=v%128<112?128:256;this._buffer[P]=128;for(var k=P+1;k<U-8;k++)this._buffer[k]=0;i.writeUint32BE(L,this._buffer,U-8),i.writeUint32BE(T,this._buffer,U-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,U),this._finished=!0}for(var k=0;k<this.digestLength/8;k++)i.writeUint32BE(this._stateHi[k],m,k*8),i.writeUint32BE(this._stateLo[k],m,k*8+4);return this},g.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(m){t.wipe(m.stateHi),t.wipe(m.stateLo),m.buffer&&t.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},g}();o.SHA512=n;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(g,m,v,P,L,T,U){for(var k=v[0],K=v[1],ae=v[2],be=v[3],de=v[4],pe=v[5],ue=v[6],he=v[7],N=P[0],z=P[1],W=P[2],ge=P[3],te=P[4],Ee=P[5],Ae=P[6],et=P[7],C,q,Me,Te,J,V,H,B;U>=128;){for(var ct=0;ct<16;ct++){var ke=8*ct+T;g[ct]=i.readUint32BE(L,ke),m[ct]=i.readUint32BE(L,ke+4)}for(var ct=0;ct<80;ct++){var Nr=k,me=K,xt=ae,R=be,A=de,S=pe,h=ue,b=he,Z=N,oe=z,ve=W,Re=ge,$e=te,Ie=Ee,It=Ae,vt=et;if(C=he,q=et,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=(de>>>14|te<<32-14)^(de>>>18|te<<32-18)^(te>>>41-32|de<<32-(41-32)),q=(te>>>14|de<<32-14)^(te>>>18|de<<32-18)^(de>>>41-32|te<<32-(41-32)),J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,C=de&pe^~de&ue,q=te&Ee^~te&Ae,J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,C=a[ct*2],q=a[ct*2+1],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,C=g[ct%16],q=m[ct%16],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,Me=H&65535|B<<16,Te=J&65535|V<<16,C=Me,q=Te,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=(k>>>28|N<<32-28)^(N>>>34-32|k<<32-(34-32))^(N>>>39-32|k<<32-(39-32)),q=(N>>>28|k<<32-28)^(k>>>34-32|N<<32-(34-32))^(k>>>39-32|N<<32-(39-32)),J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,C=k&K^k&ae^K&ae,q=N&z^N&W^z&W,J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,b=H&65535|B<<16,vt=J&65535|V<<16,C=R,q=Re,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=Me,q=Te,J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,R=H&65535|B<<16,Re=J&65535|V<<16,K=Nr,ae=me,be=xt,de=R,pe=A,ue=S,he=h,k=b,z=Z,W=oe,ge=ve,te=Re,Ee=$e,Ae=Ie,et=It,N=vt,ct%16===15)for(var ke=0;ke<16;ke++)C=g[ke],q=m[ke],J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=g[(ke+9)%16],q=m[(ke+9)%16],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,Me=g[(ke+1)%16],Te=m[(ke+1)%16],C=(Me>>>1|Te<<32-1)^(Me>>>8|Te<<32-8)^Me>>>7,q=(Te>>>1|Me<<32-1)^(Te>>>8|Me<<32-8)^(Te>>>7|Me<<32-7),J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,Me=g[(ke+14)%16],Te=m[(ke+14)%16],C=(Me>>>19|Te<<32-19)^(Te>>>61-32|Me<<32-(61-32))^Me>>>6,q=(Te>>>19|Me<<32-19)^(Me>>>61-32|Te<<32-(61-32))^(Te>>>6|Me<<32-6),J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,g[ke]=H&65535|B<<16,m[ke]=J&65535|V<<16}C=k,q=N,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=v[0],q=P[0],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,v[0]=k=H&65535|B<<16,P[0]=N=J&65535|V<<16,C=K,q=z,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=v[1],q=P[1],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,v[1]=K=H&65535|B<<16,P[1]=z=J&65535|V<<16,C=ae,q=W,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=v[2],q=P[2],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,v[2]=ae=H&65535|B<<16,P[2]=W=J&65535|V<<16,C=be,q=ge,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=v[3],q=P[3],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,v[3]=be=H&65535|B<<16,P[3]=ge=J&65535|V<<16,C=de,q=te,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=v[4],q=P[4],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,v[4]=de=H&65535|B<<16,P[4]=te=J&65535|V<<16,C=pe,q=Ee,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=v[5],q=P[5],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,v[5]=pe=H&65535|B<<16,P[5]=Ee=J&65535|V<<16,C=ue,q=Ae,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=v[6],q=P[6],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,v[6]=ue=H&65535|B<<16,P[6]=Ae=J&65535|V<<16,C=he,q=et,J=q&65535,V=q>>>16,H=C&65535,B=C>>>16,C=v[7],q=P[7],J+=q&65535,V+=q>>>16,H+=C&65535,B+=C>>>16,V+=J>>>16,H+=V>>>16,B+=H>>>16,v[7]=he=H&65535|B<<16,P[7]=et=J&65535|V<<16,T+=128,U-=128}return T}function f(g){var m=new n;m.update(g);var v=m.digest();return m.clean(),v}o.hash=f})(Xl);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const i=ql,t=Xl,n=Dl;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a(R){const A=new Float64Array(16);if(R)for(let S=0;S<R.length;S++)A[S]=R[S];return A}const c=new Uint8Array(32);c[0]=9;const f=a(),g=a([1]),m=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),v=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),P=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),L=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),T=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function U(R,A){for(let S=0;S<16;S++)R[S]=A[S]|0}function k(R){let A=1;for(let S=0;S<16;S++){let h=R[S]+A+65535;A=Math.floor(h/65536),R[S]=h-A*65536}R[0]+=A-1+37*(A-1)}function K(R,A,S){const h=~(S-1);for(let b=0;b<16;b++){const Z=h&(R[b]^A[b]);R[b]^=Z,A[b]^=Z}}function ae(R,A){const S=a(),h=a();for(let b=0;b<16;b++)h[b]=A[b];k(h),k(h),k(h);for(let b=0;b<2;b++){S[0]=h[0]-65517;for(let oe=1;oe<15;oe++)S[oe]=h[oe]-65535-(S[oe-1]>>16&1),S[oe-1]&=65535;S[15]=h[15]-32767-(S[14]>>16&1);const Z=S[15]>>16&1;S[14]&=65535,K(h,S,1-Z)}for(let b=0;b<16;b++)R[2*b]=h[b]&255,R[2*b+1]=h[b]>>8}function be(R,A){let S=0;for(let h=0;h<32;h++)S|=R[h]^A[h];return(1&S-1>>>8)-1}function de(R,A){const S=new Uint8Array(32),h=new Uint8Array(32);return ae(S,R),ae(h,A),be(S,h)}function pe(R){const A=new Uint8Array(32);return ae(A,R),A[0]&1}function ue(R,A){for(let S=0;S<16;S++)R[S]=A[2*S]+(A[2*S+1]<<8);R[15]&=32767}function he(R,A,S){for(let h=0;h<16;h++)R[h]=A[h]+S[h]}function N(R,A,S){for(let h=0;h<16;h++)R[h]=A[h]-S[h]}function z(R,A,S){let h,b,Z=0,oe=0,ve=0,Re=0,$e=0,Ie=0,It=0,vt=0,nt=0,De=0,Je=0,Qe=0,st=0,ze=0,Ye=0,Ne=0,He=0,ut=0,je=0,St=0,Ft=0,zt=0,Ut=0,jt=0,Gt=0,tr=0,$r=0,Wt=0,kr=0,ii=0,wi=0,ht=S[0],tt=S[1],lt=S[2],ft=S[3],at=S[4],rt=S[5],Pt=S[6],Ot=S[7],pt=S[8],Ct=S[9],dt=S[10],_t=S[11],gt=S[12],We=S[13],At=S[14],Tt=S[15];h=A[0],Z+=h*ht,oe+=h*tt,ve+=h*lt,Re+=h*ft,$e+=h*at,Ie+=h*rt,It+=h*Pt,vt+=h*Ot,nt+=h*pt,De+=h*Ct,Je+=h*dt,Qe+=h*_t,st+=h*gt,ze+=h*We,Ye+=h*At,Ne+=h*Tt,h=A[1],oe+=h*ht,ve+=h*tt,Re+=h*lt,$e+=h*ft,Ie+=h*at,It+=h*rt,vt+=h*Pt,nt+=h*Ot,De+=h*pt,Je+=h*Ct,Qe+=h*dt,st+=h*_t,ze+=h*gt,Ye+=h*We,Ne+=h*At,He+=h*Tt,h=A[2],ve+=h*ht,Re+=h*tt,$e+=h*lt,Ie+=h*ft,It+=h*at,vt+=h*rt,nt+=h*Pt,De+=h*Ot,Je+=h*pt,Qe+=h*Ct,st+=h*dt,ze+=h*_t,Ye+=h*gt,Ne+=h*We,He+=h*At,ut+=h*Tt,h=A[3],Re+=h*ht,$e+=h*tt,Ie+=h*lt,It+=h*ft,vt+=h*at,nt+=h*rt,De+=h*Pt,Je+=h*Ot,Qe+=h*pt,st+=h*Ct,ze+=h*dt,Ye+=h*_t,Ne+=h*gt,He+=h*We,ut+=h*At,je+=h*Tt,h=A[4],$e+=h*ht,Ie+=h*tt,It+=h*lt,vt+=h*ft,nt+=h*at,De+=h*rt,Je+=h*Pt,Qe+=h*Ot,st+=h*pt,ze+=h*Ct,Ye+=h*dt,Ne+=h*_t,He+=h*gt,ut+=h*We,je+=h*At,St+=h*Tt,h=A[5],Ie+=h*ht,It+=h*tt,vt+=h*lt,nt+=h*ft,De+=h*at,Je+=h*rt,Qe+=h*Pt,st+=h*Ot,ze+=h*pt,Ye+=h*Ct,Ne+=h*dt,He+=h*_t,ut+=h*gt,je+=h*We,St+=h*At,Ft+=h*Tt,h=A[6],It+=h*ht,vt+=h*tt,nt+=h*lt,De+=h*ft,Je+=h*at,Qe+=h*rt,st+=h*Pt,ze+=h*Ot,Ye+=h*pt,Ne+=h*Ct,He+=h*dt,ut+=h*_t,je+=h*gt,St+=h*We,Ft+=h*At,zt+=h*Tt,h=A[7],vt+=h*ht,nt+=h*tt,De+=h*lt,Je+=h*ft,Qe+=h*at,st+=h*rt,ze+=h*Pt,Ye+=h*Ot,Ne+=h*pt,He+=h*Ct,ut+=h*dt,je+=h*_t,St+=h*gt,Ft+=h*We,zt+=h*At,Ut+=h*Tt,h=A[8],nt+=h*ht,De+=h*tt,Je+=h*lt,Qe+=h*ft,st+=h*at,ze+=h*rt,Ye+=h*Pt,Ne+=h*Ot,He+=h*pt,ut+=h*Ct,je+=h*dt,St+=h*_t,Ft+=h*gt,zt+=h*We,Ut+=h*At,jt+=h*Tt,h=A[9],De+=h*ht,Je+=h*tt,Qe+=h*lt,st+=h*ft,ze+=h*at,Ye+=h*rt,Ne+=h*Pt,He+=h*Ot,ut+=h*pt,je+=h*Ct,St+=h*dt,Ft+=h*_t,zt+=h*gt,Ut+=h*We,jt+=h*At,Gt+=h*Tt,h=A[10],Je+=h*ht,Qe+=h*tt,st+=h*lt,ze+=h*ft,Ye+=h*at,Ne+=h*rt,He+=h*Pt,ut+=h*Ot,je+=h*pt,St+=h*Ct,Ft+=h*dt,zt+=h*_t,Ut+=h*gt,jt+=h*We,Gt+=h*At,tr+=h*Tt,h=A[11],Qe+=h*ht,st+=h*tt,ze+=h*lt,Ye+=h*ft,Ne+=h*at,He+=h*rt,ut+=h*Pt,je+=h*Ot,St+=h*pt,Ft+=h*Ct,zt+=h*dt,Ut+=h*_t,jt+=h*gt,Gt+=h*We,tr+=h*At,$r+=h*Tt,h=A[12],st+=h*ht,ze+=h*tt,Ye+=h*lt,Ne+=h*ft,He+=h*at,ut+=h*rt,je+=h*Pt,St+=h*Ot,Ft+=h*pt,zt+=h*Ct,Ut+=h*dt,jt+=h*_t,Gt+=h*gt,tr+=h*We,$r+=h*At,Wt+=h*Tt,h=A[13],ze+=h*ht,Ye+=h*tt,Ne+=h*lt,He+=h*ft,ut+=h*at,je+=h*rt,St+=h*Pt,Ft+=h*Ot,zt+=h*pt,Ut+=h*Ct,jt+=h*dt,Gt+=h*_t,tr+=h*gt,$r+=h*We,Wt+=h*At,kr+=h*Tt,h=A[14],Ye+=h*ht,Ne+=h*tt,He+=h*lt,ut+=h*ft,je+=h*at,St+=h*rt,Ft+=h*Pt,zt+=h*Ot,Ut+=h*pt,jt+=h*Ct,Gt+=h*dt,tr+=h*_t,$r+=h*gt,Wt+=h*We,kr+=h*At,ii+=h*Tt,h=A[15],Ne+=h*ht,He+=h*tt,ut+=h*lt,je+=h*ft,St+=h*at,Ft+=h*rt,zt+=h*Pt,Ut+=h*Ot,jt+=h*pt,Gt+=h*Ct,tr+=h*dt,$r+=h*_t,Wt+=h*gt,kr+=h*We,ii+=h*At,wi+=h*Tt,Z+=38*He,oe+=38*ut,ve+=38*je,Re+=38*St,$e+=38*Ft,Ie+=38*zt,It+=38*Ut,vt+=38*jt,nt+=38*Gt,De+=38*tr,Je+=38*$r,Qe+=38*Wt,st+=38*kr,ze+=38*ii,Ye+=38*wi,b=1,h=Z+b+65535,b=Math.floor(h/65536),Z=h-b*65536,h=oe+b+65535,b=Math.floor(h/65536),oe=h-b*65536,h=ve+b+65535,b=Math.floor(h/65536),ve=h-b*65536,h=Re+b+65535,b=Math.floor(h/65536),Re=h-b*65536,h=$e+b+65535,b=Math.floor(h/65536),$e=h-b*65536,h=Ie+b+65535,b=Math.floor(h/65536),Ie=h-b*65536,h=It+b+65535,b=Math.floor(h/65536),It=h-b*65536,h=vt+b+65535,b=Math.floor(h/65536),vt=h-b*65536,h=nt+b+65535,b=Math.floor(h/65536),nt=h-b*65536,h=De+b+65535,b=Math.floor(h/65536),De=h-b*65536,h=Je+b+65535,b=Math.floor(h/65536),Je=h-b*65536,h=Qe+b+65535,b=Math.floor(h/65536),Qe=h-b*65536,h=st+b+65535,b=Math.floor(h/65536),st=h-b*65536,h=ze+b+65535,b=Math.floor(h/65536),ze=h-b*65536,h=Ye+b+65535,b=Math.floor(h/65536),Ye=h-b*65536,h=Ne+b+65535,b=Math.floor(h/65536),Ne=h-b*65536,Z+=b-1+37*(b-1),b=1,h=Z+b+65535,b=Math.floor(h/65536),Z=h-b*65536,h=oe+b+65535,b=Math.floor(h/65536),oe=h-b*65536,h=ve+b+65535,b=Math.floor(h/65536),ve=h-b*65536,h=Re+b+65535,b=Math.floor(h/65536),Re=h-b*65536,h=$e+b+65535,b=Math.floor(h/65536),$e=h-b*65536,h=Ie+b+65535,b=Math.floor(h/65536),Ie=h-b*65536,h=It+b+65535,b=Math.floor(h/65536),It=h-b*65536,h=vt+b+65535,b=Math.floor(h/65536),vt=h-b*65536,h=nt+b+65535,b=Math.floor(h/65536),nt=h-b*65536,h=De+b+65535,b=Math.floor(h/65536),De=h-b*65536,h=Je+b+65535,b=Math.floor(h/65536),Je=h-b*65536,h=Qe+b+65535,b=Math.floor(h/65536),Qe=h-b*65536,h=st+b+65535,b=Math.floor(h/65536),st=h-b*65536,h=ze+b+65535,b=Math.floor(h/65536),ze=h-b*65536,h=Ye+b+65535,b=Math.floor(h/65536),Ye=h-b*65536,h=Ne+b+65535,b=Math.floor(h/65536),Ne=h-b*65536,Z+=b-1+37*(b-1),R[0]=Z,R[1]=oe,R[2]=ve,R[3]=Re,R[4]=$e,R[5]=Ie,R[6]=It,R[7]=vt,R[8]=nt,R[9]=De,R[10]=Je,R[11]=Qe,R[12]=st,R[13]=ze,R[14]=Ye,R[15]=Ne}function W(R,A){z(R,A,A)}function ge(R,A){const S=a();let h;for(h=0;h<16;h++)S[h]=A[h];for(h=253;h>=0;h--)W(S,S),h!==2&&h!==4&&z(S,S,A);for(h=0;h<16;h++)R[h]=S[h]}function te(R,A){const S=a();let h;for(h=0;h<16;h++)S[h]=A[h];for(h=250;h>=0;h--)W(S,S),h!==1&&z(S,S,A);for(h=0;h<16;h++)R[h]=S[h]}function Ee(R,A){const S=a(),h=a(),b=a(),Z=a(),oe=a(),ve=a(),Re=a(),$e=a(),Ie=a();N(S,R[1],R[0]),N(Ie,A[1],A[0]),z(S,S,Ie),he(h,R[0],R[1]),he(Ie,A[0],A[1]),z(h,h,Ie),z(b,R[3],A[3]),z(b,b,v),z(Z,R[2],A[2]),he(Z,Z,Z),N(oe,h,S),N(ve,Z,b),he(Re,Z,b),he($e,h,S),z(R[0],oe,ve),z(R[1],$e,Re),z(R[2],Re,ve),z(R[3],oe,$e)}function Ae(R,A,S){for(let h=0;h<4;h++)K(R[h],A[h],S)}function et(R,A){const S=a(),h=a(),b=a();ge(b,A[2]),z(S,A[0],b),z(h,A[1],b),ae(R,h),R[31]^=pe(S)<<7}function C(R,A,S){U(R[0],f),U(R[1],g),U(R[2],g),U(R[3],f);for(let h=255;h>=0;--h){const b=S[h/8|0]>>(h&7)&1;Ae(R,A,b),Ee(A,R),Ee(R,R),Ae(R,A,b)}}function q(R,A){const S=[a(),a(),a(),a()];U(S[0],P),U(S[1],L),U(S[2],g),z(S[3],P,L),C(R,S,A)}function Me(R){if(R.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const A=(0,t.hash)(R);A[0]&=248,A[31]&=127,A[31]|=64;const S=new Uint8Array(32),h=[a(),a(),a(),a()];q(h,A),et(S,h);const b=new Uint8Array(64);return b.set(R),b.set(S,32),{publicKey:S,secretKey:b}}o.generateKeyPairFromSeed=Me;function Te(R){const A=(0,i.randomBytes)(32,R),S=Me(A);return(0,n.wipe)(A),S}o.generateKeyPair=Te;function J(R){if(R.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(R.subarray(32))}o.extractPublicKeyFromSecretKey=J;const V=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function H(R,A){let S,h,b,Z;for(h=63;h>=32;--h){for(S=0,b=h-32,Z=h-12;b<Z;++b)A[b]+=S-16*A[h]*V[b-(h-32)],S=Math.floor((A[b]+128)/256),A[b]-=S*256;A[b]+=S,A[h]=0}for(S=0,b=0;b<32;b++)A[b]+=S-(A[31]>>4)*V[b],S=A[b]>>8,A[b]&=255;for(b=0;b<32;b++)A[b]-=S*V[b];for(h=0;h<32;h++)A[h+1]+=A[h]>>8,R[h]=A[h]&255}function B(R){const A=new Float64Array(64);for(let S=0;S<64;S++)A[S]=R[S];for(let S=0;S<64;S++)R[S]=0;H(R,A)}function ct(R,A){const S=new Float64Array(64),h=[a(),a(),a(),a()],b=(0,t.hash)(R.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const Z=new Uint8Array(64);Z.set(b.subarray(32),32);const oe=new t.SHA512;oe.update(Z.subarray(32)),oe.update(A);const ve=oe.digest();oe.clean(),B(ve),q(h,ve),et(Z,h),oe.reset(),oe.update(Z.subarray(0,32)),oe.update(R.subarray(32)),oe.update(A);const Re=oe.digest();B(Re);for(let $e=0;$e<32;$e++)S[$e]=ve[$e];for(let $e=0;$e<32;$e++)for(let Ie=0;Ie<32;Ie++)S[$e+Ie]+=Re[$e]*b[Ie];return H(Z.subarray(32),S),Z}o.sign=ct;function ke(R,A){const S=a(),h=a(),b=a(),Z=a(),oe=a(),ve=a(),Re=a();return U(R[2],g),ue(R[1],A),W(b,R[1]),z(Z,b,m),N(b,b,R[2]),he(Z,R[2],Z),W(oe,Z),W(ve,oe),z(Re,ve,oe),z(S,Re,b),z(S,S,Z),te(S,S),z(S,S,b),z(S,S,Z),z(S,S,Z),z(R[0],S,Z),W(h,R[0]),z(h,h,Z),de(h,b)&&z(R[0],R[0],T),W(h,R[0]),z(h,h,Z),de(h,b)?-1:(pe(R[0])===A[31]>>7&&N(R[0],f,R[0]),z(R[3],R[0],R[1]),0)}function Nr(R,A,S){const h=new Uint8Array(32),b=[a(),a(),a(),a()],Z=[a(),a(),a(),a()];if(S.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(ke(Z,R))return!1;const oe=new t.SHA512;oe.update(S.subarray(0,32)),oe.update(R),oe.update(A);const ve=oe.digest();return B(ve),C(b,Z,ve),q(Z,S.subarray(32)),Ee(b,Z),et(h,b),!be(S,h)}o.verify=Nr;function me(R){let A=[a(),a(),a(),a()];if(ke(A,R))throw new Error("Ed25519: invalid public key");let S=a(),h=a(),b=A[1];he(S,g,b),N(h,g,b),ge(h,h),z(S,S,h);let Z=new Uint8Array(32);return ae(Z,S),Z}o.convertPublicKeyToX25519=me;function xt(R){const A=(0,t.hash)(R.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const S=new Uint8Array(A.subarray(0,32));return(0,n.wipe)(A),S}o.convertSecretKeyToX25519=xt})(Cc);const Am="EdDSA",Tm="JWT",Zl=".",ef="base64url",Rm="utf8",Nm="utf8",$m=":",Fm="did",Dm="key",Zh="base58btc",qm="z",jm="K36",Lm=32;function ua(o){return pa(bc(xc(o),Rm),ef)}function tf(o){const i=bc(jm,Zh),t=qm+pa(r1([i,o]),Zh);return[Fm,Dm,t].join($m)}function Mm(o){return pa(o,ef)}function zm(o){return bc([ua(o.header),ua(o.payload)].join(Zl),Nm)}function Um(o){return[ua(o.header),ua(o.payload),Mm(o.signature)].join(Zl)}function el(o=ql.randomBytes(Lm)){return Cc.generateKeyPairFromSeed(o)}async function km(o,i,t,n,a=re.fromMiliseconds(Date.now())){const c={alg:Am,typ:Tm},f=tf(n.publicKey),g=a+t,m={iss:f,sub:o,aud:i,iat:a,exp:g},v=zm({header:c,payload:m}),P=Cc.sign(n.secretKey,v);return Um({header:c,payload:m,signature:P})}const Hm=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Km=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",tl=o=>o.split("?")[0],rl=10,Vm=Hm();class Bm{constructor(i){if(this.url=i,this.events=new Ur.EventEmitter,this.registering=!1,!Lh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}off(i,t){this.events.off(i,t)}removeListener(i,t){this.events.removeListener(i,t)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),i()},this.socket.close()})}async send(i,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(xc(i))}catch(n){this.onError(i.id,n)}}register(i=this.url){if(!Lh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,a)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),a(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=i,this.registering=!0,new Promise((t,n)=>{const a=H1.isReactNative()?void 0:{rejectUnauthorized:!K1(i)},c=new Vm(i,[],a);Km()?c.onerror=f=>{const g=f;n(this.emitError(g.error))}:c.on("error",f=>{n(this.emitError(f))}),c.onopen=()=>{this.onOpen(c),t(c)}})}onOpen(i){i.onmessage=t=>this.onPayload(t),i.onclose=t=>this.onClose(t),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const t=typeof i.data=="string"?Hl(i.data):i.data;this.events.emit("payload",t)}onError(i,t){const n=this.parseError(t),a=n.message||n.toString(),c=Ic(i,a);this.events.emit("payload",c)}parseError(i,t=this.url){return V1(i,tl(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>rl&&this.events.setMaxListeners(rl)}emitError(i){const t=this.parseError(new Error((i==null?void 0:i.message)||`WebSocket connection failed for host: ${tl(this.url)}`));return this.events.emit("register_error",t),t}}var ha={exports:{}};ha.exports;(function(o,i){var t=200,n="__lodash_hash_undefined__",a=1,c=2,f=9007199254740991,g="[object Arguments]",m="[object Array]",v="[object AsyncFunction]",P="[object Boolean]",L="[object Date]",T="[object Error]",U="[object Function]",k="[object GeneratorFunction]",K="[object Map]",ae="[object Number]",be="[object Null]",de="[object Object]",pe="[object Promise]",ue="[object Proxy]",he="[object RegExp]",N="[object Set]",z="[object String]",W="[object Symbol]",ge="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Ae="[object DataView]",et="[object Float32Array]",C="[object Float64Array]",q="[object Int8Array]",Me="[object Int16Array]",Te="[object Int32Array]",J="[object Uint8Array]",V="[object Uint8ClampedArray]",H="[object Uint16Array]",B="[object Uint32Array]",ct=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,Nr=/^(?:0|[1-9]\d*)$/,me={};me[et]=me[C]=me[q]=me[Me]=me[Te]=me[J]=me[V]=me[H]=me[B]=!0,me[g]=me[m]=me[Ee]=me[P]=me[Ae]=me[L]=me[T]=me[U]=me[K]=me[ae]=me[de]=me[he]=me[N]=me[z]=me[te]=!1;var xt=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,R=typeof self=="object"&&self&&self.Object===Object&&self,A=xt||R||Function("return this")(),S=i&&!i.nodeType&&i,h=S&&!0&&o&&!o.nodeType&&o,b=h&&h.exports===S,Z=b&&xt.process,oe=function(){try{return Z&&Z.binding&&Z.binding("util")}catch{}}(),ve=oe&&oe.isTypedArray;function Re(y,E){for(var j=-1,Q=y==null?0:y.length,Ve=0,le=[];++j<Q;){var Xe=y[j];E(Xe,j,y)&&(le[Ve++]=Xe)}return le}function $e(y,E){for(var j=-1,Q=E.length,Ve=y.length;++j<Q;)y[Ve+j]=E[j];return y}function Ie(y,E){for(var j=-1,Q=y==null?0:y.length;++j<Q;)if(E(y[j],j,y))return!0;return!1}function It(y,E){for(var j=-1,Q=Array(y);++j<y;)Q[j]=E(j);return Q}function vt(y){return function(E){return y(E)}}function nt(y,E){return y.has(E)}function De(y,E){return y==null?void 0:y[E]}function Je(y){var E=-1,j=Array(y.size);return y.forEach(function(Q,Ve){j[++E]=[Ve,Q]}),j}function Qe(y,E){return function(j){return y(E(j))}}function st(y){var E=-1,j=Array(y.size);return y.forEach(function(Q){j[++E]=Q}),j}var ze=Array.prototype,Ye=Function.prototype,Ne=Object.prototype,He=A["__core-js_shared__"],ut=Ye.toString,je=Ne.hasOwnProperty,St=function(){var y=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),Ft=Ne.toString,zt=RegExp("^"+ut.call(je).replace(ct,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ut=b?A.Buffer:void 0,jt=A.Symbol,Gt=A.Uint8Array,tr=Ne.propertyIsEnumerable,$r=ze.splice,Wt=jt?jt.toStringTag:void 0,kr=Object.getOwnPropertySymbols,ii=Ut?Ut.isBuffer:void 0,wi=Qe(Object.keys,Object),ht=ur(A,"DataView"),tt=ur(A,"Map"),lt=ur(A,"Promise"),ft=ur(A,"Set"),at=ur(A,"WeakMap"),rt=ur(Object,"create"),Pt=Kr(ht),Ot=Kr(tt),pt=Kr(lt),Ct=Kr(ft),dt=Kr(at),_t=jt?jt.prototype:void 0,gt=_t?_t.valueOf:void 0;function We(y){var E=-1,j=y==null?0:y.length;for(this.clear();++E<j;){var Q=y[E];this.set(Q[0],Q[1])}}function At(){this.__data__=rt?rt(null):{},this.size=0}function Tt(y){var E=this.has(y)&&delete this.__data__[y];return this.size-=E?1:0,E}function _a(y){var E=this.__data__;if(rt){var j=E[y];return j===n?void 0:j}return je.call(E,y)?E[y]:void 0}function ma(y){var E=this.__data__;return rt?E[y]!==void 0:je.call(E,y)}function wa(y,E){var j=this.__data__;return this.size+=this.has(y)?0:1,j[y]=rt&&E===void 0?n:E,this}We.prototype.clear=At,We.prototype.delete=Tt,We.prototype.get=_a,We.prototype.has=ma,We.prototype.set=wa;function gr(y){var E=-1,j=y==null?0:y.length;for(this.clear();++E<j;){var Q=y[E];this.set(Q[0],Q[1])}}function ba(){this.__data__=[],this.size=0}function Ea(y){var E=this.__data__,j=bi(E,y);if(j<0)return!1;var Q=E.length-1;return j==Q?E.pop():$r.call(E,j,1),--this.size,!0}function xa(y){var E=this.__data__,j=bi(E,y);return j<0?void 0:E[j][1]}function Ia(y){return bi(this.__data__,y)>-1}function Sa(y,E){var j=this.__data__,Q=bi(j,y);return Q<0?(++this.size,j.push([y,E])):j[Q][1]=E,this}gr.prototype.clear=ba,gr.prototype.delete=Ea,gr.prototype.get=xa,gr.prototype.has=Ia,gr.prototype.set=Sa;function Hr(y){var E=-1,j=y==null?0:y.length;for(this.clear();++E<j;){var Q=y[E];this.set(Q[0],Q[1])}}function Mi(){this.size=0,this.__data__={hash:new We,map:new(tt||gr),string:new We}}function Pa(y){var E=ni(this,y).delete(y);return this.size-=E?1:0,E}function zi(y){return ni(this,y).get(y)}function Oa(y){return ni(this,y).has(y)}function Ca(y,E){var j=ni(this,y),Q=j.size;return j.set(y,E),this.size+=j.size==Q?0:1,this}Hr.prototype.clear=Mi,Hr.prototype.delete=Pa,Hr.prototype.get=zi,Hr.prototype.has=Oa,Hr.prototype.set=Ca;function Ui(y){var E=-1,j=y==null?0:y.length;for(this.__data__=new Hr;++E<j;)this.add(y[E])}function Xn(y){return this.__data__.set(y,n),this}function Zn(y){return this.__data__.has(y)}Ui.prototype.add=Ui.prototype.push=Xn,Ui.prototype.has=Zn;function Sr(y){var E=this.__data__=new gr(y);this.size=E.size}function Aa(){this.__data__=new gr,this.size=0}function Ta(y){var E=this.__data__,j=E.delete(y);return this.size=E.size,j}function Ra(y){return this.__data__.get(y)}function Na(y){return this.__data__.has(y)}function es(y,E){var j=this.__data__;if(j instanceof gr){var Q=j.__data__;if(!tt||Q.length<t-1)return Q.push([y,E]),this.size=++j.size,this;j=this.__data__=new Hr(Q)}return j.set(y,E),this.size=j.size,this}Sr.prototype.clear=Aa,Sr.prototype.delete=Ta,Sr.prototype.get=Ra,Sr.prototype.has=Na,Sr.prototype.set=es;function ts(y,E){var j=Ki(y),Q=!j&&ps(y),Ve=!j&&!Q&&gn(y),le=!j&&!Q&&!Ve&&ys(y),Xe=j||Q||Ve||le,Rt=Xe?It(y.length,String):[],Pe=Rt.length;for(var Be in y)(E||je.call(y,Be))&&!(Xe&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||le&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||cs(Be,Pe)))&&Rt.push(Be);return Rt}function bi(y,E){for(var j=y.length;j--;)if(fs(y[j][0],E))return j;return-1}function pn(y,E,j){var Q=E(y);return Ki(y)?Q:$e(Q,j(y))}function Ei(y){return y==null?y===void 0?ge:be:Wt&&Wt in Object(y)?as(y):Da(y)}function dn(y){return Ii(y)&&Ei(y)==g}function xi(y,E,j,Q,Ve){return y===E?!0:y==null||E==null||!Ii(y)&&!Ii(E)?y!==y&&E!==E:rs(y,E,j,Q,xi,Ve)}function rs(y,E,j,Q,Ve,le){var Xe=Ki(y),Rt=Ki(E),Pe=Xe?m:Fr(y),Be=Rt?m:Fr(E);Pe=Pe==g?de:Pe,Be=Be==g?de:Be;var mt=Pe==de,rr=Be==de,Nt=Pe==Be;if(Nt&&gn(y)){if(!gn(E))return!1;Xe=!0,mt=!1}if(Nt&&!mt)return le||(le=new Sr),Xe||ys(y)?ki(y,E,j,Q,Ve,le):Fa(y,E,Pe,j,Q,Ve,le);if(!(j&a)){var Ze=mt&&je.call(y,"__wrapped__"),Jt=rr&&je.call(E,"__wrapped__");if(Ze||Jt){var Pr=Ze?y.value():y,yr=Jt?E.value():E;return le||(le=new Sr),Ve(Pr,yr,j,Q,le)}}return Nt?(le||(le=new Sr),ss(y,E,j,Q,Ve,le)):!1}function $a(y){if(!gs(y)||hs(y))return!1;var E=Vi(y)?zt:ke;return E.test(Kr(y))}function is(y){return Ii(y)&&ds(y.length)&&!!me[Ei(y)]}function ns(y){if(!ls(y))return wi(y);var E=[];for(var j in Object(y))je.call(y,j)&&j!="constructor"&&E.push(j);return E}function ki(y,E,j,Q,Ve,le){var Xe=j&a,Rt=y.length,Pe=E.length;if(Rt!=Pe&&!(Xe&&Pe>Rt))return!1;var Be=le.get(y);if(Be&&le.get(E))return Be==E;var mt=-1,rr=!0,Nt=j&c?new Ui:void 0;for(le.set(y,E),le.set(E,y);++mt<Rt;){var Ze=y[mt],Jt=E[mt];if(Q)var Pr=Xe?Q(Jt,Ze,mt,E,y,le):Q(Ze,Jt,mt,y,E,le);if(Pr!==void 0){if(Pr)continue;rr=!1;break}if(Nt){if(!Ie(E,function(yr,Dr){if(!nt(Nt,Dr)&&(Ze===yr||Ve(Ze,yr,j,Q,le)))return Nt.push(Dr)})){rr=!1;break}}else if(!(Ze===Jt||Ve(Ze,Jt,j,Q,le))){rr=!1;break}}return le.delete(y),le.delete(E),rr}function Fa(y,E,j,Q,Ve,le,Xe){switch(j){case Ae:if(y.byteLength!=E.byteLength||y.byteOffset!=E.byteOffset)return!1;y=y.buffer,E=E.buffer;case Ee:return!(y.byteLength!=E.byteLength||!le(new Gt(y),new Gt(E)));case P:case L:case ae:return fs(+y,+E);case T:return y.name==E.name&&y.message==E.message;case he:case z:return y==E+"";case K:var Rt=Je;case N:var Pe=Q&a;if(Rt||(Rt=st),y.size!=E.size&&!Pe)return!1;var Be=Xe.get(y);if(Be)return Be==E;Q|=c,Xe.set(y,E);var mt=ki(Rt(y),Rt(E),Q,Ve,le,Xe);return Xe.delete(y),mt;case W:if(gt)return gt.call(y)==gt.call(E)}return!1}function ss(y,E,j,Q,Ve,le){var Xe=j&a,Rt=Hi(y),Pe=Rt.length,Be=Hi(E),mt=Be.length;if(Pe!=mt&&!Xe)return!1;for(var rr=Pe;rr--;){var Nt=Rt[rr];if(!(Xe?Nt in E:je.call(E,Nt)))return!1}var Ze=le.get(y);if(Ze&&le.get(E))return Ze==E;var Jt=!0;le.set(y,E),le.set(E,y);for(var Pr=Xe;++rr<Pe;){Nt=Rt[rr];var yr=y[Nt],Dr=E[Nt];if(Q)var yn=Xe?Q(Dr,yr,Nt,E,y,le):Q(yr,Dr,Nt,y,E,le);if(!(yn===void 0?yr===Dr||Ve(yr,Dr,j,Q,le):yn)){Jt=!1;break}Pr||(Pr=Nt=="constructor")}if(Jt&&!Pr){var Si=y.constructor,Lt=E.constructor;Si!=Lt&&"constructor"in y&&"constructor"in E&&!(typeof Si=="function"&&Si instanceof Si&&typeof Lt=="function"&&Lt instanceof Lt)&&(Jt=!1)}return le.delete(y),le.delete(E),Jt}function Hi(y){return pn(y,La,os)}function ni(y,E){var j=y.__data__;return us(E)?j[typeof E=="string"?"string":"hash"]:j.map}function ur(y,E){var j=De(y,E);return $a(j)?j:void 0}function as(y){var E=je.call(y,Wt),j=y[Wt];try{y[Wt]=void 0;var Q=!0}catch{}var Ve=Ft.call(y);return Q&&(E?y[Wt]=j:delete y[Wt]),Ve}var os=kr?function(y){return y==null?[]:(y=Object(y),Re(kr(y),function(E){return tr.call(y,E)}))}:Ke,Fr=Ei;(ht&&Fr(new ht(new ArrayBuffer(1)))!=Ae||tt&&Fr(new tt)!=K||lt&&Fr(lt.resolve())!=pe||ft&&Fr(new ft)!=N||at&&Fr(new at)!=te)&&(Fr=function(y){var E=Ei(y),j=E==de?y.constructor:void 0,Q=j?Kr(j):"";if(Q)switch(Q){case Pt:return Ae;case Ot:return K;case pt:return pe;case Ct:return N;case dt:return te}return E});function cs(y,E){return E=E??f,!!E&&(typeof y=="number"||Nr.test(y))&&y>-1&&y%1==0&&y<E}function us(y){var E=typeof y;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?y!=="__proto__":y===null}function hs(y){return!!St&&St in y}function ls(y){var E=y&&y.constructor,j=typeof E=="function"&&E.prototype||Ne;return y===j}function Da(y){return Ft.call(y)}function Kr(y){if(y!=null){try{return ut.call(y)}catch{}try{return y+""}catch{}}return""}function fs(y,E){return y===E||y!==y&&E!==E}var ps=dn(function(){return arguments}())?dn:function(y){return Ii(y)&&je.call(y,"callee")&&!tr.call(y,"callee")},Ki=Array.isArray;function qa(y){return y!=null&&ds(y.length)&&!Vi(y)}var gn=ii||Ue;function ja(y,E){return xi(y,E)}function Vi(y){if(!gs(y))return!1;var E=Ei(y);return E==U||E==k||E==v||E==ue}function ds(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=f}function gs(y){var E=typeof y;return y!=null&&(E=="object"||E=="function")}function Ii(y){return y!=null&&typeof y=="object"}var ys=ve?vt(ve):is;function La(y){return qa(y)?ts(y):ns(y)}function Ke(){return[]}function Ue(){return!1}o.exports=ja})(ha,ha.exports);var Gm=ha.exports;const Wm=i1(Gm);function Jm(o,i){if(o.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var a=0;a<o.length;a++){var c=o.charAt(a),f=c.charCodeAt(0);if(t[f]!==255)throw new TypeError(c+" is ambiguous");t[f]=a}var g=o.length,m=o.charAt(0),v=Math.log(g)/Math.log(256),P=Math.log(256)/Math.log(g);function L(k){if(k instanceof Uint8Array||(ArrayBuffer.isView(k)?k=new Uint8Array(k.buffer,k.byteOffset,k.byteLength):Array.isArray(k)&&(k=Uint8Array.from(k))),!(k instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(k.length===0)return"";for(var K=0,ae=0,be=0,de=k.length;be!==de&&k[be]===0;)be++,K++;for(var pe=(de-be)*P+1>>>0,ue=new Uint8Array(pe);be!==de;){for(var he=k[be],N=0,z=pe-1;(he!==0||N<ae)&&z!==-1;z--,N++)he+=256*ue[z]>>>0,ue[z]=he%g>>>0,he=he/g>>>0;if(he!==0)throw new Error("Non-zero carry");ae=N,be++}for(var W=pe-ae;W!==pe&&ue[W]===0;)W++;for(var ge=m.repeat(K);W<pe;++W)ge+=o.charAt(ue[W]);return ge}function T(k){if(typeof k!="string")throw new TypeError("Expected String");if(k.length===0)return new Uint8Array;var K=0;if(k[K]!==" "){for(var ae=0,be=0;k[K]===m;)ae++,K++;for(var de=(k.length-K)*v+1>>>0,pe=new Uint8Array(de);k[K];){var ue=t[k.charCodeAt(K)];if(ue===255)return;for(var he=0,N=de-1;(ue!==0||he<be)&&N!==-1;N--,he++)ue+=g*pe[N]>>>0,pe[N]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");be=he,K++}if(k[K]!==" "){for(var z=de-be;z!==de&&pe[z]===0;)z++;for(var W=new Uint8Array(ae+(de-z)),ge=ae;z!==de;)W[ge++]=pe[z++];return W}}}function U(k){var K=T(k);if(K)return K;throw new Error(`Non-${i} character`)}return{encode:L,decodeUnsafe:T,decode:U}}var Qm=Jm,Ym=Qm;const rf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Xm=o=>new TextEncoder().encode(o),Zm=o=>new TextDecoder().decode(o);class ew{constructor(i,t,n){this.name=i,this.prefix=t,this.baseEncode=n}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class tw{constructor(i,t,n){if(this.name=i,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return nf(this,i)}}class rw{constructor(i){this.decoders=i}or(i){return nf(this,i)}decode(i){const t=i[0],n=this.decoders[t];if(n)return n.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const nf=(o,i)=>new rw({...o.decoders||{[o.prefix]:o},...i.decoders||{[i.prefix]:i}});class iw{constructor(i,t,n,a){this.name=i,this.prefix=t,this.baseEncode=n,this.baseDecode=a,this.encoder=new ew(i,t,n),this.decoder=new tw(i,t,a)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const ya=({name:o,prefix:i,encode:t,decode:n})=>new iw(o,i,t,n),Yn=({prefix:o,name:i,alphabet:t})=>{const{encode:n,decode:a}=Ym(t,i);return ya({prefix:o,name:i,encode:n,decode:c=>rf(a(c))})},nw=(o,i,t,n)=>{const a={};for(let P=0;P<i.length;++P)a[i[P]]=P;let c=o.length;for(;o[c-1]==="=";)--c;const f=new Uint8Array(c*t/8|0);let g=0,m=0,v=0;for(let P=0;P<c;++P){const L=a[o[P]];if(L===void 0)throw new SyntaxError(`Non-${n} character`);m=m<<t|L,g+=t,g>=8&&(g-=8,f[v++]=255&m>>g)}if(g>=t||255&m<<8-g)throw new SyntaxError("Unexpected end of data");return f},sw=(o,i,t)=>{const n=i[i.length-1]==="=",a=(1<<t)-1;let c="",f=0,g=0;for(let m=0;m<o.length;++m)for(g=g<<8|o[m],f+=8;f>t;)f-=t,c+=i[a&g>>f];if(f&&(c+=i[a&g<<t-f]),n)for(;c.length*t&7;)c+="=";return c},Ht=({name:o,prefix:i,bitsPerChar:t,alphabet:n})=>ya({prefix:i,name:o,encode(a){return sw(a,n,t)},decode(a){return nw(a,n,t,o)}}),aw=ya({prefix:"\0",name:"identity",encode:o=>Zm(o),decode:o=>Xm(o)});var ow=Object.freeze({__proto__:null,identity:aw});const cw=Ht({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var uw=Object.freeze({__proto__:null,base2:cw});const hw=Ht({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lw=Object.freeze({__proto__:null,base8:hw});const fw=Yn({prefix:"9",name:"base10",alphabet:"0123456789"});var pw=Object.freeze({__proto__:null,base10:fw});const dw=Ht({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gw=Ht({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var yw=Object.freeze({__proto__:null,base16:dw,base16upper:gw});const vw=Ht({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_w=Ht({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),mw=Ht({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ww=Ht({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),bw=Ht({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ew=Ht({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xw=Ht({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Iw=Ht({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Sw=Ht({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Pw=Object.freeze({__proto__:null,base32:vw,base32upper:_w,base32pad:mw,base32padupper:ww,base32hex:bw,base32hexupper:Ew,base32hexpad:xw,base32hexpadupper:Iw,base32z:Sw});const Ow=Yn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Cw=Yn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Aw=Object.freeze({__proto__:null,base36:Ow,base36upper:Cw});const Tw=Yn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Rw=Yn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Nw=Object.freeze({__proto__:null,base58btc:Tw,base58flickr:Rw});const $w=Ht({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fw=Ht({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Dw=Ht({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),qw=Ht({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var jw=Object.freeze({__proto__:null,base64:$w,base64pad:Fw,base64url:Dw,base64urlpad:qw});const sf=Array.from(""),Lw=sf.reduce((o,i,t)=>(o[t]=i,o),[]),Mw=sf.reduce((o,i,t)=>(o[i.codePointAt(0)]=t,o),[]);function zw(o){return o.reduce((i,t)=>(i+=Lw[t],i),"")}function Uw(o){const i=[];for(const t of o){const n=Mw[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);i.push(n)}return new Uint8Array(i)}const kw=ya({prefix:"",name:"base256emoji",encode:zw,decode:Uw});var Hw=Object.freeze({__proto__:null,base256emoji:kw}),Kw=af,il=128,Vw=127,Bw=~Vw,Gw=Math.pow(2,31);function af(o,i,t){i=i||[],t=t||0;for(var n=t;o>=Gw;)i[t++]=o&255|il,o/=128;for(;o&Bw;)i[t++]=o&255|il,o>>>=7;return i[t]=o|0,af.bytes=t-n+1,i}var Ww=yc,Jw=128,nl=127;function yc(o,n){var t=0,n=n||0,a=0,c=n,f,g=o.length;do{if(c>=g)throw yc.bytes=0,new RangeError("Could not decode varint");f=o[c++],t+=a<28?(f&nl)<<a:(f&nl)*Math.pow(2,a),a+=7}while(f>=Jw);return yc.bytes=c-n,t}var Qw=Math.pow(2,7),Yw=Math.pow(2,14),Xw=Math.pow(2,21),Zw=Math.pow(2,28),eb=Math.pow(2,35),tb=Math.pow(2,42),rb=Math.pow(2,49),ib=Math.pow(2,56),nb=Math.pow(2,63),sb=function(o){return o<Qw?1:o<Yw?2:o<Xw?3:o<Zw?4:o<eb?5:o<tb?6:o<rb?7:o<ib?8:o<nb?9:10},ab={encode:Kw,decode:Ww,encodingLength:sb},of=ab;const sl=(o,i,t=0)=>(of.encode(o,i,t),i),al=o=>of.encodingLength(o),vc=(o,i)=>{const t=i.byteLength,n=al(o),a=n+al(t),c=new Uint8Array(a+t);return sl(o,c,0),sl(t,c,n),c.set(i,a),new ob(o,t,i,c)};class ob{constructor(i,t,n,a){this.code=i,this.size=t,this.digest=n,this.bytes=a}}const cf=({name:o,code:i,encode:t})=>new cb(o,i,t);class cb{constructor(i,t,n){this.name=i,this.code=t,this.encode=n}digest(i){if(i instanceof Uint8Array){const t=this.encode(i);return t instanceof Uint8Array?vc(this.code,t):t.then(n=>vc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const uf=o=>async i=>new Uint8Array(await crypto.subtle.digest(o,i)),ub=cf({name:"sha2-256",code:18,encode:uf("SHA-256")}),hb=cf({name:"sha2-512",code:19,encode:uf("SHA-512")});var lb=Object.freeze({__proto__:null,sha256:ub,sha512:hb});const hf=0,fb="identity",lf=rf,pb=o=>vc(hf,lf(o)),db={code:hf,name:fb,encode:lf,digest:pb};var gb=Object.freeze({__proto__:null,identity:db});new TextEncoder,new TextDecoder;const ol={...ow,...uw,...lw,...pw,...yw,...Pw,...Aw,...Nw,...jw,...Hw};({...lb,...gb});function ff(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function yb(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ff(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function pf(o,i,t,n){return{name:o,prefix:i,encoder:{name:o,prefix:i,encode:t},decoder:{decode:n}}}const cl=pf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),Qo=pf("ascii","a",o=>{let i="a";for(let t=0;t<o.length;t++)i+=String.fromCharCode(o[t]);return i},o=>{o=o.substring(1);const i=yb(o.length);for(let t=0;t<o.length;t++)i[t]=o.charCodeAt(t);return i}),vb={utf8:cl,"utf-8":cl,hex:ol.base16,latin1:Qo,ascii:Qo,binary:Qo,...ol};function _b(o,i="utf8"){const t=vb[i];if(!t)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ff(globalThis.Buffer.from(o,"utf-8")):t.decoder.decode(`${t.prefix}${o}`)}const df="wc",mb=2,Ac="core",vi=`${df}@2:${Ac}:`,wb={name:Ac,logger:"error"},bb={database:":memory:"},Eb="crypto",ul="client_ed25519_seed",xb=re.ONE_DAY,Ib="keychain",Sb="0.3",Pb="messages",Ob="0.3",Cb=re.SIX_HOURS,Ab="publisher",gf="irn",Tb="error",yf="wss://relay.walletconnect.com",hl="wss://relay.walletconnect.org",Rb="relayer",Bt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Nb="_subscription",ei={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},$b=re.ONE_SECOND,Fb="2.10.1",Db=1e4,qb="0.3",jb="WALLETCONNECT_CLIENT_ID",zr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Lb="subscription",Mb="0.3",zb=re.FIVE_SECONDS*1e3,Ub="pairing",kb="0.3",jn={wc_pairingDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:re.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:re.ONE_DAY,prompt:!1,tag:0},res:{ttl:re.ONE_DAY,prompt:!1,tag:0}}},Hn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Mr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Hb="history",Kb="0.3",Vb="expirer",Ir={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Bb="0.3",Yo="verify-api",ca="https://verify.walletconnect.com",ll="https://verify.walletconnect.org";class Gb{constructor(i,t){this.core=i,this.logger=t,this.keychain=new Map,this.name=Ib,this.version=Sb,this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:c}=X("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(c)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=i,this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,zl(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Ul(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Wb{constructor(i,t,n){this.core=i,this.logger=t,this.name=Eb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),c=el(a);return tf(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=a1();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const c=await this.getClientSeed(),f=el(c),g=sc();return await km(g,a,xb,f)},this.generateSharedKey=(a,c,f)=>{this.isInitialized();const g=this.getPrivateKey(a),m=o1(g,c);return this.setSymKey(m,f)},this.setSymKey=async(a,c)=>{this.isInitialized();const f=c||c1(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,c,f)=>{this.isInitialized();const g=u1(f),m=xc(c);if($h(g)){const T=g.senderPublicKey,U=g.receiverPublicKey;a=await this.generateSharedKey(T,U)}const v=this.getSymKey(a),{type:P,senderPublicKey:L}=g;return h1({type:P,symKey:v,message:m,senderPublicKey:L})},this.decode=async(a,c,f)=>{this.isInitialized();const g=l1(c,f);if($h(g)){const m=g.receiverPublicKey,v=g.senderPublicKey;a=await this.generateSharedKey(m,v)}try{const m=this.getSymKey(a),v=f1({symKey:m,encoded:c});return Hl(v)}catch(m){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=a=>{const c=Fh(a);return p1(c.type)},this.getPayloadSenderPublicKey=a=>{const c=Fh(a);return c.senderPublicKey?pa(c.senderPublicKey,d1):void 0},this.core=i,this.logger=Ce.generateChildLogger(t,this.name),this.keychain=n||new Gb(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(i,t){return await this.keychain.set(i,t),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(ul)}catch{i=sc(),await this.keychain.set(ul,i)}return _b(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Jb extends wm{constructor(i,t){super(i,t),this.logger=i,this.core=t,this.messages=new Map,this.name=Pb,this.version=Ob,this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const c=un(a);let f=this.messages.get(n);return typeof f>"u"&&(f={}),typeof f[c]<"u"||(f[c]=a,this.messages.set(n,f),await this.persist()),c},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const c=this.get(n),f=un(a);return typeof c[f]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ce.generateChildLogger(i,this.name),this.core=t}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,zl(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Ul(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Qb extends bm{constructor(i,t){super(i,t),this.relayer=i,this.logger=t,this.events=new Ur.EventEmitter,this.name=Ab,this.queue=new Map,this.publishTimeout=re.toMiliseconds(re.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,c)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:c}});try{const g=(c==null?void 0:c.ttl)||Cb,m=ac(c),v=(c==null?void 0:c.prompt)||!1,P=(c==null?void 0:c.tag)||0,L=(c==null?void 0:c.id)||B1().toString(),T={topic:n,message:a,opts:{ttl:g,relay:m,prompt:v,tag:P,id:L}},U=setTimeout(()=>this.queue.set(L,T),this.publishTimeout);try{await await Bn(this.rpcPublish(n,a,g,m,v,P,L),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(L),this.relayer.events.emit(Bt.publish,T)}catch(k){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=c==null?void 0:c.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(L),k;return}finally{clearTimeout(U)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:c}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=i,this.logger=Ce.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(i,t,n,a,c,f,g){var m,v,P,L;const T={method:aa(a.protocol).publish,params:{topic:i,message:t,ttl:n,prompt:c,tag:f},id:g};return yi((m=T.params)==null?void 0:m.prompt)&&((v=T.params)==null||delete v.prompt),yi((P=T.params)==null?void 0:P.tag)&&((L=T.params)==null||delete L.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:T}),this.relayer.request(T)}removeRequestFromQueue(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:t,message:n,opts:a}=i;await this.publish(t,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(ln.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Bt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Bt.message_ack,i=>{this.removeRequestFromQueue(i.id.toString())})}}class Yb{constructor(){this.map=new Map,this.set=(i,t)=>{const n=this.get(i);this.exists(i,t)||this.map.set(i,[...n,t])},this.get=i=>this.map.get(i)||[],this.exists=(i,t)=>this.get(i).includes(t),this.delete=(i,t)=>{if(typeof t>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const n=this.get(i);if(!this.exists(i,t))return;const a=n.filter(c=>c!==t);if(!a.length){this.map.delete(i);return}this.map.set(i,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Xb=Object.defineProperty,Zb=Object.defineProperties,eE=Object.getOwnPropertyDescriptors,fl=Object.getOwnPropertySymbols,tE=Object.prototype.hasOwnProperty,rE=Object.prototype.propertyIsEnumerable,pl=(o,i,t)=>i in o?Xb(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Ln=(o,i)=>{for(var t in i||(i={}))tE.call(i,t)&&pl(o,t,i[t]);if(fl)for(var t of fl(i))rE.call(i,t)&&pl(o,t,i[t]);return o},Xo=(o,i)=>Zb(o,eE(i));class iE extends Im{constructor(i,t){super(i,t),this.relayer=i,this.logger=t,this.subscriptions=new Map,this.topicMap=new Yb,this.events=new Ur.EventEmitter,this.name=Lb,this.version=Mb,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=vi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const c=ac(a),f={topic:n,relay:c};this.pending.set(n,f);const g=await this.rpcSubscribe(n,c);return this.onSubscribe(g,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),g}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,c)=>{const f=new re.Watch;f.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=zb&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=Ce.generateChildLogger(t,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,t){let n=!1;try{n=this.getSubscription(i).topic===t}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,t){const n=this.topicMap.get(i);await Promise.all(n.map(async a=>await this.unsubscribeById(i,a,t)))}async unsubscribeById(i,t,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:t,opts:n}});try{const a=ac(n);await this.rpcUnsubscribe(i,t,a);const c=er("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,t,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:t,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(i,t){const n={method:aa(t.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Bn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Bt.connection_stalled)}return un(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const t=i[0].relay,n={method:aa(t.protocol).batchSubscribe,params:{topics:i.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Bn(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Bt.connection_stalled)}}rpcUnsubscribe(i,t,n){const a={method:aa(n.protocol).unsubscribe,params:{topic:i,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(i,t){this.setSubscription(i,Xo(Ln({},t),{id:i})),this.pending.delete(t.topic)}onBatchSubscribe(i){i.length&&i.forEach(t=>{this.setSubscription(t.id,Ln({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(i,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,i)&&this.deleteSubscription(t,n),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,t){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:t}),this.addSubscription(i,t))}addSubscription(i,t){this.subscriptions.set(i,Ln({},t)),this.topicMap.set(t.topic,i),this.events.emit(zr.created,t)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const t=this.subscriptions.get(i);if(!t){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return t}deleteSubscription(i,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:t});const n=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(n.topic,i),this.events.emit(zr.deleted,Xo(Ln({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(zr.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<i;t++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(zr.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:t}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const t=await this.rpcBatchSubscribe(i);hn(t)&&this.onBatchSubscribe(t.map((n,a)=>Xo(Ln({},i[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(t=>{i.push(t)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(ln.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Bt.connect,async()=>{await this.onConnect()}),this.relayer.on(Bt.disconnect,()=>{this.onDisconnect()}),this.events.on(zr.created,async i=>{const t=zr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),await this.persist()}),this.events.on(zr.deleted,async i=>{const t=zr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),i())},this.pollingInterval)})}}var nE=Object.defineProperty,dl=Object.getOwnPropertySymbols,sE=Object.prototype.hasOwnProperty,aE=Object.prototype.propertyIsEnumerable,gl=(o,i,t)=>i in o?nE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,oE=(o,i)=>{for(var t in i||(i={}))sE.call(i,t)&&gl(o,t,i[t]);if(dl)for(var t of dl(i))aE.call(i,t)&&gl(o,t,i[t]);return o};class cE extends Em{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new Ur.EventEmitter,this.name=Rb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(Bt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(Bt.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ei.payload,this.onPayloadHandler),this.provider.on(ei.connect,this.onConnectHandler),this.provider.on(ei.disconnect,this.onDisconnectHandler),this.provider.on(ei.error,this.onProviderErrorHandler)},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?Ce.generateChildLogger(i.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:i.logger||Tb})),this.messages=new Jb(this.logger,i.core),this.subscriber=new iE(this,this.logger),this.publisher=new Qb(this,this.logger),this.relayUrl=(i==null?void 0:i.relayUrl)||yf,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${hl}...`),await this.restartTransport(hl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Db)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,t,n){this.isInitialized(),await this.publisher.publish(i,t,n),await this.recordMessageEvent({topic:i,message:t,publishedAt:Date.now()})}async subscribe(i,t){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(i))==null?void 0:n[0])||"";return a||(await Promise.all([new Promise(c=>{this.subscriber.once(zr.created,f=>{f.topic===i&&c()})}),new Promise(async c=>{a=await this.subscriber.subscribe(i,t),c()})]),a)}async unsubscribe(i,t){this.isInitialized(),await this.subscriber.unsubscribe(i,t)}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}off(i,t){this.events.off(i,t)}removeListener(i,t){this.events.removeListener(i,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Bn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(i){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){i&&i!==this.relayUrl&&(this.relayUrl=i,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(zr.resubscribed,()=>{t()})}),new Promise(async(t,n)=>{try{await Bn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){n(a);return}t()})])}catch(t){this.logger.error(t);const n=t;if(!this.isConnectionStalled(n.message))throw t;this.provider.events.emit(ei.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(i){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=i||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Dh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(i){return this.staleConnectionErrors.some(t=>i.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new _i(new Bm(g1({sdkVersion:Fb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:t,message:n}=i;await this.messages.set(t,n)}async shouldIgnoreMessageEvent(i){const{topic:t,message:n}=i;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const a=this.messages.has(t,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),Sc(i)){if(!i.method.endsWith(Nb))return;const t=i.params,{topic:n,message:a,publishedAt:c}=t.data,f={topic:n,message:a,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(oE({type:"event",event:t.id},f)),this.events.emit(t.id,f),await this.acknowledgePayload(i),await this.onMessageEvent(f)}else Pc(i)&&this.events.emit(Bt.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(Bt.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const t=Oc(i.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(ei.payload,this.onPayloadHandler),this.provider.off(ei.connect,this.onConnectHandler),this.provider.off(ei.disconnect,this.onDisconnectHandler),this.provider.off(ei.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Bt.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let i=await Dh();y1(async t=>{this.initialized&&i!==t&&(i=t,t?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Bt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(i=>this.logger.error(i))},re.toMiliseconds($b)))}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(i=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var uE=Object.defineProperty,yl=Object.getOwnPropertySymbols,hE=Object.prototype.hasOwnProperty,lE=Object.prototype.propertyIsEnumerable,vl=(o,i,t)=>i in o?uE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,_l=(o,i)=>{for(var t in i||(i={}))hE.call(i,t)&&vl(o,t,i[t]);if(yl)for(var t of yl(i))lE.call(i,t)&&vl(o,t,i[t]);return o};class va extends xm{constructor(i,t,n,a=vi,c=void 0){super(i,t,n,a),this.core=i,this.logger=t,this.name=n,this.map=new Map,this.version=qb,this.cached=[],this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!yi(f)?this.map.set(this.getKey(f),f):n1(f)?this.map.set(f.id,f):s1(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,g)=>{this.isInitialized(),this.map.has(f)?await this.update(f,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:g}),this.map.set(f,g),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(g=>Object.keys(f).every(m=>Wm(g[m],f[m]))):this.values),this.update=async(f,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:g});const m=_l(_l({},this.getData(f)),g);this.map.set(f,m),await this.persist()},this.delete=async(f,g)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:g}),this.map.delete(f),await this.persist())},this.logger=Ce.generateChildLogger(t,this.name),this.storagePrefix=a,this.getKey=c}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const t=this.map.get(i);if(!t){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:t}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class fE{constructor(i,t){this.core=i,this.logger=t,this.name=Ub,this.version=kb,this.events=new Ec,this.initialized=!1,this.storagePrefix=vi,this.ignoredPayloadTypes=[jl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=sc(),a=await this.core.crypto.setSymKey(n),c=Rr(re.FIVE_MINUTES),f={protocol:gf},g={topic:a,expiry:c,relay:f,active:!1},m=v1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:f});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,c),{topic:a,uri:m}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:c,relay:f}=_1(n.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(c,a),await this.core.relayer.subscribe(a,{relay:f}));const m=Rr(re.FIVE_MINUTES),v={topic:a,relay:f,expiry:m,active:!1};return await this.pairings.set(a,v),this.core.expirer.set(a,m),n.activatePairing&&await this.activate({topic:a}),this.events.emit(Hn.create,v),v},this.activate=async({topic:n})=>{this.isInitialized();const a=Rr(re.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const c=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:g,reject:m}=an();this.events.once($t("pairing_ping",c),({error:v})=>{v?m(v):g()}),await f()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",er("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,c)=>{const f=Vn(a,c),g=await this.core.crypto.encode(n,f),m=jn[a].req;return this.core.history.set(n,f),this.core.relayer.publish(n,g,m),f.id},this.sendResult=async(n,a,c)=>{const f=Oc(n,c),g=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,n),v=jn[m.request.method].res;await this.core.relayer.publish(a,g,v),await this.core.history.resolve(f)},this.sendError=async(n,a,c)=>{const f=Ic(n,c),g=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,n),v=jn[m.request.method]?jn[m.request.method].res:jn.unregistered_method.res;await this.core.relayer.publish(a,g,v),await this.core.history.resolve(f)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,er("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>gi(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:c}=n;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(a,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,c);default:return this.onUnknownRpcMethodRequest(a,c)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:c}=n,f=(await this.core.history.get(a,c.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,c);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(n,a)=>{const{id:c}=a;try{this.isValidPing({topic:n}),await this.sendResult(c,n,!0),this.events.emit(Hn.ping,{id:c,topic:n})}catch(f){await this.sendError(c,n,f),this.logger.error(f)}},this.onPairingPingResponse=(n,a)=>{const{id:c}=a;setTimeout(()=>{di(a)?this.events.emit($t("pairing_ping",c),{}):ri(a)&&this.events.emit($t("pairing_ping",c),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:c}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Hn.delete,{id:c,topic:n})}catch(f){await this.sendError(c,n,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:c,method:f}=a;try{if(this.registeredMethods.includes(f))return;const g=er("WC_METHOD_UNSUPPORTED",f);await this.sendError(c,n,g),this.logger.error(g)}catch(g){await this.sendError(c,n,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(er("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!cr(n)){const{message:a}=X("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(a)}if(!m1(n.uri)){const{message:a}=X("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(a)}},this.isValidPing=async n=>{if(!cr(n)){const{message:c}=X("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(c)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!cr(n)){const{message:c}=X("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(c)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!on(n,!1)){const{message:a}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(gi(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=X("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=i,this.logger=Ce.generateChildLogger(t,this.name),this.pairings=new va(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(Bt.message,async i=>{const{topic:t,message:n}=i;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(t,n);try{Sc(a)?(this.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Pc(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.core.history.delete(t,a.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(Ir.expired,async i=>{const{topic:t}=Ll(i.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Hn.expire,{topic:t}))})}}class pE extends mm{constructor(i,t){super(i,t),this.core=i,this.logger=t,this.records=new Map,this.events=new Ur.EventEmitter,this.name=Hb,this.version=Kb,this.cached=[],this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:c}),this.records.has(a.id))return;const f={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:c,expiry:Rr(re.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Mr.created,f)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=ri(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(Mr.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(c=>{if(c.topic===n){if(typeof a<"u"&&c.id!==a)return;this.records.delete(c.id),this.events.emit(Mr.deleted,c)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const n={topic:t.topic,request:Vn(t.request.method,t.request.params,t.id),chainId:t.chainId};return i.push(n)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const t=this.records.get(i);if(!t){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Mr.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:t}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(Mr.created,i=>{const t=Mr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.events.on(Mr.updated,i=>{const t=Mr.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.events.on(Mr.deleted,i=>{const t=Mr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.core.heartbeat.on(ln.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{re.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class dE extends Sm{constructor(i,t){super(i,t),this.core=i,this.logger=t,this.expirations=new Map,this.events=new Ur.EventEmitter,this.name=Vb,this.version=Bb,this.cached=[],this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const c=this.formatTarget(n),f={target:c,expiry:a};this.expirations.set(c,f),this.checkExpiry(c,f),this.events.emit(Ir.created,{target:c,expiration:f})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),c=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ir.deleted,{target:a,expiration:c})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return w1(i);if(typeof i=="number")return b1(i);const{message:t}=X("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(t)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ir.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:t}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const t=this.expirations.get(i);if(!t){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return t}checkExpiry(i,t){const{expiry:n}=t;re.toMiliseconds(n)-Date.now()<=0&&this.expire(i,t)}expire(i,t){this.expirations.delete(i),this.events.emit(Ir.expired,{target:i,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,t)=>this.checkExpiry(t,i))}registerEventListeners(){this.core.heartbeat.on(ln.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ir.created,i=>{const t=Ir.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()}),this.events.on(Ir.expired,i=>{const t=Ir.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()}),this.events.on(Ir.deleted,i=>{const t=Ir.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class gE extends Pm{constructor(i,t){super(i,t),this.projectId=i,this.logger=t,this.name=Yo,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||E1()||!Ml())return;const a=(n==null?void 0:n.verifyUrl)||ca;this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ll;try{await this.createIframe()}catch(c){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(c),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const a=(n==null?void 0:n.verifyUrl)||ca;let c;try{c=await this.fetchAttestation(n.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${a}`),this.logger.info(f),c=await this.fetchAttestation(n.attestationId,ll)}return c},this.fetchAttestation=async(n,a)=>{this.logger.info(`resolving attestation: ${n} from url: ${a}`);const c=this.startAbortTimer(re.ONE_SECOND*2),f=await fetch(`${a}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(c),f.status===200?await f.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const a=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),n())};await Promise.race([new Promise(c=>{if(document.getElementById(Yo))return c();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=Yo,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,n=c}),new Promise((c,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},re.toMiliseconds(re.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ce.generateChildLogger(t,this.name),this.verifyUrl=ca,this.abortController=new AbortController,this.isDevEnv=x1()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(i){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),re.toMiliseconds(i))}}var yE=Object.defineProperty,ml=Object.getOwnPropertySymbols,vE=Object.prototype.hasOwnProperty,_E=Object.prototype.propertyIsEnumerable,wl=(o,i,t)=>i in o?yE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,bl=(o,i)=>{for(var t in i||(i={}))vE.call(i,t)&&wl(o,t,i[t]);if(ml)for(var t of ml(i))_E.call(i,t)&&wl(o,t,i[t]);return o};class Tc extends _m{constructor(i){super(i),this.protocol=df,this.version=mb,this.name=Ac,this.events=new Ur.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=i==null?void 0:i.projectId,this.relayUrl=(i==null?void 0:i.relayUrl)||yf;const t=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||wb.logger}));this.logger=Ce.generateChildLogger(t,this.name),this.heartbeat=new ln.HeartBeat,this.crypto=new Wb(this,this.logger,i==null?void 0:i.keychain),this.history=new pE(this,this.logger),this.expirer=new dE(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new E_(bl(bl({},bb),i==null?void 0:i.storageOptions)),this.relayer=new cE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new fE(this,this.logger),this.verify=new gE(this.projectId||"",this.logger)}static async init(i){const t=new Tc(i);await t.initialize();const n=await t.crypto.getClientId();return await t.storage.setItem(jb,n),t}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const mE=Tc,vf="wc",_f=2,mf="client",Rc=`${vf}@${_f}:${mf}:`,Zo={name:mf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},El="WALLETCONNECT_DEEPLINK_CHOICE",wE="proposal",wf="Proposal expired",bE="session",ia=re.SEVEN_DAYS,EE="engine",Mn={wc_sessionPropose:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1104},res:{ttl:re.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1106},res:{ttl:re.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1112},res:{ttl:re.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1115}}},ec={min:re.FIVE_MINUTES,max:re.SEVEN_DAYS},ti={idle:"IDLE",active:"ACTIVE"},xE="request",IE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var SE=Object.defineProperty,PE=Object.defineProperties,OE=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,CE=Object.prototype.hasOwnProperty,AE=Object.prototype.propertyIsEnumerable,Il=(o,i,t)=>i in o?SE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,or=(o,i)=>{for(var t in i||(i={}))CE.call(i,t)&&Il(o,t,i[t]);if(xl)for(var t of xl(i))AE.call(i,t)&&Il(o,t,i[t]);return o},zn=(o,i)=>PE(o,OE(i));class TE extends Cm{constructor(i){super(i),this.name=EE,this.events=new Ec,this.initialized=!1,this.ignoredPayloadTypes=[jl],this.requestQueue={state:ti.idle,queue:[]},this.sessionRequestQueue={state:ti.idle,queue:[]},this.requestQueueDelay=re.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Mn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const n=zn(or({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:c,optionalNamespaces:f,sessionProperties:g,relays:m}=n;let v=a,P,L=!1;if(v&&(L=this.client.core.pairing.pairings.get(v).active),!v||!L){const{topic:pe,uri:ue}=await this.client.core.pairing.create();v=pe,P=ue}const T=await this.client.core.crypto.generateKeyPair(),U=or({requiredNamespaces:c,optionalNamespaces:f,relays:m??[{protocol:gf}],proposer:{publicKey:T,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:k,resolve:K,done:ae}=an(re.FIVE_MINUTES,wf);if(this.events.once($t("session_connect"),async({error:pe,session:ue})=>{if(pe)k(pe);else if(ue){ue.self.publicKey=T;const he=zn(or({},ue),{requiredNamespaces:ue.requiredNamespaces,optionalNamespaces:ue.optionalNamespaces});await this.client.session.set(ue.topic,he),await this.setExpiry(ue.topic,ue.expiry),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:ue.peer.metadata}),K(he)}}),!v){const{message:pe}=X("NO_MATCHING_KEY",`connect() pairing topic: ${v}`);throw new Error(pe)}const be=await this.sendRequest({topic:v,method:"wc_sessionPropose",params:U}),de=Rr(re.FIVE_MINUTES);return await this.setProposal(be,or({id:be,expiry:de},U)),{uri:P,approval:ae}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:n,relayProtocol:a,namespaces:c,sessionProperties:f}=t,g=this.client.proposal.get(n);let{pairingTopic:m,proposer:v,requiredNamespaces:P,optionalNamespaces:L}=g;m=m||"",oa(P)||(P=S1(c,"approve()"));const T=await this.client.core.crypto.generateKeyPair(),U=v.publicKey,k=await this.client.core.crypto.generateSharedKey(T,U);m&&n&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:v.metadata}),await this.sendResult({id:n,topic:m,result:{relay:{protocol:a??"irn"},responderPublicKey:T}}),await this.client.proposal.delete(n,er("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const K=or({relay:{protocol:a??"irn"},namespaces:c,requiredNamespaces:P,optionalNamespaces:L,pairingTopic:m,controller:{publicKey:T,metadata:this.client.metadata},expiry:Rr(ia)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(k),await this.sendRequest({topic:k,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0});const ae=zn(or({},K),{topic:k,pairingTopic:m,acknowledged:!1,self:K.controller,peer:{publicKey:v.publicKey,metadata:v.metadata},controller:T});return await this.client.session.set(k,ae),await this.setExpiry(k,Rr(ia)),{topic:k,acknowledged:()=>new Promise(be=>setTimeout(()=>be(this.client.session.get(k)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:n,reason:a}=t,{pairingTopic:c}=this.client.proposal.get(n);c&&(await this.sendError(n,c,a),await this.client.proposal.delete(n,er("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:n,namespaces:a}=t,c=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:g,reject:m}=an();return this.events.once($t("session_update",c),({error:v})=>{v?m(v):g()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:f}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:n}=t,a=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:c,resolve:f,reject:g}=an();return this.events.once($t("session_extend",a),({error:m})=>{m?g(m):f()}),await this.setExpiry(n,Rr(ia)),{acknowledged:c}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:n,request:a,topic:c,expiry:f}=t,g=G1(),{done:m,resolve:v,reject:P}=an(f);return this.events.once($t("session_request",g),({error:L,result:T})=>{L?P(L):v(T)}),await Promise.all([new Promise(async L=>{await this.sendRequest({clientRpcId:g,topic:c,method:"wc_sessionRequest",params:{request:a,chainId:n},expiry:f,throwOnFailedPublish:!0}).catch(T=>P(T)),this.client.events.emit("session_request_sent",{topic:c,request:a,chainId:n,id:g}),L()}),new Promise(async L=>{const T=await this.client.core.storage.getItem(El);P1({id:g,topic:c,wcDeepLink:T}),L()}),m()]).then(L=>L[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:n,response:a}=t,{id:c}=a;di(a)?await this.sendResult({id:c,topic:n,result:a.result,throwOnFailedPublish:!0}):ri(a)&&await this.sendError(c,n,a.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:n}=t;if(this.client.session.keys.includes(n)){const a=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:c,resolve:f,reject:g}=an();this.events.once($t("session_ping",a),({error:m})=>{m?g(m):f()}),await c()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:n,event:a,chainId:c}=t;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:a,chainId:c}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:n}=t;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:er("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(n=>O1(n,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const n=this.client.core.pairing.pairings.get(t.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(c=>{var f,g;return((f=c.peerMetadata)==null?void 0:f.url)&&((g=c.peerMetadata)==null?void 0:g.url)===t.peer.metadata.url&&c.topic&&c.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(c=>this.client.core.pairing.disconnect({topic:c.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(t,n)=>{const{self:a}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,er("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),n||this.client.core.expirer.del(t),this.client.core.storage.removeItem(El).catch(c=>this.client.logger.warn(c))},this.deleteProposal=async(t,n)=>{await Promise.all([this.client.proposal.delete(t,er("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,n),a?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(c=>c.id!==t),a&&(this.sessionRequestQueue.state=ti.idle)},this.setExpiry=async(t,n)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:n}),this.client.core.expirer.set(t,n)},this.setProposal=async(t,n)=>{await this.client.proposal.set(t,n),this.client.core.expirer.set(t,n.expiry)},this.setPendingSessionRequest=async t=>{const n=Mn.wc_sessionRequest.req.ttl,{id:a,topic:c,params:f,verifyContext:g}=t;await this.client.pendingRequest.set(a,{id:a,topic:c,params:f,verifyContext:g}),n&&this.client.core.expirer.set(a,Rr(n))},this.sendRequest=async t=>{const{topic:n,method:a,params:c,expiry:f,relayRpcId:g,clientRpcId:m,throwOnFailedPublish:v}=t,P=Vn(a,c,m);if(Ml()&&IE.includes(a)){const U=un(JSON.stringify(P));this.client.core.verify.register({attestationId:U})}const L=await this.client.core.crypto.encode(n,P),T=Mn[a].req;return f&&(T.ttl=f),g&&(T.id=g),this.client.core.history.set(n,P),v?(T.internal=zn(or({},T.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,L,T)):this.client.core.relayer.publish(n,L,T).catch(U=>this.client.logger.error(U)),P.id},this.sendResult=async t=>{const{id:n,topic:a,result:c,throwOnFailedPublish:f}=t,g=Oc(n,c),m=await this.client.core.crypto.encode(a,g),v=await this.client.core.history.get(a,n),P=Mn[v.request.method].res;f?(P.internal=zn(or({},P.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,m,P)):this.client.core.relayer.publish(a,m,P).catch(L=>this.client.logger.error(L)),await this.client.core.history.resolve(g)},this.sendError=async(t,n,a)=>{const c=Ic(t,a),f=await this.client.core.crypto.encode(n,c),g=await this.client.core.history.get(n,t),m=Mn[g.request.method].res;this.client.core.relayer.publish(n,f,m),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const t=[],n=[];this.client.session.getAll().forEach(a=>{gi(a.expiry)&&t.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{gi(a.expiry)&&n.push(a.id)}),await Promise.all([...t.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ti.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ti.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ti.idle},this.processRequest=t=>{const{topic:n,payload:a}=t,c=a.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async t=>{const{topic:n,payload:a}=t,c=(await this.client.core.history.get(n,a.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:n}=t,{message:a}=X("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(t,n)=>{const{params:a,id:c}=n;try{this.isValidConnect(or({},n.params));const f=Rr(re.FIVE_MINUTES),g=or({id:c,pairingTopic:t,expiry:f},a);await this.setProposal(c,g);const m=un(JSON.stringify(n)),v=await this.getVerifyContext(m,g.proposer.metadata);this.client.events.emit("session_proposal",{id:c,params:g,verifyContext:v})}catch(f){await this.sendError(c,t,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(t,n)=>{const{id:a}=n;if(di(n)){const{result:c}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const m=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const v=await this.client.core.crypto.generateSharedKey(g,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:v});const P=await this.client.core.relayer.subscribe(v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:P}),await this.client.core.pairing.activate({topic:t})}else ri(n)&&(await this.client.proposal.delete(a,er("USER_DISCONNECTED")),this.events.emit($t("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(t,n)=>{const{id:a,params:c}=n;try{this.isValidSessionSettleRequest(c);const{relay:f,controller:g,expiry:m,namespaces:v,requiredNamespaces:P,optionalNamespaces:L,sessionProperties:T,pairingTopic:U}=n.params,k=or({topic:t,relay:f,expiry:m,namespaces:v,acknowledged:!0,pairingTopic:U,requiredNamespaces:P,optionalNamespaces:L,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},T&&{sessionProperties:T});await this.sendResult({id:n.id,topic:t,result:!0}),this.events.emit($t("session_connect"),{session:k}),this.cleanupDuplicatePairings(k)}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(t,n)=>{const{id:a}=n;di(n)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit($t("session_approve",a),{})):ri(n)&&(await this.client.session.delete(t,er("USER_DISCONNECTED")),this.events.emit($t("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(t,n)=>{const{params:a,id:c}=n;try{const f=`${t}_session_update`,g=ra.get(f);if(g&&this.isRequestOutOfSync(g,c)){this.client.logger.info(`Discarding out of sync request - ${c}`);return}this.isValidUpdate(or({topic:t},a)),await this.client.session.update(t,{namespaces:a.namespaces}),await this.sendResult({id:c,topic:t,result:!0}),this.client.events.emit("session_update",{id:c,topic:t,params:a}),ra.set(f,c)}catch(f){await this.sendError(c,t,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(t,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,n)=>{const{id:a}=n;di(n)?this.events.emit($t("session_update",a),{}):ri(n)&&this.events.emit($t("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(t,n)=>{const{id:a}=n;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Rr(ia)),await this.sendResult({id:a,topic:t,result:!0}),this.client.events.emit("session_extend",{id:a,topic:t})}catch(c){await this.sendError(a,t,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(t,n)=>{const{id:a}=n;di(n)?this.events.emit($t("session_extend",a),{}):ri(n)&&this.events.emit($t("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(t,n)=>{const{id:a}=n;try{this.isValidPing({topic:t}),await this.sendResult({id:a,topic:t,result:!0}),this.client.events.emit("session_ping",{id:a,topic:t})}catch(c){await this.sendError(a,t,c),this.client.logger.error(c)}},this.onSessionPingResponse=(t,n)=>{const{id:a}=n;setTimeout(()=>{di(n)?this.events.emit($t("session_ping",a),{}):ri(n)&&this.events.emit($t("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(t,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:t,reason:n.params}),await Promise.all([new Promise(c=>{this.client.core.relayer.once(Bt.publish,async()=>{c(await this.deleteSession(t))})}),this.sendResult({id:a,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:t})}catch(c){this.client.logger.error(c)}},this.onSessionRequest=async(t,n)=>{const{id:a,params:c}=n;try{this.isValidRequest(or({topic:t},c));const f=un(JSON.stringify(Vn("wc_sessionRequest",c,a))),g=this.client.session.get(t),m=await this.getVerifyContext(f,g.peer.metadata),v={id:a,topic:t,params:c,verifyContext:m};await this.setPendingSessionRequest(v),this.addSessionRequestToSessionRequestQueue(v),this.processSessionRequestQueue()}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(t,n)=>{const{id:a}=n;di(n)?this.events.emit($t("session_request",a),{result:n.result}):ri(n)&&this.events.emit($t("session_request",a),{error:n.error})},this.onSessionEventRequest=async(t,n)=>{const{id:a,params:c}=n;try{const f=`${t}_session_event_${c.event.name}`,g=ra.get(f);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(or({topic:t},c)),this.client.events.emit("session_event",{id:a,topic:t,params:c}),ra.set(f,a)}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ti.idle,this.processSessionRequestQueue()},re.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ti.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ti.active,this.client.events.emit("session_request",t)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=t=>{if(t.active)return;const n=this.client.proposal.getAll().find(a=>a.pairingTopic===t.topic);n&&this.onSessionProposeRequest(t.topic,Vn("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async t=>{if(!cr(t)){const{message:m}=X("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(m)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:c,sessionProperties:f,relays:g}=t;if(yi(n)||await this.isValidPairingTopic(n),!C1(g,!0)){const{message:m}=X("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(m)}!yi(a)&&oa(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!yi(c)&&oa(c)!==0&&this.validateNamespaces(c,"optionalNamespaces"),yi(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(t,n)=>{const a=A1(t,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async t=>{if(!cr(t))throw new Error(X("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:n,namespaces:a,relayProtocol:c,sessionProperties:f}=t;await this.isValidProposalId(n);const g=this.client.proposal.get(n),m=Ho(a,"approve()");if(m)throw new Error(m.message);const v=qh(g.requiredNamespaces,a,"approve()");if(v)throw new Error(v.message);if(!on(c,!0)){const{message:P}=X("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(P)}yi(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async t=>{if(!cr(t)){const{message:c}=X("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(c)}const{id:n,reason:a}=t;if(await this.isValidProposalId(n),!T1(a)){const{message:c}=X("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(c)}},this.isValidSessionSettleRequest=t=>{if(!cr(t)){const{message:v}=X("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(v)}const{relay:n,controller:a,namespaces:c,expiry:f}=t;if(!R1(n)){const{message:v}=X("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(v)}const g=N1(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const m=Ho(c,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(gi(f)){const{message:v}=X("EXPIRED","onSessionSettleRequest()");throw new Error(v)}},this.isValidUpdate=async t=>{if(!cr(t)){const{message:m}=X("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(m)}const{topic:n,namespaces:a}=t;await this.isValidSessionTopic(n);const c=this.client.session.get(n),f=Ho(a,"update()");if(f)throw new Error(f.message);const g=qh(c.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async t=>{if(!cr(t)){const{message:a}=X("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionTopic(n)},this.isValidRequest=async t=>{if(!cr(t)){const{message:m}=X("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(m)}const{topic:n,request:a,chainId:c,expiry:f}=t;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!jh(g,c)){const{message:m}=X("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(m)}if(!$1(a)){const{message:m}=X("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(m)}if(!F1(g,c,a.method)){const{message:m}=X("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(m)}if(f&&!D1(f,ec)){const{message:m}=X("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${ec.min} and ${ec.max}`);throw new Error(m)}},this.isValidRespond=async t=>{if(!cr(t)){const{message:c}=X("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(c)}const{topic:n,response:a}=t;if(await this.isValidSessionTopic(n),!q1(a)){const{message:c}=X("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(c)}},this.isValidPing=async t=>{if(!cr(t)){const{message:a}=X("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async t=>{if(!cr(t)){const{message:g}=X("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(g)}const{topic:n,event:a,chainId:c}=t;await this.isValidSessionTopic(n);const{namespaces:f}=this.client.session.get(n);if(!jh(f,c)){const{message:g}=X("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(g)}if(!j1(a)){const{message:g}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!L1(f,c,a.name)){const{message:g}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async t=>{if(!cr(t)){const{message:a}=X("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(t,n)=>{const a={verified:{verifyUrl:n.verifyUrl||ca,validation:"UNKNOWN",origin:n.url||""}};try{const c=await this.client.core.verify.resolve({attestationId:t,verifyUrl:n.verifyUrl});c&&(a.verified.origin=c.origin,a.verified.isScam=c.isScam,a.verified.validation=c.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.info(c)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(t,n)=>{Object.values(t).forEach(a=>{if(!on(a,!1)){const{message:c}=X("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(c)}})}}async isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Bt.message,async i=>{const{topic:t,message:n}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(t,n);try{Sc(a)?(this.client.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Pc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.client.core.history.delete(t,a.id)):this.onRelayEventUnknownPayload({topic:t,payload:a})}catch(c){this.client.logger.error(c)}})}registerExpirerEvents(){this.client.core.expirer.on(Ir.expired,async i=>{const{topic:t,id:n}=Ll(i.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,X("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Hn.create,i=>this.onPairingCreated(i))}isValidPairingTopic(i){if(!on(i,!1)){const{message:t}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:t}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(t)}if(gi(this.client.core.pairing.pairings.get(i).expiry)){const{message:t}=X("EXPIRED",`pairing topic: ${i}`);throw new Error(t)}}async isValidSessionTopic(i){if(!on(i,!1)){const{message:t}=X("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(t)}if(!this.client.session.keys.includes(i)){const{message:t}=X("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(t)}if(gi(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:t}=X("EXPIRED",`session topic: ${i}`);throw new Error(t)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(on(i,!1)){const{message:t}=X("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(t)}else{const{message:t}=X("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(t)}}async isValidProposalId(i){if(!M1(i)){const{message:t}=X("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(t)}if(!this.client.proposal.keys.includes(i)){const{message:t}=X("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(t)}if(gi(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:t}=X("EXPIRED",`proposal id: ${i}`);throw new Error(t)}}}class RE extends va{constructor(i,t){super(i,t,wE,Rc),this.core=i,this.logger=t}}class NE extends va{constructor(i,t){super(i,t,bE,Rc),this.core=i,this.logger=t}}class $E extends va{constructor(i,t){super(i,t,xE,Rc,n=>n.id),this.core=i,this.logger=t}}let FE=class bf extends Om{constructor(i){super(i),this.protocol=vf,this.version=_f,this.name=Zo.name,this.events=new Ur.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(i==null?void 0:i.name)||Zo.name,this.metadata=(i==null?void 0:i.metadata)||I1();const t=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Zo.logger}));this.core=(i==null?void 0:i.core)||new mE(i),this.logger=Ce.generateChildLogger(t,this.name),this.session=new NE(this.core,this.logger),this.proposal=new RE(this.core,this.logger),this.pendingRequest=new $E(this.core,this.logger),this.engine=new TE(this)}static async init(i){const t=new bf(i);return await t.initialize(),t}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const Sl="error",DE="wss://relay.walletconnect.com",qE="wc",jE="universal_provider",Pl=`${qE}@2:${jE}:`,LE="https://rpc.walletconnect.com/v1/",mi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},_c={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,i){(function(){var t,n="4.17.21",a=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",g="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",v=500,P="__lodash_placeholder__",L=1,T=2,U=4,k=1,K=2,ae=1,be=2,de=4,pe=8,ue=16,he=32,N=64,z=128,W=256,ge=512,te=30,Ee="...",Ae=800,et=16,C=1,q=2,Me=3,Te=1/0,J=9007199254740991,V=17976931348623157e292,H=0/0,B=4294967295,ct=B-1,ke=B>>>1,Nr=[["ary",z],["bind",ae],["bindKey",be],["curry",pe],["curryRight",ue],["flip",ge],["partial",he],["partialRight",N],["rearg",W]],me="[object Arguments]",xt="[object Array]",R="[object AsyncFunction]",A="[object Boolean]",S="[object Date]",h="[object DOMException]",b="[object Error]",Z="[object Function]",oe="[object GeneratorFunction]",ve="[object Map]",Re="[object Number]",$e="[object Null]",Ie="[object Object]",It="[object Promise]",vt="[object Proxy]",nt="[object RegExp]",De="[object Set]",Je="[object String]",Qe="[object Symbol]",st="[object Undefined]",ze="[object WeakMap]",Ye="[object WeakSet]",Ne="[object ArrayBuffer]",He="[object DataView]",ut="[object Float32Array]",je="[object Float64Array]",St="[object Int8Array]",Ft="[object Int16Array]",zt="[object Int32Array]",Ut="[object Uint8Array]",jt="[object Uint8ClampedArray]",Gt="[object Uint16Array]",tr="[object Uint32Array]",$r=/\b__p \+= '';/g,Wt=/\b(__p \+=) '' \+/g,kr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ii=/&(?:amp|lt|gt|quot|#39);/g,wi=/[&<>"']/g,ht=RegExp(ii.source),tt=RegExp(wi.source),lt=/<%-([\s\S]+?)%>/g,ft=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pt=/^\w*$/,Ot=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pt=/[\\^$.*+?()[\]{}|]/g,Ct=RegExp(pt.source),dt=/^\s+/,_t=/\s/,gt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,At=/,? & /,Tt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,_a=/[()=,{}\[\]\/\s]/,ma=/\\(\\)?/g,wa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gr=/\w*$/,ba=/^[-+]0x[0-9a-f]+$/i,Ea=/^0b[01]+$/i,xa=/^\[object .+?Constructor\]$/,Ia=/^0o[0-7]+$/i,Sa=/^(?:0|[1-9]\d*)$/,Hr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Mi=/($^)/,Pa=/['\n\r\u2028\u2029\\]/g,zi="\\ud800-\\udfff",Oa="\\u0300-\\u036f",Ca="\\ufe20-\\ufe2f",Ui="\\u20d0-\\u20ff",Xn=Oa+Ca+Ui,Zn="\\u2700-\\u27bf",Sr="a-z\\xdf-\\xf6\\xf8-\\xff",Aa="\\xac\\xb1\\xd7\\xf7",Ta="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ra="\\u2000-\\u206f",Na=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",es="A-Z\\xc0-\\xd6\\xd8-\\xde",ts="\\ufe0e\\ufe0f",bi=Aa+Ta+Ra+Na,pn="[']",Ei="["+zi+"]",dn="["+bi+"]",xi="["+Xn+"]",rs="\\d+",$a="["+Zn+"]",is="["+Sr+"]",ns="[^"+zi+bi+rs+Zn+Sr+es+"]",ki="\\ud83c[\\udffb-\\udfff]",Fa="(?:"+xi+"|"+ki+")",ss="[^"+zi+"]",Hi="(?:\\ud83c[\\udde6-\\uddff]){2}",ni="[\\ud800-\\udbff][\\udc00-\\udfff]",ur="["+es+"]",as="\\u200d",os="(?:"+is+"|"+ns+")",Fr="(?:"+ur+"|"+ns+")",cs="(?:"+pn+"(?:d|ll|m|re|s|t|ve))?",us="(?:"+pn+"(?:D|LL|M|RE|S|T|VE))?",hs=Fa+"?",ls="["+ts+"]?",Da="(?:"+as+"(?:"+[ss,Hi,ni].join("|")+")"+ls+hs+")*",Kr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",fs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ps=ls+hs+Da,Ki="(?:"+[$a,Hi,ni].join("|")+")"+ps,qa="(?:"+[ss+xi+"?",xi,Hi,ni,Ei].join("|")+")",gn=RegExp(pn,"g"),ja=RegExp(xi,"g"),Vi=RegExp(ki+"(?="+ki+")|"+qa+ps,"g"),ds=RegExp([ur+"?"+is+"+"+cs+"(?="+[dn,ur,"$"].join("|")+")",Fr+"+"+us+"(?="+[dn,ur+os,"$"].join("|")+")",ur+"?"+os+"+"+cs,ur+"+"+us,fs,Kr,rs,Ki].join("|"),"g"),gs=RegExp("["+as+zi+Xn+ts+"]"),Ii=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ys=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],La=-1,Ke={};Ke[ut]=Ke[je]=Ke[St]=Ke[Ft]=Ke[zt]=Ke[Ut]=Ke[jt]=Ke[Gt]=Ke[tr]=!0,Ke[me]=Ke[xt]=Ke[Ne]=Ke[A]=Ke[He]=Ke[S]=Ke[b]=Ke[Z]=Ke[ve]=Ke[Re]=Ke[Ie]=Ke[nt]=Ke[De]=Ke[Je]=Ke[ze]=!1;var Ue={};Ue[me]=Ue[xt]=Ue[Ne]=Ue[He]=Ue[A]=Ue[S]=Ue[ut]=Ue[je]=Ue[St]=Ue[Ft]=Ue[zt]=Ue[ve]=Ue[Re]=Ue[Ie]=Ue[nt]=Ue[De]=Ue[Je]=Ue[Qe]=Ue[Ut]=Ue[jt]=Ue[Gt]=Ue[tr]=!0,Ue[b]=Ue[Z]=Ue[ze]=!1;var y={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},j={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,le=parseInt,Xe=typeof Un=="object"&&Un&&Un.Object===Object&&Un,Rt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Xe||Rt||Function("return this")(),Be=i&&!i.nodeType&&i,mt=Be&&!0&&o&&!o.nodeType&&o,rr=mt&&mt.exports===Be,Nt=rr&&Xe.process,Ze=function(){try{var x=mt&&mt.require&&mt.require("util").types;return x||Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),Jt=Ze&&Ze.isArrayBuffer,Pr=Ze&&Ze.isDate,yr=Ze&&Ze.isMap,Dr=Ze&&Ze.isRegExp,yn=Ze&&Ze.isSet,Si=Ze&&Ze.isTypedArray;function Lt(x,$,O){switch(O.length){case 0:return x.call($);case 1:return x.call($,O[0]);case 2:return x.call($,O[0],O[1]);case 3:return x.call($,O[0],O[1],O[2])}return x.apply($,O)}function If(x,$,O,Y){for(var ce=-1,Fe=x==null?0:x.length;++ce<Fe;){var Dt=x[ce];$(Y,Dt,O(Dt),x)}return Y}function vr(x,$){for(var O=-1,Y=x==null?0:x.length;++O<Y&&$(x[O],O,x)!==!1;);return x}function Sf(x,$){for(var O=x==null?0:x.length;O--&&$(x[O],O,x)!==!1;);return x}function Fc(x,$){for(var O=-1,Y=x==null?0:x.length;++O<Y;)if(!$(x[O],O,x))return!1;return!0}function si(x,$){for(var O=-1,Y=x==null?0:x.length,ce=0,Fe=[];++O<Y;){var Dt=x[O];$(Dt,O,x)&&(Fe[ce++]=Dt)}return Fe}function vs(x,$){var O=x==null?0:x.length;return!!O&&Bi(x,$,0)>-1}function Ma(x,$,O){for(var Y=-1,ce=x==null?0:x.length;++Y<ce;)if(O($,x[Y]))return!0;return!1}function it(x,$){for(var O=-1,Y=x==null?0:x.length,ce=Array(Y);++O<Y;)ce[O]=$(x[O],O,x);return ce}function ai(x,$){for(var O=-1,Y=$.length,ce=x.length;++O<Y;)x[ce+O]=$[O];return x}function za(x,$,O,Y){var ce=-1,Fe=x==null?0:x.length;for(Y&&Fe&&(O=x[++ce]);++ce<Fe;)O=$(O,x[ce],ce,x);return O}function Pf(x,$,O,Y){var ce=x==null?0:x.length;for(Y&&ce&&(O=x[--ce]);ce--;)O=$(O,x[ce],ce,x);return O}function Ua(x,$){for(var O=-1,Y=x==null?0:x.length;++O<Y;)if($(x[O],O,x))return!0;return!1}var Of=ka("length");function Cf(x){return x.split("")}function Af(x){return x.match(Tt)||[]}function Dc(x,$,O){var Y;return O(x,function(ce,Fe,Dt){if($(ce,Fe,Dt))return Y=Fe,!1}),Y}function _s(x,$,O,Y){for(var ce=x.length,Fe=O+(Y?1:-1);Y?Fe--:++Fe<ce;)if($(x[Fe],Fe,x))return Fe;return-1}function Bi(x,$,O){return $===$?Uf(x,$,O):_s(x,qc,O)}function Tf(x,$,O,Y){for(var ce=O-1,Fe=x.length;++ce<Fe;)if(Y(x[ce],$))return ce;return-1}function qc(x){return x!==x}function jc(x,$){var O=x==null?0:x.length;return O?Ka(x,$)/O:H}function ka(x){return function($){return $==null?t:$[x]}}function Ha(x){return function($){return x==null?t:x[$]}}function Lc(x,$,O,Y,ce){return ce(x,function(Fe,Dt,Ge){O=Y?(Y=!1,Fe):$(O,Fe,Dt,Ge)}),O}function Rf(x,$){var O=x.length;for(x.sort($);O--;)x[O]=x[O].value;return x}function Ka(x,$){for(var O,Y=-1,ce=x.length;++Y<ce;){var Fe=$(x[Y]);Fe!==t&&(O=O===t?Fe:O+Fe)}return O}function Va(x,$){for(var O=-1,Y=Array(x);++O<x;)Y[O]=$(O);return Y}function Nf(x,$){return it($,function(O){return[O,x[O]]})}function Mc(x){return x&&x.slice(0,Hc(x)+1).replace(dt,"")}function hr(x){return function($){return x($)}}function Ba(x,$){return it($,function(O){return x[O]})}function vn(x,$){return x.has($)}function zc(x,$){for(var O=-1,Y=x.length;++O<Y&&Bi($,x[O],0)>-1;);return O}function Uc(x,$){for(var O=x.length;O--&&Bi($,x[O],0)>-1;);return O}function $f(x,$){for(var O=x.length,Y=0;O--;)x[O]===$&&++Y;return Y}var Ff=Ha(y),Df=Ha(E);function qf(x){return"\\"+Q[x]}function jf(x,$){return x==null?t:x[$]}function Gi(x){return gs.test(x)}function Lf(x){return Ii.test(x)}function Mf(x){for(var $,O=[];!($=x.next()).done;)O.push($.value);return O}function Ga(x){var $=-1,O=Array(x.size);return x.forEach(function(Y,ce){O[++$]=[ce,Y]}),O}function kc(x,$){return function(O){return x($(O))}}function oi(x,$){for(var O=-1,Y=x.length,ce=0,Fe=[];++O<Y;){var Dt=x[O];(Dt===$||Dt===P)&&(x[O]=P,Fe[ce++]=O)}return Fe}function ms(x){var $=-1,O=Array(x.size);return x.forEach(function(Y){O[++$]=Y}),O}function zf(x){var $=-1,O=Array(x.size);return x.forEach(function(Y){O[++$]=[Y,Y]}),O}function Uf(x,$,O){for(var Y=O-1,ce=x.length;++Y<ce;)if(x[Y]===$)return Y;return-1}function kf(x,$,O){for(var Y=O+1;Y--;)if(x[Y]===$)return Y;return Y}function Wi(x){return Gi(x)?Kf(x):Of(x)}function Or(x){return Gi(x)?Vf(x):Cf(x)}function Hc(x){for(var $=x.length;$--&&_t.test(x.charAt($)););return $}var Hf=Ha(j);function Kf(x){for(var $=Vi.lastIndex=0;Vi.test(x);)++$;return $}function Vf(x){return x.match(Vi)||[]}function Bf(x){return x.match(ds)||[]}var Gf=function x($){$=$==null?Pe:Ji.defaults(Pe.Object(),$,Ji.pick(Pe,ys));var O=$.Array,Y=$.Date,ce=$.Error,Fe=$.Function,Dt=$.Math,Ge=$.Object,Wa=$.RegExp,Wf=$.String,_r=$.TypeError,ws=O.prototype,Jf=Fe.prototype,Qi=Ge.prototype,bs=$["__core-js_shared__"],Es=Jf.toString,Le=Qi.hasOwnProperty,Qf=0,Kc=function(){var e=/[^.]+$/.exec(bs&&bs.keys&&bs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),xs=Qi.toString,Yf=Es.call(Ge),Xf=Pe._,Zf=Wa("^"+Es.call(Le).replace(pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Is=rr?$.Buffer:t,ci=$.Symbol,Ss=$.Uint8Array,Vc=Is?Is.allocUnsafe:t,Ps=kc(Ge.getPrototypeOf,Ge),Bc=Ge.create,Gc=Qi.propertyIsEnumerable,Os=ws.splice,Wc=ci?ci.isConcatSpreadable:t,_n=ci?ci.iterator:t,Pi=ci?ci.toStringTag:t,Cs=function(){try{var e=Ri(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),ep=$.clearTimeout!==Pe.clearTimeout&&$.clearTimeout,tp=Y&&Y.now!==Pe.Date.now&&Y.now,rp=$.setTimeout!==Pe.setTimeout&&$.setTimeout,As=Dt.ceil,Ts=Dt.floor,Ja=Ge.getOwnPropertySymbols,ip=Is?Is.isBuffer:t,Jc=$.isFinite,np=ws.join,sp=kc(Ge.keys,Ge),qt=Dt.max,Kt=Dt.min,ap=Y.now,op=$.parseInt,Qc=Dt.random,cp=ws.reverse,Qa=Ri($,"DataView"),mn=Ri($,"Map"),Ya=Ri($,"Promise"),Yi=Ri($,"Set"),wn=Ri($,"WeakMap"),bn=Ri(Ge,"create"),Rs=wn&&new wn,Xi={},up=Ni(Qa),hp=Ni(mn),lp=Ni(Ya),fp=Ni(Yi),pp=Ni(wn),Ns=ci?ci.prototype:t,En=Ns?Ns.valueOf:t,Yc=Ns?Ns.toString:t;function p(e){if(yt(e)&&!fe(e)&&!(e instanceof Se)){if(e instanceof mr)return e;if(Le.call(e,"__wrapped__"))return Xu(e)}return new mr(e)}var Zi=function(){function e(){}return function(r){if(!ot(r))return{};if(Bc)return Bc(r);e.prototype=r;var s=new e;return e.prototype=t,s}}();function $s(){}function mr(e,r){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=t}p.templateSettings={escape:lt,evaluate:ft,interpolate:at,variable:"",imports:{_:p}},p.prototype=$s.prototype,p.prototype.constructor=p,mr.prototype=Zi($s.prototype),mr.prototype.constructor=mr;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=B,this.__views__=[]}function dp(){var e=new Se(this.__wrapped__);return e.__actions__=ir(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ir(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ir(this.__views__),e}function gp(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function yp(){var e=this.__wrapped__.value(),r=this.__dir__,s=fe(e),u=r<0,l=s?e.length:0,d=Cd(0,l,this.__views__),_=d.start,w=d.end,I=w-_,F=u?w:_-1,D=this.__iteratees__,M=D.length,G=0,ee=Kt(I,this.__takeCount__);if(!s||!u&&l==I&&ee==I)return bu(e,this.__actions__);var ne=[];e:for(;I--&&G<ee;){F+=r;for(var _e=-1,se=e[F];++_e<M;){var xe=D[_e],Oe=xe.iteratee,pr=xe.type,Xt=Oe(se);if(pr==q)se=Xt;else if(!Xt){if(pr==C)continue e;break e}}ne[G++]=se}return ne}Se.prototype=Zi($s.prototype),Se.prototype.constructor=Se;function Oi(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var u=e[r];this.set(u[0],u[1])}}function vp(){this.__data__=bn?bn(null):{},this.size=0}function _p(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}function mp(e){var r=this.__data__;if(bn){var s=r[e];return s===m?t:s}return Le.call(r,e)?r[e]:t}function wp(e){var r=this.__data__;return bn?r[e]!==t:Le.call(r,e)}function bp(e,r){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=bn&&r===t?m:r,this}Oi.prototype.clear=vp,Oi.prototype.delete=_p,Oi.prototype.get=mp,Oi.prototype.has=wp,Oi.prototype.set=bp;function Vr(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var u=e[r];this.set(u[0],u[1])}}function Ep(){this.__data__=[],this.size=0}function xp(e){var r=this.__data__,s=Fs(r,e);if(s<0)return!1;var u=r.length-1;return s==u?r.pop():Os.call(r,s,1),--this.size,!0}function Ip(e){var r=this.__data__,s=Fs(r,e);return s<0?t:r[s][1]}function Sp(e){return Fs(this.__data__,e)>-1}function Pp(e,r){var s=this.__data__,u=Fs(s,e);return u<0?(++this.size,s.push([e,r])):s[u][1]=r,this}Vr.prototype.clear=Ep,Vr.prototype.delete=xp,Vr.prototype.get=Ip,Vr.prototype.has=Sp,Vr.prototype.set=Pp;function Br(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var u=e[r];this.set(u[0],u[1])}}function Op(){this.size=0,this.__data__={hash:new Oi,map:new(mn||Vr),string:new Oi}}function Cp(e){var r=Bs(this,e).delete(e);return this.size-=r?1:0,r}function Ap(e){return Bs(this,e).get(e)}function Tp(e){return Bs(this,e).has(e)}function Rp(e,r){var s=Bs(this,e),u=s.size;return s.set(e,r),this.size+=s.size==u?0:1,this}Br.prototype.clear=Op,Br.prototype.delete=Cp,Br.prototype.get=Ap,Br.prototype.has=Tp,Br.prototype.set=Rp;function Ci(e){var r=-1,s=e==null?0:e.length;for(this.__data__=new Br;++r<s;)this.add(e[r])}function Np(e){return this.__data__.set(e,m),this}function $p(e){return this.__data__.has(e)}Ci.prototype.add=Ci.prototype.push=Np,Ci.prototype.has=$p;function Cr(e){var r=this.__data__=new Vr(e);this.size=r.size}function Fp(){this.__data__=new Vr,this.size=0}function Dp(e){var r=this.__data__,s=r.delete(e);return this.size=r.size,s}function qp(e){return this.__data__.get(e)}function jp(e){return this.__data__.has(e)}function Lp(e,r){var s=this.__data__;if(s instanceof Vr){var u=s.__data__;if(!mn||u.length<a-1)return u.push([e,r]),this.size=++s.size,this;s=this.__data__=new Br(u)}return s.set(e,r),this.size=s.size,this}Cr.prototype.clear=Fp,Cr.prototype.delete=Dp,Cr.prototype.get=qp,Cr.prototype.has=jp,Cr.prototype.set=Lp;function Xc(e,r){var s=fe(e),u=!s&&$i(e),l=!s&&!u&&pi(e),d=!s&&!u&&!l&&nn(e),_=s||u||l||d,w=_?Va(e.length,Wf):[],I=w.length;for(var F in e)(r||Le.call(e,F))&&!(_&&(F=="length"||l&&(F=="offset"||F=="parent")||d&&(F=="buffer"||F=="byteLength"||F=="byteOffset")||Qr(F,I)))&&w.push(F);return w}function Zc(e){var r=e.length;return r?e[co(0,r-1)]:t}function Mp(e,r){return Gs(ir(e),Ai(r,0,e.length))}function zp(e){return Gs(ir(e))}function Xa(e,r,s){(s!==t&&!Ar(e[r],s)||s===t&&!(r in e))&&Gr(e,r,s)}function xn(e,r,s){var u=e[r];(!(Le.call(e,r)&&Ar(u,s))||s===t&&!(r in e))&&Gr(e,r,s)}function Fs(e,r){for(var s=e.length;s--;)if(Ar(e[s][0],r))return s;return-1}function Up(e,r,s,u){return ui(e,function(l,d,_){r(u,l,s(l),_)}),u}function eu(e,r){return e&&jr(r,Mt(r),e)}function kp(e,r){return e&&jr(r,sr(r),e)}function Gr(e,r,s){r=="__proto__"&&Cs?Cs(e,r,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[r]=s}function Za(e,r){for(var s=-1,u=r.length,l=O(u),d=e==null;++s<u;)l[s]=d?t:Fo(e,r[s]);return l}function Ai(e,r,s){return e===e&&(s!==t&&(e=e<=s?e:s),r!==t&&(e=e>=r?e:r)),e}function wr(e,r,s,u,l,d){var _,w=r&L,I=r&T,F=r&U;if(s&&(_=l?s(e,u,l,d):s(e)),_!==t)return _;if(!ot(e))return e;var D=fe(e);if(D){if(_=Td(e),!w)return ir(e,_)}else{var M=Vt(e),G=M==Z||M==oe;if(pi(e))return Iu(e,w);if(M==Ie||M==me||G&&!l){if(_=I||G?{}:Hu(e),!w)return I?md(e,kp(_,e)):_d(e,eu(_,e))}else{if(!Ue[M])return l?e:{};_=Rd(e,M,w)}}d||(d=new Cr);var ee=d.get(e);if(ee)return ee;d.set(e,_),_h(e)?e.forEach(function(se){_.add(wr(se,r,s,se,e,d))}):yh(e)&&e.forEach(function(se,xe){_.set(xe,wr(se,r,s,xe,e,d))});var ne=F?I?wo:mo:I?sr:Mt,_e=D?t:ne(e);return vr(_e||e,function(se,xe){_e&&(xe=se,se=e[xe]),xn(_,xe,wr(se,r,s,xe,e,d))}),_}function Hp(e){var r=Mt(e);return function(s){return tu(s,e,r)}}function tu(e,r,s){var u=s.length;if(e==null)return!u;for(e=Ge(e);u--;){var l=s[u],d=r[l],_=e[l];if(_===t&&!(l in e)||!d(_))return!1}return!0}function ru(e,r,s){if(typeof e!="function")throw new _r(f);return Tn(function(){e.apply(t,s)},r)}function In(e,r,s,u){var l=-1,d=vs,_=!0,w=e.length,I=[],F=r.length;if(!w)return I;s&&(r=it(r,hr(s))),u?(d=Ma,_=!1):r.length>=a&&(d=vn,_=!1,r=new Ci(r));e:for(;++l<w;){var D=e[l],M=s==null?D:s(D);if(D=u||D!==0?D:0,_&&M===M){for(var G=F;G--;)if(r[G]===M)continue e;I.push(D)}else d(r,M,u)||I.push(D)}return I}var ui=Au(qr),iu=Au(to,!0);function Kp(e,r){var s=!0;return ui(e,function(u,l,d){return s=!!r(u,l,d),s}),s}function Ds(e,r,s){for(var u=-1,l=e.length;++u<l;){var d=e[u],_=r(d);if(_!=null&&(w===t?_===_&&!fr(_):s(_,w)))var w=_,I=d}return I}function Vp(e,r,s,u){var l=e.length;for(s=ye(s),s<0&&(s=-s>l?0:l+s),u=u===t||u>l?l:ye(u),u<0&&(u+=l),u=s>u?0:wh(u);s<u;)e[s++]=r;return e}function nu(e,r){var s=[];return ui(e,function(u,l,d){r(u,l,d)&&s.push(u)}),s}function kt(e,r,s,u,l){var d=-1,_=e.length;for(s||(s=$d),l||(l=[]);++d<_;){var w=e[d];r>0&&s(w)?r>1?kt(w,r-1,s,u,l):ai(l,w):u||(l[l.length]=w)}return l}var eo=Tu(),su=Tu(!0);function qr(e,r){return e&&eo(e,r,Mt)}function to(e,r){return e&&su(e,r,Mt)}function qs(e,r){return si(r,function(s){return Yr(e[s])})}function Ti(e,r){r=li(r,e);for(var s=0,u=r.length;e!=null&&s<u;)e=e[Lr(r[s++])];return s&&s==u?e:t}function au(e,r,s){var u=r(e);return fe(e)?u:ai(u,s(e))}function Qt(e){return e==null?e===t?st:$e:Pi&&Pi in Ge(e)?Od(e):zd(e)}function ro(e,r){return e>r}function Bp(e,r){return e!=null&&Le.call(e,r)}function Gp(e,r){return e!=null&&r in Ge(e)}function Wp(e,r,s){return e>=Kt(r,s)&&e<qt(r,s)}function io(e,r,s){for(var u=s?Ma:vs,l=e[0].length,d=e.length,_=d,w=O(d),I=1/0,F=[];_--;){var D=e[_];_&&r&&(D=it(D,hr(r))),I=Kt(D.length,I),w[_]=!s&&(r||l>=120&&D.length>=120)?new Ci(_&&D):t}D=e[0];var M=-1,G=w[0];e:for(;++M<l&&F.length<I;){var ee=D[M],ne=r?r(ee):ee;if(ee=s||ee!==0?ee:0,!(G?vn(G,ne):u(F,ne,s))){for(_=d;--_;){var _e=w[_];if(!(_e?vn(_e,ne):u(e[_],ne,s)))continue e}G&&G.push(ne),F.push(ee)}}return F}function Jp(e,r,s,u){return qr(e,function(l,d,_){r(u,s(l),d,_)}),u}function Sn(e,r,s){r=li(r,e),e=Gu(e,r);var u=e==null?e:e[Lr(Er(r))];return u==null?t:Lt(u,e,s)}function ou(e){return yt(e)&&Qt(e)==me}function Qp(e){return yt(e)&&Qt(e)==Ne}function Yp(e){return yt(e)&&Qt(e)==S}function Pn(e,r,s,u,l){return e===r?!0:e==null||r==null||!yt(e)&&!yt(r)?e!==e&&r!==r:Xp(e,r,s,u,Pn,l)}function Xp(e,r,s,u,l,d){var _=fe(e),w=fe(r),I=_?xt:Vt(e),F=w?xt:Vt(r);I=I==me?Ie:I,F=F==me?Ie:F;var D=I==Ie,M=F==Ie,G=I==F;if(G&&pi(e)){if(!pi(r))return!1;_=!0,D=!1}if(G&&!D)return d||(d=new Cr),_||nn(e)?zu(e,r,s,u,l,d):Sd(e,r,I,s,u,l,d);if(!(s&k)){var ee=D&&Le.call(e,"__wrapped__"),ne=M&&Le.call(r,"__wrapped__");if(ee||ne){var _e=ee?e.value():e,se=ne?r.value():r;return d||(d=new Cr),l(_e,se,s,u,d)}}return G?(d||(d=new Cr),Pd(e,r,s,u,l,d)):!1}function Zp(e){return yt(e)&&Vt(e)==ve}function no(e,r,s,u){var l=s.length,d=l,_=!u;if(e==null)return!d;for(e=Ge(e);l--;){var w=s[l];if(_&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++l<d;){w=s[l];var I=w[0],F=e[I],D=w[1];if(_&&w[2]){if(F===t&&!(I in e))return!1}else{var M=new Cr;if(u)var G=u(F,D,I,e,r,M);if(!(G===t?Pn(D,F,k|K,u,M):G))return!1}}return!0}function cu(e){if(!ot(e)||Dd(e))return!1;var r=Yr(e)?Zf:xa;return r.test(Ni(e))}function ed(e){return yt(e)&&Qt(e)==nt}function td(e){return yt(e)&&Vt(e)==De}function rd(e){return yt(e)&&Zs(e.length)&&!!Ke[Qt(e)]}function uu(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?fe(e)?fu(e[0],e[1]):lu(e):Rh(e)}function so(e){if(!An(e))return sp(e);var r=[];for(var s in Ge(e))Le.call(e,s)&&s!="constructor"&&r.push(s);return r}function id(e){if(!ot(e))return Md(e);var r=An(e),s=[];for(var u in e)u=="constructor"&&(r||!Le.call(e,u))||s.push(u);return s}function ao(e,r){return e<r}function hu(e,r){var s=-1,u=nr(e)?O(e.length):[];return ui(e,function(l,d,_){u[++s]=r(l,d,_)}),u}function lu(e){var r=Eo(e);return r.length==1&&r[0][2]?Vu(r[0][0],r[0][1]):function(s){return s===e||no(s,e,r)}}function fu(e,r){return Io(e)&&Ku(r)?Vu(Lr(e),r):function(s){var u=Fo(s,e);return u===t&&u===r?Do(s,e):Pn(r,u,k|K)}}function js(e,r,s,u,l){e!==r&&eo(r,function(d,_){if(l||(l=new Cr),ot(d))nd(e,r,_,s,js,u,l);else{var w=u?u(Po(e,_),d,_+"",e,r,l):t;w===t&&(w=d),Xa(e,_,w)}},sr)}function nd(e,r,s,u,l,d,_){var w=Po(e,s),I=Po(r,s),F=_.get(I);if(F){Xa(e,s,F);return}var D=d?d(w,I,s+"",e,r,_):t,M=D===t;if(M){var G=fe(I),ee=!G&&pi(I),ne=!G&&!ee&&nn(I);D=I,G||ee||ne?fe(w)?D=w:wt(w)?D=ir(w):ee?(M=!1,D=Iu(I,!0)):ne?(M=!1,D=Su(I,!0)):D=[]:Rn(I)||$i(I)?(D=w,$i(w)?D=bh(w):(!ot(w)||Yr(w))&&(D=Hu(I))):M=!1}M&&(_.set(I,D),l(D,I,u,d,_),_.delete(I)),Xa(e,s,D)}function pu(e,r){var s=e.length;if(s)return r+=r<0?s:0,Qr(r,s)?e[r]:t}function du(e,r,s){r.length?r=it(r,function(d){return fe(d)?function(_){return Ti(_,d.length===1?d[0]:d)}:d}):r=[ar];var u=-1;r=it(r,hr(ie()));var l=hu(e,function(d,_,w){var I=it(r,function(F){return F(d)});return{criteria:I,index:++u,value:d}});return Rf(l,function(d,_){return vd(d,_,s)})}function sd(e,r){return gu(e,r,function(s,u){return Do(e,u)})}function gu(e,r,s){for(var u=-1,l=r.length,d={};++u<l;){var _=r[u],w=Ti(e,_);s(w,_)&&On(d,li(_,e),w)}return d}function ad(e){return function(r){return Ti(r,e)}}function oo(e,r,s,u){var l=u?Tf:Bi,d=-1,_=r.length,w=e;for(e===r&&(r=ir(r)),s&&(w=it(e,hr(s)));++d<_;)for(var I=0,F=r[d],D=s?s(F):F;(I=l(w,D,I,u))>-1;)w!==e&&Os.call(w,I,1),Os.call(e,I,1);return e}function yu(e,r){for(var s=e?r.length:0,u=s-1;s--;){var l=r[s];if(s==u||l!==d){var d=l;Qr(l)?Os.call(e,l,1):lo(e,l)}}return e}function co(e,r){return e+Ts(Qc()*(r-e+1))}function od(e,r,s,u){for(var l=-1,d=qt(As((r-e)/(s||1)),0),_=O(d);d--;)_[u?d:++l]=e,e+=s;return _}function uo(e,r){var s="";if(!e||r<1||r>J)return s;do r%2&&(s+=e),r=Ts(r/2),r&&(e+=e);while(r);return s}function we(e,r){return Oo(Bu(e,r,ar),e+"")}function cd(e){return Zc(sn(e))}function ud(e,r){var s=sn(e);return Gs(s,Ai(r,0,s.length))}function On(e,r,s,u){if(!ot(e))return e;r=li(r,e);for(var l=-1,d=r.length,_=d-1,w=e;w!=null&&++l<d;){var I=Lr(r[l]),F=s;if(I==="__proto__"||I==="constructor"||I==="prototype")return e;if(l!=_){var D=w[I];F=u?u(D,I,w):t,F===t&&(F=ot(D)?D:Qr(r[l+1])?[]:{})}xn(w,I,F),w=w[I]}return e}var vu=Rs?function(e,r){return Rs.set(e,r),e}:ar,hd=Cs?function(e,r){return Cs(e,"toString",{configurable:!0,enumerable:!1,value:jo(r),writable:!0})}:ar;function ld(e){return Gs(sn(e))}function br(e,r,s){var u=-1,l=e.length;r<0&&(r=-r>l?0:l+r),s=s>l?l:s,s<0&&(s+=l),l=r>s?0:s-r>>>0,r>>>=0;for(var d=O(l);++u<l;)d[u]=e[u+r];return d}function fd(e,r){var s;return ui(e,function(u,l,d){return s=r(u,l,d),!s}),!!s}function Ls(e,r,s){var u=0,l=e==null?u:e.length;if(typeof r=="number"&&r===r&&l<=ke){for(;u<l;){var d=u+l>>>1,_=e[d];_!==null&&!fr(_)&&(s?_<=r:_<r)?u=d+1:l=d}return l}return ho(e,r,ar,s)}function ho(e,r,s,u){var l=0,d=e==null?0:e.length;if(d===0)return 0;r=s(r);for(var _=r!==r,w=r===null,I=fr(r),F=r===t;l<d;){var D=Ts((l+d)/2),M=s(e[D]),G=M!==t,ee=M===null,ne=M===M,_e=fr(M);if(_)var se=u||ne;else F?se=ne&&(u||G):w?se=ne&&G&&(u||!ee):I?se=ne&&G&&!ee&&(u||!_e):ee||_e?se=!1:se=u?M<=r:M<r;se?l=D+1:d=D}return Kt(d,ct)}function _u(e,r){for(var s=-1,u=e.length,l=0,d=[];++s<u;){var _=e[s],w=r?r(_):_;if(!s||!Ar(w,I)){var I=w;d[l++]=_===0?0:_}}return d}function mu(e){return typeof e=="number"?e:fr(e)?H:+e}function lr(e){if(typeof e=="string")return e;if(fe(e))return it(e,lr)+"";if(fr(e))return Yc?Yc.call(e):"";var r=e+"";return r=="0"&&1/e==-Te?"-0":r}function hi(e,r,s){var u=-1,l=vs,d=e.length,_=!0,w=[],I=w;if(s)_=!1,l=Ma;else if(d>=a){var F=r?null:xd(e);if(F)return ms(F);_=!1,l=vn,I=new Ci}else I=r?[]:w;e:for(;++u<d;){var D=e[u],M=r?r(D):D;if(D=s||D!==0?D:0,_&&M===M){for(var G=I.length;G--;)if(I[G]===M)continue e;r&&I.push(M),w.push(D)}else l(I,M,s)||(I!==w&&I.push(M),w.push(D))}return w}function lo(e,r){return r=li(r,e),e=Gu(e,r),e==null||delete e[Lr(Er(r))]}function wu(e,r,s,u){return On(e,r,s(Ti(e,r)),u)}function Ms(e,r,s,u){for(var l=e.length,d=u?l:-1;(u?d--:++d<l)&&r(e[d],d,e););return s?br(e,u?0:d,u?d+1:l):br(e,u?d+1:0,u?l:d)}function bu(e,r){var s=e;return s instanceof Se&&(s=s.value()),za(r,function(u,l){return l.func.apply(l.thisArg,ai([u],l.args))},s)}function fo(e,r,s){var u=e.length;if(u<2)return u?hi(e[0]):[];for(var l=-1,d=O(u);++l<u;)for(var _=e[l],w=-1;++w<u;)w!=l&&(d[l]=In(d[l]||_,e[w],r,s));return hi(kt(d,1),r,s)}function Eu(e,r,s){for(var u=-1,l=e.length,d=r.length,_={};++u<l;){var w=u<d?r[u]:t;s(_,e[u],w)}return _}function po(e){return wt(e)?e:[]}function go(e){return typeof e=="function"?e:ar}function li(e,r){return fe(e)?e:Io(e,r)?[e]:Yu(qe(e))}var pd=we;function fi(e,r,s){var u=e.length;return s=s===t?u:s,!r&&s>=u?e:br(e,r,s)}var xu=ep||function(e){return Pe.clearTimeout(e)};function Iu(e,r){if(r)return e.slice();var s=e.length,u=Vc?Vc(s):new e.constructor(s);return e.copy(u),u}function yo(e){var r=new e.constructor(e.byteLength);return new Ss(r).set(new Ss(e)),r}function dd(e,r){var s=r?yo(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function gd(e){var r=new e.constructor(e.source,gr.exec(e));return r.lastIndex=e.lastIndex,r}function yd(e){return En?Ge(En.call(e)):{}}function Su(e,r){var s=r?yo(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Pu(e,r){if(e!==r){var s=e!==t,u=e===null,l=e===e,d=fr(e),_=r!==t,w=r===null,I=r===r,F=fr(r);if(!w&&!F&&!d&&e>r||d&&_&&I&&!w&&!F||u&&_&&I||!s&&I||!l)return 1;if(!u&&!d&&!F&&e<r||F&&s&&l&&!u&&!d||w&&s&&l||!_&&l||!I)return-1}return 0}function vd(e,r,s){for(var u=-1,l=e.criteria,d=r.criteria,_=l.length,w=s.length;++u<_;){var I=Pu(l[u],d[u]);if(I){if(u>=w)return I;var F=s[u];return I*(F=="desc"?-1:1)}}return e.index-r.index}function Ou(e,r,s,u){for(var l=-1,d=e.length,_=s.length,w=-1,I=r.length,F=qt(d-_,0),D=O(I+F),M=!u;++w<I;)D[w]=r[w];for(;++l<_;)(M||l<d)&&(D[s[l]]=e[l]);for(;F--;)D[w++]=e[l++];return D}function Cu(e,r,s,u){for(var l=-1,d=e.length,_=-1,w=s.length,I=-1,F=r.length,D=qt(d-w,0),M=O(D+F),G=!u;++l<D;)M[l]=e[l];for(var ee=l;++I<F;)M[ee+I]=r[I];for(;++_<w;)(G||l<d)&&(M[ee+s[_]]=e[l++]);return M}function ir(e,r){var s=-1,u=e.length;for(r||(r=O(u));++s<u;)r[s]=e[s];return r}function jr(e,r,s,u){var l=!s;s||(s={});for(var d=-1,_=r.length;++d<_;){var w=r[d],I=u?u(s[w],e[w],w,s,e):t;I===t&&(I=e[w]),l?Gr(s,w,I):xn(s,w,I)}return s}function _d(e,r){return jr(e,xo(e),r)}function md(e,r){return jr(e,Uu(e),r)}function zs(e,r){return function(s,u){var l=fe(s)?If:Up,d=r?r():{};return l(s,e,ie(u,2),d)}}function en(e){return we(function(r,s){var u=-1,l=s.length,d=l>1?s[l-1]:t,_=l>2?s[2]:t;for(d=e.length>3&&typeof d=="function"?(l--,d):t,_&&Yt(s[0],s[1],_)&&(d=l<3?t:d,l=1),r=Ge(r);++u<l;){var w=s[u];w&&e(r,w,u,d)}return r})}function Au(e,r){return function(s,u){if(s==null)return s;if(!nr(s))return e(s,u);for(var l=s.length,d=r?l:-1,_=Ge(s);(r?d--:++d<l)&&u(_[d],d,_)!==!1;);return s}}function Tu(e){return function(r,s,u){for(var l=-1,d=Ge(r),_=u(r),w=_.length;w--;){var I=_[e?w:++l];if(s(d[I],I,d)===!1)break}return r}}function wd(e,r,s){var u=r&ae,l=Cn(e);function d(){var _=this&&this!==Pe&&this instanceof d?l:e;return _.apply(u?s:this,arguments)}return d}function Ru(e){return function(r){r=qe(r);var s=Gi(r)?Or(r):t,u=s?s[0]:r.charAt(0),l=s?fi(s,1).join(""):r.slice(1);return u[e]()+l}}function tn(e){return function(r){return za(Ah(Ch(r).replace(gn,"")),e,"")}}function Cn(e){return function(){var r=arguments;switch(r.length){case 0:return new e;case 1:return new e(r[0]);case 2:return new e(r[0],r[1]);case 3:return new e(r[0],r[1],r[2]);case 4:return new e(r[0],r[1],r[2],r[3]);case 5:return new e(r[0],r[1],r[2],r[3],r[4]);case 6:return new e(r[0],r[1],r[2],r[3],r[4],r[5]);case 7:return new e(r[0],r[1],r[2],r[3],r[4],r[5],r[6])}var s=Zi(e.prototype),u=e.apply(s,r);return ot(u)?u:s}}function bd(e,r,s){var u=Cn(e);function l(){for(var d=arguments.length,_=O(d),w=d,I=rn(l);w--;)_[w]=arguments[w];var F=d<3&&_[0]!==I&&_[d-1]!==I?[]:oi(_,I);if(d-=F.length,d<s)return qu(e,r,Us,l.placeholder,t,_,F,t,t,s-d);var D=this&&this!==Pe&&this instanceof l?u:e;return Lt(D,this,_)}return l}function Nu(e){return function(r,s,u){var l=Ge(r);if(!nr(r)){var d=ie(s,3);r=Mt(r),s=function(w){return d(l[w],w,l)}}var _=e(r,s,u);return _>-1?l[d?r[_]:_]:t}}function $u(e){return Jr(function(r){var s=r.length,u=s,l=mr.prototype.thru;for(e&&r.reverse();u--;){var d=r[u];if(typeof d!="function")throw new _r(f);if(l&&!_&&Vs(d)=="wrapper")var _=new mr([],!0)}for(u=_?u:s;++u<s;){d=r[u];var w=Vs(d),I=w=="wrapper"?bo(d):t;I&&So(I[0])&&I[1]==(z|pe|he|W)&&!I[4].length&&I[9]==1?_=_[Vs(I[0])].apply(_,I[3]):_=d.length==1&&So(d)?_[w]():_.thru(d)}return function(){var F=arguments,D=F[0];if(_&&F.length==1&&fe(D))return _.plant(D).value();for(var M=0,G=s?r[M].apply(this,F):D;++M<s;)G=r[M].call(this,G);return G}})}function Us(e,r,s,u,l,d,_,w,I,F){var D=r&z,M=r&ae,G=r&be,ee=r&(pe|ue),ne=r&ge,_e=G?t:Cn(e);function se(){for(var xe=arguments.length,Oe=O(xe),pr=xe;pr--;)Oe[pr]=arguments[pr];if(ee)var Xt=rn(se),dr=$f(Oe,Xt);if(u&&(Oe=Ou(Oe,u,l,ee)),d&&(Oe=Cu(Oe,d,_,ee)),xe-=dr,ee&&xe<F){var bt=oi(Oe,Xt);return qu(e,r,Us,se.placeholder,s,Oe,bt,w,I,F-xe)}var Tr=M?s:this,Zr=G?Tr[e]:e;return xe=Oe.length,w?Oe=Ud(Oe,w):ne&&xe>1&&Oe.reverse(),D&&I<xe&&(Oe.length=I),this&&this!==Pe&&this instanceof se&&(Zr=_e||Cn(Zr)),Zr.apply(Tr,Oe)}return se}function Fu(e,r){return function(s,u){return Jp(s,e,r(u),{})}}function ks(e,r){return function(s,u){var l;if(s===t&&u===t)return r;if(s!==t&&(l=s),u!==t){if(l===t)return u;typeof s=="string"||typeof u=="string"?(s=lr(s),u=lr(u)):(s=mu(s),u=mu(u)),l=e(s,u)}return l}}function vo(e){return Jr(function(r){return r=it(r,hr(ie())),we(function(s){var u=this;return e(r,function(l){return Lt(l,u,s)})})})}function Hs(e,r){r=r===t?" ":lr(r);var s=r.length;if(s<2)return s?uo(r,e):r;var u=uo(r,As(e/Wi(r)));return Gi(r)?fi(Or(u),0,e).join(""):u.slice(0,e)}function Ed(e,r,s,u){var l=r&ae,d=Cn(e);function _(){for(var w=-1,I=arguments.length,F=-1,D=u.length,M=O(D+I),G=this&&this!==Pe&&this instanceof _?d:e;++F<D;)M[F]=u[F];for(;I--;)M[F++]=arguments[++w];return Lt(G,l?s:this,M)}return _}function Du(e){return function(r,s,u){return u&&typeof u!="number"&&Yt(r,s,u)&&(s=u=t),r=Xr(r),s===t?(s=r,r=0):s=Xr(s),u=u===t?r<s?1:-1:Xr(u),od(r,s,u,e)}}function Ks(e){return function(r,s){return typeof r=="string"&&typeof s=="string"||(r=xr(r),s=xr(s)),e(r,s)}}function qu(e,r,s,u,l,d,_,w,I,F){var D=r&pe,M=D?_:t,G=D?t:_,ee=D?d:t,ne=D?t:d;r|=D?he:N,r&=~(D?N:he),r&de||(r&=~(ae|be));var _e=[e,r,l,ee,M,ne,G,w,I,F],se=s.apply(t,_e);return So(e)&&Wu(se,_e),se.placeholder=u,Ju(se,e,r)}function _o(e){var r=Dt[e];return function(s,u){if(s=xr(s),u=u==null?0:Kt(ye(u),292),u&&Jc(s)){var l=(qe(s)+"e").split("e"),d=r(l[0]+"e"+(+l[1]+u));return l=(qe(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return r(s)}}var xd=Yi&&1/ms(new Yi([,-0]))[1]==Te?function(e){return new Yi(e)}:zo;function ju(e){return function(r){var s=Vt(r);return s==ve?Ga(r):s==De?zf(r):Nf(r,e(r))}}function Wr(e,r,s,u,l,d,_,w){var I=r&be;if(!I&&typeof e!="function")throw new _r(f);var F=u?u.length:0;if(F||(r&=~(he|N),u=l=t),_=_===t?_:qt(ye(_),0),w=w===t?w:ye(w),F-=l?l.length:0,r&N){var D=u,M=l;u=l=t}var G=I?t:bo(e),ee=[e,r,s,u,l,D,M,d,_,w];if(G&&Ld(ee,G),e=ee[0],r=ee[1],s=ee[2],u=ee[3],l=ee[4],w=ee[9]=ee[9]===t?I?0:e.length:qt(ee[9]-F,0),!w&&r&(pe|ue)&&(r&=~(pe|ue)),!r||r==ae)var ne=wd(e,r,s);else r==pe||r==ue?ne=bd(e,r,w):(r==he||r==(ae|he))&&!l.length?ne=Ed(e,r,s,u):ne=Us.apply(t,ee);var _e=G?vu:Wu;return Ju(_e(ne,ee),e,r)}function Lu(e,r,s,u){return e===t||Ar(e,Qi[s])&&!Le.call(u,s)?r:e}function Mu(e,r,s,u,l,d){return ot(e)&&ot(r)&&(d.set(r,e),js(e,r,t,Mu,d),d.delete(r)),e}function Id(e){return Rn(e)?t:e}function zu(e,r,s,u,l,d){var _=s&k,w=e.length,I=r.length;if(w!=I&&!(_&&I>w))return!1;var F=d.get(e),D=d.get(r);if(F&&D)return F==r&&D==e;var M=-1,G=!0,ee=s&K?new Ci:t;for(d.set(e,r),d.set(r,e);++M<w;){var ne=e[M],_e=r[M];if(u)var se=_?u(_e,ne,M,r,e,d):u(ne,_e,M,e,r,d);if(se!==t){if(se)continue;G=!1;break}if(ee){if(!Ua(r,function(xe,Oe){if(!vn(ee,Oe)&&(ne===xe||l(ne,xe,s,u,d)))return ee.push(Oe)})){G=!1;break}}else if(!(ne===_e||l(ne,_e,s,u,d))){G=!1;break}}return d.delete(e),d.delete(r),G}function Sd(e,r,s,u,l,d,_){switch(s){case He:if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)return!1;e=e.buffer,r=r.buffer;case Ne:return!(e.byteLength!=r.byteLength||!d(new Ss(e),new Ss(r)));case A:case S:case Re:return Ar(+e,+r);case b:return e.name==r.name&&e.message==r.message;case nt:case Je:return e==r+"";case ve:var w=Ga;case De:var I=u&k;if(w||(w=ms),e.size!=r.size&&!I)return!1;var F=_.get(e);if(F)return F==r;u|=K,_.set(e,r);var D=zu(w(e),w(r),u,l,d,_);return _.delete(e),D;case Qe:if(En)return En.call(e)==En.call(r)}return!1}function Pd(e,r,s,u,l,d){var _=s&k,w=mo(e),I=w.length,F=mo(r),D=F.length;if(I!=D&&!_)return!1;for(var M=I;M--;){var G=w[M];if(!(_?G in r:Le.call(r,G)))return!1}var ee=d.get(e),ne=d.get(r);if(ee&&ne)return ee==r&&ne==e;var _e=!0;d.set(e,r),d.set(r,e);for(var se=_;++M<I;){G=w[M];var xe=e[G],Oe=r[G];if(u)var pr=_?u(Oe,xe,G,r,e,d):u(xe,Oe,G,e,r,d);if(!(pr===t?xe===Oe||l(xe,Oe,s,u,d):pr)){_e=!1;break}se||(se=G=="constructor")}if(_e&&!se){var Xt=e.constructor,dr=r.constructor;Xt!=dr&&"constructor"in e&&"constructor"in r&&!(typeof Xt=="function"&&Xt instanceof Xt&&typeof dr=="function"&&dr instanceof dr)&&(_e=!1)}return d.delete(e),d.delete(r),_e}function Jr(e){return Oo(Bu(e,t,th),e+"")}function mo(e){return au(e,Mt,xo)}function wo(e){return au(e,sr,Uu)}var bo=Rs?function(e){return Rs.get(e)}:zo;function Vs(e){for(var r=e.name+"",s=Xi[r],u=Le.call(Xi,r)?s.length:0;u--;){var l=s[u],d=l.func;if(d==null||d==e)return l.name}return r}function rn(e){var r=Le.call(p,"placeholder")?p:e;return r.placeholder}function ie(){var e=p.iteratee||Lo;return e=e===Lo?uu:e,arguments.length?e(arguments[0],arguments[1]):e}function Bs(e,r){var s=e.__data__;return Fd(r)?s[typeof r=="string"?"string":"hash"]:s.map}function Eo(e){for(var r=Mt(e),s=r.length;s--;){var u=r[s],l=e[u];r[s]=[u,l,Ku(l)]}return r}function Ri(e,r){var s=jf(e,r);return cu(s)?s:t}function Od(e){var r=Le.call(e,Pi),s=e[Pi];try{e[Pi]=t;var u=!0}catch{}var l=xs.call(e);return u&&(r?e[Pi]=s:delete e[Pi]),l}var xo=Ja?function(e){return e==null?[]:(e=Ge(e),si(Ja(e),function(r){return Gc.call(e,r)}))}:Uo,Uu=Ja?function(e){for(var r=[];e;)ai(r,xo(e)),e=Ps(e);return r}:Uo,Vt=Qt;(Qa&&Vt(new Qa(new ArrayBuffer(1)))!=He||mn&&Vt(new mn)!=ve||Ya&&Vt(Ya.resolve())!=It||Yi&&Vt(new Yi)!=De||wn&&Vt(new wn)!=ze)&&(Vt=function(e){var r=Qt(e),s=r==Ie?e.constructor:t,u=s?Ni(s):"";if(u)switch(u){case up:return He;case hp:return ve;case lp:return It;case fp:return De;case pp:return ze}return r});function Cd(e,r,s){for(var u=-1,l=s.length;++u<l;){var d=s[u],_=d.size;switch(d.type){case"drop":e+=_;break;case"dropRight":r-=_;break;case"take":r=Kt(r,e+_);break;case"takeRight":e=qt(e,r-_);break}}return{start:e,end:r}}function Ad(e){var r=e.match(We);return r?r[1].split(At):[]}function ku(e,r,s){r=li(r,e);for(var u=-1,l=r.length,d=!1;++u<l;){var _=Lr(r[u]);if(!(d=e!=null&&s(e,_)))break;e=e[_]}return d||++u!=l?d:(l=e==null?0:e.length,!!l&&Zs(l)&&Qr(_,l)&&(fe(e)||$i(e)))}function Td(e){var r=e.length,s=new e.constructor(r);return r&&typeof e[0]=="string"&&Le.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Hu(e){return typeof e.constructor=="function"&&!An(e)?Zi(Ps(e)):{}}function Rd(e,r,s){var u=e.constructor;switch(r){case Ne:return yo(e);case A:case S:return new u(+e);case He:return dd(e,s);case ut:case je:case St:case Ft:case zt:case Ut:case jt:case Gt:case tr:return Su(e,s);case ve:return new u;case Re:case Je:return new u(e);case nt:return gd(e);case De:return new u;case Qe:return yd(e)}}function Nd(e,r){var s=r.length;if(!s)return e;var u=s-1;return r[u]=(s>1?"& ":"")+r[u],r=r.join(s>2?", ":" "),e.replace(gt,`{
/* [wrapped with `+r+`] */
`)}function $d(e){return fe(e)||$i(e)||!!(Wc&&e&&e[Wc])}function Qr(e,r){var s=typeof e;return r=r??J,!!r&&(s=="number"||s!="symbol"&&Sa.test(e))&&e>-1&&e%1==0&&e<r}function Yt(e,r,s){if(!ot(s))return!1;var u=typeof r;return(u=="number"?nr(s)&&Qr(r,s.length):u=="string"&&r in s)?Ar(s[r],e):!1}function Io(e,r){if(fe(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||fr(e)?!0:Pt.test(e)||!rt.test(e)||r!=null&&e in Ge(r)}function Fd(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function So(e){var r=Vs(e),s=p[r];if(typeof s!="function"||!(r in Se.prototype))return!1;if(e===s)return!0;var u=bo(s);return!!u&&e===u[0]}function Dd(e){return!!Kc&&Kc in e}var qd=bs?Yr:ko;function An(e){var r=e&&e.constructor,s=typeof r=="function"&&r.prototype||Qi;return e===s}function Ku(e){return e===e&&!ot(e)}function Vu(e,r){return function(s){return s==null?!1:s[e]===r&&(r!==t||e in Ge(s))}}function jd(e){var r=Ys(e,function(u){return s.size===v&&s.clear(),u}),s=r.cache;return r}function Ld(e,r){var s=e[1],u=r[1],l=s|u,d=l<(ae|be|z),_=u==z&&s==pe||u==z&&s==W&&e[7].length<=r[8]||u==(z|W)&&r[7].length<=r[8]&&s==pe;if(!(d||_))return e;u&ae&&(e[2]=r[2],l|=s&ae?0:de);var w=r[3];if(w){var I=e[3];e[3]=I?Ou(I,w,r[4]):w,e[4]=I?oi(e[3],P):r[4]}return w=r[5],w&&(I=e[5],e[5]=I?Cu(I,w,r[6]):w,e[6]=I?oi(e[5],P):r[6]),w=r[7],w&&(e[7]=w),u&z&&(e[8]=e[8]==null?r[8]:Kt(e[8],r[8])),e[9]==null&&(e[9]=r[9]),e[0]=r[0],e[1]=l,e}function Md(e){var r=[];if(e!=null)for(var s in Ge(e))r.push(s);return r}function zd(e){return xs.call(e)}function Bu(e,r,s){return r=qt(r===t?e.length-1:r,0),function(){for(var u=arguments,l=-1,d=qt(u.length-r,0),_=O(d);++l<d;)_[l]=u[r+l];l=-1;for(var w=O(r+1);++l<r;)w[l]=u[l];return w[r]=s(_),Lt(e,this,w)}}function Gu(e,r){return r.length<2?e:Ti(e,br(r,0,-1))}function Ud(e,r){for(var s=e.length,u=Kt(r.length,s),l=ir(e);u--;){var d=r[u];e[u]=Qr(d,s)?l[d]:t}return e}function Po(e,r){if(!(r==="constructor"&&typeof e[r]=="function")&&r!="__proto__")return e[r]}var Wu=Qu(vu),Tn=rp||function(e,r){return Pe.setTimeout(e,r)},Oo=Qu(hd);function Ju(e,r,s){var u=r+"";return Oo(e,Nd(u,kd(Ad(u),s)))}function Qu(e){var r=0,s=0;return function(){var u=ap(),l=et-(u-s);if(s=u,l>0){if(++r>=Ae)return arguments[0]}else r=0;return e.apply(t,arguments)}}function Gs(e,r){var s=-1,u=e.length,l=u-1;for(r=r===t?u:r;++s<r;){var d=co(s,l),_=e[d];e[d]=e[s],e[s]=_}return e.length=r,e}var Yu=jd(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(Ot,function(s,u,l,d){r.push(l?d.replace(ma,"$1"):u||s)}),r});function Lr(e){if(typeof e=="string"||fr(e))return e;var r=e+"";return r=="0"&&1/e==-Te?"-0":r}function Ni(e){if(e!=null){try{return Es.call(e)}catch{}try{return e+""}catch{}}return""}function kd(e,r){return vr(Nr,function(s){var u="_."+s[0];r&s[1]&&!vs(e,u)&&e.push(u)}),e.sort()}function Xu(e){if(e instanceof Se)return e.clone();var r=new mr(e.__wrapped__,e.__chain__);return r.__actions__=ir(e.__actions__),r.__index__=e.__index__,r.__values__=e.__values__,r}function Hd(e,r,s){(s?Yt(e,r,s):r===t)?r=1:r=qt(ye(r),0);var u=e==null?0:e.length;if(!u||r<1)return[];for(var l=0,d=0,_=O(As(u/r));l<u;)_[d++]=br(e,l,l+=r);return _}function Kd(e){for(var r=-1,s=e==null?0:e.length,u=0,l=[];++r<s;){var d=e[r];d&&(l[u++]=d)}return l}function Vd(){var e=arguments.length;if(!e)return[];for(var r=O(e-1),s=arguments[0],u=e;u--;)r[u-1]=arguments[u];return ai(fe(s)?ir(s):[s],kt(r,1))}var Bd=we(function(e,r){return wt(e)?In(e,kt(r,1,wt,!0)):[]}),Gd=we(function(e,r){var s=Er(r);return wt(s)&&(s=t),wt(e)?In(e,kt(r,1,wt,!0),ie(s,2)):[]}),Wd=we(function(e,r){var s=Er(r);return wt(s)&&(s=t),wt(e)?In(e,kt(r,1,wt,!0),t,s):[]});function Jd(e,r,s){var u=e==null?0:e.length;return u?(r=s||r===t?1:ye(r),br(e,r<0?0:r,u)):[]}function Qd(e,r,s){var u=e==null?0:e.length;return u?(r=s||r===t?1:ye(r),r=u-r,br(e,0,r<0?0:r)):[]}function Yd(e,r){return e&&e.length?Ms(e,ie(r,3),!0,!0):[]}function Xd(e,r){return e&&e.length?Ms(e,ie(r,3),!0):[]}function Zd(e,r,s,u){var l=e==null?0:e.length;return l?(s&&typeof s!="number"&&Yt(e,r,s)&&(s=0,u=l),Vp(e,r,s,u)):[]}function Zu(e,r,s){var u=e==null?0:e.length;if(!u)return-1;var l=s==null?0:ye(s);return l<0&&(l=qt(u+l,0)),_s(e,ie(r,3),l)}function eh(e,r,s){var u=e==null?0:e.length;if(!u)return-1;var l=u-1;return s!==t&&(l=ye(s),l=s<0?qt(u+l,0):Kt(l,u-1)),_s(e,ie(r,3),l,!0)}function th(e){var r=e==null?0:e.length;return r?kt(e,1):[]}function eg(e){var r=e==null?0:e.length;return r?kt(e,Te):[]}function tg(e,r){var s=e==null?0:e.length;return s?(r=r===t?1:ye(r),kt(e,r)):[]}function rg(e){for(var r=-1,s=e==null?0:e.length,u={};++r<s;){var l=e[r];u[l[0]]=l[1]}return u}function rh(e){return e&&e.length?e[0]:t}function ig(e,r,s){var u=e==null?0:e.length;if(!u)return-1;var l=s==null?0:ye(s);return l<0&&(l=qt(u+l,0)),Bi(e,r,l)}function ng(e){var r=e==null?0:e.length;return r?br(e,0,-1):[]}var sg=we(function(e){var r=it(e,po);return r.length&&r[0]===e[0]?io(r):[]}),ag=we(function(e){var r=Er(e),s=it(e,po);return r===Er(s)?r=t:s.pop(),s.length&&s[0]===e[0]?io(s,ie(r,2)):[]}),og=we(function(e){var r=Er(e),s=it(e,po);return r=typeof r=="function"?r:t,r&&s.pop(),s.length&&s[0]===e[0]?io(s,t,r):[]});function cg(e,r){return e==null?"":np.call(e,r)}function Er(e){var r=e==null?0:e.length;return r?e[r-1]:t}function ug(e,r,s){var u=e==null?0:e.length;if(!u)return-1;var l=u;return s!==t&&(l=ye(s),l=l<0?qt(u+l,0):Kt(l,u-1)),r===r?kf(e,r,l):_s(e,qc,l,!0)}function hg(e,r){return e&&e.length?pu(e,ye(r)):t}var lg=we(ih);function ih(e,r){return e&&e.length&&r&&r.length?oo(e,r):e}function fg(e,r,s){return e&&e.length&&r&&r.length?oo(e,r,ie(s,2)):e}function pg(e,r,s){return e&&e.length&&r&&r.length?oo(e,r,t,s):e}var dg=Jr(function(e,r){var s=e==null?0:e.length,u=Za(e,r);return yu(e,it(r,function(l){return Qr(l,s)?+l:l}).sort(Pu)),u});function gg(e,r){var s=[];if(!(e&&e.length))return s;var u=-1,l=[],d=e.length;for(r=ie(r,3);++u<d;){var _=e[u];r(_,u,e)&&(s.push(_),l.push(u))}return yu(e,l),s}function Co(e){return e==null?e:cp.call(e)}function yg(e,r,s){var u=e==null?0:e.length;return u?(s&&typeof s!="number"&&Yt(e,r,s)?(r=0,s=u):(r=r==null?0:ye(r),s=s===t?u:ye(s)),br(e,r,s)):[]}function vg(e,r){return Ls(e,r)}function _g(e,r,s){return ho(e,r,ie(s,2))}function mg(e,r){var s=e==null?0:e.length;if(s){var u=Ls(e,r);if(u<s&&Ar(e[u],r))return u}return-1}function wg(e,r){return Ls(e,r,!0)}function bg(e,r,s){return ho(e,r,ie(s,2),!0)}function Eg(e,r){var s=e==null?0:e.length;if(s){var u=Ls(e,r,!0)-1;if(Ar(e[u],r))return u}return-1}function xg(e){return e&&e.length?_u(e):[]}function Ig(e,r){return e&&e.length?_u(e,ie(r,2)):[]}function Sg(e){var r=e==null?0:e.length;return r?br(e,1,r):[]}function Pg(e,r,s){return e&&e.length?(r=s||r===t?1:ye(r),br(e,0,r<0?0:r)):[]}function Og(e,r,s){var u=e==null?0:e.length;return u?(r=s||r===t?1:ye(r),r=u-r,br(e,r<0?0:r,u)):[]}function Cg(e,r){return e&&e.length?Ms(e,ie(r,3),!1,!0):[]}function Ag(e,r){return e&&e.length?Ms(e,ie(r,3)):[]}var Tg=we(function(e){return hi(kt(e,1,wt,!0))}),Rg=we(function(e){var r=Er(e);return wt(r)&&(r=t),hi(kt(e,1,wt,!0),ie(r,2))}),Ng=we(function(e){var r=Er(e);return r=typeof r=="function"?r:t,hi(kt(e,1,wt,!0),t,r)});function $g(e){return e&&e.length?hi(e):[]}function Fg(e,r){return e&&e.length?hi(e,ie(r,2)):[]}function Dg(e,r){return r=typeof r=="function"?r:t,e&&e.length?hi(e,t,r):[]}function Ao(e){if(!(e&&e.length))return[];var r=0;return e=si(e,function(s){if(wt(s))return r=qt(s.length,r),!0}),Va(r,function(s){return it(e,ka(s))})}function nh(e,r){if(!(e&&e.length))return[];var s=Ao(e);return r==null?s:it(s,function(u){return Lt(r,t,u)})}var qg=we(function(e,r){return wt(e)?In(e,r):[]}),jg=we(function(e){return fo(si(e,wt))}),Lg=we(function(e){var r=Er(e);return wt(r)&&(r=t),fo(si(e,wt),ie(r,2))}),Mg=we(function(e){var r=Er(e);return r=typeof r=="function"?r:t,fo(si(e,wt),t,r)}),zg=we(Ao);function Ug(e,r){return Eu(e||[],r||[],xn)}function kg(e,r){return Eu(e||[],r||[],On)}var Hg=we(function(e){var r=e.length,s=r>1?e[r-1]:t;return s=typeof s=="function"?(e.pop(),s):t,nh(e,s)});function sh(e){var r=p(e);return r.__chain__=!0,r}function Kg(e,r){return r(e),e}function Ws(e,r){return r(e)}var Vg=Jr(function(e){var r=e.length,s=r?e[0]:0,u=this.__wrapped__,l=function(d){return Za(d,e)};return r>1||this.__actions__.length||!(u instanceof Se)||!Qr(s)?this.thru(l):(u=u.slice(s,+s+(r?1:0)),u.__actions__.push({func:Ws,args:[l],thisArg:t}),new mr(u,this.__chain__).thru(function(d){return r&&!d.length&&d.push(t),d}))});function Bg(){return sh(this)}function Gg(){return new mr(this.value(),this.__chain__)}function Wg(){this.__values__===t&&(this.__values__=mh(this.value()));var e=this.__index__>=this.__values__.length,r=e?t:this.__values__[this.__index__++];return{done:e,value:r}}function Jg(){return this}function Qg(e){for(var r,s=this;s instanceof $s;){var u=Xu(s);u.__index__=0,u.__values__=t,r?l.__wrapped__=u:r=u;var l=u;s=s.__wrapped__}return l.__wrapped__=e,r}function Yg(){var e=this.__wrapped__;if(e instanceof Se){var r=e;return this.__actions__.length&&(r=new Se(this)),r=r.reverse(),r.__actions__.push({func:Ws,args:[Co],thisArg:t}),new mr(r,this.__chain__)}return this.thru(Co)}function Xg(){return bu(this.__wrapped__,this.__actions__)}var Zg=zs(function(e,r,s){Le.call(e,s)?++e[s]:Gr(e,s,1)});function ey(e,r,s){var u=fe(e)?Fc:Kp;return s&&Yt(e,r,s)&&(r=t),u(e,ie(r,3))}function ty(e,r){var s=fe(e)?si:nu;return s(e,ie(r,3))}var ry=Nu(Zu),iy=Nu(eh);function ny(e,r){return kt(Js(e,r),1)}function sy(e,r){return kt(Js(e,r),Te)}function ay(e,r,s){return s=s===t?1:ye(s),kt(Js(e,r),s)}function ah(e,r){var s=fe(e)?vr:ui;return s(e,ie(r,3))}function oh(e,r){var s=fe(e)?Sf:iu;return s(e,ie(r,3))}var oy=zs(function(e,r,s){Le.call(e,s)?e[s].push(r):Gr(e,s,[r])});function cy(e,r,s,u){e=nr(e)?e:sn(e),s=s&&!u?ye(s):0;var l=e.length;return s<0&&(s=qt(l+s,0)),ea(e)?s<=l&&e.indexOf(r,s)>-1:!!l&&Bi(e,r,s)>-1}var uy=we(function(e,r,s){var u=-1,l=typeof r=="function",d=nr(e)?O(e.length):[];return ui(e,function(_){d[++u]=l?Lt(r,_,s):Sn(_,r,s)}),d}),hy=zs(function(e,r,s){Gr(e,s,r)});function Js(e,r){var s=fe(e)?it:hu;return s(e,ie(r,3))}function ly(e,r,s,u){return e==null?[]:(fe(r)||(r=r==null?[]:[r]),s=u?t:s,fe(s)||(s=s==null?[]:[s]),du(e,r,s))}var fy=zs(function(e,r,s){e[s?0:1].push(r)},function(){return[[],[]]});function py(e,r,s){var u=fe(e)?za:Lc,l=arguments.length<3;return u(e,ie(r,4),s,l,ui)}function dy(e,r,s){var u=fe(e)?Pf:Lc,l=arguments.length<3;return u(e,ie(r,4),s,l,iu)}function gy(e,r){var s=fe(e)?si:nu;return s(e,Xs(ie(r,3)))}function yy(e){var r=fe(e)?Zc:cd;return r(e)}function vy(e,r,s){(s?Yt(e,r,s):r===t)?r=1:r=ye(r);var u=fe(e)?Mp:ud;return u(e,r)}function _y(e){var r=fe(e)?zp:ld;return r(e)}function my(e){if(e==null)return 0;if(nr(e))return ea(e)?Wi(e):e.length;var r=Vt(e);return r==ve||r==De?e.size:so(e).length}function wy(e,r,s){var u=fe(e)?Ua:fd;return s&&Yt(e,r,s)&&(r=t),u(e,ie(r,3))}var by=we(function(e,r){if(e==null)return[];var s=r.length;return s>1&&Yt(e,r[0],r[1])?r=[]:s>2&&Yt(r[0],r[1],r[2])&&(r=[r[0]]),du(e,kt(r,1),[])}),Qs=tp||function(){return Pe.Date.now()};function Ey(e,r){if(typeof r!="function")throw new _r(f);return e=ye(e),function(){if(--e<1)return r.apply(this,arguments)}}function ch(e,r,s){return r=s?t:r,r=e&&r==null?e.length:r,Wr(e,z,t,t,t,t,r)}function uh(e,r){var s;if(typeof r!="function")throw new _r(f);return e=ye(e),function(){return--e>0&&(s=r.apply(this,arguments)),e<=1&&(r=t),s}}var To=we(function(e,r,s){var u=ae;if(s.length){var l=oi(s,rn(To));u|=he}return Wr(e,u,r,s,l)}),hh=we(function(e,r,s){var u=ae|be;if(s.length){var l=oi(s,rn(hh));u|=he}return Wr(r,u,e,s,l)});function lh(e,r,s){r=s?t:r;var u=Wr(e,pe,t,t,t,t,t,r);return u.placeholder=lh.placeholder,u}function fh(e,r,s){r=s?t:r;var u=Wr(e,ue,t,t,t,t,t,r);return u.placeholder=fh.placeholder,u}function ph(e,r,s){var u,l,d,_,w,I,F=0,D=!1,M=!1,G=!0;if(typeof e!="function")throw new _r(f);r=xr(r)||0,ot(s)&&(D=!!s.leading,M="maxWait"in s,d=M?qt(xr(s.maxWait)||0,r):d,G="trailing"in s?!!s.trailing:G);function ee(bt){var Tr=u,Zr=l;return u=l=t,F=bt,_=e.apply(Zr,Tr),_}function ne(bt){return F=bt,w=Tn(xe,r),D?ee(bt):_}function _e(bt){var Tr=bt-I,Zr=bt-F,Nh=r-Tr;return M?Kt(Nh,d-Zr):Nh}function se(bt){var Tr=bt-I,Zr=bt-F;return I===t||Tr>=r||Tr<0||M&&Zr>=d}function xe(){var bt=Qs();if(se(bt))return Oe(bt);w=Tn(xe,_e(bt))}function Oe(bt){return w=t,G&&u?ee(bt):(u=l=t,_)}function pr(){w!==t&&xu(w),F=0,u=I=l=w=t}function Xt(){return w===t?_:Oe(Qs())}function dr(){var bt=Qs(),Tr=se(bt);if(u=arguments,l=this,I=bt,Tr){if(w===t)return ne(I);if(M)return xu(w),w=Tn(xe,r),ee(I)}return w===t&&(w=Tn(xe,r)),_}return dr.cancel=pr,dr.flush=Xt,dr}var xy=we(function(e,r){return ru(e,1,r)}),Iy=we(function(e,r,s){return ru(e,xr(r)||0,s)});function Sy(e){return Wr(e,ge)}function Ys(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new _r(f);var s=function(){var u=arguments,l=r?r.apply(this,u):u[0],d=s.cache;if(d.has(l))return d.get(l);var _=e.apply(this,u);return s.cache=d.set(l,_)||d,_};return s.cache=new(Ys.Cache||Br),s}Ys.Cache=Br;function Xs(e){if(typeof e!="function")throw new _r(f);return function(){var r=arguments;switch(r.length){case 0:return!e.call(this);case 1:return!e.call(this,r[0]);case 2:return!e.call(this,r[0],r[1]);case 3:return!e.call(this,r[0],r[1],r[2])}return!e.apply(this,r)}}function Py(e){return uh(2,e)}var Oy=pd(function(e,r){r=r.length==1&&fe(r[0])?it(r[0],hr(ie())):it(kt(r,1),hr(ie()));var s=r.length;return we(function(u){for(var l=-1,d=Kt(u.length,s);++l<d;)u[l]=r[l].call(this,u[l]);return Lt(e,this,u)})}),Ro=we(function(e,r){var s=oi(r,rn(Ro));return Wr(e,he,t,r,s)}),dh=we(function(e,r){var s=oi(r,rn(dh));return Wr(e,N,t,r,s)}),Cy=Jr(function(e,r){return Wr(e,W,t,t,t,r)});function Ay(e,r){if(typeof e!="function")throw new _r(f);return r=r===t?r:ye(r),we(e,r)}function Ty(e,r){if(typeof e!="function")throw new _r(f);return r=r==null?0:qt(ye(r),0),we(function(s){var u=s[r],l=fi(s,0,r);return u&&ai(l,u),Lt(e,this,l)})}function Ry(e,r,s){var u=!0,l=!0;if(typeof e!="function")throw new _r(f);return ot(s)&&(u="leading"in s?!!s.leading:u,l="trailing"in s?!!s.trailing:l),ph(e,r,{leading:u,maxWait:r,trailing:l})}function Ny(e){return ch(e,1)}function $y(e,r){return Ro(go(r),e)}function Fy(){if(!arguments.length)return[];var e=arguments[0];return fe(e)?e:[e]}function Dy(e){return wr(e,U)}function qy(e,r){return r=typeof r=="function"?r:t,wr(e,U,r)}function jy(e){return wr(e,L|U)}function Ly(e,r){return r=typeof r=="function"?r:t,wr(e,L|U,r)}function My(e,r){return r==null||tu(e,r,Mt(r))}function Ar(e,r){return e===r||e!==e&&r!==r}var zy=Ks(ro),Uy=Ks(function(e,r){return e>=r}),$i=ou(function(){return arguments}())?ou:function(e){return yt(e)&&Le.call(e,"callee")&&!Gc.call(e,"callee")},fe=O.isArray,ky=Jt?hr(Jt):Qp;function nr(e){return e!=null&&Zs(e.length)&&!Yr(e)}function wt(e){return yt(e)&&nr(e)}function Hy(e){return e===!0||e===!1||yt(e)&&Qt(e)==A}var pi=ip||ko,Ky=Pr?hr(Pr):Yp;function Vy(e){return yt(e)&&e.nodeType===1&&!Rn(e)}function By(e){if(e==null)return!0;if(nr(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||pi(e)||nn(e)||$i(e)))return!e.length;var r=Vt(e);if(r==ve||r==De)return!e.size;if(An(e))return!so(e).length;for(var s in e)if(Le.call(e,s))return!1;return!0}function Gy(e,r){return Pn(e,r)}function Wy(e,r,s){s=typeof s=="function"?s:t;var u=s?s(e,r):t;return u===t?Pn(e,r,t,s):!!u}function No(e){if(!yt(e))return!1;var r=Qt(e);return r==b||r==h||typeof e.message=="string"&&typeof e.name=="string"&&!Rn(e)}function Jy(e){return typeof e=="number"&&Jc(e)}function Yr(e){if(!ot(e))return!1;var r=Qt(e);return r==Z||r==oe||r==R||r==vt}function gh(e){return typeof e=="number"&&e==ye(e)}function Zs(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ot(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}function yt(e){return e!=null&&typeof e=="object"}var yh=yr?hr(yr):Zp;function Qy(e,r){return e===r||no(e,r,Eo(r))}function Yy(e,r,s){return s=typeof s=="function"?s:t,no(e,r,Eo(r),s)}function Xy(e){return vh(e)&&e!=+e}function Zy(e){if(qd(e))throw new ce(c);return cu(e)}function e0(e){return e===null}function t0(e){return e==null}function vh(e){return typeof e=="number"||yt(e)&&Qt(e)==Re}function Rn(e){if(!yt(e)||Qt(e)!=Ie)return!1;var r=Ps(e);if(r===null)return!0;var s=Le.call(r,"constructor")&&r.constructor;return typeof s=="function"&&s instanceof s&&Es.call(s)==Yf}var $o=Dr?hr(Dr):ed;function r0(e){return gh(e)&&e>=-J&&e<=J}var _h=yn?hr(yn):td;function ea(e){return typeof e=="string"||!fe(e)&&yt(e)&&Qt(e)==Je}function fr(e){return typeof e=="symbol"||yt(e)&&Qt(e)==Qe}var nn=Si?hr(Si):rd;function i0(e){return e===t}function n0(e){return yt(e)&&Vt(e)==ze}function s0(e){return yt(e)&&Qt(e)==Ye}var a0=Ks(ao),o0=Ks(function(e,r){return e<=r});function mh(e){if(!e)return[];if(nr(e))return ea(e)?Or(e):ir(e);if(_n&&e[_n])return Mf(e[_n]());var r=Vt(e),s=r==ve?Ga:r==De?ms:sn;return s(e)}function Xr(e){if(!e)return e===0?e:0;if(e=xr(e),e===Te||e===-Te){var r=e<0?-1:1;return r*V}return e===e?e:0}function ye(e){var r=Xr(e),s=r%1;return r===r?s?r-s:r:0}function wh(e){return e?Ai(ye(e),0,B):0}function xr(e){if(typeof e=="number")return e;if(fr(e))return H;if(ot(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=ot(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=Mc(e);var s=Ea.test(e);return s||Ia.test(e)?le(e.slice(2),s?2:8):ba.test(e)?H:+e}function bh(e){return jr(e,sr(e))}function c0(e){return e?Ai(ye(e),-J,J):e===0?e:0}function qe(e){return e==null?"":lr(e)}var u0=en(function(e,r){if(An(r)||nr(r)){jr(r,Mt(r),e);return}for(var s in r)Le.call(r,s)&&xn(e,s,r[s])}),Eh=en(function(e,r){jr(r,sr(r),e)}),ta=en(function(e,r,s,u){jr(r,sr(r),e,u)}),h0=en(function(e,r,s,u){jr(r,Mt(r),e,u)}),l0=Jr(Za);function f0(e,r){var s=Zi(e);return r==null?s:eu(s,r)}var p0=we(function(e,r){e=Ge(e);var s=-1,u=r.length,l=u>2?r[2]:t;for(l&&Yt(r[0],r[1],l)&&(u=1);++s<u;)for(var d=r[s],_=sr(d),w=-1,I=_.length;++w<I;){var F=_[w],D=e[F];(D===t||Ar(D,Qi[F])&&!Le.call(e,F))&&(e[F]=d[F])}return e}),d0=we(function(e){return e.push(t,Mu),Lt(xh,t,e)});function g0(e,r){return Dc(e,ie(r,3),qr)}function y0(e,r){return Dc(e,ie(r,3),to)}function v0(e,r){return e==null?e:eo(e,ie(r,3),sr)}function _0(e,r){return e==null?e:su(e,ie(r,3),sr)}function m0(e,r){return e&&qr(e,ie(r,3))}function w0(e,r){return e&&to(e,ie(r,3))}function b0(e){return e==null?[]:qs(e,Mt(e))}function E0(e){return e==null?[]:qs(e,sr(e))}function Fo(e,r,s){var u=e==null?t:Ti(e,r);return u===t?s:u}function x0(e,r){return e!=null&&ku(e,r,Bp)}function Do(e,r){return e!=null&&ku(e,r,Gp)}var I0=Fu(function(e,r,s){r!=null&&typeof r.toString!="function"&&(r=xs.call(r)),e[r]=s},jo(ar)),S0=Fu(function(e,r,s){r!=null&&typeof r.toString!="function"&&(r=xs.call(r)),Le.call(e,r)?e[r].push(s):e[r]=[s]},ie),P0=we(Sn);function Mt(e){return nr(e)?Xc(e):so(e)}function sr(e){return nr(e)?Xc(e,!0):id(e)}function O0(e,r){var s={};return r=ie(r,3),qr(e,function(u,l,d){Gr(s,r(u,l,d),u)}),s}function C0(e,r){var s={};return r=ie(r,3),qr(e,function(u,l,d){Gr(s,l,r(u,l,d))}),s}var A0=en(function(e,r,s){js(e,r,s)}),xh=en(function(e,r,s,u){js(e,r,s,u)}),T0=Jr(function(e,r){var s={};if(e==null)return s;var u=!1;r=it(r,function(d){return d=li(d,e),u||(u=d.length>1),d}),jr(e,wo(e),s),u&&(s=wr(s,L|T|U,Id));for(var l=r.length;l--;)lo(s,r[l]);return s});function R0(e,r){return Ih(e,Xs(ie(r)))}var N0=Jr(function(e,r){return e==null?{}:sd(e,r)});function Ih(e,r){if(e==null)return{};var s=it(wo(e),function(u){return[u]});return r=ie(r),gu(e,s,function(u,l){return r(u,l[0])})}function $0(e,r,s){r=li(r,e);var u=-1,l=r.length;for(l||(l=1,e=t);++u<l;){var d=e==null?t:e[Lr(r[u])];d===t&&(u=l,d=s),e=Yr(d)?d.call(e):d}return e}function F0(e,r,s){return e==null?e:On(e,r,s)}function D0(e,r,s,u){return u=typeof u=="function"?u:t,e==null?e:On(e,r,s,u)}var Sh=ju(Mt),Ph=ju(sr);function q0(e,r,s){var u=fe(e),l=u||pi(e)||nn(e);if(r=ie(r,4),s==null){var d=e&&e.constructor;l?s=u?new d:[]:ot(e)?s=Yr(d)?Zi(Ps(e)):{}:s={}}return(l?vr:qr)(e,function(_,w,I){return r(s,_,w,I)}),s}function j0(e,r){return e==null?!0:lo(e,r)}function L0(e,r,s){return e==null?e:wu(e,r,go(s))}function M0(e,r,s,u){return u=typeof u=="function"?u:t,e==null?e:wu(e,r,go(s),u)}function sn(e){return e==null?[]:Ba(e,Mt(e))}function z0(e){return e==null?[]:Ba(e,sr(e))}function U0(e,r,s){return s===t&&(s=r,r=t),s!==t&&(s=xr(s),s=s===s?s:0),r!==t&&(r=xr(r),r=r===r?r:0),Ai(xr(e),r,s)}function k0(e,r,s){return r=Xr(r),s===t?(s=r,r=0):s=Xr(s),e=xr(e),Wp(e,r,s)}function H0(e,r,s){if(s&&typeof s!="boolean"&&Yt(e,r,s)&&(r=s=t),s===t&&(typeof r=="boolean"?(s=r,r=t):typeof e=="boolean"&&(s=e,e=t)),e===t&&r===t?(e=0,r=1):(e=Xr(e),r===t?(r=e,e=0):r=Xr(r)),e>r){var u=e;e=r,r=u}if(s||e%1||r%1){var l=Qc();return Kt(e+l*(r-e+Ve("1e-"+((l+"").length-1))),r)}return co(e,r)}var K0=tn(function(e,r,s){return r=r.toLowerCase(),e+(s?Oh(r):r)});function Oh(e){return qo(qe(e).toLowerCase())}function Ch(e){return e=qe(e),e&&e.replace(Hr,Ff).replace(ja,"")}function V0(e,r,s){e=qe(e),r=lr(r);var u=e.length;s=s===t?u:Ai(ye(s),0,u);var l=s;return s-=r.length,s>=0&&e.slice(s,l)==r}function B0(e){return e=qe(e),e&&tt.test(e)?e.replace(wi,Df):e}function G0(e){return e=qe(e),e&&Ct.test(e)?e.replace(pt,"\\$&"):e}var W0=tn(function(e,r,s){return e+(s?"-":"")+r.toLowerCase()}),J0=tn(function(e,r,s){return e+(s?" ":"")+r.toLowerCase()}),Q0=Ru("toLowerCase");function Y0(e,r,s){e=qe(e),r=ye(r);var u=r?Wi(e):0;if(!r||u>=r)return e;var l=(r-u)/2;return Hs(Ts(l),s)+e+Hs(As(l),s)}function X0(e,r,s){e=qe(e),r=ye(r);var u=r?Wi(e):0;return r&&u<r?e+Hs(r-u,s):e}function Z0(e,r,s){e=qe(e),r=ye(r);var u=r?Wi(e):0;return r&&u<r?Hs(r-u,s)+e:e}function ev(e,r,s){return s||r==null?r=0:r&&(r=+r),op(qe(e).replace(dt,""),r||0)}function tv(e,r,s){return(s?Yt(e,r,s):r===t)?r=1:r=ye(r),uo(qe(e),r)}function rv(){var e=arguments,r=qe(e[0]);return e.length<3?r:r.replace(e[1],e[2])}var iv=tn(function(e,r,s){return e+(s?"_":"")+r.toLowerCase()});function nv(e,r,s){return s&&typeof s!="number"&&Yt(e,r,s)&&(r=s=t),s=s===t?B:s>>>0,s?(e=qe(e),e&&(typeof r=="string"||r!=null&&!$o(r))&&(r=lr(r),!r&&Gi(e))?fi(Or(e),0,s):e.split(r,s)):[]}var sv=tn(function(e,r,s){return e+(s?" ":"")+qo(r)});function av(e,r,s){return e=qe(e),s=s==null?0:Ai(ye(s),0,e.length),r=lr(r),e.slice(s,s+r.length)==r}function ov(e,r,s){var u=p.templateSettings;s&&Yt(e,r,s)&&(r=t),e=qe(e),r=ta({},r,u,Lu);var l=ta({},r.imports,u.imports,Lu),d=Mt(l),_=Ba(l,d),w,I,F=0,D=r.interpolate||Mi,M="__p += '",G=Wa((r.escape||Mi).source+"|"+D.source+"|"+(D===at?wa:Mi).source+"|"+(r.evaluate||Mi).source+"|$","g"),ee="//# sourceURL="+(Le.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++La+"]")+`
`;e.replace(G,function(se,xe,Oe,pr,Xt,dr){return Oe||(Oe=pr),M+=e.slice(F,dr).replace(Pa,qf),xe&&(w=!0,M+=`' +
__e(`+xe+`) +
'`),Xt&&(I=!0,M+=`';
`+Xt+`;
__p += '`),Oe&&(M+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),F=dr+se.length,se}),M+=`';
`;var ne=Le.call(r,"variable")&&r.variable;if(!ne)M=`with (obj) {
`+M+`
}
`;else if(_a.test(ne))throw new ce(g);M=(I?M.replace($r,""):M).replace(Wt,"$1").replace(kr,"$1;"),M="function("+(ne||"obj")+`) {
`+(ne?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(I?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+M+`return __p
}`;var _e=Th(function(){return Fe(d,ee+"return "+M).apply(t,_)});if(_e.source=M,No(_e))throw _e;return _e}function cv(e){return qe(e).toLowerCase()}function uv(e){return qe(e).toUpperCase()}function hv(e,r,s){if(e=qe(e),e&&(s||r===t))return Mc(e);if(!e||!(r=lr(r)))return e;var u=Or(e),l=Or(r),d=zc(u,l),_=Uc(u,l)+1;return fi(u,d,_).join("")}function lv(e,r,s){if(e=qe(e),e&&(s||r===t))return e.slice(0,Hc(e)+1);if(!e||!(r=lr(r)))return e;var u=Or(e),l=Uc(u,Or(r))+1;return fi(u,0,l).join("")}function fv(e,r,s){if(e=qe(e),e&&(s||r===t))return e.replace(dt,"");if(!e||!(r=lr(r)))return e;var u=Or(e),l=zc(u,Or(r));return fi(u,l).join("")}function pv(e,r){var s=te,u=Ee;if(ot(r)){var l="separator"in r?r.separator:l;s="length"in r?ye(r.length):s,u="omission"in r?lr(r.omission):u}e=qe(e);var d=e.length;if(Gi(e)){var _=Or(e);d=_.length}if(s>=d)return e;var w=s-Wi(u);if(w<1)return u;var I=_?fi(_,0,w).join(""):e.slice(0,w);if(l===t)return I+u;if(_&&(w+=I.length-w),$o(l)){if(e.slice(w).search(l)){var F,D=I;for(l.global||(l=Wa(l.source,qe(gr.exec(l))+"g")),l.lastIndex=0;F=l.exec(D);)var M=F.index;I=I.slice(0,M===t?w:M)}}else if(e.indexOf(lr(l),w)!=w){var G=I.lastIndexOf(l);G>-1&&(I=I.slice(0,G))}return I+u}function dv(e){return e=qe(e),e&&ht.test(e)?e.replace(ii,Hf):e}var gv=tn(function(e,r,s){return e+(s?" ":"")+r.toUpperCase()}),qo=Ru("toUpperCase");function Ah(e,r,s){return e=qe(e),r=s?t:r,r===t?Lf(e)?Bf(e):Af(e):e.match(r)||[]}var Th=we(function(e,r){try{return Lt(e,t,r)}catch(s){return No(s)?s:new ce(s)}}),yv=Jr(function(e,r){return vr(r,function(s){s=Lr(s),Gr(e,s,To(e[s],e))}),e});function vv(e){var r=e==null?0:e.length,s=ie();return e=r?it(e,function(u){if(typeof u[1]!="function")throw new _r(f);return[s(u[0]),u[1]]}):[],we(function(u){for(var l=-1;++l<r;){var d=e[l];if(Lt(d[0],this,u))return Lt(d[1],this,u)}})}function _v(e){return Hp(wr(e,L))}function jo(e){return function(){return e}}function mv(e,r){return e==null||e!==e?r:e}var wv=$u(),bv=$u(!0);function ar(e){return e}function Lo(e){return uu(typeof e=="function"?e:wr(e,L))}function Ev(e){return lu(wr(e,L))}function xv(e,r){return fu(e,wr(r,L))}var Iv=we(function(e,r){return function(s){return Sn(s,e,r)}}),Sv=we(function(e,r){return function(s){return Sn(e,s,r)}});function Mo(e,r,s){var u=Mt(r),l=qs(r,u);s==null&&!(ot(r)&&(l.length||!u.length))&&(s=r,r=e,e=this,l=qs(r,Mt(r)));var d=!(ot(s)&&"chain"in s)||!!s.chain,_=Yr(e);return vr(l,function(w){var I=r[w];e[w]=I,_&&(e.prototype[w]=function(){var F=this.__chain__;if(d||F){var D=e(this.__wrapped__),M=D.__actions__=ir(this.__actions__);return M.push({func:I,args:arguments,thisArg:e}),D.__chain__=F,D}return I.apply(e,ai([this.value()],arguments))})}),e}function Pv(){return Pe._===this&&(Pe._=Xf),this}function zo(){}function Ov(e){return e=ye(e),we(function(r){return pu(r,e)})}var Cv=vo(it),Av=vo(Fc),Tv=vo(Ua);function Rh(e){return Io(e)?ka(Lr(e)):ad(e)}function Rv(e){return function(r){return e==null?t:Ti(e,r)}}var Nv=Du(),$v=Du(!0);function Uo(){return[]}function ko(){return!1}function Fv(){return{}}function Dv(){return""}function qv(){return!0}function jv(e,r){if(e=ye(e),e<1||e>J)return[];var s=B,u=Kt(e,B);r=ie(r),e-=B;for(var l=Va(u,r);++s<e;)r(s);return l}function Lv(e){return fe(e)?it(e,Lr):fr(e)?[e]:ir(Yu(qe(e)))}function Mv(e){var r=++Qf;return qe(e)+r}var zv=ks(function(e,r){return e+r},0),Uv=_o("ceil"),kv=ks(function(e,r){return e/r},1),Hv=_o("floor");function Kv(e){return e&&e.length?Ds(e,ar,ro):t}function Vv(e,r){return e&&e.length?Ds(e,ie(r,2),ro):t}function Bv(e){return jc(e,ar)}function Gv(e,r){return jc(e,ie(r,2))}function Wv(e){return e&&e.length?Ds(e,ar,ao):t}function Jv(e,r){return e&&e.length?Ds(e,ie(r,2),ao):t}var Qv=ks(function(e,r){return e*r},1),Yv=_o("round"),Xv=ks(function(e,r){return e-r},0);function Zv(e){return e&&e.length?Ka(e,ar):0}function e1(e,r){return e&&e.length?Ka(e,ie(r,2)):0}return p.after=Ey,p.ary=ch,p.assign=u0,p.assignIn=Eh,p.assignInWith=ta,p.assignWith=h0,p.at=l0,p.before=uh,p.bind=To,p.bindAll=yv,p.bindKey=hh,p.castArray=Fy,p.chain=sh,p.chunk=Hd,p.compact=Kd,p.concat=Vd,p.cond=vv,p.conforms=_v,p.constant=jo,p.countBy=Zg,p.create=f0,p.curry=lh,p.curryRight=fh,p.debounce=ph,p.defaults=p0,p.defaultsDeep=d0,p.defer=xy,p.delay=Iy,p.difference=Bd,p.differenceBy=Gd,p.differenceWith=Wd,p.drop=Jd,p.dropRight=Qd,p.dropRightWhile=Yd,p.dropWhile=Xd,p.fill=Zd,p.filter=ty,p.flatMap=ny,p.flatMapDeep=sy,p.flatMapDepth=ay,p.flatten=th,p.flattenDeep=eg,p.flattenDepth=tg,p.flip=Sy,p.flow=wv,p.flowRight=bv,p.fromPairs=rg,p.functions=b0,p.functionsIn=E0,p.groupBy=oy,p.initial=ng,p.intersection=sg,p.intersectionBy=ag,p.intersectionWith=og,p.invert=I0,p.invertBy=S0,p.invokeMap=uy,p.iteratee=Lo,p.keyBy=hy,p.keys=Mt,p.keysIn=sr,p.map=Js,p.mapKeys=O0,p.mapValues=C0,p.matches=Ev,p.matchesProperty=xv,p.memoize=Ys,p.merge=A0,p.mergeWith=xh,p.method=Iv,p.methodOf=Sv,p.mixin=Mo,p.negate=Xs,p.nthArg=Ov,p.omit=T0,p.omitBy=R0,p.once=Py,p.orderBy=ly,p.over=Cv,p.overArgs=Oy,p.overEvery=Av,p.overSome=Tv,p.partial=Ro,p.partialRight=dh,p.partition=fy,p.pick=N0,p.pickBy=Ih,p.property=Rh,p.propertyOf=Rv,p.pull=lg,p.pullAll=ih,p.pullAllBy=fg,p.pullAllWith=pg,p.pullAt=dg,p.range=Nv,p.rangeRight=$v,p.rearg=Cy,p.reject=gy,p.remove=gg,p.rest=Ay,p.reverse=Co,p.sampleSize=vy,p.set=F0,p.setWith=D0,p.shuffle=_y,p.slice=yg,p.sortBy=by,p.sortedUniq=xg,p.sortedUniqBy=Ig,p.split=nv,p.spread=Ty,p.tail=Sg,p.take=Pg,p.takeRight=Og,p.takeRightWhile=Cg,p.takeWhile=Ag,p.tap=Kg,p.throttle=Ry,p.thru=Ws,p.toArray=mh,p.toPairs=Sh,p.toPairsIn=Ph,p.toPath=Lv,p.toPlainObject=bh,p.transform=q0,p.unary=Ny,p.union=Tg,p.unionBy=Rg,p.unionWith=Ng,p.uniq=$g,p.uniqBy=Fg,p.uniqWith=Dg,p.unset=j0,p.unzip=Ao,p.unzipWith=nh,p.update=L0,p.updateWith=M0,p.values=sn,p.valuesIn=z0,p.without=qg,p.words=Ah,p.wrap=$y,p.xor=jg,p.xorBy=Lg,p.xorWith=Mg,p.zip=zg,p.zipObject=Ug,p.zipObjectDeep=kg,p.zipWith=Hg,p.entries=Sh,p.entriesIn=Ph,p.extend=Eh,p.extendWith=ta,Mo(p,p),p.add=zv,p.attempt=Th,p.camelCase=K0,p.capitalize=Oh,p.ceil=Uv,p.clamp=U0,p.clone=Dy,p.cloneDeep=jy,p.cloneDeepWith=Ly,p.cloneWith=qy,p.conformsTo=My,p.deburr=Ch,p.defaultTo=mv,p.divide=kv,p.endsWith=V0,p.eq=Ar,p.escape=B0,p.escapeRegExp=G0,p.every=ey,p.find=ry,p.findIndex=Zu,p.findKey=g0,p.findLast=iy,p.findLastIndex=eh,p.findLastKey=y0,p.floor=Hv,p.forEach=ah,p.forEachRight=oh,p.forIn=v0,p.forInRight=_0,p.forOwn=m0,p.forOwnRight=w0,p.get=Fo,p.gt=zy,p.gte=Uy,p.has=x0,p.hasIn=Do,p.head=rh,p.identity=ar,p.includes=cy,p.indexOf=ig,p.inRange=k0,p.invoke=P0,p.isArguments=$i,p.isArray=fe,p.isArrayBuffer=ky,p.isArrayLike=nr,p.isArrayLikeObject=wt,p.isBoolean=Hy,p.isBuffer=pi,p.isDate=Ky,p.isElement=Vy,p.isEmpty=By,p.isEqual=Gy,p.isEqualWith=Wy,p.isError=No,p.isFinite=Jy,p.isFunction=Yr,p.isInteger=gh,p.isLength=Zs,p.isMap=yh,p.isMatch=Qy,p.isMatchWith=Yy,p.isNaN=Xy,p.isNative=Zy,p.isNil=t0,p.isNull=e0,p.isNumber=vh,p.isObject=ot,p.isObjectLike=yt,p.isPlainObject=Rn,p.isRegExp=$o,p.isSafeInteger=r0,p.isSet=_h,p.isString=ea,p.isSymbol=fr,p.isTypedArray=nn,p.isUndefined=i0,p.isWeakMap=n0,p.isWeakSet=s0,p.join=cg,p.kebabCase=W0,p.last=Er,p.lastIndexOf=ug,p.lowerCase=J0,p.lowerFirst=Q0,p.lt=a0,p.lte=o0,p.max=Kv,p.maxBy=Vv,p.mean=Bv,p.meanBy=Gv,p.min=Wv,p.minBy=Jv,p.stubArray=Uo,p.stubFalse=ko,p.stubObject=Fv,p.stubString=Dv,p.stubTrue=qv,p.multiply=Qv,p.nth=hg,p.noConflict=Pv,p.noop=zo,p.now=Qs,p.pad=Y0,p.padEnd=X0,p.padStart=Z0,p.parseInt=ev,p.random=H0,p.reduce=py,p.reduceRight=dy,p.repeat=tv,p.replace=rv,p.result=$0,p.round=Yv,p.runInContext=x,p.sample=yy,p.size=my,p.snakeCase=iv,p.some=wy,p.sortedIndex=vg,p.sortedIndexBy=_g,p.sortedIndexOf=mg,p.sortedLastIndex=wg,p.sortedLastIndexBy=bg,p.sortedLastIndexOf=Eg,p.startCase=sv,p.startsWith=av,p.subtract=Xv,p.sum=Zv,p.sumBy=e1,p.template=ov,p.times=jv,p.toFinite=Xr,p.toInteger=ye,p.toLength=wh,p.toLower=cv,p.toNumber=xr,p.toSafeInteger=c0,p.toString=qe,p.toUpper=uv,p.trim=hv,p.trimEnd=lv,p.trimStart=fv,p.truncate=pv,p.unescape=dv,p.uniqueId=Mv,p.upperCase=gv,p.upperFirst=qo,p.each=ah,p.eachRight=oh,p.first=rh,Mo(p,function(){var e={};return qr(p,function(r,s){Le.call(p.prototype,s)||(e[s]=r)}),e}(),{chain:!1}),p.VERSION=n,vr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),vr(["drop","take"],function(e,r){Se.prototype[e]=function(s){s=s===t?1:qt(ye(s),0);var u=this.__filtered__&&!r?new Se(this):this.clone();return u.__filtered__?u.__takeCount__=Kt(s,u.__takeCount__):u.__views__.push({size:Kt(s,B),type:e+(u.__dir__<0?"Right":"")}),u},Se.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),vr(["filter","map","takeWhile"],function(e,r){var s=r+1,u=s==C||s==Me;Se.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ie(l,3),type:s}),d.__filtered__=d.__filtered__||u,d}}),vr(["head","last"],function(e,r){var s="take"+(r?"Right":"");Se.prototype[e]=function(){return this[s](1).value()[0]}}),vr(["initial","tail"],function(e,r){var s="drop"+(r?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[s](1)}}),Se.prototype.compact=function(){return this.filter(ar)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=we(function(e,r){return typeof e=="function"?new Se(this):this.map(function(s){return Sn(s,e,r)})}),Se.prototype.reject=function(e){return this.filter(Xs(ie(e)))},Se.prototype.slice=function(e,r){e=ye(e);var s=this;return s.__filtered__&&(e>0||r<0)?new Se(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),r!==t&&(r=ye(r),s=r<0?s.dropRight(-r):s.take(r-e)),s)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(B)},qr(Se.prototype,function(e,r){var s=/^(?:filter|find|map|reject)|While$/.test(r),u=/^(?:head|last)$/.test(r),l=p[u?"take"+(r=="last"?"Right":""):r],d=u||/^find/.test(r);l&&(p.prototype[r]=function(){var _=this.__wrapped__,w=u?[1]:arguments,I=_ instanceof Se,F=w[0],D=I||fe(_),M=function(xe){var Oe=l.apply(p,ai([xe],w));return u&&G?Oe[0]:Oe};D&&s&&typeof F=="function"&&F.length!=1&&(I=D=!1);var G=this.__chain__,ee=!!this.__actions__.length,ne=d&&!G,_e=I&&!ee;if(!d&&D){_=_e?_:new Se(this);var se=e.apply(_,w);return se.__actions__.push({func:Ws,args:[M],thisArg:t}),new mr(se,G)}return ne&&_e?e.apply(this,w):(se=this.thru(M),ne?u?se.value()[0]:se.value():se)})}),vr(["pop","push","shift","sort","splice","unshift"],function(e){var r=ws[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(u&&!this.__chain__){var d=this.value();return r.apply(fe(d)?d:[],l)}return this[s](function(_){return r.apply(fe(_)?_:[],l)})}}),qr(Se.prototype,function(e,r){var s=p[r];if(s){var u=s.name+"";Le.call(Xi,u)||(Xi[u]=[]),Xi[u].push({name:r,func:s})}}),Xi[Us(t,be).name]=[{name:"wrapper",func:t}],Se.prototype.clone=dp,Se.prototype.reverse=gp,Se.prototype.value=yp,p.prototype.at=Vg,p.prototype.chain=Bg,p.prototype.commit=Gg,p.prototype.next=Wg,p.prototype.plant=Qg,p.prototype.reverse=Yg,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=Xg,p.prototype.first=p.prototype.head,_n&&(p.prototype[_n]=Jg),p},Ji=Gf();mt?((mt.exports=Ji)._=Ji,Be._=Ji):Pe._=Ji}).call(Un)})(_c,_c.exports);var ME=Object.defineProperty,zE=Object.defineProperties,UE=Object.getOwnPropertyDescriptors,Ol=Object.getOwnPropertySymbols,kE=Object.prototype.hasOwnProperty,HE=Object.prototype.propertyIsEnumerable,Cl=(o,i,t)=>i in o?ME(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,na=(o,i)=>{for(var t in i||(i={}))kE.call(i,t)&&Cl(o,t,i[t]);if(Ol)for(var t of Ol(i))HE.call(i,t)&&Cl(o,t,i[t]);return o},KE=(o,i)=>zE(o,UE(i));function fn(o,i,t){var n;const a=z1(o);return((n=i.rpcMap)==null?void 0:n[a.reference])||`${LE}?chainId=${a.namespace}:${a.reference}&projectId=${t}`}function Li(o){return o.includes(":")?o.split(":")[1]:o}function Ef(o){return o.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function VE(o,i){const t=Object.keys(i.namespaces).filter(a=>a.includes(o));if(!t.length)return[];const n=[];return t.forEach(a=>{const c=i.namespaces[a].accounts;n.push(...c)}),n}function BE(o={},i={}){const t=Al(o),n=Al(i);return _c.exports.merge(t,n)}function Al(o){var i,t,n,a;const c={};if(!oa(o))return c;for(const[f,g]of Object.entries(o)){const m=kl(f)?[f]:g.chains,v=g.methods||[],P=g.events||[],L=g.rpcMap||{},T=kn(f);c[T]=KE(na(na({},c[T]),g),{chains:Ko(m,(i=c[T])==null?void 0:i.chains),methods:Ko(v,(t=c[T])==null?void 0:t.methods),events:Ko(P,(n=c[T])==null?void 0:n.events),rpcMap:na(na({},L),(a=c[T])==null?void 0:a.rpcMap)})}return c}function GE(o){return o.includes(":")?o.split(":")[2]:o}function WE(o){const i={};for(const[t,n]of Object.entries(o)){const a=n.methods||[],c=n.events||[],f=n.accounts||[],g=kl(t)?[t]:n.chains?n.chains:Ef(n.accounts);i[t]={chains:g,methods:a,events:c,accounts:f}}return i}function tc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const xf={},Et=o=>xf[o],rc=(o,i)=>{xf[o]=i};class JE{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Li(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||fn(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new _i(new qi(n,Et("disableProviderPing")))}}class QE{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(parseInt(i),t),this.chainId=parseInt(i),this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,t){const n=t||fn(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new _i(new qi(n,Et("disableProviderPing")))}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=parseInt(Li(t));i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}async handleSwitchChain(i){var t,n;let a=i.request.params?(t=i.request.params[0])==null?void 0:t.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const c=parseInt(a,16);if(this.isChainApproved(c))this.setDefaultChain(`${c}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${c}`);else throw new Error(`Failed to switch to chain 'eip155:${c}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class YE{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Li(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||fn(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new _i(new qi(n,Et("disableProviderPing")))}}class XE{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Li(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||fn(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new _i(new qi(n,Et("disableProviderPing")))}}class ZE{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{const n=this.getCardanoRPCUrl(t),a=Li(t);i[a]=this.createHttpProvider(a,n)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}getCardanoRPCUrl(i){const t=this.namespace.rpcMap;if(t)return t[i]}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||this.getCardanoRPCUrl(i);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new _i(new qi(n,Et("disableProviderPing")))}}class ex{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Li(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||fn(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new _i(new qi(n,Et("disableProviderPing")))}}class tx{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=Et("events"),this.client=Et("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){this.httpProviders[i]||this.setHttpProvider(i,t),this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=Li(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||fn(i,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);return new _i(new qi(n,Et("disableProviderPing")))}}var rx=Object.defineProperty,ix=Object.defineProperties,nx=Object.getOwnPropertyDescriptors,Tl=Object.getOwnPropertySymbols,sx=Object.prototype.hasOwnProperty,ax=Object.prototype.propertyIsEnumerable,Rl=(o,i,t)=>i in o?rx(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,sa=(o,i)=>{for(var t in i||(i={}))sx.call(i,t)&&Rl(o,t,i[t]);if(Tl)for(var t of Tl(i))ax.call(i,t)&&Rl(o,t,i[t]);return o},ic=(o,i)=>ix(o,nx(i));class Nc{constructor(i){this.events=new Ec,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Sl})),this.disableProviderPing=(i==null?void 0:i.disableProviderPing)||!1}static async init(i){const t=new Nc(i);return await t.initialize(),t}async request(i,t){const[n,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:sa({},i),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(i,t,n){this.request(i,n).then(a=>t(null,a)).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:er("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}removeListener(i,t){this.events.removeListener(i,t)}off(i,t){this.events.off(i,t)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(c=>{this.session=c,this.namespaces||(this.namespaces=WE(c.namespaces),this.persist("namespaces",this.namespaces))}).catch(c=>{if(c.message!==wf)throw c;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,t){try{if(!this.session)return;const[n,a]=this.validateChain(i);this.getProvider(n).setDefaultChain(a,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(hn(t)){for(const n of t)i.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await FE.init({logger:this.providerOpts.logger||Sl,relayUrl:this.providerOpts.relayUrl||DE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(t=>kn(t)))];rc("client",this.client),rc("events",this.events),rc("disableProviderPing",this.disableProviderPing),i.forEach(t=>{if(!this.session)return;const n=VE(t,this.session),a=Ef(n),c=BE(this.namespaces,this.optionalNamespaces),f=ic(sa({},c[t]),{accounts:n,chains:a});switch(t){case"eip155":this.rpcProviders[t]=new QE({namespace:f});break;case"solana":this.rpcProviders[t]=new YE({namespace:f});break;case"cosmos":this.rpcProviders[t]=new XE({namespace:f});break;case"polkadot":this.rpcProviders[t]=new JE({namespace:f});break;case"cip34":this.rpcProviders[t]=new ZE({namespace:f});break;case"elrond":this.rpcProviders[t]=new ex({namespace:f});break;case"multiversx":this.rpcProviders[t]=new tx({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:t}=i,{event:n}=t;if(n.name==="accountsChanged"){const a=n.data;a&&hn(a)&&this.events.emit("accountsChanged",a.map(GE))}else if(n.name==="chainChanged"){const a=t.chainId,c=t.event.data,f=kn(a),g=tc(a)!==tc(c)?`${f}:${tc(c)}`:a;this.onChainChanged(g)}else this.events.emit(n.name,n.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:t})=>{var n;const{namespaces:a}=t,c=(n=this.client)==null?void 0:n.session.get(i);this.session=ic(sa({},c),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:t})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",ic(sa({},er("USER_DISCONNECTED")),{data:i.topic}))}),this.on(mi.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var t;this.getProvider(i).updateNamespace((t=this.session)==null?void 0:t.namespaces[i])})}setNamespaces(i){const{namespaces:t,optionalNamespaces:n,sessionProperties:a}=i;t&&Object.keys(t).length&&(this.namespaces=t),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",t),this.persist("optionalNamespaces",n)}validateChain(i){const[t,n]=(i==null?void 0:i.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(f=>kn(f)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];const a=kn(Object.keys(this.namespaces)[0]),c=this.rpcProviders[a].getDefaultChain();return[a,c]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,t=!1){var n;if(!this.namespaces)return;const[a,c]=this.validateChain(i);t||this.getProvider(a).setDefaultChain(c),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${c}`]).defaultChain=c,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",c)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,t){this.client.core.storage.setItem(`${Pl}/${i}`,t)}async getFromStore(i){return await this.client.core.storage.getItem(`${Pl}/${i}`)}}const ox=Nc,cx="wc",ux="ethereum_provider",hx=`${cx}@2:${ux}:`,lx="https://rpc.walletconnect.com/v1/",mc=["eth_sendTransaction","personal_sign"],fx=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],wc=["chainChanged","accountsChanged"],px=["chainChanged","accountsChanged","message","disconnect","connect"];var dx=Object.defineProperty,gx=Object.defineProperties,yx=Object.getOwnPropertyDescriptors,Nl=Object.getOwnPropertySymbols,vx=Object.prototype.hasOwnProperty,_x=Object.prototype.propertyIsEnumerable,$l=(o,i,t)=>i in o?dx(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Kn=(o,i)=>{for(var t in i||(i={}))vx.call(i,t)&&$l(o,t,i[t]);if(Nl)for(var t of Nl(i))_x.call(i,t)&&$l(o,t,i[t]);return o},Fl=(o,i)=>gx(o,yx(i));function la(o){return Number(o[0].split(":")[1])}function nc(o){return`0x${o.toString(16)}`}function mx(o){const{chains:i,optionalChains:t,methods:n,optionalMethods:a,events:c,optionalEvents:f,rpcMap:g}=o;if(!hn(i))throw new Error("Invalid chains");const m={chains:i,methods:n||mc,events:c||wc,rpcMap:Kn({},i.length?{[la(i)]:g[la(i)]}:{})},v=c==null?void 0:c.filter(U=>!wc.includes(U)),P=n==null?void 0:n.filter(U=>!mc.includes(U));if(!t&&!f&&!a&&!(v!=null&&v.length)&&!(P!=null&&P.length))return{required:i.length?m:void 0};const L=(v==null?void 0:v.length)&&(P==null?void 0:P.length)||!t,T={chains:[...new Set(L?m.chains.concat(t||[]):t)],methods:[...new Set(m.methods.concat(a!=null&&a.length?a:fx))],events:[...new Set(m.events.concat(f!=null&&f.length?f:px))],rpcMap:g};return{required:i.length?m:void 0,optional:t.length?T:void 0}}class $c{constructor(){this.events=new Ur.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=hx,this.on=(i,t)=>(this.events.on(i,t),this),this.once=(i,t)=>(this.events.once(i,t),this),this.removeListener=(i,t)=>(this.events.removeListener(i,t),this),this.off=(i,t)=>(this.events.off(i,t),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const t=new $c;return await t.initialize(i),t}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,t){this.signer.sendAsync(i,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:t,optional:n}=mx(this.rpc);try{const a=await new Promise(async(f,g)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(v=>{!v.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Fl(Kn({namespaces:Kn({},t&&{[this.namespace]:t})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:i==null?void 0:i.pairingTopic})).then(v=>{f(v)}).catch(v=>{g(new Error(v.message))})});if(!a)return;const c=U1(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:c),this.setAccounts(c),this.events.emit("connect",{chainId:nc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:t}=i,{event:n}=t;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const t=parseInt(i);this.chainId=t,this.events.emit("chainChanged",nc(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",Fl(Kn({},er("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var t,n;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(n=this.modal)==null||n.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const t=i.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",nc(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const t=this.parseChainId(i);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(i){const[t,n,a]=i.split(":");return{chainId:`${t}:${n}`,address:a}}setAccounts(i){this.accounts=i.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var t,n;const a=(t=i==null?void 0:i.chains)!=null?t:[],c=(n=i==null?void 0:i.optionalChains)!=null?n:[],f=a.concat(c);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?(i==null?void 0:i.methods)||mc:[],m=a.length?(i==null?void 0:i.events)||wc:[],v=(i==null?void 0:i.optionalMethods)||[],P=(i==null?void 0:i.optionalEvents)||[],L=(i==null?void 0:i.rpcMap)||this.buildRpcMap(f,i.projectId),T=(i==null?void 0:i.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(U=>this.formatChainId(U)),optionalChains:c.map(U=>this.formatChainId(U)),methods:g,events:m,optionalMethods:v,optionalEvents:P,rpcMap:L,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:T,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,t){const n={};return i.forEach(a=>{n[a]=this.getRpcUrl(a,t)}),n}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?la(this.rpc.chains):la(this.rpc.optionalChains),this.signer=await ox.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:n}=await k1(()=>import("./index-926756d6.js").then(a=>a.i),["assets/index-926756d6.js","assets/index-9fd9e1d6.js","assets/index-882a2daf.css"]);t=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(Kn({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:t,optionalChains:n,rpcMap:a}=i;t&&hn(t)&&(this.rpc.chains=t.map(c=>this.formatChainId(c)),t.forEach(c=>{this.rpc.rpcMap[c]=(a==null?void 0:a[c])||this.getRpcUrl(c)})),n&&hn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(c=>this.formatChainId(c)),n.forEach(c=>{this.rpc.rpcMap[c]=(a==null?void 0:a[c])||this.getRpcUrl(c)}))}getRpcUrl(i,t){var n;return((n=this.rpc.rpcMap)==null?void 0:n[i])||`${lx}?chainId=eip155:${i}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(t=>this.parseAccount(t))}}const Nx=$c;export{Nx as EthereumProvider,px as OPTIONAL_EVENTS,fx as OPTIONAL_METHODS,wc as REQUIRED_EVENTS,mc as REQUIRED_METHODS,$c as default};
